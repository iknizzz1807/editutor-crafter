direction: down

start: Start {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
}

restart: Coordinator Restarts {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

read_log: Read Write-Ahead Log {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

check_tx: For Each Transaction in Log {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

decision_logged: Decision Logged? {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

check_decision: Decision = COMMIT? {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

send_abort: Send ABORT to All Participants {
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
  style.bold: true
}

check_ack: All ACKs Received? {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

resend_commit: Resend COMMIT to Unacknowledged Participants {
  style.fill: "#00b894"
  style.stroke: "#55efc4"
  style.font-color: "#ffffff"
  style.bold: true
}

complete: Mark Transaction Complete {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

more_tx: More Transactions? {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

end: Recovery Complete {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
  style.double-border: true
}

start -> restart
restart -> read_log
read_log -> check_tx
check_tx -> decision_logged

decision_logged -> send_abort: No\n(Incomplete)
decision_logged -> check_decision: Yes

check_decision -> send_abort: ABORT
check_decision -> check_ack: COMMIT

send_abort -> complete
check_ack -> complete: Yes
check_ack -> resend_commit: No

resend_commit -> complete

complete -> more_tx
more_tx -> check_tx: Yes
more_tx -> end: No