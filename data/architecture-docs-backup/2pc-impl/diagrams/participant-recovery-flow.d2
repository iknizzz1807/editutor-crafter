direction: down

start: START {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
}

crash: Participant Crashes {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

restart: Restart Process {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

readLog: Read Local Log {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

logState: Check Log State {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

committed: COMMITTED Found {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

aborted: ABORTED Found {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

prepared: PREPARED Found {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

empty: No Log Entry {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

applyCommit: Apply Transaction {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

rollback: Rollback Changes {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

queryCoord: Query Coordinator\nfor Decision {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

coordReachable: Coordinator\nReachable? {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

receiveDecision: Receive Decision\n(COMMIT/ABORT) {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

isCommit: Decision = COMMIT? {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

blocked: Enter BLOCKED State\n(Hold Locks) {
  shape: rectangle
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
  style.bold: true
}

waitRetry: Wait and Retry\nCoordinator Query {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

cleanup: Cleanup and\nRelease Locks {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

end: END {
  shape: circle
  style.fill: "#8b949e"
  style.stroke: "#8b949e"
  style.multiple: true
}

start -> crash
crash -> restart
restart -> readLog
readLog -> logState

logState -> committed: COMMITTED
logState -> aborted: ABORTED
logState -> prepared: PREPARED
logState -> empty: EMPTY

committed -> applyCommit
applyCommit -> cleanup
cleanup -> end

aborted -> rollback
rollback -> cleanup

empty -> cleanup

prepared -> queryCoord
queryCoord -> coordReachable

coordReachable -> receiveDecision: YES
coordReachable -> blocked: NO

receiveDecision -> isCommit
isCommit -> applyCommit: YES
isCommit -> rollback: NO

blocked -> waitRetry
waitRetry -> queryCoord