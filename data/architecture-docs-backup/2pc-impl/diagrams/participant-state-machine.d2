direction: down

classes: {
  state: {
    shape: oval
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.stroke-width: 2
  }
  
  initial: {
    shape: circle
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    width: 20
    height: 20
  }
  
  final: {
    shape: circle
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.stroke-width: 4
    style.double-border: true
  }
  
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

start.class: initial

INIT: INIT {
  class: state
}

PREPARED: PREPARED {
  class: state
  style.stroke: "#f39c12"
  style.bold: true
}

COMMITTED: COMMITTED {
  class: state
  style.stroke: "#27ae60"
}

ABORTED: ABORTED {
  class: state
  style.stroke: "#e74c3c"
}

start -> INIT: {
  class: transition
}

INIT -> PREPARED: ReceivePrepare\nAcquire Locks {
  class: transition
}

PREPARED -> PREPARED: SendVote\n(YES or NO) {
  class: transition
}

PREPARED -> COMMITTED: ReceiveCommit\nApply Changes {
  class: transition
  style.stroke: "#27ae60"
}

PREPARED -> ABORTED: ReceiveAbort\nRelease Locks {
  class: transition
  style.stroke: "#e74c3c"
}

PREPARED -> ABORTED: Timeout\nNo Decision {
  class: transition
  style.stroke: "#e74c3c"
  style.stroke-dash: 3
}

INIT -> ABORTED: Vote NO\nLock Failure {
  class: transition
  style.stroke: "#e74c3c"
}

ABORTED -> INIT: Recovery\nRestart {
  class: transition
  style.stroke-dash: 3
}

COMMITTED -> INIT: Recovery\nRestart {
  class: transition
  style.stroke-dash: 3
}

PREPARED -> INIT: Recovery\nQuery Coordinator {
  class: transition
  style.stroke: "#f39c12"
  style.stroke-dash: 3
}

note: |md
  **Uncertainty Window**: PREPARED state
  Participant has voted YES and must wait
  for coordinator's decision
| {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#f39c12"
  style.font-color: "#e6edf3"
}

note -> PREPARED: {
  style.stroke-dash: 3
  style.stroke: "#f39c12"
}