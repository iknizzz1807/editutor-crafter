shape: sequence_diagram

gateway: API Gateway {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#3fb950"
}

fraud: Fraud Detection {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#3fb950"
}

targeting: Targeting Engine {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#3fb950"
}

auction: Auction Engine {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#3fb950"
  style.bold: true
}

budget: Budget Service {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#3fb950"
}

response: Response Generator {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#3fb950"
}

gateway -> fraud: Bid Request (Device ID, IP, User Agent)
fraud -> gateway: Risk Score + Clean Flag
gateway -> targeting: Request + User Profile
targeting -> gateway: Qualified Campaigns List
gateway -> auction: Request + Campaigns + Risk Score
auction -> budget: Check Campaign Budgets
budget -> auction: Available Budgets
auction -> auction: Run Second-Price Auction (<5ms)
auction -> response: Winner + Clearing Price
response -> gateway: Ad Creative + Tracking URLs
gateway -> gateway: Final Response Assembly