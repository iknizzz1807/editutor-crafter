# Title: Multi-Layer Memory Architecture
direction: right

# Define classes for consistent styling
classes: {
  container_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.border-radius: 8
  }
  
  memory_style: {
    style.fill: "#16213e"
    style.stroke: "#ffd43b"
    style.font-color: "#e6edf3"
    style.bold: true
    style.stroke-width: 2
  }
  
  core_style: {
    style.fill: "#0f3460"
    style.stroke: "#ff6b6b"
    style.font-color: "#ffffff"
    style.bold: true
    style.stroke-width: 3
  }
  
  flow_style: {
    style.stroke: "#8b949e"
    style.stroke-width: 2
  }
  
  storage_style: {
    style.stroke: "#3fb950"
    style.stroke-dash: 3
  }
  
  retrieval_style: {
    style.stroke: "#ffd43b"
  }
}

# Memory Layers Container
memory_layers: Memory System {
  class: container_style
  
  episodic: Episodic/Conversation Memory {
    class: memory_style
    label: "Episodic/Conversation Memory\n(Short-Term)"
    description: "Stores conversation history,\nrecent events, immediate context"
  }
  
  working: Working Memory {
    class: memory_style
    label: "Working Memory\n(Active Context)"
    description: "Holds current task state,\nintermediate results, plan steps"
  }
  
  longterm: Long-Term Memory {
    class: memory_style
    label: "Long-Term Memory\n(Persistent Storage)"
    description: "Archives completed tasks,\nlearned patterns, vector embeddings"
  }
}

# Agent Core
agent_core: Agent Core {
  class: core_style
  shape: circle
  width: 160
  height: 160
  label: |md
  **Agent Core**
  - Planner
  - ReAct Loop
  - Tool System
  - Orchestrator
  |
}

# Arrange memory layers vertically
episodic.near: top-left
working.near: center-left  
longterm.near: bottom-left
agent_core.near: center-right

# Storage flows (from Agent Core to Memory)
agent_core -> episodic: store {
  class: storage_style
  label: "Store\nConversation History"
  source-arrowhead: none
}

agent_core -> working: store {
  class: storage_style
  label: "Store\nTask State"
  source-arrowhead: none
}

agent_core -> longterm: store {
  class: storage_style
  label: "Archive\nCompleted Tasks"
  source-arrowhead: none
}

# Retrieval flows (from Memory to Agent Core)
episodic -> agent_core: retrieve {
  class: retrieval_style
  label: "Retrieve\nContext"
  target-arrowhead: none
}

working -> agent_core: retrieve {
  class: retrieval_style
  label: "Retrieve\nActive State"
  target-arrowhead: none
}

longterm -> agent_core: retrieve {
  class: retrieval_style
  label: "Search\n& Recall"
  target-arrowhead: none
}

# Add legend/note
note: |md
## Memory Layer Functions

**Episodic/Conversation Memory**
- Short-term storage
- Conversation history
- Recent tool outputs
- Immediate context

**Working Memory**
- Active task state
- Current plan steps
- Intermediate results
- Tool execution context

**Long-Term Memory**
- Persistent storage
- Task archives
- Learned patterns
- Vector embeddings
| {
  shape: page
  near: bottom-right
  width: 200
}