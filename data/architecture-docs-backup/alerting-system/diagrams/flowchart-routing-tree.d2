# Title: Flowchart: Routing Tree Walk
direction: right

classes: {
  node_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision_style: {
    style.fill: "#0f3460"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    shape: diamond
  }
  action_style: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

start: Start at root route {
  class: node_style
  style.font-size: 20
}

evaluate_matchers: Evaluate route matchers against alert {
  class: decision_style
}

match_decision: Matchers match? {
  class: decision_style
}

has_receiver: Route has receiver? {
  class: decision_style
}

check_rate_limit: Apply rate limiting to receiver {
  class: action_style
}

send_to_receiver: Send notification to route's receiver {
  class: action_style
  style.bold: true
  style.fill: "#2ecc71"
  style.stroke: "#27ae60"
}

check_continue: Check continue flag {
  class: decision_style
}

continue_to_children: Continue to child routes {
  class: action_style
}

check_children: Route has children? {
  class: decision_style
}

process_child: Process next child route (recursive) {
  class: action_style
}

end: End of tree walk {
  class: node_style
  style.font-size: 20
}

# Flow connections
start -> evaluate_matchers
evaluate_matchers -> match_decision

match_decision -> has_receiver: Yes
match_decision -> check_children: No

has_receiver -> check_rate_limit: Yes
has_receiver -> check_continue: No

check_rate_limit -> send_to_receiver: Within limit
check_rate_limit -> check_continue: Rate limited

send_to_receiver -> check_continue

check_continue -> continue_to_children: Continue = true
check_continue -> end: Continue = false

continue_to_children -> check_children

check_children -> process_child: Yes
check_children -> end: No

process_child -> evaluate_matchers: Recursive call