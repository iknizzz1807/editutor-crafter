shape: sequence_diagram
title: Sequence Diagram: Request Flow Through Pipeline

# Define participants in order of processing
Client
Ingress: Gateway Ingress
Auth: Authentication
RateLimit: Rate Limiting
Router: Routing & Transformation
Egress: Gateway Egress
Backend: Upstream Backend

# Main request flow (forward direction)
Client -> Ingress: HTTP Request
Ingress -> Auth: Forward Request
Auth -> RateLimit: Pass (auth valid)
RateLimit -> Router: Pass (within limits)
note: Router determines upstream target\nand applies request transformations
Router -> Egress: Forward Transformed Request
Egress -> Backend: Send to Upstream

# Backend processing
Backend -> Backend: Process Request

# Response flow (reverse direction)
Backend -> Egress: Backend Response
Egress -> Router: Return Response
note: Router may apply\nresponse transformations
Router -> RateLimit: Pass Response (observability)
RateLimit -> Auth: Pass Response (observability)
Auth -> Ingress: Pass Response
Ingress -> Client: Final HTTP Response

# Error scenario branch (rate limit exceeded)
Client -> Ingress: Another Request
Ingress -> Auth: Forward Request
Auth -> RateLimit: Pass (auth valid)
RateLimit -> Client: 429 Too Many Requests {
  style.stroke: "#ff6b6b"
  style.stroke-width: 2
}

# Error scenario branch (authentication failed)
Client -> Ingress: Unauthenticated Request
Ingress -> Auth: Forward Request
Auth -> Client: 401 Unauthorized {
  style.stroke: "#ff6b6b"
  style.stroke-width: 2
}