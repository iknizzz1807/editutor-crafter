shape: sequence_diagram
title: Performance Analytics and Alerting

# Participants
aggregator: Aggregator {
  label: "Aggregator\n(Stats Engine)"
  class: participant_style
}
tdigest: TDigest {
  label: "TDigest\n(Rolling Distribution)"
  class: component_style
}
baseline_calc: BaselineCalculator {
  label: "Baseline\nCalculator"
  class: component_style
}
tsdb: TSDB {
  label: "Time Series DB\n(Baseline Storage)"
  class: storage_style
}
alert_engine: AlertEngine {
  label: "Alert Engine"
  class: alert_style
}

# Styling classes
classes: {
  participant_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  component_style: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  storage_style: {
    shape: cylinder
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  alert_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#ff7b72"
    style.font-color: "#ff7b72"
    style.bold: true
  }
}

# Sequence flow
aggregator -> aggregator: "1. Receive span with latency"
aggregator -> tdigest: "2. Update distribution"
aggregator -> baseline_calc: "3. Calculate current p95"
baseline_calc -> tsdb: "4. Fetch historical baseline"
tsdb -> baseline_calc: "Return baseline p95 & thresholds"
baseline_calc -> baseline_calc: "5. Compare current vs baseline"
baseline_calc -> alert_engine: "Anomaly detected!"
alert_engine -> aggregator: "Acknowledgment"