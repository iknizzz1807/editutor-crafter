title: Error Recovery Flowchart
desc: Flowchart showing panic mode recovery: detect error → report → discard tokens until synchronization point → resume parsing. Shows different synchronization points for different contexts.

classes: {
  action_node: {
    shape: rectangle
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  decision_node: {
    shape: diamond
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  sync_point: {
    shape: hexagon
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  error_flow: {
    style.stroke: "#ff7b72"
    style.stroke-dash: 3
  }
  recovery_flow: {
    style.stroke: "#3fb950"
    style.bold: true
  }
}

start: Parse Tokens {
  class: action_node
}

error_detected: Syntax Error Detected {
  class: decision_node
}

report_error: Report Error {
  class: action_node
  label: |md
    **Report Error**
    - Location (file, line, column)
    - Expected token
    - Actual token
  |
}

panic_mode: Enter Panic Mode {
  class: action_node
  style.fill: "#2d0f0f"
  style.stroke: "#ff7b72"
  style.font-color: "#ffa198"
}

discard_tokens: Discard Tokens {
  class: action_node
}

resync_check: Find Synchronization Point {
  class: decision_node
}

context: Current Context {
  class: decision_node
}

in_statement: Statement Context {
  class: sync_point
  label: |md
    **Statement Boundary**
    - Semicolon (`;`)
    - Closing brace (`}`)
    - `end` keyword
  |
}

in_expression: Expression Context {
  class: sync_point
  label: |md
    **Expression Boundary**
    - Comma (`,`)
    - Closing parenthesis (`)`)
    - Operator token
  |
}

in_declaration: Declaration Context {
  class: sync_point
  label: |md
    **Declaration Boundary**
    - Semicolon (`;`)
    - Closing brace (`}`)
    - Next top-level keyword
  |
}

resume_parsing: Resume Parsing {
  class: action_node
  style.fill: "#0f2a0f"
  style.stroke: "#3fb950"
  style.font-color: "#7ee787"
}

continue_normal: Continue Normal Parsing {
  class: action_node
}

# Main flow
start -> error_detected: Next token
error_detected -> continue_normal: No
error_detected -> report_error: Yes { class: error_flow }
report_error -> panic_mode { class: error_flow }
panic_mode -> discard_tokens { class: error_flow }
discard_tokens -> resync_check { class: error_flow }

# Synchronization point selection
resync_check -> context { class: recovery_flow }
context -> in_statement: Statement { class: recovery_flow }
context -> in_expression: Expression { class: recovery_flow }
context -> in_declaration: Declaration { class: recovery_flow }

# Resume from synchronization points
in_statement -> resume_parsing: Reached { class: recovery_flow }
in_expression -> resume_parsing: Reached { class: recovery_flow }
in_declaration -> resume_parsing: Reached { class: recovery_flow }

# Return to normal flow
resume_parsing -> continue_normal { class: recovery_flow }
continue_normal -> error_detected: Next token