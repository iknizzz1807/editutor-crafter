title: If-Statement Parsing Flowchart

flowchart: {
  direction: down
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.stroke-width: 2

  start: "Start parsing if-statement" {
    shape: oval
    style.fill: "#16213e"
    style.font-color: "#e6edf3"
    style.stroke: "#3fb950"
  }

  check_if_token: "Check for 'if' token" {
    shape: diamond
    style.fill: "#1a1a2e"
    style.font-color: "#e6edf3"
    style.stroke: "#3fb950"
  }

  parse_condition: "Parse condition expression (in parentheses)" {
    shape: rectangle
    style.fill: "#1a1a2e"
    style.font-color: "#e6edf3"
    style.stroke: "#3fb950"
  }

  parse_then_branch: "Parse then-branch statement" {
    shape: rectangle
    style.fill: "#1a1a2e"
    style.font-color: "#e6edf3"
    style.stroke: "#3fb950"
  }

  check_else_token: "Look ahead for 'else' token" {
    shape: diamond
    style.fill: "#1a1a2e"
    style.font-color: "#e6edf3"
    style.stroke: "#3fb950"
  }

  parse_else_branch: "Parse else-branch statement" {
    shape: rectangle
    style.fill: "#1a1a2e"
    style.font-color: "#e6edf3"
    style.stroke: "#3fb950"
  }

  end: "If-statement parsing complete" {
    shape: oval
    style.fill: "#16213e"
    style.font-color: "#e6edf3"
    style.stroke: "#3fb950"
  }

  missing_if_error: "Error: Expected 'if' token" {
    shape: rectangle
    style.fill: "#ff6b6b"
    style.font-color: "#ffffff"
    style.stroke: "#c92a2a"
    style.bold: true
  }

  dangling_else_note: {
    shape: page
    style.fill: "#1a1a2e"
    style.font-color: "#8b949e"
    style.stroke: "#3fb950"
    label: |md
      **Dangling Else Resolution**
      In ambiguous cases (nested ifs),
      the parser uses the **nearest-if rule**:
      else binds to the closest unmatched if.
      This is typically enforced by the grammar design.
    |
  }

  start -> check_if_token
  check_if_token -> parse_condition: "Found 'if' token"
  check_if_token -> missing_if_error: "No 'if' token"
  parse_condition -> parse_then_branch
  parse_then_branch -> check_else_token
  check_else_token -> parse_else_branch: "Found 'else'"
  check_else_token -> end: "No 'else'"
  parse_else_branch -> end
}