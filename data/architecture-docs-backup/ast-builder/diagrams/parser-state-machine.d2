title: Parser State Machine
desc: Shows parser state transitions: Normal → Error → Recovery → Normal. Includes events that trigger transitions (unexpected token, synchronization point reached).

# Initial state marker
init: {
  shape: circle
  style.fill: "#3fb950"
  label: ""
}

# States
Normal: {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  style.stroke-width: 3
}

Error: {
  style.fill: "#1a1a2e"
  style.stroke: "#d63031"
  style.font-color: "#e6edf3"
  style.bold: true
  style.stroke-width: 3
}

Recovery: {
  style.fill: "#1a1a2e"
  style.stroke: "#f39c12"
  style.font-color: "#e6edf3"
  style.bold: true
  style.stroke-width: 3
}

# State transitions
init -> Normal: "Begin Parsing"

Normal -> Error: "Unexpected Token\n(missing semicolon, unmatched paren, etc.)"
Error.label: Collects error details\n(location, expected token)

Error -> Recovery: "Enter Panic Mode\n(skip tokens until safe point)"
Recovery.label: Seeks synchronization point\n(statement boundary, keyword, etc.)

Recovery -> Normal: "Synchronization Point Reached\n(safe to resume parsing)"

# Self-transition for normal parsing
Normal -> Normal: "Valid Token Processed" {
  style.stroke-dash: 3
}

# Error handler behavior
note: |md
  **Error Handler Behavior (Spell Checker Analogy):**
  - Flags individual errors without halting
  - Collects multiple errors in single pass
  - Prevents cascading false positives
  - Provides context-aware error messages
| {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  near: bottom-right
  width: 300
}