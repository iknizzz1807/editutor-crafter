shape: sequence_diagram
title: Hash Chain Construction Sequence

client: Client
ingestor: Ingestor {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}
storage: Storage Engine {
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}
wal: WAL {
  shape: page
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

client -> ingestor: 1. Append Event (payload, timestamp)
ingestor -> ingestor: 2. Validate Schema & Signature
ingestor -> storage: 3. Read Previous Hash
storage -> ingestor: Previous Hash (or null for genesis)
ingestor -> ingestor: 4. Compute New Hash\nH(new) = H(prev_hash || event_data)
ingestor -> wal: "5. Append Entry\n(index, prev_hash, new_hash, event_data, timestamp)"
wal -> ingestor: Write Confirmed
ingestor -> client: "6. Acknowledgment\n(index, new_hash, timestamp)"