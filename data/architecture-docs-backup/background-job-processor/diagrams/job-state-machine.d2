classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  final_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
    style.double-border: true
  }
  error_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#e17055"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  error_final: {
    style.fill: "#1a1a2e"
    style.stroke: "#e17055"
    style.font-color: "#e6edf3"
    style.bold: true
    style.double-border: true
  }
}

title: Job State Machine

init: {
  shape: circle
  style.fill: "#3fb950"
  label: ""
}

init -> Pending: Job Enqueued

Pending: Pending {
  class: state
}

Active: Active {
  class: state
}

Completed: Completed {
  class: final_state
}

Failed: Failed {
  class: error_state
}

RetryScheduled: RetryScheduled {
  class: state
}

DeadLetter: DeadLetter {
  class: error_final
}

Pending -> Active: Worker Picks Up Job
Active -> Completed: Success
Active -> Failed: Failure

Failed -> RetryScheduled: Schedule Retry
RetryScheduled -> Active: Retry Attempt

# Retry loop (from Failed back to Failed)
Failed -> Failed: Retry Loop (Attempts Remain) {
  style.stroke: "#e17055"
}

# Final transition to DLQ when retries exhausted
Failed -> DeadLetter: Max Retries Exhausted {
  style.stroke: "#e17055"
}

# Manual intervention: retry from DLQ
DeadLetter -> Active: Manual Retry From DLQ {
  style.stroke-dash: 3
  style.stroke: "#3fb950"
}