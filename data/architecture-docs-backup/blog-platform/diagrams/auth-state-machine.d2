title: User Authentication State Machine

direction: right

classes: {
  state: {
    shape: rectangle
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  transition: {
    style.font-color: "#8b949e"
    style.stroke: "#8b949e"
  }
  initial: {
    shape: circle
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    label: ""
    width: 16
    height: 16
  }
  important: {
    style.stroke: "#3fb950"
    style.stroke-width: 3
  }
}

# Initial state marker
init: { class: initial }

# States
Unauthenticated: {
  class: state
  label: "Unauthenticated\n(User not logged in)"
}

LoggingIn: {
  class: state
  label: "Logging In\n(Validating credentials)"
}

Authenticated: {
  class: state
  label: "Authenticated\n(Valid session)"
}

TokenRefresh: {
  class: state
  label: "Token Refresh\n(Renewing access token)"
}

LoggedOut: {
  class: [state; important]
  label: "Logged Out\n(Session terminated)"
}

# Transitions
init -> Unauthenticated

Unauthenticated -> LoggingIn: "submit credentials" { class: transition }
LoggingIn -> Authenticated: "authentication success" { class: transition }
LoggingIn -> Unauthenticated: "authentication failure" { class: transition }

Authenticated -> TokenRefresh: "token expiry detected" { class: transition }
Authenticated -> LoggedOut: "logout action" { class: [transition; important] }

TokenRefresh -> Authenticated: "refresh success" { class: transition }
TokenRefresh -> LoggedOut: "refresh failure" { class: [transition; important] }

LoggedOut -> Unauthenticated: "return to login" { class: transition }