title: API Error Handling Flowchart
desc: Flowchart for error processing in middleware: Request → Validate Input → Authenticate → Authorize → Process → Catch Errors → Format Response → Send HTTP Status

classes: {
  start_end: {
    shape: oval
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  process: {
    shape: rectangle
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    shape: diamond
    style.fill: "#1a1a2e"
    style.stroke: "#ff7b72"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  error: {
    shape: rectangle
    style.fill: "#490202"
    style.stroke: "#ff7b72"
    style.font-color: "#ff7b72"
    style.bold: true
  }
  success: {
    shape: rectangle
    style.fill: "#0d2c0a"
    style.stroke: "#3fb950"
    style.font-color: "#3fb950"
    style.bold: true
  }
}

start: Request Received {
  class: start_end
}

validate: Validate Input {
  class: process
}

authenticate: Authenticate User {
  class: process
}

authorize: Authorize Request {
  class: process
}

process: Process Business Logic {
  class: process
}

error_check: Errors Occurred? {
  class: decision
}

format_error: Format Error Response {
  class: error
}

format_success: Format Success Response {
  class: success
}

send_response: Send HTTP Response {
  class: process
}

end: Request Complete {
  class: start_end
}

note: |md
  ## HTTP Status Codes
  **400**: Invalid Input
  **401**: Authentication Failed
  **403**: Authorization Failed
  **500**: Server Error
  **200/201**: Success
| {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  near: top-right
}

start -> validate: Validate JSON, Required Fields
validate -> authenticate: Input Valid
validate -> format_error: "Invalid Input (400 Bad Request)"
authenticate -> authorize: Credentials Valid
authenticate -> format_error: "Invalid Credentials (401 Unauthorized)"
authorize -> process: Permissions Granted
authorize -> format_error: "Insufficient Permissions (403 Forbidden)"
process -> error_check: Execute Business Logic
error_check -> format_error: "Yes (500 Server Error)"
error_check -> format_success: "No (200/201 Success)"
format_error -> send_response: Set Status, Error Message
format_success -> send_response: Set Status, Response Data
send_response -> end: Send to Client