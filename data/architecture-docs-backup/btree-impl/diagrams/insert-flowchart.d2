title: Insertion with Splitting Algorithm

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    shape: diamond
    style.fill: "#16213e"
    style.stroke: "#f0db4f"
    style.font-color: "#e6edf3"
  }
  start_end: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  highlight: {
    style.stroke: "#f0db4f"
    style.stroke-width: 3
    style.bold: true
  }
}

flowchart: {
  orientation: vertical
  
  start: "Start Insertion" {
    shape: oval
    class: start_end
  }
  
  check_root_full: "Is root full?\n(has 2t-1 keys?)" {
    class: decision
  }
  
  split_root: "Split root" {
    class: process
  }
  
  create_new_root: "Create new root with\nmiddle key and 2 children" {
    class: process
  }
  
  set_current: "Set current node = root" {
    class: process
  }
  
  is_leaf: "Is current node a leaf?" {
    class: decision
  }
  
  find_child: "Find child index i\nwhere key should go" {
    class: process
  }
  
  check_child_full: "Is child i full?\n(has 2t-1 keys?)" {
    class: decision
  }
  
  split_child: "Split child i" {
    class: process
  }
  
  update_current: "Insert middle key from child\ninto current node at position i" {
    class: process
  }
  
  adjust_index: "If key > middle key,\nincrement i" {
    class: process
  }
  
  descend: "Set current node = child i" {
    class: process
  }
  
  leaf_insert: "Insert key into leaf node\nin correct sorted position" {
    class: process
    class: highlight
  }
  
  end: "Insertion Complete" {
    shape: oval
    class: start_end
  }
  
  special_case: "Special Case:\nRoot Split" {
    shape: page
    style.fill: "#2d3250"
    style.stroke: "#f0db4f"
    style.font-color: "#f0db4f"
    style.bold: true
  }

  # Connections
  start -> check_root_full
  
  check_root_full -> split_root: Yes
  split_root -> create_new_root
  create_new_root -> set_current
  special_case <- create_new_root: {style.stroke-dash: 2}
  
  check_root_full -> set_current: No
  set_current -> is_leaf
  
  is_leaf -> leaf_insert: Yes
  leaf_insert -> end
  
  is_leaf -> find_child: No
  find_child -> check_child_full
  
  check_child_full -> split_child: Yes
  split_child -> update_current
  update_current -> adjust_index
  adjust_index -> descend
  
  check_child_full -> descend: No
  descend -> is_leaf
  
  # Styling adjustments
  style: {
    stroke: "#8b949e"
    font-size: 16
  }
}