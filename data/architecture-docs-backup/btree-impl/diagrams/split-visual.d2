title: Node Split and Median Promotion

classes: {
  node_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  array_style: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#c9d1d9"
  }
  promotion_style: {
    style.fill: "#3fb950"
    style.stroke: "#ffffff"
    style.font-color: "#0a0a0a"
    style.bold: true
  }
}

before: Before Split {
  class: node_style
  shape: rectangle
  label: "Full Node (t=2, 5 keys, 6 children)"

  before_keys: Keys {
    shape: rectangle
    class: array_style
    label: |md
      **Key Array**
      [K1, K2, K3, K4, K5]
    |
  }

  before_children: Child Pointers {
    shape: rectangle
    class: array_style
    label: |md
      **Child Pointer Array**
      [C0, C1, C2, C3, C4, C5]
    |
  }

  before_keys -> before_children: index aligned
}

split_process: Split Process {
  shape: diamond
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  label: "Node Overflow\n(Split Required)"
}

after: After Split {
  class: node_style
  shape: rectangle
  label: "Parent Node"

  after_keys: Keys {
    shape: rectangle
    class: array_style
    label: |md
      **Key Array**
      [..., K3, ...]
    |
  }

  after_children: Child Pointers {
    shape: rectangle
    class: array_style
    label: |md
      **Child Pointer Array**
      [..., Left_Node, Right_Node, ...]
    |
  }

  after_keys -> after_children: index aligned
}

left_node: Left Node {
  class: node_style
  shape: rectangle
  label: "Left Child (t=2, 2 keys, 3 children)"

  left_keys: Keys {
    shape: rectangle
    class: array_style
    label: |md
      **Key Array**
      [K1, K2]
    |
  }

  left_children: Child Pointers {
    shape: rectangle
    class: array_style
    label: |md
      **Child Pointer Array**
      [C0, C1, C2]
    |
  }

  left_keys -> left_children: index aligned
}

right_node: Right Node {
  class: node_style
  shape: rectangle
  label: "Right Child (t=2, 2 keys, 3 children)"

  right_keys: Keys {
    shape: rectangle
    class: array_style
    label: |md
      **Key Array**
      [K4, K5]
    |
  }

  right_children: Child Pointers {
    shape: rectangle
    class: array_style
    label: |md
      **Child Pointer Array**
      [C3, C4, C5]
    |
  }

  right_keys -> right_children: index aligned
}

promoted_key: K3 {
  class: promotion_style
  shape: oval
  label: "Promoted Key (Median)"
}

# Connections
before -> split_process: "5 keys > 2t-1 (t=2)"
split_process -> promoted_key: "extract middle"
promoted_key -> after: "insert into parent"
split_process -> left_node: "first 2 keys & 3 children"
split_process -> right_node: "last 2 keys & 3 children"

# Layout
before -> after: {style.stroke-dash: 3}
left_node -> right_node: {style.stroke-dash: 3}
after -> left_node
after -> right_node