title: Multi-Peer Download Coordination {
  style.font-size: 20
  style.bold: true
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
}

piece_manager: PieceManager {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  piece_tracker: Piece Availability Tracker {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  request_scheduler: Request Scheduler {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  piece_verifier: Piece Verifier {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

shared_state: Shared State {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  availability_map: Piece Availability Map {
    shape: cylinder
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  request_queue: Global Request Queue {
    shape: queue
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  completed_pieces: Completed Pieces {
    shape: cylinder
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

peer_connections: Peer Connections {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  peer1: PeerConnection 1 {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    
    local_queue: Request Queue {
      shape: queue
      style.fill: "#1a1a2e"
      style.stroke: "#8b949e"
    }
  }
  
  peer2: PeerConnection 2 {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    
    local_queue: Request Queue {
      shape: queue
      style.fill: "#1a1a2e"
      style.stroke: "#8b949e"
    }
  }
  
  peer3: PeerConnection N {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    
    local_queue: Request Queue {
      shape: queue
      style.fill: "#1a1a2e"
      style.stroke: "#8b949e"
    }
  }
}

piece_manager.piece_tracker -> shared_state.availability_map: update availability {
  style.stroke: "#3fb950"
}

piece_manager.request_scheduler -> shared_state.request_queue: prioritize requests {
  style.stroke: "#3fb950"
}

piece_manager.piece_verifier -> shared_state.completed_pieces: store verified {
  style.stroke: "#3fb950"
}

shared_state.request_queue -> peer_connections.peer1.local_queue: assign requests {
  style.stroke: "#8b949e"
}

shared_state.request_queue -> peer_connections.peer2.local_queue: assign requests {
  style.stroke: "#8b949e"
}

shared_state.request_queue -> peer_connections.peer3.local_queue: assign requests {
  style.stroke: "#8b949e"
}

peer_connections.peer1 -> piece_manager.piece_verifier: piece data {
  style.stroke: "#8b949e"
}

peer_connections.peer2 -> piece_manager.piece_verifier: piece data {
  style.stroke: "#8b949e"
}

peer_connections.peer3 -> piece_manager.piece_verifier: piece data {
  style.stroke: "#8b949e"
}

peer_connections.peer1 -> shared_state.availability_map: bitfield updates {
  style.stroke: "#8b949e"
}

peer_connections.peer2 -> shared_state.availability_map: bitfield updates {
  style.stroke: "#8b949e"
}

peer_connections.peer3 -> shared_state.availability_map: bitfield updates {
  style.stroke: "#8b949e"
}