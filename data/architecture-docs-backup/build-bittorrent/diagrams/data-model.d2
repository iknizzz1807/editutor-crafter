title: Core Data Structures {
  style.font-size: 24
  style.bold: true
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
}

torrent: Torrent {
  shape: class
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  +announce: string
  +info_hash: byte array
  +piece_length: int
  +pieces: byte arrays
  +length: int64
  +name: string
  +files: FileInfo array
}

peer_info: PeerInfo {
  shape: class
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  +id: byte array
  +ip: string
  +port: int
  +bitfield: byte array
  +am_choking: bool
  +am_interested: bool
  +peer_choking: bool
  +peer_interested: bool
  +connection: net.Conn
}

piece_state: PieceState {
  shape: class
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  +index: int
  +length: int
  +hash: byte array
  +blocks: BlockState array
  +downloaded: int
  +requested: int
  +complete: bool
  +verified: bool
}

message: Message {
  shape: class
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  +type: MessageType
  +payload: byte array
  +piece_index: int
  +block_offset: int
  +block_length: int
  +bitfield: byte array
}

block_state: BlockState {
  shape: class
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  
  +offset: int
  +length: int
  +data: byte array
  +requested: bool
  +downloaded: bool
}

message_type: MessageType {
  shape: class
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  
  CHOKE: 0
  UNCHOKE: 1
  INTERESTED: 2
  NOT_INTERESTED: 3
  HAVE: 4
  BITFIELD: 5
  REQUEST: 6
  PIECE: 7
  CANCEL: 8
}

torrent -> piece_state: defines pieces {
  style.stroke: "#8b949e"
  style.animated: true
}

peer_info -> message: sends/receives {
  style.stroke: "#8b949e"
  style.animated: true
}

piece_state -> block_state: contains blocks {
  style.stroke: "#8b949e"
}

message -> message_type: has type {
  style.stroke: "#8b949e"
}

peer_info -> piece_state: requests pieces {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

torrent -> peer_info: shared among peers {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}