title: Cache Entry State Machine

# States
empty: Empty {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

cached: Cached {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

expired: Expired {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

nx_cached: NX Cached {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#d63031"
  style.font-color: "#e6edf3"
}

nx_expired: NX Expired {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#d63031"
  style.font-color: "#e6edf3"
}

# Initial state indicator
start: {
  shape: circle
  style.fill: "#3fb950"
  width: 20
  height: 20
}

# Transitions
start -> empty: initial
empty -> cached: cache miss\n+ successful resolution {
  style.stroke: "#8b949e"
}
empty -> nx_cached: cache miss\n+ NXDOMAIN response {
  style.stroke: "#8b949e"
}
cached -> expired: TTL timeout {
  style.stroke: "#8b949e"
}
nx_cached -> nx_expired: TTL timeout {
  style.stroke: "#8b949e"
}
expired -> empty: eviction {
  style.stroke: "#8b949e"
}
nx_expired -> empty: eviction {
  style.stroke: "#8b949e"
}
expired -> cached: cache hit\n+ refresh resolution {
  style.stroke: "#8b949e"
}
nx_expired -> nx_cached: cache hit\n+ refresh NXDOMAIN {
  style.stroke: "#8b949e"
}

# Legend
legend: Legend {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  
  positive: Positive Cache States {
    style.font-color: "#e6edf3"
  }
  negative: Negative Cache States (NXDOMAIN) {
    style.font-color: "#d63031"
  }
}