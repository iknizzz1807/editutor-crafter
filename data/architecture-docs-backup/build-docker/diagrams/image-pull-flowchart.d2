title: Image Pull and Extraction Flowchart

# Flowchart starts here
start: Start {
  shape: circle
  style.fill: "#3fb950"
  style.font-color: "#1a1a2e"
}

check_cache: Check local cache for image? {
  shape: diamond
}

fetch_manifest: Fetch manifest from registry
download_layers: Download layers from registry
verify_checksums: Verify layer checksums (SHA256)
extract_storage: Extract layers to storage directory
create_rootfs: Create ready root filesystem

# Success/failure states
image_ready: Image ready for container {
  shape: oval
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.bold: true
}
fetch_failed: Fetch failed {
  shape: oval
  style.fill: "#3a0c0c"
  style.stroke: "#f85149"
}
verify_failed: Verification failed {
  shape: oval
  style.fill: "#3a0c0c"
  style.stroke: "#f85149"
}

# Flow connections
start -> check_cache

check_cache -> fetch_manifest: No (not cached)
check_cache -> extract_storage: Yes (cached)

fetch_manifest -> download_layers
fetch_manifest -> fetch_failed: Failed

download_layers -> verify_checksums
download_layers -> fetch_failed: Failed

verify_checksums -> extract_storage: Valid
verify_checksums -> verify_failed: Invalid

extract_storage -> create_rootfs
create_rootfs -> image_ready

# Styling for key decisions
check_cache.style.stroke-width: 3
fetch_manifest.style.stroke-width: 2
download_layers.style.stroke-width: 2
verify_checksums.style.stroke-width: 3
verify_checksums.style.stroke: "#f0883e"

# Connection styling for clarity
(check_cache -> fetch_manifest)[0].style.stroke-dash: 2
(check_cache -> extract_storage)[0].style.stroke-dash: 2
