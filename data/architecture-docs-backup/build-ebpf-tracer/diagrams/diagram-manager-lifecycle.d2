init: {
  shape: circle
  style.fill: "#3fb950"
  label: ""
}

states: {
  INIT: "INIT" {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.border-radius: 5
  }

  LOADING: "LOADING" {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.border-radius: 5
  }

  RUNNING: "RUNNING" {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.border-radius: 5
  }

  PAUSED: "PAUSED" {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.border-radius: 5
  }

  SHUTTING_DOWN: "SHUTTING_DOWN" {
    style.fill: "#1a1a2e"
    style.stroke: "#ffa500"
    style.font-color: "#e6edf3"
    style.border-radius: 5
    style.double-border: true
  }

  ERROR: "ERROR" {
    style.fill: "#1a1a2e"
    style.stroke: "#ff5555"
    style.font-color: "#e6edf3"
    style.border-radius: 5
    style.double-border: true
  }
}

init -> states.INIT: "start"

states.INIT -> states.LOADING: "load eBPF programs"

states.LOADING -> states.RUNNING: "load success"
states.LOADING -> states.ERROR: "load failure"

states.RUNNING -> states.PAUSED: "pause"
states.PAUSED -> states.RUNNING: "resume"

states.RUNNING -> states.LOADING: "configuration\nupdate"
states.PAUSED -> states.LOADING: "configuration\nupdate"

states.RUNNING -> states.SHUTTING_DOWN: "SIGINT"
states.PAUSED -> states.SHUTTING_DOWN: "SIGINT"
states.ERROR -> states.SHUTTING_DOWN: "SIGINT"

states.SHUTTING_DOWN -> states.INIT: "cleanup complete" {
  style.stroke-dash: 3
}

title: "User-space Manager Lifecycle State Machine"
description: |md
  State machine for the manager: INIT, LOADING, RUNNING, PAUSED, SHUTTING_DOWN, ERROR.
  Shows events like SIGINT, load success/failure, and configuration update.
| {
  style.font-size: 12
  style.italic: true
  style.font-color: "#8b949e"
}