direction: right

# Initial state
idle: IDLE {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

# Interrupt detection
detect: DETECT\nINTERRUPT {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

# Priority handling
priority: PRIORITY\nCHECK {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

# Context save
save: SAVE\nCONTEXT {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

# Vector dispatch
dispatch: VECTOR\nDISPATCH {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

# Handler execution
handler: EXECUTE\nHANDLER {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

# Context restore
restore: RESTORE\nCONTEXT {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

# Transitions
idle -> detect: IRQ Signal\n(2-4 cycles)
detect -> priority: Valid IRQ
detect -> idle: IRQ Disabled
priority -> save: Higher Priority
priority -> idle: Lower Priority
save -> dispatch: Push PC/Status\n(3-7 cycles)
dispatch -> handler: Jump to Vector\n(1-2 cycles)
handler -> restore: RTI Instruction
restore -> idle: Pop PC/Status\n(4-6 cycles)

# Self-loop for handler execution
handler -> handler: Execute Instructions

# Timing notes
timing_note: |md
  **Timing Considerations:**
  - Interrupt latency: 7-13 cycles
  - Context switch overhead
  - Priority arbitration delay
  - Vector fetch from memory
| {
  shape: page
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# Arrow styling
idle.style.stroke-width: 3
save.style.stroke: "#3fb950"
restore.style.stroke: "#3fb950"