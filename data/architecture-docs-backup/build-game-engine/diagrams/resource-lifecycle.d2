direction: right

# Initial state
initial: {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
  width: 20
  height: 20
}

# Resource states
unloaded: Unloaded {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

loading: Loading {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

loaded: Loaded {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

error: Error {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#d63031"
  style.font-color: "#e6edf3"
}

# State transitions
initial -> unloaded
unloaded -> loading: load request
loading -> loaded: load complete
loading -> error: load failed
loaded -> loading: reload request
error -> loading: retry
loaded -> unloaded: ref count = 0
error -> unloaded: ref count = 0

# Reference counting loop
loaded -> loaded: increment ref count {
  style.stroke: "#8b949e"
  style.stroke-dash: 5
}

# Self-loop for error state
error -> error: load failed (retry limit) {
  style.stroke: "#d63031"
  style.stroke-dash: 5
}

# Title
title: Resource Loading and Caching State Machine {
  shape: page
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}