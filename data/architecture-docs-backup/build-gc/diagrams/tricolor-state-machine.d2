direction: right

# Initial state
initial: "" {
  shape: circle
  style.fill: "#000000"
  style.stroke: "#3fb950"
  width: 20
  height: 20
}

# States
white: White {
  shape: circle
  style.fill: "#ffffff"
  style.stroke: "#3fb950"
  style.font-color: "#000000"
  style.bold: true
}

gray: Gray {
  shape: circle
  style.fill: "#8b949e"
  style.stroke: "#3fb950"
  style.font-color: "#ffffff"
  style.bold: true
}

black: Black {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

# Transitions
initial -> white: "Object allocation"

white -> gray: "Discovery\n[object found from root]" {
  style.stroke: "#e17055"
  style.bold: true
}

gray -> black: "Scanning complete\n[all children processed]" {
  style.stroke: "#00b894"
  style.bold: true
}

black -> gray: "Write barrier\n[new reference added]" {
  style.stroke: "#fdcb6e"
  style.bold: true
}

gray -> gray: "Child discovery\n[processing children]" {
  style.stroke: "#a29bfe"
  style.bold: true
}

# Legend
legend: State Meanings {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  
  white_desc: "White: Unvisited/Unreachable" {
    style.fill: "#ffffff"
    style.font-color: "#000000"
    shape: rectangle
  }
  
  gray_desc: "Gray: Discovered but not scanned" {
    style.fill: "#8b949e"
    style.font-color: "#ffffff"
    shape: rectangle
  }
  
  black_desc: "Black: Fully processed/Reachable" {
    style.fill: "#1a1a2e"
    style.font-color: "#e6edf3"
    shape: rectangle
  }
}