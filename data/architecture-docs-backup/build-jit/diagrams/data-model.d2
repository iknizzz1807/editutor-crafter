title: Data Model and Relationships {
  style.font-size: 20
  style.bold: true
}

BytecodeFunction: {
  shape: class
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  +instructions: Vec<Bytecode>
  +constants: Vec<Value>
  +metadata: FunctionMetadata
  +hot_spots: Vec<usize>
  +"get_instruction()": void
  +"mark_hot_spot()": void
  +"should_compile()": bool
}

CompiledFunction: {
  shape: class
  style.fill: "#16213e"
  style.stroke: "#3fb950" 
  style.font-color: "#e6edf3"
  style.bold: true
  
  +native_code: "*mut u8"
  +code_size: usize
  +entry_point: fn
  +optimization_level: OptLevel
  +bytecode_mapping: Vec<Mapping>
  +"execute()": void
  +"get_entry_point()": fn
  +"invalidate()": void
}

CodeBuffer: {
  shape: class
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  +buffer: Vec<u8>
  +position: usize
  +capacity: usize
  +executable_memory: "*mut u8"
  +"emit_bytes()": void
  +"emit_instruction()": void
  +"make_executable()": void
  +"allocate_page()": void
}

ProfileData: {
  shape: class
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  +call_count: u64
  +execution_time: Duration
  +hot_paths: Vec<PathInfo>
  +branch_frequencies: HashMap
  +"record_execution()": void
  +"is_hot()": bool
  +"get_optimization_hints()": Hints
}

BytecodeFunction -> CompiledFunction: compiles to {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

BytecodeFunction -> ProfileData: profiles execution {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

CompiledFunction -> CodeBuffer: uses for generation {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

ProfileData -> CompiledFunction: triggers recompilation {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  style.stroke-dash: 5
}

CodeBuffer -> CompiledFunction: produces native code {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

transformation_flow: {
  label: Transformation Flow
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  bytecode_input: {
    label: Bytecode Instructions
    shape: page
    style.fill: "#1a1a2e"
  }
  
  machine_code: {
    label: x86-64 Machine Code
    shape: page
    style.fill: "#0f3460"
  }
  
  bytecode_input -> machine_code: JIT compilation {
    style.stroke: "#3fb950"
    style.bold: true
  }
}
