JIT Compiler System: {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  
  VM Core: Virtual Machine Core {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    
    interpreter: Bytecode Interpreter {
      style.font-color: "#e6edf3"
    }
    
    execution_engine: Execution Engine {
      style.font-color: "#e6edf3"
    }
    
    interpreter -> execution_engine: execute bytecode
  }
  
  profiler: Runtime Profiler {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
    
    hotspot_detector: Hotspot Detector
    metrics_collector: Metrics Collector
  }
  
  JIT Compiler: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    
    ir_generator: IR Generator
    optimizer: Code Optimizer
    x86_backend: x86-64 Backend
    
    ir_generator -> optimizer: intermediate code
    optimizer -> x86_backend: optimized IR
  }
  
  Code Cache: Native Code Cache {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
    shape: cylinder
    
    executable_memory: Executable Memory Pages
    metadata: Code Metadata
  }
  
  Machine Code Emitter: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    
    assembler: x86-64 Assembler
    memory_manager: Memory Manager
    
    assembler -> memory_manager: allocate pages
  }
}

# Data flow connections
VM Core.interpreter -> profiler: execution stats {
  style.stroke: "#8b949e"
}

profiler.hotspot_detector -> JIT Compiler.ir_generator: trigger compilation {
  style.stroke: "#3fb950"
  style.bold: true
}

VM Core.interpreter -> JIT Compiler.ir_generator: bytecode {
  style.stroke: "#8b949e"
}

JIT Compiler.x86_backend -> Machine Code Emitter.assembler: machine code {
  style.stroke: "#8b949e"
}

Machine Code Emitter.memory_manager -> Code Cache.executable_memory: store native code {
  style.stroke: "#8b949e"
}

Code Cache -> VM Core.execution_engine: native execution {
  style.stroke: "#3fb950"
  style.bold: true
}

VM Core.execution_engine -> Code Cache: lookup compiled code {
  style.stroke: "#8b949e"
}

# Control flow labels
bytecode_input: Bytecode Input {
  shape: page
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

native_output: Native Execution {
  shape: page
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

bytecode_input -> VM Core: interpret
native_output <- Code Cache: execute