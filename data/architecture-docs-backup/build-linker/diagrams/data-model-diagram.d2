classes: {
  dark_theme: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: false
  }
  container_theme: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    style.bold: false
  }
}

title: "Data Model Relationships"
description: "Shows key data structures and their relationships for a static linker"

core_model: Core Data Model {
  class: container_theme
  style.bold: true

  object_file: ObjectFile {
    shape: class
    "-path: string"
    "-sections: ELFSection[]"
    "-symbols: SymbolTableEntry[]"
    "-relocations: RelocationEntry[]"
    "+read_from_disk(path: string): void"
    "+get_section(name: string): ELFSection"
    class: dark_theme
    style.stroke-width: 3
  }

  merged_section: MergedSection {
    shape: class
    "-name: string"
    "-output_offset: uint64"
    "-size: uint64"
    "-input_sections: List<InputSection>"
    "+add_input_section(section: ELFSection): void"
    "+finalize_layout(): void"
    "+write_content(): byte[]"
    class: dark_theme
  }

  symbol_table_entry: SymbolTableEntry {
    shape: class
    "-name: string"
    "-value: uint64"
    "-section: MergedSection | null"
    "-binding: SymbolBinding"
    "-type: SymbolType"
    "-defined_in: ObjectFile | null"
    "+is_defined(): bool"
    "+resolve(target: SymbolTableEntry): void"
    class: dark_theme
  }

  relocation_entry: RelocationEntry {
    shape: class
    "-offset: uint64"
    "-type: RelocationType"
    "-symbol: SymbolTableEntry"
    "-addend: int64"
    "-referencing_section: ELFSection"
    "+apply(target_addr: uint64): void"
    "+requires_symbol(): bool"
    class: dark_theme
  }
}

core_model.object_file -> core_model.merged_section: "sections map to"
core_model.object_file -> core_model.symbol_table_entry: "contains"
core_model.object_file -> core_model.relocation_entry: "contains"

core_model.merged_section <- core_model.symbol_table_entry: "hosts"
core_model.relocation_entry -> core_model.symbol_table_entry: "references" {
  style.stroke-dash: 3
}
core_model.relocation_entry -> core_model.merged_section: "patches location in"

elf_representation: ELF File Representation {
  class: container_theme
  style.italic: true
  near: top-center

  note: "Mirrors on-disk ELF format\nProvides parsed, in-memory view\nMental model: Library index card system" {
    shape: rectangle
    style.fill: "#16213e"
    style.stroke: "#8b949e"
  }
}

elf_representation -> core_model.object_file: "parsed into" {
  style.stroke-dash: 2
}

legend: Relationship Legend {
  class: container_theme
  near: bottom-right

  contains: "-> contains" {
    style.stroke: "#3fb950"
  }
  maps_to: "-> maps to" {
    style.stroke: "#8b949e"
  }
  references: "-.-> references" {
    style.stroke: "#8b949e"
    style.stroke-dash: 3
  }
}