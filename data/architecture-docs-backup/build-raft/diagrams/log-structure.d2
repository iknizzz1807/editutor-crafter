title: Log Entry and Index Relationship Diagram

log_array: {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"

  # Sample entries with expanded details
  entry1: Log Entry (Index 1) {
    shape: sql_table
    style.fill: "#0f3460"
    style.stroke: "#8b949e"

    Term: "3"
    Command: "SET x=5"
    Index: "1"
  }

  entry2: Log Entry (Index 2) {
    shape: sql_table
    style.fill: "#0f3460"
    style.stroke: "#8b949e"

    Term: "3"
    Command: "INC y"
    Index: "2"
  }

  entry3: Log Entry (Index 3) {
    shape: sql_table
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.bold: true

    Term: "4"
    Command: "DEL z"
    Index: "3"
  }

  entry4: Log Entry (Index 4) {
    shape: sql_table
    style.fill: "#0f3460"
    style.stroke: "#8b949e"

    Term: "4"
    Command: "GET a"
    Index: "4"
  }

  entry5: Log Entry (Index 5) {
    shape: sql_table
    style.fill: "#0f3460"
    style.stroke: "#8b949e"

    Term: "4"
    Command: "PUT b=9"
    Index: "5"
  }

  entry1 -> entry2: "" {style.stroke: "#8b949e"}
  entry2 -> entry3: "" {style.stroke: "#8b949e"}
  entry3 -> entry4: "" {style.stroke: "#8b949e"}
  entry4 -> entry5: "" {style.stroke: "#8b949e"}
}

# Key indices as pointers
last_applied: lastApplied = 2 {
  style.bold: true
  style.font-color: "#fcca03"
}
commit_index: commitIndex = 3 {
  style.bold: true
  style.font-color: "#0d8bff"
}
last_log_index: lastLogIndex = 5 {
  style.bold: true
  style.font-color: "#3fb950"
}

# Pointers to log entries
last_applied -> log_array.entry2: "Last applied to state machine" {
  style.stroke-dash: 3
  style.stroke: "#fcca03"
}
commit_index -> log_array.entry3: "Committed entries (majority match)" {
  style.stroke-dash: 3
  style.stroke: "#0d8bff"
}
last_log_index -> log_array.entry5: "Last entry in log" {
  style.stroke-dash: 3
  style.stroke: "#3fb950"
}

# AppendEntries RPC
append_entries_rpc: AppendEntries RPC {
  shape: sql_table
  style.fill: "#16213e"
  style.stroke: "#e6edf3"
  style.font-color: "#e6edf3"
  
  prevLogIndex: "3"
  prevLogTerm: "4"
  entries: "[Log Entry (Index 4), Log Entry (Index 5)]"
  leaderCommit: "3"
}

# Show prev pointers connecting to specific log entry
append_entries_rpc -> log_array.entry3: "Points to entry just before new entries"

# Legend/notes
notes: {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  style.italic: true
  
  label: |md
  **Log Matching Property:**
  - If two entries have same index and term, they contain same command
  - If two entries have same index and term, all preceding entries are identical
  |
}
