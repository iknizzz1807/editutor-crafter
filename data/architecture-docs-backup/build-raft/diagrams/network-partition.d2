direction: right

title: Component Diagram: Network Partition Scenario

initial_cluster: {
  label: "Initial State: Healthy 5-Node Raft Cluster (Term 1)"
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.border-radius: 15

  leader: Node A {
    shape: circle
    style: {
      fill: "#3fb950"
      font-color: "#ffffff"
      stroke-width: 3
      bold: true
    }
    label: "Leader\nTerm: 1"
  }

  follower1: Node B {
    shape: circle
    style.fill: "#16213e"
    label: "Follower\nTerm: 1"
  }
  follower2: Node C {
    shape: circle
    style.fill: "#16213e"
    label: "Follower\nTerm: 1"
  }
  follower3: Node D {
    shape: circle
    style.fill: "#16213e"
    label: "Follower\nTerm: 1"
  }
  follower4: Node E {
    shape: circle
    style.fill: "#16213e"
    label: "Follower\nTerm: 1"
  }

  leader <-> follower1: Heartbeats
  leader <-> follower2: Heartbeats
  leader <-> follower3: Heartbeats
  leader <-> follower4: Heartbeats
}

network_partition: {
  label: "Network Partition Occurs"
  shape: diamond
  style.fill: "#1a1a2e"
  style.stroke: "#e17055"
}

majority_side: {
  label: "Majority Partition (3 Nodes)"
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.border-radius: 15
  style.bold: true

  node_a: Node A {
    shape: circle
    style: {
      fill: "#3fb950"
      font-color: "#ffffff"
      stroke-width: 3
      bold: true
    }
    label: "Leader\nTerm: 2"
  }

  node_b: Node B {
    shape: circle
    style.fill: "#16213e"
    label: "Follower\nTerm: 2"
  }
  node_c: Node C {
    shape: circle
    style.fill: "#16213e"
    label: "Follower\nTerm: 2"
  }

  node_a <-> node_b: Heartbeats
  node_a <-> node_c: Heartbeats

  note: |md
    **Majority Quorum Achieved**
    - Can elect leader (Term 2)
    - Continues processing requests
    - Commits log entries
  | {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
  }
}

minority_side: {
  label: "Minority Partition (2 Nodes)"
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.border-radius: 15

  node_d: Node D {
    shape: circle
    style: {
      fill: "#d63031"
      font-color: "#ffffff"
    }
    label: "Candidate\nTerm: 3"
  }
  node_e: Node E {
    shape: circle
    style: {
      fill: "#d63031"
      font-color: "#ffffff"
    }
    label: "Candidate\nTerm: 3"
  }

  node_d -- node_e: Vote Request

  note: |md
    **No Quorum Available**
    - Candidates increment terms (3, 4, 5...)
    - Cannot achieve majority vote
    - Cannot commit log entries
    - Leadership cannot be established
  | {
    style.fill: "#1a1a2e"
    style.stroke: "#e17055"
  }
}

partition_healing: {
  label: "Partition Heals"
  shape: diamond
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
}

reconciled_cluster: {
  label: "Reconciled Cluster State"
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.border-radius: 15

  reconciled_leader: Node A {
    shape: circle
    style: {
      fill: "#3fb950"
      font-color: "#ffffff"
      stroke-width: 3
      bold: true
    }
    label: "Leader\nTerm: 2"
  }

  rb: Node B {
    shape: circle
    style.fill: "#16213e"
    label: "Follower\nTerm: 2"
  }
  rc: Node C {
    shape: circle
    style.fill: "#16213e"
    label: "Follower\nTerm: 2"
  }
  rd: Node D {
    shape: circle
    style.fill: "#16213e"
    label: "Follower\nTerm: 2"
  }
  re: Node E {
    shape: circle
    style.fill: "#16213e"
    label: "Follower\nTerm: 2"
  }

  reconciled_leader -> rd: AppendEntries (Term 2)
  reconciled_leader -> re: AppendEntries (Term 2)

  note: |md
    **Term Reconciliation**
    1. Minority nodes receive AppendEntries from leader (Term 2)
    2. Nodes D & E: Term 3 > 2, but step down
    3. Revert to followers, adopt leader's term (2)
    4. Logs are synchronized
    5. Cluster consistency restored
  | {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
  }
}

initial_cluster -> network_partition: "Partition Begins"
network_partition -> majority_side
network_partition -> minority_side
majority_side -> partition_healing: "Network Heals"
minority_side -> partition_healing: "Network Heals"
partition_healing -> reconciled_cluster