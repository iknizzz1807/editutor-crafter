# Camera Coordinate System
direction: right

# Screen Space
screen_space: Screen Space {
  pixel_grid: Pixel Grid\n(0,0) to (width-1, height-1) {
    shape: rectangle
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  sample_pixel: Sample Pixel\n(x, y) {
    shape: circle
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

# Camera Components
camera_system: Camera System {
  viewport: Viewport\n(Virtual Film Plane) {
    shape: rectangle
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  lens_disk: Lens Disk\n(Aperture) {
    shape: circle
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  camera_center: Camera Center\n(lookfrom) {
    shape: circle
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

# Focus Plane
focus_plane: Focus Plane {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

# World Space
world_space: 3D World Space {
  world_ray: World Ray\n(origin + t*direction) {
    shape: rectangle
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  hit_point: Hit Point\n(x, y, z) {
    shape: circle
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

# Coordinate Transformations
transform_note: |md
  **Coordinate Transformations:**
  1. Pixel (i,j) → Normalized (u,v)
  2. (u,v) → Viewport coordinates
  3. Viewport → 3D ray direction
  4. Apply camera orientation (u,v,w basis)
| {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

# Connections - Coordinate transformation flow
screen_space.sample_pixel -> camera_system.viewport: "1. Pixel to Viewport\n(u,v) = f(x,y)" {
  style.stroke: "#8b949e"
}

camera_system.viewport -> camera_system.lens_disk: "2. Random aperture\nsampling" {
  style.stroke: "#8b949e"
}

camera_system.lens_disk -> focus_plane: "3. Focus distance\nprojection" {
  style.stroke: "#8b949e"
}

camera_system.camera_center -> world_space.world_ray: "4. Ray origin" {
  style.stroke: "#8b949e"
}

focus_plane -> world_space.world_ray: "5. Ray direction\n(focus_point - ray_origin)" {
  style.stroke: "#8b949e"
}

world_space.world_ray -> world_space.hit_point: "6. Ray-scene\nintersection" {
  style.stroke: "#8b949e"
}

# Camera basis vectors
camera_system.camera_center -> transform_note: "Camera basis\n(u, v, w vectors)" {
  style.stroke: "#3fb950"
  style.stroke-dash: 5
}