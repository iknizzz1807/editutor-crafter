direction: down

title: Ray-Object Intersection Flow {
  style.font-size: 18
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
}

start: Start {
  shape: circle
  style.fill: "#3fb950"
  style.font-color: "#000000"
}

input: Ray Input\n(origin, direction) {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

init_vars: Initialize:\n• closest_t = infinity\n• hit_record = null {
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

iterator: Object Iterator {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

intersection_test: Compute Ray-Object\nIntersection {
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

valid_check: Valid Hit?\n(t_min < t < t_max) {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

closest_check: Closer than\nCurrent Best? {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

update_hit: Update Hit Record:\n• distance (t)\n• hit point\n• surface normal\n• material {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

next_object: Next Object {
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

final_check: Hit Found? {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

return_hit: Return Hit Record {
  style.fill: "#3fb950"
  style.font-color: "#000000"
  style.bold: true
}

return_miss: Return Miss {
  style.fill: "#d63031"
  style.font-color: "#ffffff"
  style.bold: true
}

start -> input
input -> init_vars
init_vars -> iterator
iterator -> intersection_test: More objects
iterator -> final_check: No more objects

intersection_test -> valid_check
valid_check -> closest_check: Yes
valid_check -> next_object: No

closest_check -> update_hit: Yes
closest_check -> next_object: No

update_hit -> next_object
next_object -> iterator

final_check -> return_hit: Yes
final_check -> return_miss: No