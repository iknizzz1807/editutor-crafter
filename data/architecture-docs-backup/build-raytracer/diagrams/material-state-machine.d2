direction: right

# Initial state
initial: {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

# States
ray_cast: Ray Cast {
  shape: oval
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

hit_detection: Hit Detection {
  shape: oval
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

material_scatter: Material Analysis {
  shape: oval
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

# Outcome states
absorbed: Absorbed {
  shape: oval
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
}

reflected: Reflected {
  shape: oval
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

refracted: Refracted {
  shape: oval
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

new_ray: New Ray Generated {
  shape: oval
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

# Terminal states
terminate: Terminate {
  shape: circle
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
  style.bold: true
}

# Transitions
initial -> ray_cast: "start"
ray_cast -> hit_detection: "trace path"
hit_detection -> material_scatter: "surface hit"
hit_detection -> terminate: "no intersection" {
  style.stroke: "#8b949e"
}

material_scatter -> absorbed: "diffuse scatter" {
  style.stroke: "#e17055"
}
material_scatter -> reflected: "metal surface" {
  style.stroke: "#8b949e"
}
material_scatter -> refracted: "dielectric/glass" {
  style.stroke: "#8b949e"
}

absorbed -> terminate: "light absorbed" {
  style.stroke: "#e17055"
}
reflected -> new_ray: "compute reflection" {
  style.stroke: "#8b949e"
}
refracted -> new_ray: "compute refraction" {
  style.stroke: "#8b949e"
}

new_ray -> ray_cast: "continue tracing" {
  style.stroke: "#3fb950"
}