title: VNode Tree vs. Fiber Tree

canvas: {
  theme: {
    canvas_fill: "#0d1117"
    root_fill: "#0d1117"
  }
}

# VNode Tree Container
vnode_tree: VNode Tree (Virtual DOM) {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.stroke-width: 2

  # Root VNode
  vnode_root: <App /> {
    shape: class
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.bold: true
    type: Function (App)
    props: "{count: 0}"
    children: "[ChildVNodes]"
  }

  # Level 1 VNodes
  vnode_child1: <Header /> {
    shape: class
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    type: Function (Header)
    props: {}
    children: "[TextVNode]"
  }

  vnode_child2: <Counter /> {
    shape: class
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    type: Function (Counter)
    props: "{count: 0}"
    children: "[ButtonVNodes]"
  }

  # Level 2 VNodes
  vnode_text1: "My App" {
    shape: class
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    type: string
    props: "null"
    children: "null"
  }

  vnode_button1: <button> {
    shape: class
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    type: string (button)
    props: "{onClick: ƒ}"
    children: "[TextVNode2]"
  }

  vnode_text2: "Count: 0" {
    shape: class
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    type: string
    props: "null"
    children: "null"
  }

  # VNode tree connections (simple parent-child)
  vnode_root -> vnode_child1: child
  vnode_root -> vnode_child2: child
  vnode_child1 -> vnode_text1: child
  vnode_child2 -> vnode_button1: child
  vnode_button1 -> vnode_text2: child
}

# Fiber Tree Container
fiber_tree: Fiber Tree (Work Units) {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.stroke-width: 2

  # Root Fiber
  fiber_root: Fiber<App> {
    shape: class
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.bold: true
    type: Function (App)
    child: Fiber<Header>
    sibling: null
    parent: null
    alternate: "null"
    memoizedProps: "{count: 0}"
  }

  # Level 1 Fibers
  fiber_child1: Fiber<Header> {
    shape: class
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    type: Function (Header)
    child: Fiber<Text>
    sibling: Fiber<Counter>
    parent: Fiber<App>
    alternate: "null"
    memoizedProps: "{}"
  }

  fiber_child2: Fiber<Counter> {
    shape: class
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    type: Function (Counter)
    child: Fiber<button>
    sibling: null
    parent: Fiber<App>
    alternate: "null"
    memoizedProps: "{count: 0}"
  }

  # Level 2 Fibers
  fiber_text1: Fiber<Text> {
    shape: class
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    type: string
    child: null
    sibling: null
    parent: Fiber<Header>
    alternate: "null"
    memoizedProps: "My App"
  }

  fiber_button: Fiber<button> {
    shape: class
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    type: string (button)
    child: Fiber<Text>
    sibling: null
    parent: Fiber<Counter>
    alternate: "null"
    memoizedProps: "{onClick: ƒ}"
  }

  fiber_text2: Fiber<Text> {
    shape: class
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    type: string
    child: null
    sibling: null
    parent: Fiber<button>
    alternate: "null"
    memoizedProps: "Count: 0"
  }

  # Previous version fibers (for reconciliation)
  fiber_root_old: Fiber<App> {
    shape: class
    style.fill: "#16213e"
    style.stroke: "#e6cc00"
    style.stroke-dash: 3
    style.opacity: 0.8
    type: Function (App)
    child: Fiber<Header> (old)
    alternate: "null"
  }

  fiber_child1_old: Fiber<Header> {
    shape: class
    style.fill: "#16213e"
    style.stroke: "#e6cc00"
    style.stroke-dash: 3
    style.opacity: 0.8
    type: Function (Header)
    child: Fiber<Text> (old)
    alternate: Fiber<Header>
  }

  fiber_text1_old: Fiber<Text> {
    shape: class
    style.fill: "#1a1a2e"
    style.stroke: "#e6cc00"
    style.stroke-dash: 3
    style.opacity: 0.8
    type: string
    alternate: Fiber<Text>
  }

  # Fiber tree connections (linked list structure)
  fiber_root -> fiber_child1: child {
    style.stroke-dash: 0
  }
  fiber_child1 -> fiber_child2: sibling {
    style.stroke-dash: 0
  }
  fiber_child1 -> fiber_text1: child {
    style.stroke-dash: 0
  }
  fiber_child2 -> fiber_button: child {
    style.stroke-dash: 0
  }
  fiber_button -> fiber_text2: child {
    style.stroke-dash: 0
  }
  fiber_root <- fiber_child1: parent {
    style.stroke-dash: 2
  }
  fiber_child1 <- fiber_text1: parent {
    style.stroke-dash: 2
  }
  fiber_child2 <- fiber_button: parent {
    style.stroke-dash: 2
  }
  fiber_button <- fiber_text2: parent {
    style.stroke-dash: 2
  }

  # Alternate pointers (previous tree)
  fiber_child1 -> fiber_child1_old: alternate {
    style.stroke: "#e6cc00"
    style.stroke-dash: 2
  }
  fiber_text1 -> fiber_text1_old: alternate {
    style.stroke: "#e6cc00"
    style.stroke-dash: 2
  }
  fiber_root -> fiber_root_old: alternate {
    style.stroke: "#e6cc00"
    style.stroke-dash: 2
  }
}

# Legend
legend: Legend {
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.stroke-width: 1

  vnode_example: VNode {
    shape: class
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    type: string|Function
    props: object
    children: array
  }

  fiber_example: Fiber {
    shape: class
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    child: Fiber|null
    sibling: Fiber|null
    parent: Fiber|null
    alternate: Fiber|null
  }

  arrow_parent_child: -> : child (solid)
  arrow_sibling: -> : sibling (solid)
  arrow_parent: <- : parent (dashed)
  arrow_alternate: -> : alternate (yellow, dashed)

  vnode_example -> arrow_parent_child: represents
  fiber_example -> arrow_sibling: has pointers
}

# Connections between trees
vnode_root -> fiber_root: becomes
vnode_child1 -> fiber_child1: becomes
vnode_text1 -> fiber_text1: becomes

note: |md
  ## Key Differences

  **VNode Tree:**
  - Simple parent-child hierarchy
  - Recreated on every render
  - Lightweight description of UI

  **Fiber Tree:**
  - Linked list structure for efficient traversal
  - Persistent across renders
  - Contains work units with additional metadata
  - Alternate pointers enable diffing (reconciliation)
| {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
}