shape: sequence_diagram

Browser: Browser Main Thread {
  label: "Controls rendering lifecycle"
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

WorkLoop: Work Loop (Fiber) {
  label: "Manages task scheduling\nwith requestIdleCallback"
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

Fiber: Fiber Reconciliation {
  label: "Process individual fiber nodes\nperform diff, mark effects"
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

Commit: Commit Phase {
  label: "Batch apply all side-effects\nto the actual DOM"
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

DOM: DOM Tree {
  label: "Actual browser DOM"
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

Browser -> WorkLoop: State change detected
Browser -> WorkLoop: requestIdleCallback(scheduleWork)

WorkLoop -> WorkLoop: has idle time remaining?
WorkLoop -> Fiber: beginWork(currentFiber)
Fiber -> Fiber: reconcileChildren()\ncreate/diff/update fibers
Fiber -> Fiber: mark side-effects (Placement,\nUpdate, Deletion, etc.)
Fiber -> WorkLoop: return next unit of work

note: |md
  ## Work Loop Continues
  - Processes fibers during idle periods
  - Can be interrupted if time runs out
  - Maintains progress with fiber pointers
| {
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

WorkLoop -> WorkLoop: more fibers to process?
WorkLoop -> Browser: requestIdleCallback(continueWork) if interrupted

WorkLoop -> Commit: all fibers processed\nbegin commit phase
Commit -> Commit: flush all side-effects\nin batch
Commit -> DOM: apply DOM mutations
Commit -> DOM: call lifecycle methods\n(componentDidMount/Update)
Commit -> Browser: commit complete\nready for next frame