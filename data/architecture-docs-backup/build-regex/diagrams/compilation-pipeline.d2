title: Pattern Compilation Data Flow {
  style.font-size: 24
  style.bold: true
  style.font-color: "#e6edf3"
}

input: "Regex String\na(b|c)*d" {
  shape: page
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

tokenizer: Tokenization {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

tokens: "Token Stream\n[CHAR(a), LPAREN, CHAR(b), PIPE, CHAR(c), RPAREN, STAR, CHAR(d)]" {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

parser: Parsing {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

ast: "Abstract Syntax Tree" {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

nfa_gen: "NFA Construction\n(Thompson's Algorithm)" {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

nfa: "Non-Deterministic\nFinite Automaton" {
  shape: cylinder
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

dfa_conv: "DFA Conversion\n(Subset Construction)" {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

dfa: "Deterministic\nFinite Automaton" {
  shape: cylinder
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

optimization: "DFA Optimization\n(State Minimization)" {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

final_dfa: "Optimized DFA" {
  shape: cylinder
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

input -> tokenizer: "Raw pattern string"
tokenizer -> tokens: "Lexical analysis"
tokens -> parser: "Token sequence"
parser -> ast: "Syntax analysis"
ast -> nfa_gen: "Tree traversal"
nfa_gen -> nfa: "State construction"
nfa -> dfa_conv: "Îµ-closure & transitions"
dfa_conv -> dfa: "Powerset construction"
dfa -> optimization: "State merging"
optimization -> final_dfa: "Minimal automaton"

note: "Optional Path: Some engines use NFA directly\nfor simplicity at the cost of performance" {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

nfa -> note: "Direct execution" {
  style.stroke-dash: 3
  style.stroke: "#8b949e"
}