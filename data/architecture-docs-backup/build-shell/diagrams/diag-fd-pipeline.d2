title: File Descriptor Layout for a 3-Stage Pipeline

terminal: {
  shape: rectangle
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  stdin: { shape: rectangle }
  stdout: { shape: rectangle }
  stderr: { shape: rectangle }
}

parent: {
  label: "Parent (Shell)"
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  pipe1: {
    read_end: {
      label: "pipe1[0]"
      style.fill: "#16213e"
      style.stroke: "#8b949e"
    }
    write_end: {
      label: "pipe1[1]"
      style.fill: "#16213e"
      style.stroke: "#8b949e"
    }
  }
  
  pipe2: {
    read_end: {
      label: "pipe2[0]"
      style.fill: "#16213e"
      style.stroke: "#8b949e"
    }
    write_end: {
      label: "pipe2[1]"
      style.fill: "#16213e"
      style.stroke: "#8b949e"
    }
  }
}

cmd1: {
  label: "Process 1 (cmd1)"
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  fd0: {
    label: "fd 0: stdin"
    style.bold: true
    style.stroke: "#3fb950"
  }
  fd1: {
    label: "fd 1: stdout"
    style.bold: true
    style.stroke: "#3fb950"
  }
  fd2: {
    label: "fd 2: stderr"
    style.bold: true
    style.stroke: "#3fb950"
  }
  
  closed1: {
    label: "pipe1[0] (closed)"
    style.fill: "#1a1a2e"
    style.stroke-dash: 3
    style.stroke: "#8b949e"
  }
  
  closed_pipe2: {
    label: "pipe2 ends (closed)"
    style.fill: "#1a1a2e"
    style.stroke-dash: 3
    style.stroke: "#8b949e"
  }
}

cmd2: {
  label: "Process 2 (cmd2)"
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  fd0: {
    label: "fd 0: stdin"
    style.bold: true
    style.stroke: "#3fb950"
  }
  fd1: {
    label: "fd 1: stdout"
    style.bold: true
    style.stroke: "#3fb950"
  }
  fd2: {
    label: "fd 2: stderr"
    style.bold: true
    style.stroke: "#3fb950"
  }
  
  closed_pipe1_write: {
    label: "pipe1[1] (closed)"
    style.fill: "#1a1a2e"
    style.stroke-dash: 3
    style.stroke: "#8b949e"
  }
  
  closed_pipe2_read: {
    label: "pipe2[0] (closed)"
    style.fill: "#1a1a2e"
    style.stroke-dash: 3
    style.stroke: "#8b949e"
  }
}

cmd3: {
  label: "Process 3 (cmd3)"
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  fd0: {
    label: "fd 0: stdin"
    style.bold: true
    style.stroke: "#3fb950"
  }
  fd1: {
    label: "fd 1: stdout"
    style.bold: true
    style.stroke: "#3fb950"
  }
  fd2: {
    label: "fd 2: stderr"
    style.bold: true
    style.stroke: "#3fb950"
  }
  
  closed_pipe1: {
    label: "pipe1 ends (closed)"
    style.fill: "#1a1a2e"
    style.stroke-dash: 3
    style.stroke: "#8b949e"
  }
  
  closed_pipe2_write: {
    label: "pipe2[1] (closed)"
    style.fill: "#1a1a2e"
    style.stroke-dash: 3
    style.stroke: "#8b949e"
  }
}

terminal.stdin -> cmd1.fd0: "dup2(terminal, 0)"
terminal.stderr -> cmd1.fd2: "dup2(terminal, 2)"
terminal.stderr -> cmd2.fd2: "dup2(terminal, 2)"
terminal.stderr -> cmd3.fd2: "dup2(terminal, 2)"
cmd3.fd1 -> terminal.stdout: "dup2(terminal, 1)"

parent.pipe1.write_end -> cmd1.fd1: "dup2(pipe1[1], 1)"
parent.pipe1.read_end -> cmd2.fd0: "dup2(pipe1[0], 0)"
parent.pipe2.write_end -> cmd2.fd1: "dup2(pipe2[1], 1)"
parent.pipe2.read_end -> cmd3.fd0: "dup2(pipe2[0], 0)"

cmd1 -> parent.pipe1.read_end: "close(pipe1[0])" { style.stroke-dash: 3; style.stroke: "#8b949e" }
cmd1 -> parent.pipe2.read_end: "close(pipe2[0])" { style.stroke-dash: 3; style.stroke: "#8b949e" }
cmd1 -> parent.pipe2.write_end: "close(pipe2[1])" { style.stroke-dash: 3; style.stroke: "#8b949e" }
cmd2 -> parent.pipe1.write_end: "close(pipe1[1])" { style.stroke-dash: 3; style.stroke: "#8b949e" }
cmd2 -> parent.pipe2.read_end: "close(pipe2[0])" { style.stroke-dash: 3; style.stroke: "#8b949e" }
cmd3 -> parent.pipe1.read_end: "close(pipe1[0])" { style.stroke-dash: 3; style.stroke: "#8b949e" }
cmd3 -> parent.pipe1.write_end: "close(pipe1[1])" { style.stroke-dash: 3; style.stroke: "#8b949e" }
cmd3 -> parent.pipe2.write_end: "close(pipe2[1])" { style.stroke-dash: 3; style.stroke: "#8b949e" }

legend: {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  open_fd: "Open File Descriptor" { style.stroke: "#3fb950"; style.bold: true }
  closed_fd: "Closed File Descriptor" { style.stroke-dash: 3; style.stroke: "#8b949e" }
  pipe: "Pipe Connection"
  terminal_conn: "Terminal Connection"
}