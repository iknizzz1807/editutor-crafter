# Gauntlet Shell: Component Architecture

title: "Gauntlet Shell: Component Architecture"

# Main components as containers
repl: REPL (Read-Eval-Print Loop) {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  readline: Readline Module {
    shape: circle
    style.stroke: "#8b949e"
  }
  prompt: Prompt Displayer {
    shape: circle
    style.stroke: "#8b949e"
  }
  signal_handler: Signal Dispatcher {
    shape: circle
    style.stroke: "#8b949e"
  }
  
  readline -> prompt: "display"
  signal_handler -> prompt: "interrupt"
}

parser: Parser {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  lexer: Tokenizer/Lexer {
    shape: parallelogram
    style.stroke: "#8b949e"
  }
  syntax: Syntax Analyzer {
    shape: diamond
    style.stroke: "#8b949e"
  }
  ast_builder: AST Builder {
    shape: page
    style.stroke: "#8b949e"
  }
  
  lexer -> syntax: "tokens"
  syntax -> ast_builder: "valid syntax"
}

executor: Executor {
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  process_mgr: Process Manager {
    shape: hexagon
    style.stroke: "#8b949e"
  }
  fd_mgr: File Descriptor Manager {
    shape: cylinder
    style.stroke: "#8b949e"
  }
  pipeline: Pipeline Orchestrator {
    shape: queue
    style.stroke: "#8b949e"
  }
  
  fd_mgr -> process_mgr: "setup fds"
  pipeline -> process_mgr: "spawn"
  pipeline -> fd_mgr: "pipe creation"
}

job_control: Job Control {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  job_table: Job Table {
    shape: sql_table
    style.stroke: "#8b949e"
  }
  signal_mgr: Signal Manager {
    shape: cloud
    style.stroke: "#8b949e"
  }
  fg_bg: Foreground/Background Manager {
    shape: oval
    style.stroke: "#8b949e"
  }
  
  job_table -> fg_bg: "job state"
  signal_mgr -> fg_bg: "SIGCHLD, SIGINT, SIGTSTP"
}

# Primary data flow
repl.readline -> parser.lexer: "raw command string"
parser.ast_builder -> executor.pipeline: "command AST"
executor.process_mgr -> job_control.job_table: "add/update job"
job_control.signal_mgr -> executor.process_mgr: "signal delivery"
job_control.fg_bg -> repl.prompt: "job state update"

# Function calls and events
repl.signal_handler -> job_control.signal_mgr: "user signals (Ctrl+C/Z)"
executor.pipeline -> job_control.fg_bg: "request foreground/background"
job_control.fg_bg -> repl.readline: "suspend/resume input"

# Bi-directional coordination
executor.process_mgr <-> job_control.job_table: "job lifecycle"
job_control.signal_mgr <-> executor.process_mgr: "signal handling coordination"

# Overall flow direction indicator
direction: right