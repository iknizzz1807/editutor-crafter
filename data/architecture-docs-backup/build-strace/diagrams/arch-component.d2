title: System Component Architecture
direction: right

classes: {
  component_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  interface_style: {
    style.stroke: "#8b949e"
    style.stroke-dash: 3
  }
  kernel_style: {
    style.fill: "#0f3460"
    style.stroke: "#ff7b72"
    style.font-color: "#e6edf3"
  }
  process_style: {
    style.fill: "#16213e"
    style.stroke: "#d2a8ff"
    style.font-color: "#e6edf3"
  }
}

tracer: "System Call Tracer" {
  shape: rectangle
  class: component_style

  process_manager: Process Manager {
    class: component_style
    label: |md
      **Process Manager**
      - Launches child process
      - ptrace(PTRACE_TRACEME)
      - Manages traced processes
    |
  }

  event_dispatcher: Event Dispatcher {
    class: component_style
    label: |md
      **Event Dispatcher**
      - waitpid() for events
      - Distributes to handlers
      - Manages STOP/CONT signals
    |
  }

  decoder: Decoder {
    class: component_style
    label: |md
      **Decoder**
      - Reads register state
      - Maps syscall numbers to names
      - Interprets argument types
      - Reads string arguments
    |
  }

  stats: Stats {
    class: component_style
    label: |md
      **Stats**
      - Collects syscall counts
      - Tracks execution time
      - Generates summary reports
    |
  }

  process_manager -> event_dispatcher: "child PID"
  event_dispatcher -> decoder: "syscall entry/exit"
  decoder -> stats: "decoded syscall data"
}

kernel: Kernel {
  class: kernel_style
  shape: rectangle
  label: |md
    **Linux Kernel**
    - ptrace API
    - System call interface
    - Process management
  |
}

traced_processes: "Traced Process(es)" {
  class: process_style
  shape: rectangle
  label: |md
    **Traced Process**
    - Runs target program
    - Makes syscalls
    - Memory space isolated
  |
}

# ptrace interactions
tracer.process_manager -> kernel: "ptrace(PTRACE_TRACEME/ATTACH)" {
  class: interface_style
}
kernel -> tracer.event_dispatcher: "SIGTRAP on syscall" {
  class: interface_style
}

# Syscall execution flow
traced_processes -> kernel: "syscall execution"
kernel -> traced_processes: "syscall return"

# Data flows
tracer.event_dispatcher -> traced_processes: "PTRACE_SYSCALL"
tracer.decoder -> traced_processes: "PTRACE_PEEKDATA"
traced_processes -> tracer.decoder: "register values"
traced_processes -> tracer.decoder: "memory contents"

# Output
output: "Log/Console Output" {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}
tracer.stats -> output: "statistics & reports"