title: State Machine: A Traced Process

state_machine: {
  direction: down

  init: Initial {
    shape: circle
    label: ""
    style.fill: "#3fb950"
    width: 20
    height: 20
  }

  init -> NEW: fork()

  NEW: NEW (Created) {
    style.fill: "#16213e"
    style.font-color: "#e6edf3"
    style.stroke: "#8b949e"
    style.bold: false
  }

  TRACED_syscall: TRACED (in syscall) {
    style.fill: "#16213e"
    style.font-color: "#e6edf3"
    style.stroke: "#3fb950"
    style.bold: true
  }

  TRACED_signal: TRACED (in signal stop) {
    style.fill: "#16213e"
    style.font-color: "#e6edf3"
    style.stroke: "#3fb950"
    style.bold: true
  }

  TRACED_event: TRACED (PTRACE_EVENT) {
    style.fill: "#16213e"
    style.font-color: "#e6edf3"
    style.stroke: "#3fb950"
    style.bold: true
  }

  EXITED: EXITED {
    shape: circle
    style.double-border: true
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    style.fill: "#1a1a2e"
  }

  NEW -> TRACED_signal: PTRACE_ATTACH/PTRACE_SEIZE
  NEW -> TRACED_event: PTRACE_TRACEME (child)

  TRACED_signal -> TRACED_syscall: PTRACE_SYSCALL
  TRACED_signal -> TRACED_event: PTRACE_SETOPTIONS + event occurs
  TRACED_signal -> EXITED: exit/kill

  TRACED_syscall -> TRACED_syscall: PTRACE_SYSCALL (next entry/exit)
  TRACED_syscall -> TRACED_signal: signal delivered
  TRACED_syscall -> TRACED_event: PTRACE_EVENT (fork/exec/etc.)
  TRACED_syscall -> EXITED: exit_group

  TRACED_event -> TRACED_signal: PTRACE_CONT
  TRACED_event -> TRACED_syscall: PTRACE_SYSCALL
  TRACED_event -> EXITED: exit after event
}