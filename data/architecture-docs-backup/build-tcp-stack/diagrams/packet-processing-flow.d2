direction: down

title: Incoming Packet Processing Flow

start: Incoming Ethernet Frame {
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
}

check_ethertype: Check EtherType {
  shape: diamond
  style.fill: "#16213e"
  style.font-color: "#e6edf3"
  style.stroke: "#3fb950"
}

arp_processing: Process ARP Packet {
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
}

ip_processing: Process IPv4 Packet {
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
}

check_ip_protocol: Check IP Protocol {
  shape: diamond
  style.fill: "#16213e"
  style.font-color: "#e6edf3"
  style.stroke: "#3fb950"
}

icmp_processing: Process ICMP Packet {
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
}

tcp_find_tcb: Find TCB (Transmission Control Block) {
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
}

tcp_process_state: Process TCP State Machine {
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
}

validate_checksum: Validate IPv4 Checksum {
  shape: diamond
  style.fill: "#16213e"
  style.font-color: "#e6edf3"
  style.stroke: "#3fb950"
}

drop_packet_1: Drop Packet {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#f85149"
  style.bold: true
}

drop_packet_2: Drop Packet {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#f85149"
  style.bold: true
}

drop_packet_3: Drop Packet {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#f85149"
  style.bold: true
}

drop_packet_4: Drop Packet {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#f85149"
  style.bold: true
}

end_arp: End ARP Processing {
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
}

end_icmp: End ICMP Processing {
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
}

end_tcp: End TCP Processing {
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
}

start -> check_ethertype

check_ethertype -> arp_processing: ARP (0x0806)
check_ethertype -> validate_checksum: IPv4 (0x0800)
check_ethertype -> drop_packet_1: Other EtherType

arp_processing -> end_arp

validate_checksum -> ip_processing: Valid
validate_checksum -> drop_packet_2: Invalid

ip_processing -> check_ip_protocol

check_ip_protocol -> icmp_processing: ICMP (1)
check_ip_protocol -> tcp_find_tcb: TCP (6)
check_ip_protocol -> drop_packet_3: Other Protocol

icmp_processing -> end_icmp

tcp_find_tcb -> tcp_process_state: TCB Found
tcp_find_tcb -> drop_packet_4: No TCB

tcp_process_state -> end_tcp