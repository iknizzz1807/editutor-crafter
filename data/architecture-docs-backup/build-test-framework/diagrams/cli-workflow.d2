title: CLI Workflow
desc: Flowchart for the main CLI workflow

classes: {
  dark_theme: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.border-radius: 2
  }
  action_node: {
    shape: rectangle
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: false
  }
  decision_node: {
    shape: diamond
    style.fill: "#0f3460"
    style.stroke: "#ff7e5f"
    style.font-color: "#e6edf3"
    style.bold: false
  }
  start_end_node: {
    shape: rectangle
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    style.bold: true
    style.double-border: true
  }
  data_node: {
    shape: cylinder
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    style.bold: false
  }
}

Start: "Start: CLI invoked" {
  class: start_end_node
}

ParseArgs: "Parse CLI arguments" {
  class: action_node
}

HelpDecision: "Check if --help flag present" {
  class: decision_node
}

PrintHelp: "Print help message" {
  class: action_node
}

ExitHelp: "Exit (code 0)" {
  class: start_end_node
}

ConvertPaths: "Convert file patterns to absolute paths" {
  class: action_node
}

Discoverer: "Discoverer: find and load tests" {
  class: action_node
}

TestSuite: TestSuite {
  shape: sql_table
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  tests: "List[TestCase]"
  fixtures: "List[Fixture]"
  metadata: "Dict"
}

Runner: "Runner: execute tests" {
  class: action_node
}

CollectResults: "Collect execution results" {
  class: action_node
}

Reporter: "Reporter: format results" {
  class: action_node
}

Output: "Output to stdout or file" {
  class: action_node
}

SetExitCode: "Set exit code" {
  class: decision_node
}

ExitSuccess: "Exit (code 0)" {
  class: start_end_node
}

ExitFailure: "Exit (code non-zero)" {
  class: start_end_node
}

Start -> ParseArgs
ParseArgs -> HelpDecision
HelpDecision -> PrintHelp: "Yes"
PrintHelp -> ExitHelp
HelpDecision -> ConvertPaths: "No"
ConvertPaths -> Discoverer
Discoverer -> TestSuite: "produces"
TestSuite -> Runner
Runner -> CollectResults
CollectResults -> Reporter
Reporter -> Output
Output -> SetExitCode
SetExitCode -> ExitSuccess: "All tests passed"
SetExitCode -> ExitFailure: "Some tests failed"