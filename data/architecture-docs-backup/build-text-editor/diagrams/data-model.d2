direction: right

title: Core Data Structures {
  style.font-size: 18
  style.bold: true
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
}

EditorState: {
  shape: class
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  fields: |md
    - buffer: TextBuffer*
    - viewport: ViewPort
    - cursor: Cursor
    - undo_stack: UndoStack
    - filename: char*
    - dirty: bool
    - quit_times: int
  |
  
  methods: |md
    + init_editor()
    + cleanup_editor()
    + set_status_message()
    + prompt_user()
  |
}

TextBuffer: {
  shape: class
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  fields: |md
    - rows: erow*
    - numrows: int
    - capacity: int
  |
  
  methods: |md
    + insert_row()
    + delete_row()
    + row_insert_char()
    + row_delete_char()
    + row_to_string()
    + update_row()
  |
}

ViewPort: {
  shape: class
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  fields: |md
    - row_offset: int
    - col_offset: int
    - screen_rows: int
    - screen_cols: int
    - status_msg: char[80]
    - status_msg_time: time_t
  |
  
  methods: |md
    + scroll()
    + get_window_size()
    + refresh_screen()
  |
}

Cursor: {
  shape: class
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  fields: |md
    - x: int
    - y: int
    - rx: int
  |
  
  methods: |md
    + move_cursor()
    + cursor_position_to_row_x()
    + row_x_to_cursor_position()
  |
}

UndoStack: {
  shape: class
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  fields: |md
    - operations: UndoOp*
    - capacity: int
    - count: int
    - current: int
  |
  
  methods: |md
    + push_operation()
    + undo()
    + redo()
    + clear_stack()
  |
}

erow: {
  shape: class
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  
  fields: |md
    - chars: char*
    - size: int
    - render: char*
    - rsize: int
    - hl: unsigned char*
  |
  
  methods: |md
    + update_syntax()
    + expand_tabs()
  |
}

UndoOp: {
  shape: class
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  
  fields: |md
    - type: OpType
    - row: int
    - col: int
    - data: char*
    - cursor_x: int
    - cursor_y: int
  |
}

EditorState -> TextBuffer: "1" {
  style.stroke: "#3fb950"
  style.stroke-width: 2
}

EditorState -> ViewPort: "1" {
  style.stroke: "#3fb950"
  style.stroke-width: 2
}

EditorState -> Cursor: "1" {
  style.stroke: "#3fb950"
  style.stroke-width: 2
}

EditorState -> UndoStack: "1" {
  style.stroke: "#3fb950"
  style.stroke-width: 2
}

TextBuffer -> erow: "0..*" {
  style.stroke: "#8b949e"
  style.stroke-dash: 5
}

UndoStack -> UndoOp: "0..*" {
  style.stroke: "#8b949e"
  style.stroke-dash: 5
}