direction: right

title: Screen Rendering Pipeline

# Input Stage
buffer: Text Buffer {
  shape: cylinder
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

cursor_state: Cursor State {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

editor_state: Editor State {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# Processing Pipeline
viewport: Viewport Calculator {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

formatter: Line Formatter {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

highlighter: Syntax Highlighter {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

ansi_gen: ANSI Generator {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

# Output Buffer
output_buffer: Screen Buffer {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

terminal: Terminal Output {
  shape: rectangle
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

# Flow connections
buffer -> viewport: visible lines
cursor_state -> viewport: scroll offset
editor_state -> viewport: window size

viewport -> formatter: text rows
formatter -> highlighter: formatted lines
highlighter -> ansi_gen: colored tokens

ansi_gen -> output_buffer: escape sequences
output_buffer -> terminal: buffered output

# Data flow labels
viewport.style.stroke: "#8b949e"
formatter.style.stroke: "#8b949e" 
highlighter.style.stroke: "#8b949e"
ansi_gen.style.stroke: "#8b949e"