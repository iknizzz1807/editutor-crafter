direction: down

title: Record Layer Processing Pipeline {
  style.font-size: 24
  style.font-color: "#e6edf3"
}

incoming_bytes: Incoming Bytes {
  shape: cylinder
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

header_parser: Record Header Parser {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

fragment_check: Message Complete? {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

fragment_buffer: Fragment Buffer {
  shape: queue
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

content_router: Content Type Router {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

decrypt_check: Encrypted? {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

decryption: AEA Decryption {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

protocol_layers: Upper Protocol Layers {
  handshake: Handshake Protocol {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  alert: Alert Protocol {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  application: Application Data {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

incoming_bytes -> header_parser: parse header
header_parser -> fragment_check: extract metadata
fragment_check -> fragment_buffer: No {style.stroke: "#8b949e"}
fragment_buffer -> fragment_check: reassemble {style.stroke: "#8b949e"}
fragment_check -> content_router: Yes {style.stroke: "#3fb950"}
content_router -> decrypt_check: route by type
decrypt_check -> decryption: Yes {style.stroke: "#3fb950"}
decrypt_check -> protocol_layers.handshake: No - Handshake {style.stroke: "#8b949e"}
decrypt_check -> protocol_layers.alert: No - Alert {style.stroke: "#8b949e"}
decryption -> protocol_layers.application: deliver data
decryption -> protocol_layers.handshake: deliver handshake