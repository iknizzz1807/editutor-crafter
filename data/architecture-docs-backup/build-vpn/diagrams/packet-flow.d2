title: Packet Processing Flow {
  style.font-color: "#e6edf3"
}

local_side: Local Side {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  
  app: Application {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  net_stack: Network Stack {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  tun: TUN Interface {
    shape: hexagon
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.bold: true
    style.font-color: "#e6edf3"
  }
  
  encrypt: Encryption {
    shape: diamond
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  udp: UDP Socket {
    shape: cylinder
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

network: Network {
  shape: cloud
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

remote_side: Remote VPN Side {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  
  remote_udp: UDP Socket {
    shape: cylinder
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  decrypt: Decryption {
    shape: diamond
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  remote_tun: Remote TUN {
    shape: hexagon
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.bold: true
    style.font-color: "#e6edf3"
  }
  
  remote_net_stack: Remote Network Stack {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  remote_app: Remote Application {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

local_side.app -> local_side.net_stack: IP packets {
  style.stroke: "#8b949e"
}
local_side.net_stack -> local_side.tun: intercept {
  style.stroke: "#8b949e"
}
local_side.tun -> local_side.encrypt: raw packets {
  style.stroke: "#8b949e"
}
local_side.encrypt -> local_side.udp: encrypted data {
  style.stroke: "#8b949e"
}
local_side.udp -> network: UDP packets {
  style.stroke: "#8b949e"
}
network -> remote_side.remote_udp: encrypted tunnel {
  style.stroke: "#8b949e"
}
remote_side.remote_udp -> remote_side.decrypt: encrypted data {
  style.stroke: "#8b949e"
}
remote_side.decrypt -> remote_side.remote_tun: decrypted packets {
  style.stroke: "#8b949e"
}
remote_side.remote_tun -> remote_side.remote_net_stack: inject packets {
  style.stroke: "#8b949e"
}
remote_side.remote_net_stack -> remote_side.remote_app: deliver {
  style.stroke: "#8b949e"
}