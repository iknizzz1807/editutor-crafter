direction: right

# States
disconnected: Disconnected {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.stroke-width: 3
}

handshaking: Handshaking {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#ffa500"
  style.font-color: "#e6edf3"
  style.stroke-width: 2
}

connected: Connected {
  shape: circle
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.stroke-width: 3
  style.bold: true
}

rekeying: Rekeying {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#ffa500"
  style.font-color: "#e6edf3"
  style.stroke-width: 2
}

# State transitions
disconnected -> handshaking: Start Handshake {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

handshaking -> handshaking: Receive Public Key {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

handshaking -> connected: Authentication Success {
  style.stroke: "#3fb950"
  style.font-color: "#3fb950"
  style.bold: true
}

handshaking -> disconnected: Authentication Failure {
  style.stroke: "#d63031"
  style.font-color: "#d63031"
}

connected -> rekeying: Key Rotation Timer {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

rekeying -> connected: Key Exchange Complete {
  style.stroke: "#3fb950"
  style.font-color: "#3fb950"
}

rekeying -> disconnected: Rekey Failure {
  style.stroke: "#d63031"
  style.font-color: "#d63031"
}

connected -> disconnected: Connection Lost {
  style.stroke: "#d63031"
  style.font-color: "#d63031"
}

# Event legend
events: Events {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  start: "• Start Handshake" {
    shape: text
    style.font-color: "#8b949e"
  }
  
  pubkey: "• Receive Public Key" {
    shape: text
    style.font-color: "#8b949e"
  }
  
  success: "• Authentication Success" {
    shape: text
    style.font-color: "#3fb950"
  }
  
  failure: "• Authentication Failure" {
    shape: text
    style.font-color: "#d63031"
  }
  
  timer: "• Key Rotation Timer" {
    shape: text
    style.font-color: "#8b949e"
  }
  
  lost: "• Connection Lost" {
    shape: text
    style.font-color: "#d63031"
  }
}