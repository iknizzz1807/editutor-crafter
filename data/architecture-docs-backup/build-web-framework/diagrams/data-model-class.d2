title: "Core Data Model: Class Relationships"
direction: right

classes: {
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

Application: {
  shape: class
  router: Router
  middlewares: "Layer[]"
  settings: Map
  listen:  "(port: number) => void"
  use:  "(middleware: Function) => Application"
  handle:  "(req: Request, res: Response) => void"
}

Router: {
  shape: class
  routes: Map
  middlewareStack: "Layer[]"
  register:  "(path: string, method: string, handler: Function) => void"
  match:  "(req: Request) => Route"
  use:  "(...handlers: Function[]) => Router"
}

Route: {
  shape: class
  path: string
  method: string
  handler: Function
  route_layers: "Layer[]"
  dispatch:  "(req: Request, res: Response) => void"
}

Layer: {
  shape: class
  handler: Function
  path: string
  options: Map
  match:  "(path: string) => boolean"
  handle:  "(req: Request, res: Response, next: Function) => void"
}

Request: {
  shape: class
  method: string
  url: string
  headers: Map
  params: Map
  query: Map
  body: any
  getHeader:  "(name: string) => string"
  param:  "(name: string) => string"
}

Response: {
  shape: class
  statusCode: number
  headers: Map
  body: any
  status:  "(code: number) => Response"
  send:  "(data: any) => void"
  json:  "(data: any) => void"
  render:  "(template: string, data: object) => void"
}

Template: {
  shape: class
  name: string
  path: string
  engine: Function
  cache: boolean
  render:  "(data: object) => string"
  compile:  "() => Function"
}

Application -> Router: "1 router" {style.stroke-width: 2}
Router -> Route: "0..* routes" {style.stroke-width: 2}
Route -> Layer: "0..* layers" {style.stroke-width: 2}

Application -> Layer: "0..* middlewares" {style.stroke-dash: 3; style.stroke-width: 1}
Router -> Layer: "0..* middlewareStack" {style.stroke-dash: 3; style.stroke-width: 1}

Request -- Response: "paired"
Layer -> Request: "handles" {style.stroke-dash: 2}
Layer -> Response: "modifies" {style.stroke-dash: 2}
Response -> Template: "renders" {style.stroke-dash: 2}

Application -> Request: "creates"
Application -> Response: "creates"

note: |md
  ## Theater Production Analogy
  - **Application** = Theater
  - **Router** = Stage Manager
  - **Layer** = Technician (Lighting/Sound)
  - **Request/Response** = Lead Actors
  - **Template** = Script with Placeholders
| {
  shape: page
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#3fb950"
}