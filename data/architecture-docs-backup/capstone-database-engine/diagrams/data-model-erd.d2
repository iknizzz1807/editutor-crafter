title: Core Data Model Entity Relationship Diagram
desc: A class diagram showing key in-memory and on-disk data structures

core_data_model: {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"

  catalog: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.bold: true
    
    database: {
      shape: sql_table
      database_id: int
      name: string
      created_at: timestamp
    }
    
    table: {
      shape: sql_table
      table_id: int
      name: string
      row_count: int
      page_count: int
      created_at: timestamp
    }
    
    column: {
      shape: sql_table
      column_id: int
      name: string
      data_type: DataType
      nullable: bool
      default_value: any
    }
    
    Relationships: {
      database -> table: "has many" {
        style.stroke-width: 2
        style.stroke-dash: 0
      }
      table -> column: "has many" {
        style.stroke-width: 2
        style.stroke-dash: 0
      }
    }
  }

  storage: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.bold: true
    
    page: {
      shape: sql_table
      page_id: int
      page_type: PageType
      data: "byte[]"
      free_space: int
      lsn: int
    }
    
    slotted_record: {
      shape: sql_table
      slot_id: int
      record_data: "byte[]"
      record_size: int
      is_deleted: bool
      xmin: int
      xmax: int
    }
    
    btree_node: {
      shape: sql_table
      node_id: int
      is_leaf: bool
      keys: "any[]"
      children: "int[]"
      values: "any[]"
    }
    
    wal_record: {
      shape: sql_table
      lsn: int
      transaction_id: int
      page_id: int
      operation: OperationType
      redo_data: "byte[]"
      undo_data: "byte[]"
      timestamp: timestamp
    }
    
    Relationships: {
      page -> slotted_record: "contains many" {
        style.stroke-width: 2
        style.stroke-dash: 0
      }
      btree_node -> page: "references" {
        style.stroke-dash: 3
      }
    }
  }

  transactions: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.bold: true
    
    transaction: {
      shape: sql_table
      transaction_id: int
      state: TransactionState
      isolation_level: IsolationLevel
      start_time: timestamp
      read_set: "int[]"
      write_set: "int[]"
      snapshot_ref: Snapshot
    }
    
    snapshot: {
      shape: sql_table
      snapshot_id: int
      active_transactions: "int[]"
      xmin: int
      xmax: int
      created_at: timestamp
    }
    
    Relationships: {
      transaction -> snapshot: "creates/has" {
        style.stroke-width: 2
        style.stroke-dash: 0
      }
      transaction -> wal_record: "generates" {
        style.stroke-dash: 3
      }
      wal_record -> transaction: "belongs to" {
        style.stroke-dash: 3
      }
    }
  }

  catalog.table -> storage.btree_node: "indexed by" {
    style.stroke-dash: 3
  }
  storage.page -> catalog.table: "belongs to" {
    style.stroke-dash: 3
  }
  transactions.transaction -> catalog.database: "operates on" {
    style.stroke-dash: 3
  }
}