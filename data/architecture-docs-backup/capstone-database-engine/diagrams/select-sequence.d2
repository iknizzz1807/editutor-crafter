shape: sequence_diagram
title: Sequence Diagram: Processing a SELECT Query

Client: Client
ProtocolServer: Protocol Server
Parser: Parser
Optimizer: Optimizer
Executor: Executor
BufferPool: Buffer Pool
DiskManager: Disk Manager

Client -> ProtocolServer: QueryMessage (SQL string)
ProtocolServer -> Parser: Parse SQL
note: Recursive descent parser converts SQL to AST {
  style.stroke: "#3fb950"
  style.bold: true
}

Parser -> Optimizer: AST (SelectStmt)
Optimizer -> Optimizer: Logical Planning
Optimizer -> Optimizer: Cost-based Optimization
note: Join ordering, index selection, pushdown {
  style.stroke: "#3fb950"
}

Optimizer -> Executor: Optimized Physical Plan
Executor -> BufferPool: Request Page (table/index)
BufferPool -> DiskManager: Read Page (if cache miss)
DiskManager -> BufferPool: Page Data
BufferPool -> Executor: Page
Executor -> Executor: Process Rows (join, filter, aggregate)
Executor -> BufferPool: More Page Requests...
BufferPool -> Executor: More Pages
Executor -> Executor: Finalize (sort, limit)

Executor -> ProtocolServer: Result Set
ProtocolServer -> Client: Result Rows