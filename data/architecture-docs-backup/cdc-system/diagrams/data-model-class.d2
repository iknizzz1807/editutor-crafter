title: Data Model Class Diagram

classes: {
  data_model_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

RawLogEntry: {
  shape: class
  - "log_sequence_number: string"
  - "operation_type: string"
  - "table_name: string"
  - "raw_data: Map<string, any>"
  - "timestamp: DateTime"
  - "transaction_id: string"
  - "source_database: string"
  label: "RawLogEntry\n(Raw material from transaction log)"
  class: data_model_style
}

ChangeEvent: {
  shape: class
  - "event_id: UUID"
  - "lsn: string"
  - "offset: int64"
  - "operation: INSERT | UPDATE | DELETE"
  - "table_name: string"
  - "schema_version_id: UUID"
  - "before_image: Map<string, any> | null"
  - "after_image: Map<string, any> | null"
  - "timestamp: DateTime"
  - "transaction_id: string"
  - "processed_at: DateTime"
  label: "ChangeEvent\n(Finished product for consumers)"
  class: data_model_style
}

SchemaVersion: {
  shape: class
  - "id: UUID"
  - "table_name: string"
  - "version: int"
  - "schema_definition: TableSchema"
  - "effective_from: DateTime"
  - "effective_to: DateTime | null"
  - "created_at: DateTime"
  label: "SchemaVersion\n(Blueprint for data interpretation)"
  class: data_model_style
}

TableSchema: {
  shape: class
  - "table_name: string"
  - "columns: ColumnDefinition list"
  - "primary_key: string list"
  - "created_at: DateTime"
  - "updated_at: DateTime"
  label: "TableSchema\n(Table structure definition)"
  class: data_model_style
}

RawLogEntry -> ChangeEvent: "transforms to" {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

ChangeEvent -> SchemaVersion: "has" {
  style.stroke: "#3fb950"
  target-arrowhead.shape: diamond
}

SchemaVersion -> TableSchema: "references" {
  style.stroke: "#8b949e"
}

note: |md
  ## Data Flow
  1. **RawLogEntry**: Raw database log entry
  2. **ChangeEvent**: Normalized change notification
  3. **SchemaVersion**: Schema at time of change
  4. **TableSchema**: Table structure definition
| {
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}