title: High-Level System Component Diagram
direction: right

classes: {
  dark_container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.border-radius: 5
  }
  dark_component: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  control_flow: {
    style.stroke: "#ff7b72"
    style.stroke-dash: 3
  }
  data_flow: {
    style.stroke: "#3fb950"
    style.bold: true
  }
  edge_node: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

# Main containers
client_group: {
  shape: rectangle
  class: dark_container
  label: "User Devices"

  client: Client {
    class: dark_component
    shape: rectangle
  }
}

edge_network: Edge Network {
  shape: rectangle
  class: dark_container

  edge_node_1: Edge Node {
    class: edge_node
    shape: rectangle
  }
  edge_node_2: Edge Node {
    class: edge_node
    shape: rectangle
  }
  edge_node_3: Edge Node {
    class: edge_node
    shape: rectangle
  }

  edge_node_1 <-> edge_node_2: "cache sync"
  edge_node_2 <-> edge_node_3: "cache sync"
}

origin_shield: Origin Shield {
  shape: rectangle
  class: dark_component
}

origin: Origin Server {
  shape: cylinder
  class: dark_component
}

control_plane: Control Plane {
  shape: rectangle
  class: dark_container

  config_mgr: Configuration Manager {
    class: dark_component
    shape: rectangle
  }
  invalidation: Invalidation Service {
    class: dark_component
    shape: rectangle
  }
  monitoring: Monitoring & Analytics {
    class: dark_component
    shape: rectangle
  }

  config_mgr -> invalidation
  invalidation -> monitoring
}

# Data flow (user requests) - solid lines
client -> edge_node_1: "HTTP Request" {
  class: data_flow
}
edge_node_1 -> origin_shield: "Cache Miss / TTL Expired" {
  class: data_flow
}
origin_shield -> origin: "Cache Miss at Shield" {
  class: data_flow
}
origin -> origin_shield: "Origin Response" {
  class: data_flow
}
origin_shield -> edge_node_1: "Cached Response" {
  class: data_flow
}
edge_node_1 -> client: "HTTP Response" {
  class: data_flow
}

# Control flow - dashed lines
control_plane.config_mgr -> edge_network: "Configuration Updates" {
  class: control_flow
}
control_plane.config_mgr -> origin_shield: "Shield Configuration" {
  class: control_flow
}
control_plane.config_mgr -> origin: "Origin Configuration" {
  class: control_flow
}
control_plane.invalidation -> edge_network: "Cache Invalidation" {
  class: control_flow
}
control_plane.invalidation -> origin_shield: "Shield Invalidation" {
  class: control_flow
}
edge_network -> control_plane.monitoring: "Metrics & Health" {
  class: control_flow
}
origin_shield -> control_plane.monitoring: "Shield Metrics" {
  class: control_flow
}
origin -> control_plane.monitoring: "Origin Metrics" {
  class: control_flow
}
