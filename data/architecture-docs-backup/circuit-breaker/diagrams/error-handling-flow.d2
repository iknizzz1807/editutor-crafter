direction: right

title: Error Classification and Handling {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  process: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  critical: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  success: {
    style.fill: "#00b894"
    style.stroke: "#00cec9"
    style.font-color: "#ffffff"
  }
}

error_input: Incoming Error {
  class: container
}

classify: Classify Error Type {
  shape: diamond
  class: decision
}

network_check: Network Error? {
  shape: diamond
  class: decision
}

timeout_check: Timeout Error? {
  shape: diamond
  class: decision
}

service_check: Service Error? {
  shape: diamond
  class: decision
}

circuit_state: Check Circuit State {
  shape: diamond
  class: decision
}

failure_count: Increment Failure Count {
  class: process
}

threshold_check: Failure Threshold Exceeded? {
  shape: diamond
  class: critical
}

open_circuit: Open Circuit {
  class: critical
}

execute_fallback: Execute Fallback {
  class: process
}

fallback_success: Fallback Success? {
  shape: diamond
  class: decision
}

fallback_response: Return Fallback Response {
  class: success
}

fallback_error: Log Fallback Failure {
  class: critical
}

default_response: Return Default Response {
  class: process
}

update_metrics: Update Error Metrics {
  class: process
}

log_error: Log Error Details {
  class: process
}

half_open_check: Half-Open State? {
  shape: diamond
  class: decision
}

reset_circuit: Reset to Closed {
  class: success
}

maintain_open: Keep Circuit Open {
  class: critical
}

error_input -> classify
classify -> network_check: Start Classification
network_check -> timeout_check: No
network_check -> circuit_state: Yes - Network Error
timeout_check -> service_check: No
timeout_check -> circuit_state: Yes - Timeout
service_check -> circuit_state: Yes - Service Error
service_check -> log_error: No - Unknown Error

circuit_state -> failure_count: Circuit Closed/Half-Open
circuit_state -> execute_fallback: Circuit Open

failure_count -> threshold_check
threshold_check -> open_circuit: Yes
threshold_check -> update_metrics: No

open_circuit -> execute_fallback
execute_fallback -> fallback_success

fallback_success -> fallback_response: Yes
fallback_success -> fallback_error: No

fallback_error -> default_response

update_metrics -> half_open_check
half_open_check -> reset_circuit: Success Pattern Detected
half_open_check -> maintain_open: Still Failing

log_error -> update_metrics

fallback_response -> update_metrics: Update Success Metrics
default_response -> update_metrics: Update Fallback Metrics
reset_circuit -> update_metrics: Update Recovery Metrics
maintain_open -> update_metrics: Update Failure Metrics