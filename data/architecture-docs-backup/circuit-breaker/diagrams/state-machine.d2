title: Circuit Breaker State Machine

classes: {
  state: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  initial_state: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#1a1a2e"
  }
}

init: {
  shape: circle
  label: ""
  class: initial_state
}

closed: Closed {
  shape: circle
  class: state
}

open: Open {
  shape: circle
  class: state
}

half_open: Half-Open {
  shape: circle
  class: state
}

init -> closed: {
  class: transition
}

closed -> open: failure_threshold_reached {
  class: transition
}

open -> half_open: timeout_expired {
  class: transition
}

half_open -> closed: success_in_half_open {
  class: transition
}

half_open -> open: failure_in_half_open {
  class: transition
}

closed_note: |md
  **CLOSED STATE**
  - Requests flow normally
  - Monitors failure rate
  - Tracks response times
| {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: bottom-left
}

open_note: |md
  **OPEN STATE**
  - Blocks all requests
  - Returns fast failures
  - Timer counts down
| {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: top-right
}

half_open_note: |md
  **HALF-OPEN STATE**
  - Limited test requests
  - Evaluates service health
  - Quick state transition
| {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: bottom-right
}