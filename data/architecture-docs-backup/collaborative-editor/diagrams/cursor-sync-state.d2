title: Cursor Synchronization State Machine {
  near: top-center
  style.font-size: 18
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  state: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.stroke-width: 2
  }
  initial: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#1a1a2e"
    style.bold: true
  }
  final: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
    style.stroke-width: 2
  }
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    style.font-size: 12
  }
  important: {
    style.stroke: "#e17055"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

init: {
  shape: circle
  class: initial
  label: ""
}

local_position: Local Position {
  shape: circle
  class: state
}

synchronizing: Synchronizing {
  shape: circle
  class: state
}

transformed: Transformed {
  shape: circle
  class: state
}

synchronized: Synchronized {
  shape: circle
  class: state
}

conflict_resolution: Conflict Resolution {
  shape: circle
  class: state
}

disconnected: Disconnected {
  shape: circle
  class: final
}

init -> local_position: "cursor move" {
  class: transition
}

local_position -> synchronizing: "send position update" {
  class: transition
}

local_position -> local_position: "local cursor move" {
  class: transition
}

synchronizing -> synchronized: "ack received" {
  class: transition
}

synchronizing -> disconnected: "network timeout" {
  class: important
}

synchronized -> local_position: "user moves cursor" {
  class: transition
}

synchronized -> transformed: "remote edit received" {
  class: important
}

transformed -> synchronizing: "send transformed position" {
  class: transition
}

transformed -> conflict_resolution: "transformation conflict" {
  class: important
}

conflict_resolution -> transformed: "conflict resolved" {
  class: transition
}

conflict_resolution -> disconnected: "unresolvable conflict" {
  class: important
}

disconnected -> local_position: "reconnect" {
  class: transition
}

transformation_note: |md
  **Position Transformation**
  - Insert before cursor: position += length
  - Delete before cursor: position -= length
  - Insert/delete after cursor: no change
| {
  shape: page
  near: bottom-right
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

events_note: |md
  **Key Events**
  - Cursor movement (local)
  - Remote edits (insertions/deletions)
  - Network acknowledgments
  - Transformation conflicts
| {
  shape: page
  near: bottom-left
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}