title: Error Detection and Reporting Flow

classes: {
  error_source: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  
  detection_node: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  enrichment_node: {
    style.fill: "#16213e"
    style.stroke: "#74b9ff"
    style.font-color: "#e6edf3"
  }
  
  output_node: {
    style.fill: "#0f3460"
    style.stroke: "#fdcb6e"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

lexical: Lexical Errors {
  class: error_source
  shape: diamond
}

syntax: Syntax Errors {
  class: error_source
  shape: diamond
}

semantic: Semantic Errors {
  class: error_source
  shape: diamond
}

tokenizer: Tokenizer {
  class: detection_node
}

parser: Parser {
  class: detection_node
}

validator: Semantic Validator {
  class: detection_node
}

error_collector: Error Collector {
  class: enrichment_node
}

context_enricher: Context Enricher {
  class: enrichment_node
}

error_formatter: Error Formatter {
  class: enrichment_node
}

format_detector: Format Detector {
  class: enrichment_node
}

user_message: User-Friendly Message {
  class: output_node
}

debug_info: Debug Information {
  class: output_node
}

recovery_suggestions: Recovery Suggestions {
  class: output_node
}

lexical -> tokenizer: "Invalid characters\nUnrecognized tokens"
syntax -> parser: "Malformed structure\nMissing delimiters"
semantic -> validator: "Type conflicts\nInvalid references"

tokenizer -> error_collector: "Token position\nCharacter offset"
parser -> error_collector: "Parse tree context\nExpected tokens"
validator -> error_collector: "Validation rules\nConflict details"

error_collector -> context_enricher: Raw error data

context_enricher -> format_detector: Error context
format_detector -> error_formatter: "Format-specific\nrules applied"

context_enricher -> error_formatter: "Line numbers\nColumn positions\nSurrounding text"

error_formatter -> user_message: "Clear explanation\nSpecific location"
error_formatter -> debug_info: "Technical details\nStack trace"
error_formatter -> recovery_suggestions: "Fix recommendations\nExample corrections"

note: |md
  **Error Flow Process:**
  
  1. **Detection**: Each parser component detects format-specific errors
  2. **Collection**: Central collector gathers error details with position info
  3. **Enrichment**: Context enricher adds line/column data and surrounding text
  4. **Formatting**: Format-aware formatter creates appropriate error messages
  5. **Output**: Multiple output formats for different audiences
| {
  near: bottom-center
  shape: page
  class: enrichment_node
}