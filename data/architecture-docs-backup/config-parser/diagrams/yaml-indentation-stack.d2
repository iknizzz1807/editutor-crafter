title: YAML Indentation Stack Management
direction: down

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  stack_op: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
}

start: Start {
  shape: circle
  class: process
}

read_line: Read Line {
  class: process
}

measure_indent: Measure Indentation {
  class: process
}

check_indent: Current > Stack Top? {
  shape: diamond
  class: decision
}

push_indent: Push Indentation\nto Stack {
  class: stack_op
}

start_block: Start New Block {
  class: process
}

check_equal: Current = Stack Top? {
  shape: diamond
  class: decision
}

continue_block: Continue Block\nat Same Level {
  class: process
}

check_valid: Valid Dedent? {
  shape: diamond
  class: decision
}

pop_stack: Pop Stack Until\nMatching Level {
  class: stack_op
}

end_blocks: End Nested Blocks {
  class: process
}

indent_error: Indentation Error {
  class: error
}

parse_content: Parse Line Content {
  class: process
}

check_more: More Lines? {
  shape: diamond
  class: decision
}

complete: Complete {
  shape: circle
  class: process
}

stack_display: Indentation Stack {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

stack_note: |md
  **Stack Operations:**
  - Push: New deeper level
  - Pop: Return to shallower level
  - Validate: Ensure proper nesting
| {
  shape: page
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  near: bottom-right
}

start -> read_line
read_line -> measure_indent
measure_indent -> check_indent

check_indent -> push_indent: Yes\n(Deeper)
push_indent -> start_block
start_block -> parse_content

check_indent -> check_equal: No
check_equal -> continue_block: Yes\n(Same Level)
continue_block -> parse_content

check_equal -> check_valid: No\n(Shallower)
check_valid -> pop_stack: Yes
pop_stack -> end_blocks
end_blocks -> parse_content

check_valid -> indent_error: No\n(Invalid)

parse_content -> check_more
check_more -> read_line: Yes
check_more -> complete: No

measure_indent -> stack_display: updates
push_indent -> stack_display: modifies
pop_stack -> stack_display: modifies