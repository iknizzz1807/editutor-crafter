title: Cgroups Resource Control Hierarchy

classes: {
  cgroup_controller: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  cgroup_node: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  process_node: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    shape: circle
  }
  limit_text: {
    style.fill: "#2d1b69"
    style.stroke: "#f39c12"
    style.font-color: "#f39c12"
    shape: page
  }
}

cgroupfs: /sys/fs/cgroup {
  class: cgroup_controller
  
  memory_controller: memory {
    class: cgroup_controller
    
    system_slice: system.slice {
      class: cgroup_node
    }
    
    user_slice: user.slice {
      class: cgroup_node
    }
    
    docker_slice: docker {
      class: cgroup_node
      
      container1: container-abc123 {
        class: cgroup_node
        
        proc1: PID 1001 {
          class: process_node
        }
        
        proc2: PID 1002 {
          class: process_node
        }
      }
      
      container2: container-def456 {
        class: cgroup_node
        
        proc3: PID 1003 {
          class: process_node
        }
      }
    }
  }
  
  cpu_controller: cpu {
    class: cgroup_controller
    
    cpu_system: system.slice {
      class: cgroup_node
    }
    
    cpu_docker: docker {
      class: cgroup_node
      
      cpu_container1: container-abc123 {
        class: cgroup_node
      }
      
      cpu_container2: container-def456 {
        class: cgroup_node
      }
    }
  }
  
  pids_controller: pids {
    class: cgroup_controller
    
    pids_docker: docker {
      class: cgroup_node
      
      pids_container1: container-abc123 {
        class: cgroup_node
      }
    }
  }
}

memory_limits: Memory Limits {
  class: limit_text
  label: |md
    **Memory Controller**
    - memory.limit_in_bytes: 512M
    - memory.usage_in_bytes: 256M
    - memory.oom_control: 1
  |
}

cpu_limits: CPU Limits {
  class: limit_text
  label: |md
    **CPU Controller**
    - cpu.cfs_quota_us: 50000
    - cpu.cfs_period_us: 100000
    - cpu.shares: 1024
  |
}

pids_limits: PID Limits {
  class: limit_text
  label: |md
    **PIDs Controller**
    - pids.max: 100
    - pids.current: 3
  |
}

container_runtime: Container Runtime {
  class: cgroup_controller
  shape: rectangle
}

kernel: Linux Kernel {
  class: cgroup_controller
  shape: hexagon
}

container_runtime -> cgroupfs.memory_controller.docker_slice.container1: creates cgroup
container_runtime -> cgroupfs.cpu_controller.cpu_docker.cpu_container1: creates cgroup
container_runtime -> cgroupfs.pids_controller.pids_docker.pids_container1: creates cgroup

cgroupfs.memory_controller.docker_slice.container1.proc1 -> memory_limits: enforced by
cgroupfs.cpu_controller.cpu_docker.cpu_container1 -> cpu_limits: enforced by
cgroupfs.pids_controller.pids_docker.pids_container1 -> pids_limits: enforced by

kernel -> cgroupfs.memory_controller: manages
kernel -> cgroupfs.cpu_controller: manages
kernel -> cgroupfs.pids_controller: manages

cgroupfs.memory_controller.docker_slice.container1 -> cgroupfs.cpu_controller.cpu_docker.cpu_container1: same container {
  style.stroke-dash: 3
  style.stroke: "#f39c12"
}

cgroupfs.cpu_controller.cpu_docker.cpu_container1 -> cgroupfs.pids_controller.pids_docker.pids_container1: same container {
  style.stroke-dash: 3
  style.stroke: "#f39c12"
}