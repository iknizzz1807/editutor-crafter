direction: down

title: Container Debugging Inspection Points {
  style.font-size: 24
  style.bold: true
  style.font-color: "#e6edf3"
  near: top-center
}

classes: {
  container_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  inspection_point: {
    style.fill: "#16213e"
    style.stroke: "#58a6ff"
    style.font-color: "#e6edf3"
  }
  
  symptom: {
    style.fill: "#0f3460"
    style.stroke: "#f85149"
    style.font-color: "#e6edf3"
  }
  
  arrow: {
    style.stroke: "#8b949e"
  }
}

symptoms: Debugging Symptoms {
  class: container_style
  
  pid_issues: PID Issues {
    class: symptom
    label: |md
      • Process not isolated
      • Wrong PID inside container
      • Can see host processes
    |
  }
  
  mount_issues: Mount Issues {
    class: symptom
    label: |md
      • Files not accessible
      • Wrong filesystem view
      • Mount propagation problems
    |
  }
  
  network_issues: Network Issues {
    class: symptom
    label: |md
      • No network connectivity
      • Wrong network namespace
      • Interface not available
    |
  }
  
  resource_issues: Resource Issues {
    class: symptom
    label: |md
      • Memory/CPU not limited
      • Process killed unexpectedly
      • Resource accounting wrong
    |
  }
}

inspection_points: Kernel Inspection Points {
  class: container_style
  
  proc_fs: /proc Filesystem {
    class: inspection_point
    
    proc_pid: /proc/PID/ {
      class: inspection_point
      label: |md
        • /proc/PID/ns/* - namespace links
        • /proc/PID/status - process state
        • /proc/PID/cgroup - cgroup membership
      |
    }
    
    proc_mounts: /proc/mounts {
      class: inspection_point
      label: |md
        • Current mount table
        • Filesystem types
        • Mount options
      |
    }
    
    proc_net: /proc/net/ {
      class: inspection_point
      label: |md
        • /proc/net/dev - network devices
        • /proc/net/route - routing table
        • Network namespace view
      |
    }
  }
  
  namespace_files: Namespace Files {
    class: inspection_point
    
    ns_links: /proc/PID/ns/* {
      class: inspection_point
      label: |md
        • pid - PID namespace
        • mnt - mount namespace  
        • net - network namespace
        • uts - hostname namespace
      |
    }
  }
  
  cgroup_files: Cgroup Files {
    class: inspection_point
    
    cgroup_v1: /sys/fs/cgroup/ {
      class: inspection_point
      label: |md
        • memory/memory.usage_in_bytes
        • cpu/cpu.cfs_quota_us
        • pids/pids.current
      |
    }
    
    cgroup_v2: /sys/fs/cgroup/unified/ {
      class: inspection_point
      label: |md
        • memory.current
        • cpu.max
        • pids.current
      |
    }
  }
  
  network_interfaces: Network Interfaces {
    class: inspection_point
    
    ip_command: ip netns exec {
      class: inspection_point
      label: |md
        • List interfaces in namespace
        • Check routing tables
        • Verify IP addresses
      |
    }
  }
}

debugging_tools: Debugging Tools {
  class: container_style
  
  command_tools: Command Line Tools {
    class: inspection_point
    
    nsenter: nsenter {
      class: inspection_point
      label: |md
        nsenter -t PID -p -m -n
        Enter container namespaces
      |
    }
    
    lsns: lsns {
      class: inspection_point
      label: |md
        lsns -p PID
        List namespaces for process
      |
    }
    
    findmnt: findmnt {
      class: inspection_point
      label: |md
        findmnt -N PID
        Show mounts in namespace
      |
    }
  }
  
  file_inspection: File Inspection {
    class: inspection_point
    
    readlink: readlink {
      class: inspection_point
      label: |md
        readlink /proc/PID/ns/*
        Compare namespace IDs
      |
    }
    
    cat_files: cat /proc files {
      class: inspection_point
      label: |md
        cat /proc/PID/cgroup
        cat /proc/mounts
      |
    }
  }
}

symptoms.pid_issues -> inspection_points.proc_fs.proc_pid: inspect {
  class: arrow
  label: "Check process state"
}

symptoms.pid_issues -> inspection_points.namespace_files.ns_links: inspect {
  class: arrow
  label: "Verify PID namespace"
}

symptoms.mount_issues -> inspection_points.proc_fs.proc_mounts: inspect {
  class: arrow
  label: "Check mount table"
}

symptoms.mount_issues -> debugging_tools.command_tools.findmnt: use {
  class: arrow
  label: "List namespace mounts"
}

symptoms.network_issues -> inspection_points.proc_fs.proc_net: inspect {
  class: arrow
  label: "Check network devices"
}

symptoms.network_issues -> inspection_points.network_interfaces.ip_command: use {
  class: arrow
  label: "Inspect network namespace"
}

symptoms.resource_issues -> inspection_points.cgroup_files.cgroup_v1: inspect {
  class: arrow
  label: "Check resource limits"
}

symptoms.resource_issues -> inspection_points.cgroup_files.cgroup_v2: inspect {
  class: arrow
  label: "Check cgroup v2 limits"
}

debugging_tools.command_tools.nsenter -> inspection_points.namespace_files: enters {
  class: arrow
  label: "Access namespace"
}

debugging_tools.command_tools.lsns -> inspection_points.namespace_files: lists {
  class: arrow
  label: "Show namespace info"
}