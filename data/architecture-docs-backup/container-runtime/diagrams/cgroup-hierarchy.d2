title: Cgroup v2 Hierarchy Structure

classes: {
  container_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  controller_style: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  process_style: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

root: "/" {
  class: container_style
  
  sys: sys {
    class: container_style
    
    fs: fs {
      class: container_style
      
      cgroup: cgroup {
        class: container_style
        
        controllers: cgroup.controllers {
          shape: page
          label: "memory cpu io"
          style.fill: "#16213e"
          style.font-color: "#e6edf3"
        }
        
        subtree: cgroup.subtree_control {
          shape: page
          label: "+memory +cpu +io"
          style.fill: "#16213e"
          style.font-color: "#e6edf3"
        }
        
        init: init.scope {
          class: container_style
          
          init_procs: cgroup.procs {
            shape: page
            label: "1, 2, 3..."
            class: process_style
          }
        }
        
        container1: container1.slice {
          class: container_style
          
          mem_limit: memory.max {
            shape: page
            label: "512M"
            class: controller_style
          }
          
          cpu_limit: cpu.max {
            shape: page
            label: "50000 100000"
            class: controller_style
          }
          
          io_limit: io.max {
            shape: page
            label: "8:0 rbps=1048576"
            class: controller_style
          }
          
          cont1_procs: cgroup.procs {
            shape: page
            label: "1001, 1002"
            class: process_style
          }
        }
        
        container2: container2.slice {
          class: container_style
          
          mem_limit2: memory.max {
            shape: page
            label: "256M"
            class: controller_style
          }
          
          cpu_limit2: cpu.max {
            shape: page
            label: "25000 100000"
            class: controller_style
          }
          
          io_limit2: io.max {
            shape: page
            label: "8:0 rbps=524288"
            class: controller_style
          }
          
          cont2_procs: cgroup.procs {
            shape: page
            label: "2001, 2002"
            class: process_style
          }
        }
      }
    }
  }
}

runtime: Container Runtime {
  shape: rectangle
  class: container_style
}

legend: Resource Controllers {
  shape: rectangle
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  
  memory_ctrl: Memory Controller {
    class: controller_style
  }
  
  cpu_ctrl: CPU Controller {
    class: controller_style
  }
  
  io_ctrl: I/O Controller {
    class: controller_style
  }
}

runtime -> root.sys.fs.cgroup.container1: create & configure
runtime -> root.sys.fs.cgroup.container2: create & configure
runtime -> root.sys.fs.cgroup.container1.cont1_procs: assign processes
runtime -> root.sys.fs.cgroup.container2.cont2_procs: assign processes

root.sys.fs.cgroup.controllers -> root.sys.fs.cgroup.container1.mem_limit: enables
root.sys.fs.cgroup.controllers -> root.sys.fs.cgroup.container1.cpu_limit: enables
root.sys.fs.cgroup.controllers -> root.sys.fs.cgroup.container1.io_limit: enables

note: |md
  ## Cgroup v2 Unified Hierarchy
  
  - **Single unified tree** structure under /sys/fs/cgroup
  - **Controllers** (memory, cpu, io) enabled via subtree_control
  - **Container slices** provide resource isolation
  - **Process assignment** via cgroup.procs files
  - **Resource limits** enforced by controller-specific files
| {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: top-right
}