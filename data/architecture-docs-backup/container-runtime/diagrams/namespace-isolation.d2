title: Namespace Isolation Layers

classes: {
  host_style: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  container_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  process_style: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  resource_style: {
    style.fill: "#2d3748"
    style.stroke: "#4a5568"
    style.font-color: "#e6edf3"
  }
}

host_view: Host System View {
  class: host_style
  
  pid_ns: PID Namespace {
    class: resource_style
    label: "All Processes\n(1, 2, 3, ...1000+)"
  }
  
  mount_ns: Mount Namespace {
    class: resource_style
    label: "Host Filesystem\n/bin, /usr, /var, etc."
  }
  
  net_ns: Network Namespace {
    class: resource_style
    label: "Host Network\neth0: 192.168.1.100"
  }
  
  uts_ns: UTS Namespace {
    class: resource_style
    label: "Hostname\nmyhost.example.com"
  }
  
  user_ns: User Namespace {
    class: resource_style
    label: "User Mapping\nroot=0, user=1000"
  }
}

container_view: Container Process View {
  class: container_style
  
  c_pid_ns: PID Namespace {
    class: resource_style
    label: "Isolated PIDs\nProcess 1 (init)\nProcess 2 (app)"
  }
  
  c_mount_ns: Mount Namespace {
    class: resource_style
    label: "Container Filesystem\n/bin -> overlay\n/app -> volume"
  }
  
  c_net_ns: Network Namespace {
    class: resource_style
    label: "Virtual Network\nveth0: 172.17.0.2"
  }
  
  c_uts_ns: UTS Namespace {
    class: resource_style
    label: "Container Hostname\ncontainer-abc123"
  }
  
  c_user_ns: User Namespace {
    class: resource_style
    label: "Mapped Users\ncontainer-root=0\n-> host-user=1000"
  }
}

kernel: Linux Kernel {
  class: host_style
  label: "Namespace Manager\nFilters & Translates Views"
}

app_process: Container Process {
  class: process_style
  label: "Application\nPID 1 (container view)\nPID 1337 (host view)"
}

isolation_note: |md
  **Key Insight:**
  Same resources, different views
  Kernel maintains single truth,
  presents filtered perspectives
| {
  shape: page
  class: resource_style
  near: top-center
}

# Connections showing isolation flow
app_process -> kernel: "System calls"
kernel -> container_view: "Filtered view"
kernel -> host_view: "Complete view"

# Namespace type mappings
pid_ns -> c_pid_ns: "PID isolation" {
  style.stroke: "#ffa500"
  style.stroke-dash: 3
}

mount_ns -> c_mount_ns: "Filesystem isolation" {
  style.stroke: "#ff6b6b"
  style.stroke-dash: 3
}

net_ns -> c_net_ns: "Network isolation" {
  style.stroke: "#4ecdc4"
  style.stroke-dash: 3
}

uts_ns -> c_uts_ns: "Hostname isolation" {
  style.stroke: "#45b7d1"
  style.stroke-dash: 3
}

user_ns -> c_user_ns: "User ID isolation" {
  style.stroke: "#96ceb4"
  style.stroke-dash: 3
}