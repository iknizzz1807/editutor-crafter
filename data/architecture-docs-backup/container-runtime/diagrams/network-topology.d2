title: Container Network Topology

classes: {
  namespace: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  interface: {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  bridge: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  nat_rule: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
}

host_ns: Host Network Namespace {
  class: namespace
  
  bridge: container-br0 {
    shape: hexagon
    class: bridge
  }
  
  host_eth0: eth0 {
    class: interface
  }
  
  veth1_host: veth1-host {
    class: interface
  }
  
  veth2_host: veth2-host {
    class: interface
  }
  
  iptables: iptables NAT Rules {
    class: nat_rule
    shape: rectangle
  }
  
  bridge -> veth1_host: attached
  bridge -> veth2_host: attached
  host_eth0 -> bridge: forwarding
  iptables -> bridge: port mapping
}

container1_ns: Container 1 Network Namespace {
  class: namespace
  
  veth1_container: veth1-container {
    class: interface
    label: "eth0\n192.168.1.10/24"
  }
  
  lo1: lo {
    shape: circle
    class: interface
  }
}

container2_ns: Container 2 Network Namespace {
  class: namespace
  
  veth2_container: veth2-container {
    class: interface
    label: "eth0\n192.168.1.11/24"
  }
  
  lo2: lo {
    shape: circle
    class: interface
  }
}

external: External Network {
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  shape: cloud
}

veth_pair1: veth pair 1 {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: center-left
}

veth_pair2: veth pair 2 {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: center-right
}

host_ns.veth1_host <-> container1_ns.veth1_container: veth pair {
  style.stroke: "#3fb950"
  style.stroke-width: 3
}

host_ns.veth2_host <-> container2_ns.veth2_container: veth pair {
  style.stroke: "#3fb950"
  style.stroke-width: 3
}

container1_ns.veth1_container <-> container2_ns.veth2_container: inter-container {
  style.stroke: "#8b949e"
  style.stroke-dash: 5
}

external -> host_ns.host_eth0: incoming traffic
host_ns.iptables -> external: SNAT outgoing {
  style.stroke: "#d63031"
}

external -> host_ns.iptables: "port 8080 -> container1:80" {
  style.stroke: "#d63031"
}