title: Disassembly Pipeline Sequence
shape: sequence_diagram

instruction_stream: Instruction Stream
prefix_decoder: Prefix Decoder
opcode_lookup: Opcode Lookup
operand_decoder: Operand Decoder
formatter: Formatter
output: Assembly Output

instruction_stream -> prefix_decoder: Raw bytes (48 89 C3)
prefix_decoder -> prefix_decoder: Detect REX prefix (48)
prefix_decoder -> opcode_lookup: Opcode byte (89) + prefix context
opcode_lookup -> opcode_lookup: Look up MOV r/m,r in table
opcode_lookup -> operand_decoder: Instruction template + ModR/M byte (C3)
operand_decoder -> operand_decoder: Decode ModR/M: reg=RAX, r/m=RBX
operand_decoder -> formatter: Parsed instruction object
formatter -> formatter: Apply AT&T/Intel syntax rules
formatter -> output: "mov rbx, rax"

classes: {
  dark_theme: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

instruction_stream.class: dark_theme
prefix_decoder.class: dark_theme
opcode_lookup.class: dark_theme
operand_decoder.class: dark_theme
formatter.class: dark_theme
output.class: dark_theme