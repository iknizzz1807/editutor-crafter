classes: {
  physical_node: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  virtual_node: {
    style.fill: "#1a1a2e"
    style.stroke: "#58a6ff"
    style.font-color: "#e6edf3"
  }
  data_key: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
    shape: circle
  }
  ring_container: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

ring: Hash Ring {
  class: ring_container
  
  # Physical Node A and its virtual nodes
  node_a: Node A {
    class: physical_node
  }
  va1: A-v1 {
    class: virtual_node
  }
  va2: A-v2 {
    class: virtual_node
  }
  va3: A-v3 {
    class: virtual_node
  }
  
  # Physical Node B and its virtual nodes
  node_b: Node B {
    class: physical_node
  }
  vb1: B-v1 {
    class: virtual_node
  }
  vb2: B-v2 {
    class: virtual_node
  }
  vb3: B-v3 {
    class: virtual_node
  }
  
  # Physical Node C and its virtual nodes
  node_c: Node C {
    class: physical_node
  }
  vc1: C-v1 {
    class: virtual_node
  }
  vc2: C-v2 {
    class: virtual_node
  }
  vc3: C-v3 {
    class: virtual_node
  }
  
  # Data keys
  key1: Key1 {
    class: data_key
  }
  key2: Key2 {
    class: data_key
  }
  key3: Key3 {
    class: data_key
  }
  key4: Key4 {
    class: data_key
  }
  
  # Ring connections (clockwise)
  va1 -> vb2: {style.stroke: "#8b949e"; style.stroke-dash: 3}
  vb2 -> vc1: {style.stroke: "#8b949e"; style.stroke-dash: 3}
  vc1 -> va2: {style.stroke: "#8b949e"; style.stroke-dash: 3}
  va2 -> vb3: {style.stroke: "#8b949e"; style.stroke-dash: 3}
  vb3 -> vc2: {style.stroke: "#8b949e"; style.stroke-dash: 3}
  vc2 -> vb1: {style.stroke: "#8b949e"; style.stroke-dash: 3}
  vb1 -> vc3: {style.stroke: "#8b949e"; style.stroke-dash: 3}
  vc3 -> va3: {style.stroke: "#8b949e"; style.stroke-dash: 3}
  va3 -> va1: {style.stroke: "#8b949e"; style.stroke-dash: 3}
  
  # Key assignments
  key1 -> vb2: maps to {style.stroke: "#d63031"}
  key2 -> vc2: maps to {style.stroke: "#d63031"}
  key3 -> va3: maps to {style.stroke: "#d63031"}
  key4 -> vc1: maps to {style.stroke: "#d63031"}
  
  # Virtual to physical mappings
  va1 -> node_a: {style.stroke: "#3fb950"; style.stroke-width: 2}
  va2 -> node_a: {style.stroke: "#3fb950"; style.stroke-width: 2}
  va3 -> node_a: {style.stroke: "#3fb950"; style.stroke-width: 2}
  
  vb1 -> node_b: {style.stroke: "#3fb950"; style.stroke-width: 2}
  vb2 -> node_b: {style.stroke: "#3fb950"; style.stroke-width: 2}
  vb3 -> node_b: {style.stroke: "#3fb950"; style.stroke-width: 2}
  
  vc1 -> node_c: {style.stroke: "#3fb950"; style.stroke-width: 2}
  vc2 -> node_c: {style.stroke: "#3fb950"; style.stroke-width: 2}
  vc3 -> node_c: {style.stroke: "#3fb950"; style.stroke-width: 2}
}

legend: Legend {
  class: ring_container
  
  phys: Physical Node {
    class: physical_node
  }
  virt: Virtual Node {
    class: virtual_node
  }
  key: Data Key {
    class: data_key
  }
  
  legend_notes: |md
    **Ring Structure:**
    - Keys hash to closest virtual node (clockwise)
    - Virtual nodes map to physical nodes
    - Adding/removing nodes only affects neighbors
  | {
    shape: page
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}