classes: {
  core_type: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  container_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  arrow_style: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

title: Data Model and Type Relationships {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

core_types: Core Data Types {
  class: container_style
  
  CacheEntry: CacheEntry {
    shape: class
    class: core_type
    "- key: string"
    "- value: bytes"
    "- ttl: Duration"
    "- size: int64"
    "- created_at: Time"
    "- accessed_at: Time"
  }

  Node: Node {
    shape: class  
    class: core_type
    "- id: string"
    "- address: string"
    "- port: int"
    "- hash_value: uint64"
    "- status: NodeStatus"
    "- last_seen: Time"
    "+ is_alive(): bool"
    "+ get_endpoint(): string"
  }

  Ring: Ring {
    shape: class
    class: core_type
    "- nodes: Node[]"
    "- virtual_nodes: int"
    "- hash_ring: Map<uint64, Node>"
    "+ add_node(node: Node): void"
    "+ remove_node(node_id: string): void"
    "+ find_node(key: string): Node"
    "+ get_replicas(key: string, count: int): Node[]"
  }
}

cluster_types: Cluster Management Types {
  class: container_style
  
  ClusterState: ClusterState {
    shape: class
    class: core_type
    "- ring: Ring"
    "- version: int64"
    "- nodes: Map<string, Node>"
    "- replication_factor: int"
    "+ update_node(node: Node): void"
    "+ get_active_nodes(): Node[]"
    "+ is_healthy(): bool"
  }

  NodeStatus: NodeStatus {
    shape: class
    class: core_type
    "ACTIVE"
    "JOINING"
    "LEAVING"
    "FAILED"
  }
}

storage_types: Storage Types {
  class: container_style
  
  Storage: Storage {
    shape: class
    class: core_type
    "- entries: Map<string, CacheEntry>"
    "- max_size: int64"
    "- current_size: int64"
    "+ get(key: string): CacheEntry"
    "+ put(entry: CacheEntry): bool"
    "+ delete(key: string): bool"
    "+ evict_expired(): int"
  }

  ReplicationData: ReplicationData {
    shape: class
    class: core_type
    "- primary_node: Node"
    "- replica_nodes: Node[]"
    "- consistency_level: ConsistencyLevel"
    "- version_vector: Map<string, int64>"
  }
}

cluster_types.ClusterState -> core_types.Ring: contains {
  class: arrow_style
  style.stroke-dash: 5
}

core_types.Ring -> core_types.Node: manages {
  class: arrow_style
}

storage_types.Storage -> core_types.CacheEntry: stores {
  class: arrow_style
  style.stroke-dash: 5
}

core_types.Node -> cluster_types.NodeStatus: has status {
  class: arrow_style
}

storage_types.ReplicationData -> core_types.Node: references {
  class: arrow_style
}

core_types.Ring -> core_types.CacheEntry: routes by key {
  class: arrow_style
  style.stroke-dash: 3
}

cluster_types.ClusterState -> storage_types.Storage: coordinates {
  class: arrow_style
  style.stroke-dash: 3
}