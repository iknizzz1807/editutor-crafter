title: Service Dependency Graph Generation

classes: {
  container_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  processor_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  data_style: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  storage_style: {
    style.fill: "#2d3748"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

trace_storage: Trace Storage {
  class: storage_style
  shape: cylinder
}

spans: Raw Spans {
  class: data_style
  shape: page
}

dependency_analyzer: Dependency Analyzer {
  class: container_style
  
  span_extractor: Span Extractor {
    class: processor_style
    shape: rectangle
  }
  
  relationship_builder: Relationship Builder {
    class: processor_style
    shape: rectangle
  }
  
  graph_generator: Graph Generator {
    class: processor_style
    shape: rectangle
  }
  
  span_extractor -> relationship_builder: service pairs
  relationship_builder -> graph_generator: weighted edges
}

service_relationships: Service Relationships {
  class: data_style
  shape: sql_table
  service_a: varchar
  service_b: varchar
  call_count: int
  avg_latency: float
  error_rate: float
  last_seen: timestamp
}

dependency_graph: Dependency Graph {
  class: data_style
  shape: page
}

cache_layer: Dependency Cache {
  class: storage_style
  shape: cylinder
}

trace_storage -> spans: fetch spans
spans -> dependency_analyzer: analyze
dependency_analyzer -> service_relationships: store relationships
service_relationships -> dependency_graph: generate graph
service_relationships -> cache_layer: cache results

graph_api: Graph Query API {
  class: processor_style
}

cache_layer -> graph_api: cached graphs
dependency_graph -> graph_api: fresh graphs

clients: Client Applications {
  class: container_style
  
  ui_dashboard: UI Dashboard {
    class: processor_style
  }
  
  alerting: Alerting System {
    class: processor_style
  }
}

graph_api -> clients: dependency data