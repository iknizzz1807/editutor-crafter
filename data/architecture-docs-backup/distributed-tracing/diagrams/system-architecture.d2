applications: Instrumented Applications {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  app1: API Gateway {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  app2: Auth Service {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  app3: Inventory Service {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  app4: Payment Service {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

collector: Trace Collector {
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

storage: Storage System {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  db: Trace Database {
    shape: cylinder
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

query: Query & Analysis {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  api: Query API {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  ui: Web UI {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  api -> ui: trace data
}

trace_context: |md
  **W3C Trace Context**
  - Trace ID
  - Span ID
  - Trace Flags
| {
  shape: page
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

applications.app1 -> applications.app2: HTTP + trace context {
  style.stroke: "#3fb950"
}

applications.app2 -> applications.app3: HTTP + trace context {
  style.stroke: "#3fb950"
}

applications.app3 -> applications.app4: HTTP + trace context {
  style.stroke: "#3fb950"
}

applications -> collector: span data export {
  style.stroke: "#e17055"
  style.bold: true
}

collector -> storage: processed traces {
  style.stroke: "#e17055"
  style.bold: true
}

storage -> query.api: trace queries {
  style.stroke: "#8b949e"
}

trace_context -> applications: propagates through services {
  style.stroke: "#3fb950"
  style.stroke-dash: 3
}