title: Order Processing Transaction Flow

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
  }
  success: {
    style.fill: "#00b894"
    style.stroke: "#00a085"
    style.font-color: "#ffffff"
  }
}

start: Start Checkout {
  shape: circle
  class: process
}

validate_cart: Validate Cart Items {
  class: process
}

cart_valid: Cart Valid? {
  shape: diamond
  class: decision
}

check_inventory: Check Inventory Availability {
  class: process
}

inventory_check: Sufficient Inventory? {
  shape: diamond
  class: decision
}

begin_transaction: Begin Database Transaction {
  class: process
}

reserve_inventory: Reserve Inventory Items {
  class: process
}

reservation_success: Reservation Success? {
  shape: diamond
  class: decision
}

create_order: Create Order Record {
  class: process
}

order_creation: Order Created? {
  shape: diamond
  class: decision
}

process_payment: Process Payment {
  class: process
}

payment_success: Payment Success? {
  shape: diamond
  class: decision
}

confirm_order: Confirm Order & Update Inventory {
  class: process
}

commit_transaction: Commit Transaction {
  class: process
}

rollback_inventory: Rollback Inventory Reservation {
  class: error
}

rollback_transaction: Rollback Transaction {
  class: error
}

cancel_order: Cancel Order {
  class: error
}

order_complete: Order Complete {
  shape: circle
  style.double-border: true
  class: success
}

checkout_failed: Checkout Failed {
  shape: circle
  style.double-border: true
  class: error
}

start -> validate_cart
validate_cart -> cart_valid
cart_valid -> check_inventory: Yes
cart_valid -> checkout_failed: No
check_inventory -> inventory_check
inventory_check -> begin_transaction: Yes
inventory_check -> checkout_failed: No
begin_transaction -> reserve_inventory
reserve_inventory -> reservation_success
reservation_success -> create_order: Yes
reservation_success -> rollback_transaction: No
create_order -> order_creation
order_creation -> process_payment: Yes
order_creation -> rollback_inventory: No
process_payment -> payment_success
payment_success -> confirm_order: Yes
payment_success -> cancel_order: No
confirm_order -> commit_transaction
commit_transaction -> order_complete

rollback_inventory -> rollback_transaction
rollback_transaction -> checkout_failed
cancel_order -> rollback_inventory