direction: right

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  final_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
  }
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  important: {
    style.stroke: "#3fb950"
    style.bold: true
    style.font-color: "#e6edf3"
  }
}

init: {
  shape: circle
  style.fill: "#3fb950"
  label: ""
}

created: Created {
  shape: circle
  class: state
}

alive: Alive {
  shape: circle
  class: state
}

destroyed: Destroyed {
  shape: circle
  class: state
}

recycled: Recycled {
  shape: circle
  class: final_state
}

free_list: {
  shape: rectangle
  label: "Free List\nManagement"
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

generation_counter: {
  shape: rectangle
  label: "Generation\nCounter"
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

init -> created: "Allocate ID\nGeneration = 0" {
  class: transition
}

created -> alive: "Entity\nInitialized" {
  class: transition
}

alive -> destroyed: "Destroy\nCommand" {
  class: important
}

destroyed -> recycled: "Add to\nFree List" {
  class: transition
}

recycled -> created: "Reuse ID\nIncrement Generation" {
  class: important
}

destroyed -> generation_counter: "Increment\nGeneration" {
  class: transition
}

destroyed -> free_list: "Push ID" {
  class: transition
}

free_list -> created: "Pop ID for\nReuse" {
  class: transition
}

validation_note: |md
  **Entity Validation:**
  ID + Generation must match
  for valid entity reference
| {
  shape: page
  near: top-right
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}