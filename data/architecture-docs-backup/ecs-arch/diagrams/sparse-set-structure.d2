title: Sparse Set Data Structure

classes: {
  container_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  array_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  mapping_style: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  highlight_style: {
    style.stroke: "#3fb950"
    style.bold: true
    style.font-color: "#3fb950"
  }
}

sparse_set: Sparse Set {
  class: container_style
  
  sparse_array: Sparse Array {
    class: array_style
    s0: "Entity 0: -"
    s1: "Entity 1: 2"
    s2: "Entity 2: -" 
    s3: "Entity 3: 0"
    s4: "Entity 4: -"
    s5: "Entity 5: 1"
    s6: "Entity 6: 3"
    s7: "Entity 7: -"
  }
  
  dense_array: Dense Array {
    class: array_style
    d0: "Index 0: Entity 3"
    d1: "Index 1: Entity 5"
    d2: "Index 2: Entity 1"
    d3: "Index 3: Entity 6"
  }
  
  components: Component Data {
    class: array_style
    c0: "Position(10, 20)"
    c1: "Position(5, 15)"
    c2: "Position(30, 8)"
    c3: "Position(12, 25)"
  }
}

operations: Operations {
  class: container_style
  
  lookup: "O(1) Lookup" {
    class: highlight_style
    label: "sparse[entity_id] -> component_index"
  }
  
  iteration: "O(n) Iteration" {
    class: highlight_style
    label: "for each in dense array"
  }
  
  removal: "O(1) Removal" {
    class: highlight_style
    label: "swap with last + update mappings"
  }
}

example: Example Query {
  class: container_style
  
  query_text: |md
    **Query Entity 5's Position:**
    1. sparse[5] = 1
    2. components[1] = Position(5, 15)
  | {
    shape: page
    class: array_style
  }
}

sparse_set.sparse_array.s3 -> sparse_set.dense_array.d0: "points to" {
  class: mapping_style
}

sparse_set.sparse_array.s5 -> sparse_set.dense_array.d1: "points to" {
  class: mapping_style
}

sparse_set.sparse_array.s1 -> sparse_set.dense_array.d2: "points to" {
  class: mapping_style
}

sparse_set.sparse_array.s6 -> sparse_set.dense_array.d3: "points to" {
  class: mapping_style
}

sparse_set.dense_array.d0 -> sparse_set.components.c0: "same index" {
  class: highlight_style
}

sparse_set.dense_array.d1 -> sparse_set.components.c1: "same index" {
  class: highlight_style
}

sparse_set.dense_array.d2 -> sparse_set.components.c2: "same index" {
  class: highlight_style
}

sparse_set.dense_array.d3 -> sparse_set.components.c3: "same index" {
  class: highlight_style
}

operations.lookup -> sparse_set.sparse_array: "Entity ID lookup"
operations.iteration -> sparse_set.dense_array: "Cache-friendly iteration"
operations.iteration -> sparse_set.components: "Sequential access"