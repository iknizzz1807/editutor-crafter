classes: {
  event_class: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  aggregate_class: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  stream_class: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  snapshot_class: {
    style.fill: "#2d1b69"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

title: Event and Aggregate Data Model {
  near: top-center
  style.font-size: 18
  style.bold: true
  style.font-color: "#e6edf3"
}

Event: {
  shape: class
  class: event_class
  - "id: UUID"
  - "aggregateId: UUID"
  - "eventType: string"
  - "eventData: JSON"
  - "metadata: EventMetadata"
  - "timestamp: DateTime"
  - "version: long"
}

EventMetadata: {
  shape: class
  class: event_class
  - "causationId: UUID"
  - "correlationId: UUID"
  - "userId: string"
  - "source: string"
  - "headers: \"Map<string, string>\""
}

EventStream: {
  shape: class
  class: stream_class
  - "streamId: UUID"
  - "aggregateId: UUID"
  - "aggregateType: string"
  - "version: long"
  - "events: \"List<Event>\""
  + "appendEvent(event: Event): void"
  + "getEvents(): \"List<Event>\""
  + "getEventsFromVersion(version: long): \"List<Event>\""
}

Aggregate: {
  shape: class
  class: aggregate_class
  - "id: UUID"
  - "aggregateType: string"
  - "version: long"
  - "uncommittedEvents: \"List<Event>\""
  - "state: AggregateState"
  + "applyEvent(event: Event): void"
  + "markEventsAsCommitted(): void"
  + "getUncommittedEvents(): \"List<Event>\""
  + "loadFromHistory(events: \"List<Event>\"): void"
}

Snapshot: {
  shape: class
  class: snapshot_class
  - "aggregateId: UUID"
  - "aggregateType: string"
  - "version: long"
  - "data: JSON"
  - "timestamp: DateTime"
  - "metadata: SnapshotMetadata"
  + "serialize(): JSON"
  + "deserialize(data: JSON): AggregateState"
}

SnapshotMetadata: {
  shape: class
  class: snapshot_class
  - "reason: string"
  - "size: long"
  - "compression: string"
  - "checksum: string"
}

EventStream -> Event: contains {
  style.stroke: "#8b949e"
  style.stroke-width: 2
}

Event -> EventMetadata: has {
  style.stroke: "#8b949e"
}

Aggregate -> Event: produces {
  style.stroke: "#8b949e"
  style.stroke-width: 2
}

Aggregate -> EventStream: reconstituted from {
  style.stroke: "#8b949e"
  style.stroke-width: 2
}

Snapshot -> SnapshotMetadata: has {
  style.stroke: "#8b949e"
}

Aggregate -> Snapshot: creates {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

Snapshot -> Aggregate: restores {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}