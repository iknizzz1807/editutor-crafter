title: Data Model Relationships

classes: {
  entity_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  arrow_style: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

Flag: {
  shape: class
  class: entity_style
  - "id: string"
  - "name: string"
  - "description: string"
  - "enabled: boolean"
  - "default_value: any"
  - "created_at: timestamp"
  - "updated_at: timestamp"
  + "evaluate(context: UserContext): any"
  + "add_rule(rule: Rule): void"
}

Rule: {
  shape: class
  class: entity_style
  - "id: string"
  - "flag_id: string"
  - "priority: number"
  - "conditions: Condition[]"
  - "percentage: number"
  - "value: any"
  - "enabled: boolean"
  + "matches(context: UserContext): boolean"
  + "get_value(): any"
}

Variant: {
  shape: class
  class: entity_style
  - "id: string"
  - "flag_id: string"
  - "name: string"
  - "value: any"
  - "weight: number"
  - "enabled: boolean"
  + "is_active(): boolean"
}

UserContext: {
  shape: class
  class: entity_style
  - "user_id: string"
  - "attributes: Map<string, any>"
  - "session_id: string"
  - "ip_address: string"
  - "user_agent: string"
  - "timestamp: timestamp"
  + "get_attribute(key: string): any"
  + "matches_segment(segment: Segment): boolean"
}

Segment: {
  shape: class
  class: entity_style
  - "id: string"
  - "name: string"
  - "description: string"
  - "conditions: Condition[]"
  - "created_at: timestamp"
  - "updated_at: timestamp"
  + "matches(context: UserContext): boolean"
  + "get_users_count(): number"
}

Experiment: {
  shape: class
  class: entity_style
  - "id: string"
  - "flag_id: string"
  - "name: string"
  - "status: ExperimentStatus"
  - "traffic_percentage: number"
  - "start_date: timestamp"
  - "end_date: timestamp"
  - "metrics: string[]"
  + "is_active(): boolean"
  + "get_results(): ExperimentResults"
}

Flag -> Rule: "has many" {
  class: arrow_style
}
Flag -> Variant: "contains" {
  class: arrow_style
}
Flag -> Experiment: "used in" {
  class: arrow_style
}
Rule -> Segment: "targets" {
  class: arrow_style
}
UserContext -> Segment: "evaluated by" {
  class: arrow_style
}
UserContext -> Flag: "triggers evaluation" {
  class: arrow_style
}
Experiment -> Variant: "tests" {
  class: arrow_style
}