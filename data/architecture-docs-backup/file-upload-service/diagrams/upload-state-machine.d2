direction: right

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  initial: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#000000"
  }
  final: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
  }
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
  }
  scanning: {
    style.fill: "#fdcb6e"
    style.stroke: "#e17055"
    style.font-color: "#000000"
  }
}

init: {
  shape: circle
  label: ""
  class: initial
}

created: Created {
  shape: circle
  class: state
}

receiving: Receiving Chunks {
  shape: circle
  class: state
}

paused: Paused {
  shape: circle
  class: state
}

assembling: Assembling {
  shape: circle
  class: state
}

scanning: Virus Scanning {
  shape: circle
  class: scanning
}

scan_failed: Scan Failed {
  shape: circle
  class: error
}

completed: Completed {
  shape: circle
  class: final
}

failed: Failed {
  shape: circle
  class: error
}

expired: Expired {
  shape: circle
  class: error
}

init -> created: "POST /files\n(create session)"
created -> receiving: "PATCH /files/{id}\n(first chunk)"
receiving -> receiving: "PATCH /files/{id}\n(next chunk)"
receiving -> paused: "client inactive\n(timeout)"
paused -> receiving: "PATCH /files/{id}\n(resume)"
receiving -> assembling: "all chunks\nreceived"
assembling -> scanning: "file assembled\nsuccessfully"
assembling -> failed: "assembly error\n(corruption)"
scanning -> completed: "virus scan\npassed"
scanning -> scan_failed: "virus detected\nor scan error"
scan_failed -> failed: "cleanup\ncompleted"
created -> expired: "session timeout\n(no activity)"
receiving -> expired: "session timeout\n(max duration)"
paused -> expired: "session timeout\n(max pause)"
receiving -> failed: "chunk validation\nfailed"