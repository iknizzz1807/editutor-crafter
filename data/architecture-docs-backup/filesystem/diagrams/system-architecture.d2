title: Filesystem Component Architecture

classes: {
  component: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  interface: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  storage: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

user_apps: User Applications {
  class: interface
}

fuse_interface: FUSE Interface {
  class: component
  syscall_handler: System Call Handler
  vfs_adapter: VFS Adapter
  syscall_handler -> vfs_adapter: translate
}

file_ops: File Operations {
  class: component
  read_write: Read/Write Handler
  create_delete: Create/Delete Handler
  metadata: Metadata Handler
}

dir_ops: Directory Operations {
  class: component
  lookup: Name Lookup
  traversal: Directory Traversal
  entry_mgmt: Entry Management
}

inode_mgmt: Inode Management {
  class: component
  inode_cache: Inode Cache
  allocation: Inode Allocation
  metadata_ops: Metadata Operations
  inode_cache -> allocation: allocate new
  allocation -> metadata_ops: update
}

block_layer: Block Layer {
  class: component
  block_allocator: Block Allocator
  cache: Block Cache
  io_scheduler: I/O Scheduler
  block_allocator -> cache: cached blocks
  cache -> io_scheduler: write requests
}

disk_image: Disk Image Backend {
  class: storage
  superblock: Superblock
  inode_table: Inode Table
  data_blocks: Data Blocks
  journal: Journal
}

user_apps -> fuse_interface: system calls

fuse_interface -> file_ops: file operations
fuse_interface -> dir_ops: directory operations

file_ops -> inode_mgmt: get/update inodes
dir_ops -> inode_mgmt: resolve names

inode_mgmt -> block_layer: read/write blocks
file_ops -> block_layer: data I/O
dir_ops -> block_layer: directory data

block_layer -> disk_image: block I/O

inode_mgmt -> disk_image: inode metadata {
  style.stroke-dash: 3
}