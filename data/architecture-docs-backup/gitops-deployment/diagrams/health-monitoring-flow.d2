title: Health Monitoring Process {
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
  near: top-center
}

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#ffa726"
    style.font-color: "#e6edf3"
  }
  data: {
    style.fill: "#0f3460"
    style.stroke: "#42a5f5"
    style.font-color: "#e6edf3"
  }
  critical: {
    style.fill: "#d63031"
    style.stroke: "#ffffff"
    style.font-color: "#ffffff"
    style.bold: true
  }
}

start: Start Health Check {
  shape: circle
  class: process
}

discover: Discover Resources {
  class: process
}

get_manifests: Get Application Manifests {
  class: process
}

parse_resources: Parse Kubernetes Resources {
  class: process
}

has_resources: Resources Found? {
  shape: diamond
  class: decision
}

select_resource: Select Next Resource {
  class: process
}

check_builtin: Execute Built-in Health Checks {
  class: process
}

has_custom: Custom Scripts Available? {
  shape: diamond
  class: decision
}

run_custom: Execute Custom Health Scripts {
  class: process
}

evaluate_status: Evaluate Resource Status {
  class: process
}

status_check: Status? {
  shape: diamond
  class: decision
}

mark_healthy: Mark as Healthy {
  class: data
}

mark_progressing: Mark as Progressing {
  class: data
}

mark_degraded: Mark as Degraded {
  class: critical
}

mark_unknown: Mark as Unknown {
  class: data
}

more_resources: More Resources? {
  shape: diamond
  class: decision
}

aggregate: Aggregate Application Health {
  class: process
}

detect_degradation: Apply Degradation Logic {
  class: process
}

app_status: Determine Overall Status {
  shape: diamond
  class: decision
}

report_healthy: Report Application Healthy {
  class: data
}

report_degraded: Report Application Degraded {
  class: critical
}

report_progressing: Report Application Progressing {
  class: data
}

update_history: Update Health History {
  class: process
}

end: End {
  shape: circle
  class: process
}

start -> discover
discover -> get_manifests
get_manifests -> parse_resources
parse_resources -> has_resources

has_resources -> select_resource: Yes
has_resources -> report_healthy: No Resources

select_resource -> check_builtin
check_builtin -> has_custom

has_custom -> run_custom: Yes
has_custom -> evaluate_status: No

run_custom -> evaluate_status
evaluate_status -> status_check

status_check -> mark_healthy: Healthy
status_check -> mark_progressing: Progressing
status_check -> mark_degraded: Degraded/Failed
status_check -> mark_unknown: Unknown

mark_healthy -> more_resources
mark_progressing -> more_resources
mark_degraded -> more_resources
mark_unknown -> more_resources

more_resources -> select_resource: Yes
more_resources -> aggregate: No

aggregate -> detect_degradation
detect_degradation -> app_status

app_status -> report_healthy: All Healthy
app_status -> report_degraded: Any Degraded/Failed
app_status -> report_progressing: Some Progressing

report_healthy -> update_history
report_degraded -> update_history
report_progressing -> update_history

update_history -> end