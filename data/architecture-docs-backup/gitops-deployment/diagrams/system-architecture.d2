direction: right

classes: {
  gitops_component: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  data_store: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  external_system: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  event_flow: {
    style.stroke: "#3fb950"
    style.font-color: "#3fb950"
  }
  data_flow: {
    style.stroke: "#8b949e"
    style.font-color: "#8b949e"
  }
}

title: GitOps System Architecture {
  near: top-center
  style.font-size: 24
  style.bold: true
  style.font-color: "#e6edf3"
}

# External Systems
git_repos: Git Repositories {
  shape: cloud
  class: external_system
}

k8s_api: Kubernetes API {
  shape: cloud
  class: external_system
}

webhooks: External Webhooks {
  shape: cloud
  class: external_system
}

# Core GitOps Components
core_system: GitOps Core System {
  class: gitops_component
  
  repo_manager: Repository Manager {
    class: gitops_component
  }
  
  manifest_gen: Manifest Generator {
    class: gitops_component
  }
  
  sync_engine: Sync Engine {
    class: gitops_component
  }
  
  health_monitor: Health Monitor {
    class: gitops_component
  }
  
  history_tracker: History Tracker {
    class: gitops_component
  }
}

# Data Stores
config_store: Configuration Store {
  shape: cylinder
  class: data_store
}

state_cache: State Cache {
  shape: cylinder
  class: data_store
}

audit_db: Audit Database {
  shape: cylinder
  class: data_store
}

# Event Bus
event_bus: Event Bus {
  shape: queue
  class: gitops_component
}

# External Connections
git_repos -> core_system.repo_manager: Git changes {
  class: event_flow
}

core_system.sync_engine -> k8s_api: Apply manifests {
  class: event_flow
}

core_system.health_monitor -> k8s_api: Query status {
  class: data_flow
}

core_system.health_monitor -> webhooks: Status notifications {
  class: event_flow
}

# Internal Component Interactions
core_system.repo_manager -> event_bus: Repository events {
  class: event_flow
}

event_bus -> core_system.manifest_gen: Process changes {
  class: event_flow
}

core_system.manifest_gen -> event_bus: Manifest ready {
  class: event_flow
}

event_bus -> core_system.sync_engine: Deploy manifests {
  class: event_flow
}

core_system.sync_engine -> event_bus: Sync status {
  class: event_flow
}

event_bus -> core_system.health_monitor: Monitor request {
  class: event_flow
}

core_system.health_monitor -> event_bus: Health status {
  class: event_flow
}

core_system.history_tracker <-> event_bus: Audit events {
  class: data_flow
}

# Data Store Connections
core_system.repo_manager <-> config_store: Store/retrieve configs {
  class: data_flow
}

core_system.sync_engine <-> state_cache: Cache cluster state {
  class: data_flow
}

core_system.health_monitor <-> state_cache: Read/write status {
  class: data_flow
}

core_system.history_tracker <-> audit_db: Store audit trail {
  class: data_flow
}