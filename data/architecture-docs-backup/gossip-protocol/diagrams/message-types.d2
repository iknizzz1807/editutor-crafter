classes: {
  message_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  base_style: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

title: Message Type Hierarchy {
  shape: text
  style.font-size: 24
  style.bold: true
  style.font-color: "#e6edf3"
}

BaseMessage: {
  shape: class
  class: base_style
  - "message_id: string"
  - "sender_id: NodeID"
  - "timestamp: int64"
  - "version: int"
}

GossipMessage: {
  shape: class
  class: message_style
  - "state_updates: Map<string, StateEntry>"
  - "node_states: \"[]NodeState\""
  - "max_entries: int"
  + "add_state(key: string, value: StateEntry)"
  + "merge_updates(other: GossipMessage)"
}

ProbeMessage: {
  shape: class
  class: message_style
  - "target_node: NodeID"
  - "probe_id: string"
  - "indirect_probe: bool"
  - "timeout_ms: int"
  + "create_response(): ProbeResponse"
}

PushMessage: {
  shape: class
  class: message_style
  - "state_entries: \"[]StateEntry\""
  - "node_metadata: Map<string, string>"
  - "priority: int"
  + "get_entry_count(): int"
  + "validate_entries(): bool"
}

PullRequest: {
  shape: class
  class: message_style
  - "request_id: string"
  - "known_versions: Map<NodeID, int>"
  - "max_response_size: int"
  - "filter_keys: \"[]string\""
  + "should_include(entry: StateEntry): bool"
}

PullResponse: {
  shape: class
  class: message_style
  - "request_id: string"
  - "state_diff: \"[]StateEntry\""
  - "has_more: bool"
  - "next_token: string"
  + "get_diff_size(): int"
  + "is_complete(): bool"
}

BaseMessage -> GossipMessage: extends
BaseMessage -> ProbeMessage: extends
BaseMessage -> PushMessage: extends
BaseMessage -> PullRequest: extends
BaseMessage -> PullResponse: extends

GossipMessage -> PushMessage: "contains state for\npush gossip" {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

PullRequest -> PullResponse: "request/response\npair" {
  style.stroke: "#3fb950"
}