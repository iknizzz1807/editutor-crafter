title: Peer State Machine

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  final_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
    style.double-border: true
  }
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  important_transition: {
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

init: {
  shape: circle
  style.fill: "#3fb950"
  label: ""
}

unknown: Unknown {
  shape: circle
  class: state
}

alive: Alive {
  shape: circle
  class: state
}

suspected: Suspected {
  shape: circle
  class: state
}

dead: Dead {
  shape: circle
  class: final_state
}

init -> unknown: start {
  class: important_transition
}

unknown -> alive: join / heartbeat {
  class: important_transition
}

alive -> suspected: timeout / no response {
  class: transition
}

alive -> alive: heartbeat received {
  class: transition
}

suspected -> alive: heartbeat received {
  class: transition
}

suspected -> dead: timeout / confirmed failure {
  class: important_transition
}

alive -> dead: leave / explicit disconnect {
  class: important_transition
}

suspected -> suspected: ping timeout {
  class: transition
}

events: Event Types {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  join_event: "• join - peer announces presence"
  heartbeat_event: "• heartbeat - periodic alive signal"
  timeout_event: "• timeout - no response received"
  leave_event: "• leave - graceful departure"
  ping_event: "• ping - active health check"
}

events.near: bottom-right