title: "Interceptor Middleware Chain"

classes: {
  interceptor: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  service: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  flow: {
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  error_flow: {
    style.stroke: "#d63031"
    style.font-color: "#d63031"
    style.stroke-dash: 3
  }
}

client: Client Request {
  class: service
}

auth: Authentication Interceptor {
  class: interceptor
}

logging: Logging Interceptor {
  class: interceptor
}

rate_limit: Rate Limiting Interceptor {
  class: interceptor
}

recovery: Recovery Interceptor {
  class: interceptor
}

handler: Service Handler {
  class: service
  style.fill: "#16213e"
}

response: Response {
  class: service
}

error_handler: Error Recovery {
  shape: diamond
  style.fill: "#d63031"
  style.font-color: "#ffffff"
}

client -> auth: "1. Incoming Request" {
  class: flow
}

auth -> logging: "2. Authenticated" {
  class: flow
}

logging -> rate_limit: "3. Logged" {
  class: flow
}

rate_limit -> recovery: "4. Rate Check Passed" {
  class: flow
}

recovery -> handler: "5. Execute Handler" {
  class: flow
}

handler -> response: "6. Success Response" {
  class: flow
}

response -> recovery: "7. Response Chain" {
  class: flow
}

recovery -> rate_limit: "8. Through Recovery" {
  class: flow
}

rate_limit -> logging: "9. Through Rate Limit" {
  class: flow
}

logging -> auth: "10. Response Logged" {
  class: flow
}

auth -> client: "11. Final Response" {
  class: flow
}

auth -> error_handler: "Auth Failure" {
  class: error_flow
}

rate_limit -> error_handler: "Rate Limited" {
  class: error_flow
}

handler -> error_handler: "Handler Error" {
  class: error_flow
}

error_handler -> recovery: "Handle Error" {
  class: error_flow
}

note: |md
  **Interceptor Flow:**
  1. Each interceptor can modify the request
  2. Errors trigger recovery mechanisms
  3. Response flows back through chain
  4. Cross-cutting concerns handled uniformly
| {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  near: bottom-right
}