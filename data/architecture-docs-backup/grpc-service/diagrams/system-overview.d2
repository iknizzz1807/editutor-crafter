# gRPC Service Architecture Overview

classes: {
  client_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  interceptor_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  service_style: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  pattern_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

client: gRPC Client {
  class: client_style
}

server: gRPC Server {
  class: service_style
  
  interceptors: Interceptor Chain {
    class: interceptor_style
    auth: Auth Interceptor
    logging: Logging Interceptor
    metrics: Metrics Interceptor
    
    auth -> logging: request
    logging -> metrics: request
  }
  
  handlers: Service Handlers {
    class: service_style
    unary_handler: Unary Handler
    server_stream: Server Stream Handler
    client_stream: Client Stream Handler
    bidi_stream: Bidirectional Stream Handler
  }
  
  interceptors -> handlers: processed request
}

patterns: RPC Communication Patterns {
  class: pattern_style
  
  unary: Unary RPC {
    class: pattern_style
    label: "Request → Response"
  }
  
  server_streaming: Server Streaming {
    class: pattern_style
    label: "Request → Stream of Responses"
  }
  
  client_streaming: Client Streaming {
    class: pattern_style
    label: "Stream of Requests → Response"
  }
  
  bidirectional: Bidirectional Streaming {
    class: pattern_style
    label: "Stream ↔ Stream"
  }
}

# Data flow connections
client -> server.interceptors: gRPC Request {
  style.stroke: "#3fb950"
  style.stroke-width: 2
}

server.handlers.unary_handler -> patterns.unary: implements
server.handlers.server_stream -> patterns.server_streaming: implements
server.handlers.client_stream -> patterns.client_streaming: implements
server.handlers.bidi_stream -> patterns.bidirectional: implements

server.interceptors -> client: Response/Stream {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

# Pattern flow indicators
patterns.unary <-> client: "1:1" {
  style.stroke: "#e6edf3"
  style.opacity: 0.6
}

patterns.server_streaming -> client: "1:N" {
  style.stroke: "#e6edf3"
  style.opacity: 0.6
}

patterns.client_streaming <- client: "N:1" {
  style.stroke: "#e6edf3"
  style.opacity: 0.6
}

patterns.bidirectional <-> client: "N:M" {
  style.stroke: "#e6edf3"
  style.opacity: 0.6
}