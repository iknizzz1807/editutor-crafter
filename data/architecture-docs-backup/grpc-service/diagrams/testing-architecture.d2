title: Testing Strategy Components

classes: {
  test_component: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  isolation_boundary: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    style.stroke-dash: 3
  }
  test_double: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  real_component: {
    style.fill: "#1a1a2e"
    style.stroke: "#e17055"
    style.font-color: "#e6edf3"
  }
}

unit_tests: Unit Test Layer {
  class: isolation_boundary
  
  service_under_test: gRPC Service {
    class: test_component
  }
  
  mock_db: Mock Database {
    class: test_double
    shape: cylinder
  }
  
  mock_external: Mock External API {
    class: test_double
  }
  
  stub_interceptors: Stub Interceptors {
    class: test_double
  }
  
  service_under_test -> mock_db: mocked calls
  service_under_test -> mock_external: mocked calls
  service_under_test -> stub_interceptors: stubbed behavior
}

integration_tests: Integration Test Layer {
  class: isolation_boundary
  
  test_server: In-Process Test Server {
    class: test_component
    grpc_service: gRPC Service {
      class: real_component
    }
    real_interceptors: Real Interceptors {
      class: real_component
    }
    grpc_service -> real_interceptors: middleware chain
  }
  
  test_db: Test Database {
    class: real_component
    shape: cylinder
  }
  
  mock_server: Mock External Server {
    class: test_double
    shape: cloud
  }
  
  test_server -> test_db: real database calls
  test_server -> mock_server: controlled responses
}

contract_tests: Contract Test Layer {
  class: isolation_boundary
  
  grpc_client: gRPC Test Client {
    class: test_component
  }
  
  contract_server: Contract Mock Server {
    class: test_double
    shape: cloud
  }
  
  schema_validator: Schema Validator {
    class: test_component
  }
  
  grpc_client -> contract_server: protobuf validation
  contract_server -> schema_validator: schema compliance
}

e2e_tests: End-to-End Test Layer {
  class: isolation_boundary
  
  full_service: Production-like Service {
    class: real_component
  }
  
  real_db: Real Database {
    class: real_component
    shape: cylinder
  }
  
  external_sandbox: External API Sandbox {
    class: real_component
    shape: cloud
  }
  
  full_service -> real_db: production behavior
  full_service -> external_sandbox: sandbox environment
}

test_client: Test Client {
  class: test_component
}

test_client -> unit_tests.service_under_test: isolated testing
test_client -> integration_tests.test_server: component integration
test_client -> contract_tests.contract_server: API contracts
test_client -> e2e_tests.full_service: full system validation

boundary_note: |md
  **Isolation Boundaries**
  - Unit: Maximum isolation, all dependencies mocked
  - Integration: Real service + DB, external APIs mocked
  - Contract: API schema and behavior validation
  - E2E: Production-like environment testing
| {
  shape: page
  class: test_component
  near: top-right
}