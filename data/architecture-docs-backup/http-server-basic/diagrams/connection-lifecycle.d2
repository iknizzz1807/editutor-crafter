direction: down

title: TCP Connection Lifecycle {
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
  near: top-center
}

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  initial: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#1a1a2e"
    style.bold: true
  }
  
  final: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
    style.double-border: true
  }
  
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

init: {
  shape: circle
  class: initial
  label: ""
}

socket_created: Socket Created {
  shape: circle
  class: state
}

bound: Bound to Port {
  shape: circle
  class: state
}

listening: Listening {
  shape: circle
  class: state
}

accepting: Accepting Connection {
  shape: circle
  class: state
}

connected: Client Connected {
  shape: circle
  class: state
}

processing: Processing Request {
  shape: circle
  class: state
}

responding: Sending Response {
  shape: circle
  class: state
}

closing: Closing Connection {
  shape: circle
  class: state
}

cleanup: Resource Cleanup {
  shape: circle
  class: state
}

closed: {
  shape: circle
  class: final
  label: "Closed"
}

init -> socket_created: create socket() {
  class: transition
}

socket_created -> bound: bind() to address:port {
  class: transition
}

bound -> listening: listen() for connections {
  class: transition
}

listening -> accepting: client connects {
  class: transition
}

accepting -> connected: accept() returns client fd {
  class: transition
}

connected -> processing: read() client request {
  class: transition
}

processing -> responding: process & write() response {
  class: transition
}

responding -> closing: send complete / client disconnect {
  class: transition
}

responding -> processing: keep-alive / next request {
  class: transition
  style.stroke: "#d63031"
  style.stroke-dash: 3
}

closing -> cleanup: close() client socket {
  class: transition
}

cleanup -> listening: ready for next client {
  class: transition
  style.stroke: "#d63031"
  style.stroke-dash: 3
}

cleanup -> closed: server shutdown {
  class: transition
}

listening -> closed: server shutdown {
  class: transition
}

socket_created -> closed: error / shutdown {
  class: transition
  style.stroke: "#d63031"
}

bound -> closed: error / shutdown {
  class: transition
  style.stroke: "#d63031"
}

accepting -> closed: error / shutdown {
  class: transition
  style.stroke: "#d63031"
}