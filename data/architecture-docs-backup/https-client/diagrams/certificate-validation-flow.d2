title: Certificate Validation Process {
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
  near: top-center
}

classes: {
  start_node: {
    style.fill: "#3fb950"
    style.font-color: "#ffffff"
    style.bold: true
  }
  process_node: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision_node: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  error_node: {
    style.fill: "#d63031"
    style.font-color: "#ffffff"
    style.bold: true
  }
  success_node: {
    style.fill: "#00b894"
    style.font-color: "#ffffff"
    style.bold: true
  }
}

start: Start Certificate Validation {
  shape: circle
  class: start_node
}

receive_cert: Receive Server Certificate Chain {
  class: process_node
}

parse_cert: Parse X.509 Certificate {
  class: process_node
}

parse_valid: Certificate Parseable? {
  shape: diamond
  class: decision_node
}

check_signature: Verify Certificate Signature {
  class: process_node
}

signature_valid: Signature Valid? {
  shape: diamond
  class: decision_node
}

check_expiry: Check Certificate Expiration {
  class: process_node
}

not_expired: Certificate Not Expired? {
  shape: diamond
  class: decision_node
}

validate_hostname: Validate Hostname Match {
  class: process_node
}

hostname_valid: Hostname Matches? {
  shape: diamond
  class: decision_node
}

check_chain: Build Certificate Chain {
  class: process_node
}

find_issuer: Find Issuer Certificate {
  class: process_node
}

issuer_found: Issuer Found? {
  shape: diamond
  class: decision_node
}

verify_trust: Verify Trust Anchor {
  class: process_node
}

trust_valid: Trust Anchor Valid? {
  shape: diamond
  class: decision_node
}

check_revocation: Check Certificate Revocation {
  class: process_node
}

not_revoked: Certificate Not Revoked? {
  shape: diamond
  class: decision_node
}

validation_success: Certificate Valid {
  shape: circle
  class: success_node
}

parse_error: Parse Error {
  shape: circle
  class: error_node
}

signature_error: Signature Verification Failed {
  shape: circle
  class: error_node
}

expiry_error: Certificate Expired {
  shape: circle
  class: error_node
}

hostname_error: Hostname Mismatch {
  shape: circle
  class: error_node
}

chain_error: Chain Building Failed {
  shape: circle
  class: error_node
}

trust_error: Trust Anchor Invalid {
  shape: circle
  class: error_node
}

revocation_error: Certificate Revoked {
  shape: circle
  class: error_node
}

start -> receive_cert
receive_cert -> parse_cert
parse_cert -> parse_valid
parse_valid -> check_signature: Yes
parse_valid -> parse_error: No

check_signature -> signature_valid
signature_valid -> check_expiry: Yes
signature_valid -> signature_error: No

check_expiry -> not_expired
not_expired -> validate_hostname: Yes
not_expired -> expiry_error: No

validate_hostname -> hostname_valid
hostname_valid -> check_chain: Yes
hostname_valid -> hostname_error: No

check_chain -> find_issuer
find_issuer -> issuer_found
issuer_found -> verify_trust: Yes
issuer_found -> chain_error: No

verify_trust -> trust_valid
trust_valid -> check_revocation: Yes
trust_valid -> trust_error: No

check_revocation -> not_revoked
not_revoked -> validation_success: Yes
not_revoked -> revocation_error: No

find_issuer -> find_issuer: More certificates in chain {
  style.stroke-dash: 3
  style.stroke: "#8b949e"
}