title: TLS 1.3 Handshake Message Flow
shape: sequence_diagram

client: Client {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

server: Server {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

client -> server: ClientHello\n(supported ciphers, extensions, client random, key_share)
server -> client: ServerHello\n(chosen cipher, server random, key_share)
server -> client: EncryptedExtensions\n(encrypted server extensions)
server -> client: Certificate\n(server certificate chain)
server -> client: CertificateVerify\n(signature over handshake transcript)
server -> client: Finished\n(MAC of handshake messages)
client -> server: Certificate\n(client certificate - optional)
client -> server: CertificateVerify\n(client signature - optional)
client -> server: Finished\n(MAC of handshake messages)
client -> server: Application Data\n(encrypted HTTP request)
server -> client: Application Data\n(encrypted HTTP response)

classes: {
  encrypted_msg: {
    style.stroke: "#e17055"
    style.stroke-dash: 3
    style.font-color: "#fd79a8"
  }
}

server -> client: {class: encrypted_msg}
client -> server: {class: encrypted_msg}
client -> server: {class: encrypted_msg}
client -> server: {class: encrypted_msg}
server -> client: {class: encrypted_msg}