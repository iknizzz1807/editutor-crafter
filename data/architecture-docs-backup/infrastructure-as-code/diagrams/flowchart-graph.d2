shape: rectangle

title: Flowchart: Dependency Graph and Topological Sort

# Styles
classes: {
  flowchart: {
    style.font-color: "#e6edf3"
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
  }
  decision: {
    shape: diamond
    style.fill: "#16213e"
    style.stroke: "#3fb950"
  }
  process: {
    shape: rectangle
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
  }
  highlight: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.stroke-width: 3
    style.bold: true
  }
  cycle: {
    style.fill: "#5c1a1a"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
  }
}

# Start
start: Start {
  shape: circle
  style.fill: "#3fb950"
}

# Graph Building Section
build_graph_container: Build Dependency Graph {
  style.fill: "#1a1a2e"
  extract_refs: Extract References from Config {
    class: process
  }
  create_nodes: Create Nodes for Resources {
    class: process
  }
  add_edges: Add Edges for Dependencies {
    class: process
  }
}

# Topological Sort Section
toposort_container: Topological Sort {
  style.fill: "#1a1a2e"
  calculate_indegree: Calculate In-Degree for Each Node {
    class: process
  }
  find_zero: Find Nodes with Zero In-Degree {
    class: decision
  }
  remove_node: Remove Node from Graph {
    class: process
  }
  update_neighbors: Update In-Degree of Neighbors {
    class: process
  }
  add_to_sorted: Add Node to Sorted List {
    class: process
  }
  check_empty: All Nodes Processed? {
    class: decision
  }
}

# Cycle Detection Section
cycle_container: Cycle Detection {
  class: cycle
  cycle_detected: Cycle Detected {
    style: {
      fill: "#5c1a1a"
      stroke: "#e17055"
    }
  }
  output_error: Output Error: Circular Dependency {
    class: process
  }
}

# End
end: End (Sorted List) {
  shape: circle
  style.fill: "#3fb950"
}

# Flow
start -> build_graph_container

extract_refs -> create_nodes -> add_edges

add_edges -> calculate_indegree

calculate_indegree -> find_zero

find_zero -> remove_node: Yes
remove_node -> update_neighbors -> add_to_sorted -> check_empty

check_empty -> find_zero: No
check_empty -> end: Yes

find_zero -> cycle_detected: No
cycle_detected -> output_error -> end

# Highlight the cycle detection path
find_zero -> cycle_detected: {
  style.stroke: "#e17055"
  style.stroke-width: 3
}