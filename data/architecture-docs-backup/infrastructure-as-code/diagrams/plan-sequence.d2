shape: sequence_diagram
title: Sequence Diagram: Plan Command

user: User {
  style.bold: true
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
}
cli: CLI {
  style.fill: "#16213e"
  style.font-color: "#e6edf3"
}
parser: Parser {
  style.fill: "#16213e"
  style.font-color: "#e6edf3"
}
state_mgr: State Manager {
  style.fill: "#16213e"
  style.font-color: "#e6edf3"
}
planner: Planner {
  style.fill: "#16213e"
  style.font-color: "#e6edf3"
}

user -> cli: `plan` command with config path
cli -> parser: Parse config file
parser -> cli: Return parsed desired state
cli -> state_mgr: Read current state
state_mgr -> cli: Return current state (or empty)
cli -> planner: Build execution plan (desired, current)
planner -> planner: 1. Build dependency graph
planner -> planner: 2. Compute resource diffs
planner -> cli: Return execution plan
cli -> user: Display formatted plan (create, update, delete)