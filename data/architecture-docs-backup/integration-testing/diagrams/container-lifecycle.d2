title: Container Lifecycle State Machine

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  error_state: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
  }
  final_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
  }
  start_state: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
  }
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  retry_transition: {
    style.stroke: "#ffa500"
    style.stroke-dash: 3
    style.font-color: "#ffa500"
  }
  error_transition: {
    style.stroke: "#d63031"
    style.font-color: "#d63031"
  }
}

init: {
  shape: circle
  class: start_state
  label: ""
}

created: Created {
  shape: circle
  class: state
}

starting: Starting {
  shape: circle
  class: state
}

healthy: Healthy {
  shape: circle
  class: state
}

running: Running {
  shape: circle
  class: state
}

stopping: Stopping {
  shape: circle
  class: state
}

stopped: Stopped {
  shape: circle
  class: final_state
}

start_failed: Start Failed {
  shape: circle
  class: error_state
}

health_check_failed: Health Check Failed {
  shape: circle
  class: error_state
}

runtime_error: Runtime Error {
  shape: circle
  class: error_state
}

init -> created: container.create() {
  class: transition
}

created -> starting: container.start() {
  class: transition
}

starting -> healthy: health_check_pass {
  class: transition
}

healthy -> running: ready {
  class: transition
}

running -> stopping: container.stop() {
  class: transition
}

stopping -> stopped: graceful_shutdown {
  class: transition
}

starting -> start_failed: startup_error {
  class: error_transition
}

healthy -> health_check_failed: health_check_timeout {
  class: error_transition
}

running -> runtime_error: crash | oom_kill {
  class: error_transition
}

start_failed -> starting: retry (max 3) {
  class: retry_transition
}

health_check_failed -> starting: restart {
  class: retry_transition
}

runtime_error -> starting: auto_restart {
  class: retry_transition
}

start_failed -> stopped: retry_exhausted {
  class: error_transition
}

health_check_failed -> stopped: give_up {
  class: error_transition
}

runtime_error -> stopped: fatal_error {
  class: error_transition
}

running -> stopping: force_kill {
  class: error_transition
}

retry_note: |md
  **Retry Logic:**
  - Start failures: 3 retries with exponential backoff
  - Health checks: 5 attempts, 30s timeout each
  - Runtime errors: Auto-restart unless fatal
| {
  shape: page
  near: top-right
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}