title: Database Test Isolation Strategies {
  near: top-center
  style.font-size: 18
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  isolation_strategy: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  pros: {
    style.fill: "#0d4d2a"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  cons: {
    style.fill: "#4d1a1a"
    style.stroke: "#e17055"
    style.font-color: "#e6edf3"
  }
  
  component: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

transaction_strategy: Transaction Rollback Strategy {
  class: isolation_strategy
  
  test_runner: Test Runner {
    class: component
  }
  
  database: Database {
    shape: cylinder
    class: component
  }
  
  transaction_mgr: Transaction Manager {
    class: component
  }
  
  test_runner -> transaction_mgr: Begin transaction
  transaction_mgr -> database: START TRANSACTION
  test_runner -> database: Execute test operations
  test_runner -> transaction_mgr: End test
  transaction_mgr -> database: ROLLBACK
  
  pros: Pros {
    class: pros
    label: |md
      • Fast execution
      • Perfect isolation
      • No data cleanup needed
      • Preserves referential integrity
    |
  }
  
  cons: Cons {
    class: cons
    label: |md
      • Cannot test commit behavior
      • Breaks with auto-commit operations
      • Complex with distributed transactions
      • May miss transaction-related bugs
    |
  }
}

truncation_strategy: Table Truncation Strategy {
  class: isolation_strategy
  
  test_runner2: Test Runner {
    class: component
  }
  
  database2: Database {
    shape: cylinder
    class: component
  }
  
  cleanup_service: Cleanup Service {
    class: component
  }
  
  test_runner2 -> database2: Execute test operations
  test_runner2 -> cleanup_service: Trigger cleanup
  cleanup_service -> database2: TRUNCATE tables
  cleanup_service -> database2: Reset sequences
  
  pros2: Pros {
    class: pros
    label: |md
      • Tests real commit behavior
      • Simple to understand
      • Works with all operations
      • Good for end-to-end tests
    |
  }
  
  cons2: Cons {
    class: cons
    label: |md
      • Slower than rollback
      • Complex dependency ordering
      • Parallel execution issues
      • Foreign key constraints
    |
  }
}

schema_strategy: Schema Separation Strategy {
  class: isolation_strategy
  
  test_runner3: Test Runner {
    class: component
  }
  
  database3: Database {
    shape: cylinder
    class: component
    
    schema_a: Schema A {
      class: component
    }
    
    schema_b: Schema B {
      class: component
    }
    
    schema_c: Schema C {
      class: component
    }
  }
  
  schema_mgr: Schema Manager {
    class: component
  }
  
  test_runner3 -> schema_mgr: Request schema
  schema_mgr -> database3: CREATE SCHEMA test_xyz
  test_runner3 -> schema_a: Execute operations
  test_runner3 -> schema_mgr: Release schema
  schema_mgr -> database3: DROP SCHEMA test_xyz
  
  pros3: Pros {
    class: pros
    label: |md
      • Perfect parallel isolation
      • Full transactional testing
      • Independent test data
      • Scalable execution
    |
  }
  
  cons3: Cons {
    class: cons
    label: |md
      • High resource overhead
      • Complex schema management
      • Slower setup/teardown
      • Database-specific features
    |
  }
}

comparison_matrix: |md
  ## Trade-off Matrix
  
  | Strategy | Speed | Isolation | Parallelism | Real Behavior |
  |----------|-------|-----------|-------------|---------------|
  | Rollback | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ | ⭐ |
  | Truncate | ⭐⭐ | ⭐⭐ | ⭐ | ⭐⭐⭐ |
  | Schema | ⭐ | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ |
| {
  shape: page
  near: bottom-center
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

transaction_strategy -> truncation_strategy: {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

truncation_strategy -> schema_strategy: {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}