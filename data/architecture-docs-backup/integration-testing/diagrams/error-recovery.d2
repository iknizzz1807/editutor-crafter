direction: down

title: Error Handling and Recovery Flowchart {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  recovery: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

start: Test Execution Start {
  shape: circle
  class: process
}

failure_detected: Failure Detected {
  shape: diamond
  class: decision
}

classify_failure: Classify Failure Type {
  class: process
}

container_startup: Container Startup Failure {
  shape: diamond
  class: error
}

test_timeout: Test Timeout {
  shape: diamond
  class: error
}

resource_exhaustion: Resource Exhaustion {
  shape: diamond
  class: error
}

other_failure: Other Failure {
  shape: diamond
  class: error
}

retry_container: Retry Container Start {
  class: recovery
}

check_retry_count: Retry Count < Max? {
  shape: diamond
  class: decision
}

extend_timeout: Extend Timeout {
  class: recovery
}

timeout_recoverable: Timeout Recoverable? {
  shape: diamond
  class: decision
}

cleanup_resources: Cleanup Resources {
  class: recovery
}

resource_recoverable: Resources Available? {
  shape: diamond
  class: decision
}

log_error: Log Error Details {
  class: process
}

graceful_cleanup: Graceful Cleanup {
  class: recovery
}

force_cleanup: Force Cleanup {
  class: recovery
}

cleanup_success: Cleanup Successful? {
  shape: diamond
  class: decision
}

mark_failed: Mark Test Failed {
  class: error
}

mark_recovered: Mark Test Recovered {
  class: process
}

continue_execution: Continue Execution {
  class: process
}

start -> failure_detected: Monitor
failure_detected -> classify_failure: Yes
failure_detected -> continue_execution: No

classify_failure -> container_startup: Container Issue
classify_failure -> test_timeout: Timeout
classify_failure -> resource_exhaustion: Resources
classify_failure -> other_failure: Unknown

container_startup -> retry_container
retry_container -> check_retry_count
check_retry_count -> retry_container: Yes
check_retry_count -> mark_failed: No

test_timeout -> timeout_recoverable
timeout_recoverable -> extend_timeout: Yes
timeout_recoverable -> log_error: No
extend_timeout -> mark_recovered

resource_exhaustion -> cleanup_resources
cleanup_resources -> resource_recoverable
resource_recoverable -> mark_recovered: Yes
resource_recoverable -> mark_failed: No

other_failure -> log_error
log_error -> graceful_cleanup
graceful_cleanup -> cleanup_success
cleanup_success -> force_cleanup: No
cleanup_success -> mark_failed: Yes (partial)

force_cleanup -> cleanup_success
mark_failed -> continue_execution
mark_recovered -> continue_execution