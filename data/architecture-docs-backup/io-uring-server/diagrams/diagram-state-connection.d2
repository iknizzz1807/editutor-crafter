CONNECTION_STATE_MACHINE: Connection State Machine {
  ACCEPTING: ACCEPTING {
    shape: circle
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  READING: READING {
    shape: circle
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  WRITING: WRITING {
    shape: circle
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  CLOSING: CLOSING {
    shape: circle
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  CLOSED: CLOSED {
    shape: circle
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

# Initial state
init: "" {
  shape: circle
  style.fill: "#3fb950"
}
init -> ACCEPTING

# Transitions
ACCEPTING -> READING: accept_complete
READING -> WRITING: data_received
WRITING -> READING: write_complete

# Error transitions from any state to CLOSING
ACCEPTING -> CLOSING: error
READING -> CLOSING: error
WRITING -> CLOSING: error

# Normal closing flow
READING -> CLOSING: connection_closed
WRITING -> CLOSING: connection_closed

# Final transition
CLOSING -> CLOSED: cleanup_complete