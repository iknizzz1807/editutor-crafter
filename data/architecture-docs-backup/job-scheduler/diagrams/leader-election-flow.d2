title: Leader Election Process

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  leader: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  failure: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
}

start: Start {
  shape: circle
  style.fill: "#3fb950"
  style.font-color: "#ffffff"
  label: ""
}

detect_failure: Detect Leader\nFailure {
  class: failure
}

announce: Announce\nCandidacy {
  class: process
}

request_votes: Request Votes\nfrom Nodes {
  class: process
}

collect_votes: Collect Vote\nResponses {
  class: process
}

majority_check: Received\nMajority? {
  shape: diamond
  class: decision
}

become_leader: Become Leader {
  class: leader
}

start_heartbeat: Start Heartbeat\nBroadcast {
  class: leader
}

send_heartbeat: Send Heartbeat\nto All Nodes {
  class: leader
}

wait_responses: Wait for\nHeartbeat ACKs {
  class: process
}

heartbeat_check: All Nodes\nResponding? {
  shape: diamond
  class: decision
}

step_down: Step Down\nfrom Leadership {
  class: failure
}

wait_election: Wait for New\nElection {
  class: process
}

start -> detect_failure
detect_failure -> announce
announce -> request_votes
request_votes -> collect_votes
collect_votes -> majority_check

majority_check -> become_leader: Yes
majority_check -> wait_election: No

become_leader -> start_heartbeat
start_heartbeat -> send_heartbeat
send_heartbeat -> wait_responses
wait_responses -> heartbeat_check

heartbeat_check -> send_heartbeat: Yes
heartbeat_check -> step_down: No

step_down -> announce
wait_election -> announce

election_timeout: Election Timeout {
  class: failure
  near: bottom-left
}

election_timeout -> announce