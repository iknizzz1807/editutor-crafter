direction: right

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    shape: circle
  }
  initial: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#1a1a2e"
    shape: circle
  }
  final: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
    shape: circle
  }
}

# Initial state
start: {
  class: initial
  label: ""
}

# Main tokenization states
initial: Initial {
  class: state
}

# String parsing states
string_start: String Start {
  class: state
}

string_content: String Content {
  class: state
}

string_escape: Escape Sequence {
  class: state
}

string_unicode: Unicode Escape {
  class: state
}

string_end: String Complete {
  class: final
}

# Number parsing states
number_start: Number Start {
  class: state
}

integer_part: Integer Part {
  class: state
}

decimal_point: Decimal Point {
  class: state
}

fraction_part: Fraction Part {
  class: state
}

exponent_start: Exponent Start {
  class: state
}

exponent_sign: Exponent Sign {
  class: state
}

exponent_digits: Exponent Digits {
  class: state
}

number_end: Number Complete {
  class: final
}

# Error state
error: Error {
  class: state
  style.fill: "#d63031"
  style.stroke: "#e17055"
}

# Transitions
start -> initial

# String parsing flow
initial -> string_start: '"'
string_start -> string_content: char
string_content -> string_content: normal char
string_content -> string_escape: backslash
string_content -> string_end: '"'
string_escape -> string_content: valid escape
string_escape -> string_unicode: u
string_escape -> error: invalid escape
string_unicode -> string_content: 4 hex digits
string_unicode -> error: invalid hex

# Number parsing flow
initial -> number_start: digit or minus
number_start -> integer_part: digit
integer_part -> integer_part: digit
integer_part -> decimal_point: dot
integer_part -> exponent_start: e or E
integer_part -> number_end: whitespace or delimiter

decimal_point -> fraction_part: digit
decimal_point -> error: non-digit
fraction_part -> fraction_part: digit
fraction_part -> exponent_start: e or E
fraction_part -> number_end: whitespace or delimiter

exponent_start -> exponent_sign: plus or minus
exponent_start -> exponent_digits: digit
exponent_start -> error: invalid char
exponent_sign -> exponent_digits: digit
exponent_sign -> error: non-digit
exponent_digits -> exponent_digits: digit
exponent_digits -> number_end: whitespace or delimiter

# Error transitions
string_start -> error: EOF
string_content -> error: EOF
number_start -> error: invalid char