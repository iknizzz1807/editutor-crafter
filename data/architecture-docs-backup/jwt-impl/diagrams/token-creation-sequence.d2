direction: right

shape: sequence_diagram

classes: {
  header_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  payload_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  crypto_style: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  token_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

client: Client {
  class: header_style
}

encoder: Token Encoder {
  class: payload_style
}

signer: Crypto Signer {
  class: crypto_style
}

assembler: Token Assembler {
  class: token_style
}

client -> encoder: Create JWT Request\n(header claims, payload data)
encoder -> encoder: "1. Serialize header to JSON\n{\"alg\": \"HS256\", \"typ\": \"JWT\"}"
encoder -> encoder: 2. Base64URL encode header\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
encoder -> encoder: "3. Serialize payload to JSON\n{\"sub\": \"user123\", \"exp\": 1234567890}"
encoder -> encoder: 4. Base64URL encode payload\neyJzdWIiOiJ1c2VyMTIzIiwiZXhwIjoxMjM0NTY3ODkwfQ

encoder -> signer: Sign Request\n(encoded_header.encoded_payload, secret_key)
signer -> signer: "5. Create signing input\nheader + \".\" + payload"
signer -> signer: 6. Generate HMAC-SHA256\nhmac_sha256(signing_input, secret)
signer -> signer: 7. Base64URL encode signature\nSflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c

signer -> assembler: Return signature\n(encoded_signature)
assembler -> assembler: 8. Assemble final token\nheader.payload.signature

assembler -> client: Complete JWT Token\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyMTIzIiwiZXhwIjoxMjM0NTY3ODkwfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c