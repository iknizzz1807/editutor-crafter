shape: sequence_diagram

client: Client
jwt_verifier: JWT Verifier
parser: Token Parser
signature_validator: Signature Validator
claims_validator: Claims Validator

client -> jwt_verifier: verify_token(token, secret)
jwt_verifier -> parser: parse_token(token)
parser -> parser: validate_base64_encoding()
parser -> parser: parse_header()
parser -> parser: parse_payload()
parser -> jwt_verifier: return parsed_token
jwt_verifier -> signature_validator: verify_signature(header, payload, signature, secret)
signature_validator -> signature_validator: get_algorithm_from_header()
signature_validator -> signature_validator: generate_expected_signature()
signature_validator -> signature_validator: constant_time_compare()
signature_validator -> jwt_verifier: return signature_valid
jwt_verifier -> claims_validator: validate_claims(payload, validation_options)
claims_validator -> claims_validator: check_expiration(exp)
claims_validator -> claims_validator: check_not_before(nbf)
claims_validator -> claims_validator: check_issued_at(iat)
claims_validator -> claims_validator: validate_issuer(iss)
claims_validator -> claims_validator: validate_audience(aud)
claims_validator -> claims_validator: validate_custom_claims()
claims_validator -> jwt_verifier: return claims_valid
jwt_verifier -> client: return verification_result

classes: {
  actor_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

client.class: actor_style
jwt_verifier.class: actor_style
parser.class: actor_style
signature_validator.class: actor_style
claims_validator.class: actor_style