title: Data Model Relationships

classes: {
  core_type: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  transform: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  result_type: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

FeatureVector: {
  shape: class
  class: core_type
  - "values: float[]"
  - "dimensions: int"
  + "get_dimension(index: int): float"
  + "euclidean_distance(other: FeatureVector): float"
  + "manhattan_distance(other: FeatureVector): float"
}

TrainingData: {
  shape: class
  class: core_type
  - "features: FeatureVector[]"
  - "labels: ClassLabel[]"
  - "size: int"
  + "get_sample(index: int): (FeatureVector, ClassLabel)"
  + "validate(): bool"
}

DistanceMatrix: {
  shape: class
  class: transform
  - "distances: float[][]"
  - "query_count: int"
  - "sample_count: int"
  + "get_distance(query_idx: int, sample_idx: int): float"
  + "compute_from_vectors(queries: FeatureVector[], samples: FeatureVector[]): void"
}

NeighborList: {
  shape: class
  class: transform
  - "indices: int[]"
  - "distances: float[]"
  - "k: int"
  + "get_neighbor(rank: int): (int, float)"
  + "add_neighbor(index: int, distance: float): void"
  + "is_full(): bool"
}

Prediction: {
  shape: class
  class: result_type
  - "predicted_class: ClassLabel"
  - "confidence: float"
  - "neighbor_votes: Map<ClassLabel, int>"
  + "get_prediction(): ClassLabel"
  + "get_confidence_score(): float"
  + "get_supporting_neighbors(): int[]"
}

pipeline: {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  distance_calc: {
    shape: rectangle
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
  }
  
  neighbor_search: {
    shape: rectangle
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
  }
  
  classification: {
    shape: rectangle
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
  }
}

TrainingData -> pipeline.distance_calc: "feature vectors"
FeatureVector -> pipeline.distance_calc: "query vector"
pipeline.distance_calc -> DistanceMatrix: "computed distances"

DistanceMatrix -> pipeline.neighbor_search: "distance values"
pipeline.neighbor_search -> NeighborList: "k nearest neighbors"

NeighborList -> pipeline.classification: "neighbor indices"
TrainingData -> pipeline.classification: "class labels"
pipeline.classification -> Prediction: "final prediction"

FeatureVector -> DistanceMatrix: {
  label: "vectorized distance computation"
  style.stroke: "#3fb950"
}

DistanceMatrix -> NeighborList: {
  label: "k-smallest selection"
  style.stroke: "#3fb950"
}

NeighborList -> Prediction: {
  label: "majority vote classification"
  style.stroke: "#3fb950"
}

TrainingData -> FeatureVector: {
  label: "contains"
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}