classes: {
  custom_resource: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  spec_field: {
    style.fill: "#16213e"
    style.stroke: "#58a6ff"
    style.font-color: "#e6edf3"
  }
  status_field: {
    style.fill: "#0f3460"
    style.stroke: "#f85149"
    style.font-color: "#e6edf3"
  }
  validation: {
    style.fill: "#2d1b69"
    style.stroke: "#a5a5ff"
    style.font-color: "#e6edf3"
  }
}

diagram_title: Custom Resource Data Model {
  near: top-center
  style.font-size: 18
  style.bold: true
  style.font-color: "#e6edf3"
}

application_crd: ApplicationCRD {
  shape: class
  class: custom_resource
  - "apiVersion: string"
  - "kind: Application"
  - "metadata: ObjectMeta"
  - "spec: ApplicationSpec"
  - "status: ApplicationStatus"
}

app_spec: ApplicationSpec {
  shape: class
  class: spec_field
  - "name: string"
  - "version: string"
  - "image: string"
  - "replicas: int32"
  - "resources: ResourceRequirements"
  - "dependencies: Dependency[]"
  - "config: Map<string, string>"
}

app_status: ApplicationStatus {
  shape: class
  class: status_field
  - "phase: ApplicationPhase"
  - "replicas: int32"
  - "readyReplicas: int32"
  - "conditions: Condition[]"
  - "observedGeneration: int64"
  - "lastUpdated: metav1.Time"
}

dependency_crd: DependencyCRD {
  shape: class
  class: custom_resource
  - "apiVersion: string"
  - "kind: Dependency"
  - "metadata: ObjectMeta"
  - "spec: DependencySpec"
  - "status: DependencyStatus"
}

dep_spec: DependencySpec {
  shape: class
  class: spec_field
  - "name: string"
  - "dependency_type: DependencyType"
  - "endpoint: string"
  - "version: string"
  - "required: bool"
  - "healthCheck: HealthCheckConfig"
}

dep_status: DependencyStatus {
  shape: class
  class: status_field
  - "ready: bool"
  - "endpoint: string"
  - "conditions: Condition[]"
  - "lastChecked: metav1.Time"
}

condition_type: Condition {
  shape: class
  class: status_field
  - "condition_type: string"
  - "status: ConditionStatus"
  - "reason: string"
  - "message: string"
  - "lastTransitionTime: metav1.Time"
}

validation_rules: ValidationRules {
  shape: class
  class: validation
  - "+ validateReplicas(min: 1, max: 100)"
  - "+ validateVersion(semver: true)"
  - "+ validateResources(required: true)"
  - "+ validateDependencies(maxItems: 10)"
  - "+ validateConfig(maxProperties: 50)"
}

webhook_admission: AdmissionWebhook {
  shape: class
  class: validation
  - "+ validateCreate(obj: Application)"
  - "+ validateUpdate(old, new: Application)"
  - "+ setDefaults(obj: Application)"
  - "+ mutateConfig(obj: Application)"
}

application_crd -> app_spec: contains
application_crd -> app_status: reports
dependency_crd -> dep_spec: contains
dependency_crd -> dep_status: reports

app_spec -> dependency_crd: references
app_status -> condition_type: includes
dep_status -> condition_type: includes

validation_rules -> application_crd: validates
validation_rules -> dependency_crd: validates
webhook_admission -> application_crd: admits
webhook_admission -> dependency_crd: admits

blueprint_note: |md
  **CRD as Blueprint**
  Defines schema, validation rules,
  and structural requirements
| {
  shape: page
  near: top-left
  style.fill: "#2d1b69"
  style.font-color: "#e6edf3"
  style.stroke: "#a5a5ff"
}

status_note: |md
  **Status Subresource**
  Controller-only updates
  Current state reporting
| {
  shape: page
  near: bottom-right
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
  style.stroke: "#f85149"
}