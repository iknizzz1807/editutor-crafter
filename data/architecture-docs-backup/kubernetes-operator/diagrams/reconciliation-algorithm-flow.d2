classes: {
  decision: {
    shape: diamond
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  process: {
    style.fill: "#16213e"
    style.stroke: "#3fb950" 
    style.font-color: "#e6edf3"
  }
  endpoint: {
    shape: oval
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

start: Start Reconciliation {
  class: endpoint
}

fetch: Fetch Current State {
  class: process
}

compare: Compare with Desired State {
  class: decision
}

no_change: No Action Required {
  class: process
}

determine_action: Determine Required Action {
  class: decision
}

create: Create Resources {
  class: process
}

update: Update Resources {
  class: process
}

delete: Delete Resources {
  class: process
}

verify: Verify Operation Success {
  class: decision
}

update_status: Update Resource Status {
  class: process
}

handle_error: Handle Error & Retry {
  class: process
}

complete: Reconciliation Complete {
  class: endpoint
}

start -> fetch: Begin

fetch -> compare: Current state retrieved

compare -> no_change: States match {
  style.stroke: "#3fb950"
}

compare -> determine_action: States differ {
  style.stroke: "#d63031"
}

determine_action -> create: Missing resources {
  style.stroke: "#8b949e"
}

determine_action -> update: Modified resources {
  style.stroke: "#8b949e"
}

determine_action -> delete: Excess resources {
  style.stroke: "#8b949e"
}

create -> verify: Resources created

update -> verify: Resources updated

delete -> verify: Resources deleted

verify -> update_status: Success {
  style.stroke: "#3fb950"
}

verify -> handle_error: Failure {
  style.stroke: "#d63031"
}

handle_error -> fetch: Retry {
  style.stroke: "#8b949e"
}

update_status -> complete: Status updated

no_change -> complete: Skip to end