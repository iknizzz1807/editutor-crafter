title: Election Message Type Relationships

classes: {
  base_class: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  message_class: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  algorithm_container: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

BaseMessage: {
  shape: class
  class: base_class
  - "sender_id: NodeId"
  - "receiver_id: NodeId"
  - "timestamp: u64"
  + "new(sender: NodeId, receiver: NodeId): Self"
  + "validate(): bool"
}

ElectionMsg: {
  shape: class
  class: message_class
  - "candidate_id: NodeId"
  - "election_id: u64"
  + "new(candidate: NodeId, election_id: u64): Self"
}

OkMsg: {
  shape: class
  class: message_class
  - "responding_to: NodeId"
  - "election_id: u64"
  + "new(responding_to: NodeId, election_id: u64): Self"
}

CoordinatorMsg: {
  shape: class
  class: message_class
  - "leader_id: NodeId"
  - "election_id: u64"
  + "new(leader: NodeId, election_id: u64): Self"
  + "broadcast(): Result"
}

HeartbeatMsg: {
  shape: class
  class: message_class
  - "sequence_number: u64"
  - "leader_term: u64"
  + "new(seq: u64, term: u64): Self"
}

RingTokenMsg: {
  shape: class
  class: message_class
  - "participants: Vec<NodeId>"
  - "initiator_id: NodeId"
  - "token_id: u64"
  + "new(initiator: NodeId): Self"
  + "add_participant(id: NodeId): Self"
  + "get_highest_id(): NodeId"
}

bully_algorithm: Bully Algorithm {
  class: algorithm_container
  bully_note: |md
    Uses Election, OK, and
    Coordinator messages
  | {
    shape: page
    style.fill: "#16213e"
    style.font-color: "#e6edf3"
  }
}

ring_algorithm: Ring Algorithm {
  class: algorithm_container
  ring_note: |md
    Uses Ring Token messages
    for cooperative election
  | {
    shape: page
    style.fill: "#16213e"
    style.font-color: "#e6edf3"
  }
}

failure_detection: Failure Detection {
  class: algorithm_container
  heartbeat_note: |md
    Uses Heartbeat messages
    for leader monitoring
  | {
    shape: page
    style.fill: "#16213e"
    style.font-color: "#e6edf3"
  }
}

BaseMessage -> ElectionMsg: extends
BaseMessage -> OkMsg: extends
BaseMessage -> CoordinatorMsg: extends
BaseMessage -> HeartbeatMsg: extends
BaseMessage -> RingTokenMsg: extends

bully_algorithm -> ElectionMsg: uses
bully_algorithm -> OkMsg: uses
bully_algorithm -> CoordinatorMsg: uses

ring_algorithm -> RingTokenMsg: uses

failure_detection -> HeartbeatMsg: uses
failure_detection -> CoordinatorMsg: monitors