title: Node Election State Machine

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  initial: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#1a1a2e"
  }
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

init: {
  shape: circle
  class: initial
  label: ""
}

follower: Follower {
  shape: circle
  class: state
}

candidate: Candidate {
  shape: circle
  class: state
}

leader: Leader {
  shape: circle
  class: state
}

init -> follower: Start {
  class: transition
}

follower -> candidate: Election timeout\nNo heartbeat from leader {
  class: transition
}

candidate -> leader: Receives majority votes\nBecomes leader {
  class: transition
}

candidate -> follower: Discovers higher term\nReceives valid heartbeat {
  class: transition
}

candidate -> candidate: Split vote\nElection timeout {
  class: transition
}

leader -> follower: Discovers higher term\nLoses majority\nNetwork partition healed {
  class: transition
}

follower -> follower: Receives heartbeat\nResets election timer {
  class: transition
}

leader -> leader: Sends heartbeats\nMaintains leadership {
  class: transition
}