title: Error Detection and Recovery Flow

# Style definitions
classes: {
  error_point: {
    style.fill: "#d63031"
    style.font-color: "#ffffff"
    style.stroke: "#e17055"
    style.bold: true
    shape: diamond
  }
  
  recovery: {
    style.fill: "#00b894"
    style.font-color: "#ffffff"
    style.stroke: "#00a085"
    style.bold: true
  }
  
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  validation: {
    style.fill: "#fdcb6e"
    style.font-color: "#2d3436"
    style.stroke: "#e84393"
  }
}

# Main flow
start: Start {
  shape: circle
  style.fill: "#3fb950"
  style.font-color: "#ffffff"
}

data_input: Data Input {
  class: process
}

input_validation: Input Validation Check {
  class: error_point
}

data_preprocessing: Data Preprocessing {
  class: process
}

matrix_validation: Matrix Dimension Check {
  class: error_point
}

gradient_computation: Gradient Computation {
  class: process
}

numerical_check: Numerical Stability Check {
  class: error_point
}

convergence_check: Convergence Check {
  class: error_point
}

model_complete: Model Complete {
  shape: circle
  style.fill: "#00b894"
  style.font-color: "#ffffff"
  style.double-border: true
}

# Recovery strategies
data_error_recovery: Data Error Recovery {
  class: recovery
  
  clean_data: Clean/Impute Data {
    class: validation
  }
  
  feature_scaling: Apply Feature Scaling {
    class: validation
  }
  
  outlier_removal: Remove Outliers {
    class: validation
  }
}

numerical_recovery: Numerical Recovery {
  class: recovery
  
  adjust_lr: Adjust Learning Rate {
    class: validation
  }
  
  regularization: Add Regularization {
    class: validation
  }
  
  rescale_features: Rescale Features {
    class: validation
  }
}

convergence_recovery: Convergence Recovery {
  class: recovery
  
  modify_lr: Modify Learning Rate {
    class: validation
  }
  
  change_optimizer: Change Optimizer {
    class: validation
  }
  
  increase_iterations: Increase Max Iterations {
    class: validation
  }
}

# Main flow connections
start -> data_input
data_input -> input_validation
input_validation -> data_preprocessing: Valid
input_validation -> data_error_recovery: Data Errors
data_preprocessing -> matrix_validation
matrix_validation -> gradient_computation: Valid Dimensions
matrix_validation -> data_error_recovery: Dimension Mismatch
gradient_computation -> numerical_check
numerical_check -> convergence_check: Numerically Stable
numerical_check -> numerical_recovery: Instability Detected
convergence_check -> model_complete: Converged
convergence_check -> convergence_recovery: No Convergence

# Recovery connections
data_error_recovery -> clean_data
data_error_recovery -> feature_scaling
data_error_recovery -> outlier_removal
clean_data -> data_preprocessing: Retry
feature_scaling -> data_preprocessing: Retry
outlier_removal -> data_preprocessing: Retry

numerical_recovery -> adjust_lr
numerical_recovery -> regularization
numerical_recovery -> rescale_features
adjust_lr -> gradient_computation: Retry
regularization -> gradient_computation: Retry
rescale_features -> gradient_computation: Retry

convergence_recovery -> modify_lr
convergence_recovery -> change_optimizer
convergence_recovery -> increase_iterations
modify_lr -> gradient_computation: Retry
change_optimizer -> gradient_computation: Retry
increase_iterations -> gradient_computation: Retry