shape: sequence_diagram

classes: {
  evaluator: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  environment: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  function: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

caller: "Caller" {
  class: evaluator
}
evaluator: "Evaluator" {
  class: evaluator
}
function: "Lambda Function" {
  class: function
}
env_mgr: "Environment Manager" {
  class: environment
}
new_env: "New Environment" {
  class: environment
}

caller -> evaluator: "(my-func 5 3)"
evaluator -> evaluator: "Parse function call"
evaluator -> evaluator: "Evaluate arguments: 5, 3"
evaluator -> function: "Retrieve function object"
function -> evaluator: "Return (params: [x y], body: (+ x y), closure-env)"
evaluator -> env_mgr: "Create new environment"
env_mgr -> new_env: "Initialize with closure environment as parent"
env_mgr -> evaluator: "Return new environment"
evaluator -> new_env: "Bind x = 5"
evaluator -> new_env: "Bind y = 3"
evaluator -> evaluator: "Evaluate body (+ x y) in new environment"
evaluator -> new_env: "Lookup x"
new_env -> evaluator: "Return 5"
evaluator -> new_env: "Lookup y"
new_env -> evaluator: "Return 3"
evaluator -> evaluator: "Apply + to [5, 3]"
evaluator -> evaluator: "Result: 8"
evaluator -> caller: "Return 8"