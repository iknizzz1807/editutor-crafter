shape: sequence_diagram

dataset_manager: Dataset Manager
eval_runner: Evaluation Runner
metrics_engine: Metrics Engine
llm_api: LLM API
cache: Cache Store
checkpoint: Checkpoint Store

dataset_manager -> eval_runner: start_evaluation(config, test_cases)
eval_runner -> cache: check_cache(test_case_hashes)
cache -> eval_runner: cached_results
eval_runner -> checkpoint: load_checkpoint(eval_id)
checkpoint -> eval_runner: previous_state

eval_runner -> eval_runner: batch_test_cases(remaining_cases)
eval_runner -> llm_api: batch_request(test_batch)
llm_api -> eval_runner: api_response
eval_runner -> eval_runner: handle_rate_limits()

eval_runner -> cache: store_results(test_id, response)
eval_runner -> metrics_engine: calculate_metrics(responses, expected)
metrics_engine -> eval_runner: metric_scores

eval_runner -> checkpoint: save_progress(batch_results)
eval_runner -> eval_runner: update_progress_tracker()

llm_api -> eval_runner: api_error
eval_runner -> eval_runner: retry_with_backoff()
eval_runner -> llm_api: retry_request(failed_batch)
llm_api -> eval_runner: retry_response

eval_runner -> metrics_engine: aggregate_final_metrics(all_results)
metrics_engine -> eval_runner: final_scores
eval_runner -> dataset_manager: evaluation_complete(results, metrics)

dataset_manager.style.fill: "#1a1a2e"
dataset_manager.style.stroke: "#3fb950"
dataset_manager.style.font-color: "#e6edf3"

eval_runner.style.fill: "#16213e"
eval_runner.style.stroke: "#3fb950"
eval_runner.style.font-color: "#e6edf3"
eval_runner.style.bold: true

metrics_engine.style.fill: "#1a1a2e"
metrics_engine.style.stroke: "#3fb950"
metrics_engine.style.font-color: "#e6edf3"

llm_api.style.fill: "#0f3460"
llm_api.style.stroke: "#8b949e"
llm_api.style.font-color: "#e6edf3"

cache.style.fill: "#1a1a2e"
cache.style.stroke: "#8b949e"
cache.style.font-color: "#e6edf3"

checkpoint.style.fill: "#1a1a2e"
checkpoint.style.stroke: "#8b949e"
checkpoint.style.font-color: "#e6edf3"