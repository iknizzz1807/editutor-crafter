classes: {
  entity: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  relationship: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

title: Core Data Model {
  near: top-center
  style.font-size: 24
  style.font-color: "#e6edf3"
  style.bold: true
}

TestConfiguration: {
  shape: class
  class: entity
  - "test_id: string"
  - "name: string"
  - "target_url: string"
  - "ramp_up_duration: Duration"
  - "steady_state_duration: Duration"
  - "ramp_down_duration: Duration"
  - "virtual_user_count: int"
  - "request_rate: int"
  - "scenario_script: string"
  - "headers: \"Map<string, string>\""
  - "created_at: DateTime"
  + "validate(): Result"
  + "get_total_duration(): Duration"
}

VirtualUser: {
  shape: class
  class: entity
  - "user_id: string"
  - "worker_id: string"
  - "test_id: string"
  - "current_state: UserState"
  - "iteration_count: int"
  - "start_time: DateTime"
  - "last_activity: DateTime"
  - "session_data: \"Map<string, any>\""
  + "execute_scenario(): void"
  + "record_metric(metric: MetricPoint): void"
  + "transition_state(state: UserState): void"
}

MetricPoint: {
  shape: class
  class: entity
  - "metric_id: string"
  - "test_id: string"
  - "user_id: string"
  - "worker_id: string"
  - "timestamp: DateTime"
  - "metric_type: MetricType"
  - "request_url: string"
  - "response_time_ms: float"
  - "status_code: int"
  - "bytes_sent: int"
  - "bytes_received: int"
  - "error_message: string"
  + "is_success(): bool"
  + "get_latency_category(): LatencyCategory"
}

WorkerState: {
  shape: class
  class: entity
  - "worker_id: string"
  - "coordinator_id: string"
  - "status: WorkerStatus"
  - "current_test_id: string"
  - "active_users: \"List<string>\""
  - "cpu_usage: float"
  - "memory_usage: float"
  - "last_heartbeat: DateTime"
  - "capabilities: \"Set<string>\""
  - "max_virtual_users: int"
  + "update_heartbeat(): void"
  + "assign_users(user_ids: \"List<string>\"): void"
  + "report_health(): HealthReport"
}

AggregatedResults: {
  shape: class
  class: entity
  - "test_id: string"
  - "time_window: TimeWindow"
  - "total_requests: int"
  - "successful_requests: int"
  - "failed_requests: int"
  - "avg_response_time: float"
  - "p95_response_time: float"
  - "p99_response_time: float"
  - "throughput_rps: float"
  - "error_rate: float"
  - "active_users: int"
  + "calculate_percentiles(): void"
  + "merge(other: AggregatedResults): AggregatedResults"
}

TestConfiguration -> VirtualUser: "configures" {
  class: relationship
}

VirtualUser -> MetricPoint: "generates" {
  class: relationship
}

VirtualUser -> WorkerState: "managed by" {
  class: relationship
}

MetricPoint -> AggregatedResults: "aggregated into" {
  class: relationship
}

WorkerState -> TestConfiguration: "receives" {
  class: relationship
}