direction: down

classes: {
  error_style: {
    style.fill: "#d63031"
    style.font-color: "#ffffff"
    style.stroke: "#e17055"
    style.bold: true
  }
  
  recovery_style: {
    style.fill: "#00b894"
    style.font-color: "#ffffff"
    style.stroke: "#00a085"
    style.bold: true
  }
  
  decision_style: {
    style.fill: "#fdcb6e"
    style.font-color: "#2d3436"
    style.stroke: "#e17055"
    style.bold: true
  }
  
  normal_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  container_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

failure_detection: Failure Detection {
  class: container_style
  
  worker_health: Worker Health Check {
    class: normal_style
  }
  
  network_monitor: Network Monitor {
    class: normal_style
  }
  
  target_probe: Target System Probe {
    class: normal_style
  }
}

worker_failure: Worker Failure Scenario {
  class: container_style
  
  worker_down: Worker Down {
    class: error_style
  }
  
  check_critical: Is Worker Critical? {
    shape: diamond
    class: decision_style
  }
  
  redistribute: Redistribute Load {
    class: recovery_style
  }
  
  terminate_test: Terminate Test {
    class: error_style
  }
  
  scale_cluster: Scale Up Cluster {
    class: recovery_style
  }
  
  worker_down -> check_critical
  check_critical -> redistribute: "No"
  check_critical -> terminate_test: "Yes + No Spare"
  check_critical -> scale_cluster: "Yes + Can Scale"
  redistribute -> scale_cluster
}

network_partition: Network Partition Scenario {
  class: container_style
  
  partition_detected: Network Partition {
    class: error_style
  }
  
  check_quorum: Maintain Quorum? {
    shape: diamond
    class: decision_style
  }
  
  isolate_partition: Isolate Partition {
    class: recovery_style
  }
  
  pause_test: Pause Test {
    class: decision_style
  }
  
  wait_recovery: Wait for Recovery {
    class: normal_style
  }
  
  timeout_check: Recovery Timeout? {
    shape: diamond
    class: decision_style
  }
  
  partition_detected -> check_quorum
  check_quorum -> isolate_partition: "Yes"
  check_quorum -> pause_test: "No"
  pause_test -> wait_recovery
  wait_recovery -> timeout_check
  timeout_check -> wait_recovery: "No"
  timeout_check -> terminate_test: "Yes"
}

target_system_down: Target System Down Scenario {
  class: container_style
  
  target_down: Target System Down {
    class: error_style
  }
  
  check_timeout: Connection Timeout? {
    shape: diamond
    class: decision_style
  }
  
  retry_logic: Exponential Backoff {
    class: recovery_style
  }
  
  circuit_breaker: Circuit Breaker {
    class: decision_style
  }
  
  mark_degraded: Mark as Degraded {
    class: normal_style
  }
  
  continue_test: Continue Partial Test {
    class: recovery_style
  }
  
  target_down -> check_timeout
  check_timeout -> retry_logic: "Yes"
  check_timeout -> circuit_breaker: "Multiple Failures"
  retry_logic -> circuit_breaker
  circuit_breaker -> mark_degraded: "Open"
  mark_degraded -> continue_test
  circuit_breaker -> retry_logic: "Half-Open"
}

recovery_coordination: Recovery Coordination {
  class: container_style
  
  coordinator: Recovery Coordinator {
    class: normal_style
  }
  
  state_sync: State Synchronization {
    class: recovery_style
  }
  
  metric_reconcile: Metric Reconciliation {
    class: recovery_style
  }
  
  test_resume: Resume/Restart Test {
    class: recovery_style
  }
}

failure_detection.worker_health -> worker_failure.worker_down
failure_detection.network_monitor -> network_partition.partition_detected
failure_detection.target_probe -> target_system_down.target_down

worker_failure.redistribute -> recovery_coordination.coordinator
worker_failure.scale_cluster -> recovery_coordination.coordinator
network_partition.isolate_partition -> recovery_coordination.coordinator
target_system_down.continue_test -> recovery_coordination.coordinator

recovery_coordination.coordinator -> recovery_coordination.state_sync
recovery_coordination.state_sync -> recovery_coordination.metric_reconcile
recovery_coordination.metric_reconcile -> recovery_coordination.test_resume