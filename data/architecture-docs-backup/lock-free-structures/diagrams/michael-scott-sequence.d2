shape: sequence_diagram

thread1: Thread 1 {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

thread2: Thread 2 {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950" 
  style.font-color: "#e6edf3"
}

thread3: Thread 3 {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

queue: MS Queue {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

sentinel: Sentinel Node {
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

thread1 -> queue: enqueue(data1)
queue -> sentinel: CAS tail.next
thread1 -> queue: CAS tail pointer
thread2 -> queue: enqueue(data2)
queue -> sentinel: CAS tail.next (fails)
thread2 -> queue: help advance tail
thread2 -> queue: retry CAS tail.next
thread3 -> queue: dequeue()
queue -> sentinel: read head.next
thread3 -> queue: CAS head pointer
queue -> thread3: return data1
thread1 -> queue: CAS tail success
thread2 -> queue: CAS tail.next success
queue -> thread2: enqueue complete
thread3 -> queue: dequeue()
queue -> sentinel: read head.next
thread3 -> queue: CAS head pointer
queue -> thread3: return data2