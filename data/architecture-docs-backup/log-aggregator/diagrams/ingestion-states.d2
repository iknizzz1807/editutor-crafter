title: Ingestion Pipeline State Machine

# Initial state
init: {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
  label: ""
}

# Core states
receiving: Receiving {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

buffering: Buffering {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

parsing: Parsing {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

validating: Validating {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

storing: Storing {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# Error states
parse_error: Parse Error {
  shape: circle
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
}

validation_error: Validation Error {
  shape: circle
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
}

storage_error: Storage Error {
  shape: circle
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
}

# Retry states
retry_parsing: Retry Parse {
  shape: circle
  style.fill: "#fdcb6e"
  style.stroke: "#e84393"
  style.font-color: "#2d3436"
}

retry_storage: Retry Store {
  shape: circle
  style.fill: "#fdcb6e"
  style.stroke: "#e84393"
  style.font-color: "#2d3436"
}

# Final states
completed: Completed {
  shape: circle
  style.fill: "#00b894"
  style.stroke: "#3fb950"
  style.font-color: "#ffffff"
  style.double-border: true
}

dead_letter: Dead Letter {
  shape: circle
  style.fill: "#636e72"
  style.stroke: "#2d3436"
  style.font-color: "#ffffff"
  style.double-border: true
}

# State transitions
init -> receiving: Log Data Received

receiving -> buffering: Data Queued
receiving -> parse_error: Invalid Format

buffering -> parsing: Buffer Ready
buffering -> storage_error: Buffer Full

parsing -> validating: Parse Success
parsing -> parse_error: Parse Failed
parsing -> retry_parsing: Recoverable Error

validating -> storing: Valid Data
validating -> validation_error: Schema Mismatch
validating -> dead_letter: Invalid Schema

storing -> completed: Store Success
storing -> storage_error: Store Failed
storing -> retry_storage: Transient Error

# Error handling
parse_error -> retry_parsing: Retry Attempt
parse_error -> dead_letter: Max Retries

validation_error -> dead_letter: Permanent Failure

storage_error -> retry_storage: Retry Attempt
storage_error -> dead_letter: Max Retries

# Retry loops
retry_parsing -> parsing: Retry Parse
retry_parsing -> dead_letter: Max Retries Exceeded

retry_storage -> storing: Retry Store
retry_storage -> dead_letter: Max Retries Exceeded