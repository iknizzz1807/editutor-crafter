direction: right

title: Formatter Plugin Architecture {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

# Core formatting system
formatter_core: Formatter Core {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  registry: Formatter Registry {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  selector: Format Selector {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  invoker: Formatter Invoker {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

# Built-in formatters
builtin_formatters: Built-in Formatters {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  json_formatter: JSON Formatter {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  pretty_printer: Pretty Printer {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  text_formatter: Text Formatter {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

# Custom user formatters
custom_formatters: Custom Formatters {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  csv_formatter: CSV Formatter {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    style.stroke-dash: 3
  }
  
  xml_formatter: XML Formatter {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    style.stroke-dash: 3
  }
  
  syslog_formatter: Syslog Formatter {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    style.stroke-dash: 3
  }
}

# Logger core
logger_core: Logger Core {
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  log_record: LogRecord {
    shape: class
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    - "timestamp: DateTime"
    - "level: LogLevel"
    - "message: string"
    - "fields: HashMap<string, Value>"
    - "logger_name: string"
  }
}

# Output targets
output_targets: Output Targets {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  console: Console Output {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  file: File Output {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  network: Network Output {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

# Formatter interface
formatter_interface: FormatterTrait {
  shape: class
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  + "format(record: &LogRecord): String"
  + "name(): &str"
  + "supports_colors(): bool"
}

# Registration flow
custom_formatters.csv_formatter -> formatter_core.registry: register
custom_formatters.xml_formatter -> formatter_core.registry: register
custom_formatters.syslog_formatter -> formatter_core.registry: register
builtin_formatters.json_formatter -> formatter_core.registry: register
builtin_formatters.pretty_printer -> formatter_core.registry: register
builtin_formatters.text_formatter -> formatter_core.registry: register

# Selection and invocation flow
logger_core.log_record -> formatter_core.selector: LogRecord
formatter_core.selector -> formatter_core.registry: lookup formatter
formatter_core.registry -> formatter_core.invoker: selected formatter
formatter_core.invoker -> output_targets.console: formatted string
formatter_core.invoker -> output_targets.file: formatted string
formatter_core.invoker -> output_targets.network: formatted string

# Interface implementation
builtin_formatters.json_formatter -> formatter_interface: implements {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}
builtin_formatters.pretty_printer -> formatter_interface: implements {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}
custom_formatters.csv_formatter -> formatter_interface: implements {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

# Configuration note
config_note: |md
  **Configuration**
  - Format type selection
  - Formatter-specific options
  - Color support detection
  - Output target settings
| {
  shape: page
  near: top-left
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}