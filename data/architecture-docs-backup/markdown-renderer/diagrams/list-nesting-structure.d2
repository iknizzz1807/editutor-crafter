# List Nesting and Indentation Handling

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  data: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  arrow: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

start: Start Processing Line {
  shape: circle
  class: process
}

detect: Detect List Item Marker {
  class: process
}

is_list: Is Valid List Item? {
  shape: diamond
  class: decision
}

calc_indent: Calculate Indentation Level {
  class: process
}

compare: Compare with Current Nesting Level {
  shape: diamond
  class: decision
}

stack: Nesting Stack {
  shape: cylinder
  class: data
}

same_level: Same Level:\nAdd to Current List {
  class: process
}

deeper: Deeper Level:\nCreate Nested List {
  class: process
}

shallower: Shallower Level:\nPop Stack & Find Parent {
  class: process
}

push_stack: Push New List Context to Stack {
  class: process
}

pop_stack: Pop Stack Until Correct Level {
  class: process
}

create_item: Create List Item Node {
  class: process
}

add_item: Add Item to Parent List {
  class: process
}

next_line: Process Next Line {
  class: process
}

end: End of Input {
  shape: circle
  class: process
}

build_tree: Build Final List Tree {
  class: process
}

# Main flow
start -> detect: {class: arrow}
detect -> is_list: {class: arrow}
is_list -> calc_indent: Yes {class: arrow}
is_list -> next_line: No {class: arrow}

calc_indent -> compare: {class: arrow}
calc_indent -> stack: read current level {class: arrow}

compare -> same_level: Equal {class: arrow}
compare -> deeper: Greater {class: arrow}
compare -> shallower: Less {class: arrow}

same_level -> create_item: {class: arrow}
deeper -> push_stack: {class: arrow}
shallower -> pop_stack: {class: arrow}

push_stack -> create_item: {class: arrow}
pop_stack -> create_item: {class: arrow}

create_item -> add_item: {class: arrow}
add_item -> next_line: {class: arrow}

next_line -> detect: more lines {class: arrow}
next_line -> end: no more lines {class: arrow}

end -> build_tree: {class: arrow}

# Stack operations
push_stack -> stack: push new context {class: arrow}
pop_stack -> stack: pop contexts {class: arrow}
stack -> add_item: get parent list {class: arrow}