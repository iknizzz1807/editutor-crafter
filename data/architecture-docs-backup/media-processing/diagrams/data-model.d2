direction: right

title: Data Model Relationships {
  near: top-center
  style.font-size: 24
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  entity: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.stroke-width: 2
  }
  relationship: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    style.stroke-width: 2
  }
  primary_key: {
    style.font-color: "#ffd700"
    style.bold: true
  }
  foreign_key: {
    style.font-color: "#ff7b72"
  }
}

Job: {
  shape: sql_table
  class: entity
  id: int {constraint: primary_key}
  user_id: varchar
  job_type: varchar
  status: varchar
  priority: int
  created_at: timestamp
  updated_at: timestamp
  completed_at: timestamp
  retry_count: int
  max_retries: int
  error_message: text
}

Task: {
  shape: sql_table
  class: entity
  id: int {constraint: primary_key}
  job_id: int {constraint: foreign_key}
  task_name: varchar
  status: varchar
  sequence_order: int
  input_config: json
  output_result: json
  started_at: timestamp
  completed_at: timestamp
  error_details: text
}

MediaFile: {
  shape: sql_table
  class: entity
  id: int {constraint: primary_key}
  job_id: int {constraint: foreign_key}
  file_path: varchar
  original_filename: varchar
  file_type: varchar
  file_size: bigint
  mime_type: varchar
  checksum: varchar
  metadata: json
  created_at: timestamp
  is_temporary: boolean
}

ProcessingConfig: {
  shape: sql_table
  class: entity
  id: int {constraint: primary_key}
  job_id: int {constraint: foreign_key}
  config_type: varchar
  parameters: json
  validation_rules: json
  created_at: timestamp
  is_active: boolean
}

ProgressUpdate: {
  shape: sql_table
  class: entity
  id: int {constraint: primary_key}
  job_id: int {constraint: foreign_key}
  task_id: int {constraint: foreign_key}
  progress_percent: decimal
  current_step: varchar
  total_steps: int
  message: text
  timestamp: timestamp
  metadata: json
}

# Relationships
Job -> Task: "1:N" {
  class: relationship
  label: has many tasks
}

Job -> MediaFile: "1:N" {
  class: relationship
  label: processes files
}

Job -> ProcessingConfig: "1:1" {
  class: relationship
  label: uses config
}

Job -> ProgressUpdate: "1:N" {
  class: relationship
  label: tracks progress
}

Task -> ProgressUpdate: "1:N" {
  class: relationship
  label: reports progress
}

# Cardinality legend
legend: {
  near: bottom-right
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  legend_title: "Relationship Cardinalities" {
    style.font-size: 16
    style.bold: true
    style.font-color: "#e6edf3"
  }
  
  one_to_many: "1:N = One-to-Many" {
    style.font-color: "#e6edf3"
  }
  
  one_to_one: "1:1 = One-to-One" {
    style.font-color: "#e6edf3"
  }
}