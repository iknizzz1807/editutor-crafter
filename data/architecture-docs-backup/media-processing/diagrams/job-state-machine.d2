direction: right

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  initial: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#1a1a2e"
  }
  final: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
  }
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
  }
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

init: {
  shape: circle
  class: initial
  label: ""
}

pending: Pending {
  shape: circle
  class: state
}

processing: Processing {
  shape: circle
  class: state
}

completed: Completed {
  shape: circle
  class: final
}

failed: Failed {
  shape: circle
  class: error
}

retry_wait: "Retry Wait" {
  shape: circle
  class: state
}

dead_letter: "Dead Letter" {
  shape: circle
  class: error
}

init -> pending: "Job Submitted" {
  class: transition
}

pending -> processing: "Worker Available\n& Job Dequeued" {
  class: transition
}

processing -> completed: "Processing Success" {
  class: transition
}

processing -> failed: "Processing Error" {
  class: transition
}

failed -> retry_wait: "Retry Count < Max\n& Transient Error" {
  class: transition
}

failed -> dead_letter: "Max Retries Exceeded\n| Permanent Error" {
  class: transition
}

retry_wait -> pending: "Retry Delay Elapsed" {
  class: transition
}

processing -> processing: "Progress Update\n& Heartbeat" {
  class: transition
}

pending -> failed: "Queue Timeout\n| Validation Error" {
  class: transition
}

title: |md
  # Job Lifecycle State Machine
  **Media Processing Pipeline - Job Queue Component**
| {
  near: top-center
  style.font-color: "#e6edf3"
  style.fill: "transparent"
}

legend: |md
  **State Types:**
  • Green: Initial state
  • Blue: Active processing states  
  • Red: Error/failure states
  • Double border: Final states
  
  **Triggers:**
  • Job submission, worker availability
  • Success/failure conditions
  • Retry logic with exponential backoff
  • Timeout and validation checks
| {
  near: bottom-right
  shape: page
  style.font-color: "#e6edf3"
  style.fill: "#16213e"
  style.stroke: "#3fb950"
}