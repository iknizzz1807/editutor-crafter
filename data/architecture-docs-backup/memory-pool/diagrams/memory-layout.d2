title: Memory Layout and Block Organization

classes: {
  memory_chunk: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  free_block: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  used_block: {
    style.fill: "#2d3748"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  header: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  pointer: {
    style.stroke: "#3fb950"
    style.stroke-width: 2
  }
}

memory_pool: Memory Pool {
  class: header
  
  chunk_header: Chunk Header {
    class: header
    shape: rectangle
    label: |md
      **Chunk Metadata**
      Size: 4096 bytes
      Block Size: 64 bytes
      Total Blocks: 64
    |
  }
  
  memory_area: Memory Area {
    class: memory_chunk
    
    block0: Block 0 {
      class: free_block
      shape: rectangle
      label: |md
        **Free Block**
        next_ptr → Block 2
      |
    }
    
    block1: Block 1 {
      class: used_block
      shape: rectangle
      label: |md
        **Used Block**
        User Data
      |
    }
    
    block2: Block 2 {
      class: free_block
      shape: rectangle
      label: |md
        **Free Block**
        next_ptr → Block 5
      |
    }
    
    block3: Block 3 {
      class: used_block
      shape: rectangle
      label: |md
        **Used Block**
        User Data
      |
    }
    
    block4: Block 4 {
      class: used_block
      shape: rectangle
      label: |md
        **Used Block**
        User Data
      |
    }
    
    block5: Block 5 {
      class: free_block
      shape: rectangle
      label: |md
        **Free Block**
        next_ptr → NULL
      |
    }
  }
  
  free_list_head: Free List Head {
    class: header
    shape: circle
    label: "Head → Block 0"
  }
}

detail_view: Block Internal Structure {
  class: memory_chunk
  
  free_block_detail: Free Block Detail {
    class: free_block
    
    block_header_area: Block Header {
      class: header
      label: |md
        **Optional Metadata**
        Magic: 0xDEADBEEF
        Size: 64 bytes
      |
    }
    
    next_pointer_area: Next Pointer Storage {
      class: free_block
      label: |md
        **Pointer Aliasing**
        next_free: 0x1000A040
        (stored in user data area)
      |
    }
    
    unused_area: Unused Space {
      class: free_block
      label: |md
        **Available Space**
        Remaining bytes
        for user data
      |
    }
  }
  
  used_block_detail: Used Block Detail {
    class: used_block
    
    used_header: Block Header {
      class: header
      label: |md
        **Optional Metadata**
        Magic: 0xCAFEBABE
        Size: 64 bytes
      |
    }
    
    user_data_area: User Data {
      class: used_block
      label: |md
        **Application Data**
        User-controlled
        memory content
      |
    }
  }
}

memory_layout_note: |md
  ## Memory Organization
  
  **Chunks:** Fixed-size memory regions from OS
  **Blocks:** Fixed-size allocatable units within chunks
  **Free List:** Embedded linked list using unused blocks
  **Pointer Aliasing:** Next pointers stored in block data area
| {
  shape: page
  class: header
}

# Free list connections
free_list_head -> memory_area.block0: points to {class: pointer}
memory_area.block0 -> memory_area.block2: next_ptr {class: pointer}
memory_area.block2 -> memory_area.block5: next_ptr {class: pointer}

# Layout relationships
chunk_header -> memory_area: manages
detail_view.free_block_detail.next_pointer_area -> detail_view.free_block_detail.unused_area: overlays with