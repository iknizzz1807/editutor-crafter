direction: right

shape: sequence_diagram

classes: {
  actor: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  message: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

producer: Producer {
  class: actor
}

broker: Message Broker {
  class: actor
}

consumer1: Consumer 1 {
  class: actor
}

consumer2: Consumer 2 {
  class: actor
}

consumer3: Consumer 3 {
  class: actor
}

ack_tracker: Ack Tracker {
  class: actor
}

producer -> broker: publish(message_1) {
  class: message
}

broker -> consumer1: deliver(message_1) {
  class: message
}

broker -> ack_tracker: track(message_1, consumer1, timeout) {
  class: message
}

consumer1 -> broker: ack(message_1) {
  class: message
}

broker -> ack_tracker: mark_acked(message_1) {
  class: message
}

producer -> broker: publish(message_2) {
  class: message
}

broker -> consumer2: deliver(message_2) {
  class: message
}

broker -> ack_tracker: track(message_2, consumer2, timeout) {
  class: message
}

producer -> broker: publish(message_3) {
  class: message
}

broker -> consumer3: deliver(message_3) {
  class: message
}

broker -> ack_tracker: track(message_3, consumer3, timeout) {
  class: message
}

consumer2 -> broker: ack(message_2) {
  class: message
}

broker -> ack_tracker: mark_acked(message_2) {
  class: message
}

ack_tracker -> broker: timeout_expired(message_3) {
  class: message
}

broker -> consumer1: redeliver(message_3) {
  class: message
}

broker -> ack_tracker: track(message_3, consumer1, timeout) {
  class: message
}

consumer1 -> broker: ack(message_3) {
  class: message
}

broker -> ack_tracker: mark_acked(message_3) {
  class: message
}