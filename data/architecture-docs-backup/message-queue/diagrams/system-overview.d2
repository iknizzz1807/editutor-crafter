classes: {
  core_component: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  external: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  storage: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  data_flow: {
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  control_flow: {
    style.stroke: "#8b949e"
    style.stroke-dash: 3
    style.font-color: "#e6edf3"
  }
}

title: System Component Overview {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

# External Clients
producers: Producer Clients {
  class: external
  shape: rectangle
}

consumers: Consumer Clients {
  class: external
  shape: rectangle
}

# Core Message Queue System
message_queue: Message Queue System {
  class: core_component
  
  protocol_handler: Protocol Handler {
    class: core_component
  }
  
  topic_manager: Topic Manager {
    class: core_component
  }
  
  consumer_coordinator: Consumer Group Coordinator {
    class: core_component
  }
  
  ack_tracker: Acknowledgment Tracker {
    class: core_component
  }
  
  persistence: Persistence Layer {
    class: core_component
  }
}

# External Storage
disk_storage: Disk Storage {
  shape: cylinder
  class: storage
}

# Client to System Connections
producers -> message_queue.protocol_handler: publish messages {
  class: data_flow
}

consumers -> message_queue.protocol_handler: consume messages {
  class: data_flow
}

message_queue.protocol_handler -> consumers: deliver messages {
  class: data_flow
}

# Internal Component Connections
message_queue.protocol_handler -> message_queue.topic_manager: route messages {
  class: data_flow
}

message_queue.protocol_handler -> message_queue.consumer_coordinator: manage consumers {
  class: control_flow
}

message_queue.topic_manager -> message_queue.persistence: store messages {
  class: data_flow
}

message_queue.consumer_coordinator -> message_queue.topic_manager: assign messages {
  class: control_flow
}

message_queue.ack_tracker <-> message_queue.consumer_coordinator: track delivery {
  class: control_flow
}

message_queue.ack_tracker -> message_queue.persistence: persist acks {
  class: data_flow
}

# Storage Connections
message_queue.persistence -> disk_storage: write/read {
  class: data_flow
}

# Component descriptions
protocol_desc: |md
  **Protocol Handler**
  - TCP connection management
  - Binary protocol parsing
  - Client request routing
| {
  shape: page
  near: bottom-left
  style.fill: "#16213e"
  style.font-color: "#e6edf3"
}

topic_desc: |md
  **Topic Manager** 
  - Message queues by topic
  - Pub/sub fanout
  - Message routing
| {
  shape: page
  near: bottom-center
  style.fill: "#16213e"
  style.font-color: "#e6edf3"
}

coordinator_desc: |md
  **Consumer Group Coordinator**
  - Load balancing
  - Group membership
  - Message assignment
| {
  shape: page
  near: bottom-right
  style.fill: "#16213e"
  style.font-color: "#e6edf3"
}