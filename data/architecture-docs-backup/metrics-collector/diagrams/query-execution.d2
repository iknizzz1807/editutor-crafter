classes: {
  stage: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  process: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
  }
}

title: Query Execution Flow {
  style.font-size: 24
  style.font-color: "#e6edf3"
  style.bold: true
  near: top-center
}

query_input: PromQL Query Input {
  class: stage
}

parse: Parse Expression {
  class: stage
}

parse_valid: Valid Syntax? {
  shape: diamond
  class: decision
}

parse_error: Syntax Error {
  class: error
}

select_series: Select Time Series {
  class: stage
}

label_match: Apply Label Matchers {
  class: process
}

filter_range: Filter Time Range {
  class: process
}

series_found: Series Found? {
  shape: diamond
  class: decision
}

empty_result: Empty Result Set {
  class: process
}

aggregate: Apply Aggregations {
  class: stage
}

group_by: Group By Labels {
  class: process
}

apply_functions: Apply Functions {
  class: process
}

range_ops: Range Operations {
  class: stage
}

rate_calc: Rate/Increase Calc {
  class: process
}

window_agg: Window Aggregation {
  class: process
}

format: Format Results {
  class: stage
}

json_output: JSON Response {
  class: process
}

query_input -> parse
parse -> parse_valid
parse_valid -> parse_error: No
parse_valid -> select_series: Yes

select_series -> label_match
label_match -> filter_range
filter_range -> series_found

series_found -> empty_result: No
series_found -> aggregate: Yes

aggregate -> group_by
group_by -> apply_functions
apply_functions -> range_ops

range_ops -> rate_calc
rate_calc -> window_agg
window_agg -> format

format -> json_output

empty_result -> format