# Data Model Relationships

classes: {
  entity: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  relationship: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

Core Entities: {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  Metric: {
    shape: class
    class: entity
    - "id: string"
    - "name: string"
    - "metric_type: enum"
    - "description: string"
    - "unit: string"
    - "created_at: timestamp"
  }
  
  TimeSeries: {
    shape: class
    class: entity
    - "id: string"
    - "metric_id: string (FK)"
    - "labels_hash: string"
    - "retention_days: int"
    - "created_at: timestamp"
  }
  
  Sample: {
    shape: class
    class: entity
    - "id: string"
    - "timeseries_id: string (FK)"
    - "timestamp: timestamp"
    - "value: float64"
    - "ingested_at: timestamp"
  }
  
  Label: {
    shape: class
    class: entity
    - "id: string"
    - "timeseries_id: string (FK)"
    - "key: string"
    - "value: string"
    - "indexed: boolean"
  }
}

Application Layer: {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  AlertRule: {
    shape: class
    class: entity
    - "id: string"
    - "name: string"
    - "query: string"
    - "condition: string"
    - "threshold: float64"
    - "severity: enum"
    - "enabled: boolean"
    - "created_at: timestamp"
  }
  
  Dashboard: {
    shape: class
    class: entity
    - "id: string"
    - "title: string"
    - "description: string"
    - "layout: json"
    - "owner: string"
    - "public: boolean"
    - "created_at: timestamp"
  }
}

# Primary relationships
Core Entities.Metric -> Core Entities.TimeSeries: "1:N\nhas time series" {
  class: relationship
}

Core Entities.TimeSeries -> Core Entities.Sample: "1:N\ncontains samples" {
  class: relationship
}

Core Entities.TimeSeries -> Core Entities.Label: "1:N\nhas labels" {
  class: relationship
}

# Application relationships  
Application Layer.AlertRule -> Core Entities.Metric: "N:M\nmonitors metrics" {
  class: relationship
}

Application Layer.Dashboard -> Core Entities.TimeSeries: "N:M\nvisualizes series" {
  class: relationship
}

# Index note
index_note: |md
  **Key Relationships:**
  • Metrics define measurement types
  • TimeSeries group samples by label combinations
  • Labels enable filtering and grouping
  • AlertRules query metrics for threshold violations
  • Dashboards visualize time series data
| {
  shape: page
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: bottom-center
}