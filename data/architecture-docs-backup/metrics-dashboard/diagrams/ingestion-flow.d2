title: Metric Ingestion Data Flow {
  near: top-center
  style.font-size: 18
  style.bold: true
  style.font-color: "#e6edf3"
}

shape: sequence_diagram

client: Client Application
push_api: Push API
pull_scraper: Pull Scraper
validator: Validator
processor: Processor
series_manager: Series Manager
storage: Storage Engine

client -> push_api: POST /metrics (payload)
push_api -> validator: validate(metrics)
validator -> validator: check format
validator -> validator: check metric types
validator -> validator: check cardinality limits
validator -> push_api: validation result
push_api -> processor: process(validated_metrics)
processor -> processor: standardize counters
processor -> processor: process gauges
processor -> processor: bucket histograms
processor -> series_manager: get_series_id(name, labels)
series_manager -> processor: series_id
processor -> storage: store(series_id, value, timestamp)
storage -> processor: ack
processor -> push_api: success
push_api -> client: 200 OK

pull_scraper -> client: GET /metrics (scheduled)
client -> pull_scraper: metrics response
pull_scraper -> validator: validate(scraped_metrics)
validator -> validator: check format
validator -> validator: verify metric types
validator -> pull_scraper: validation result
pull_scraper -> processor: process(validated_metrics)
processor -> processor: standardize data
processor -> series_manager: get_series_id(name, labels)
series_manager -> processor: series_id
processor -> storage: store(series_id, value, timestamp)
storage -> processor: ack

classes: {
  actor_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  validation_style: {
    style.stroke: "#d63031"
    style.font-color: "#d63031"
  }
  processing_style: {
    style.stroke: "#fdcb6e"
    style.font-color: "#fdcb6e"
  }
  storage_style: {
    style.stroke: "#00b894"
    style.font-color: "#00b894"
  }
}

client.class: actor_style
push_api.class: actor_style
pull_scraper.class: actor_style
validator.class: validation_style
processor.class: processing_style
series_manager.class: processing_style
storage.class: storage_style