direction: down

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  storage: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  channel: {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

evaluation: Alert Evaluation {
  class: process
  shape: rectangle
}

metrics: Metric Query {
  class: process
  shape: rectangle
}

threshold_check: Threshold Check {
  class: decision
  shape: diamond
}

state_mgr: Alert State Manager {
  class: storage
  shape: rectangle
}

pending: Pending State {
  class: process
  shape: rectangle
}

firing: Firing State {
  class: process
  shape: rectangle
}

resolved: Resolved State {
  class: process
  shape: rectangle
}

notification_router: Notification Router {
  class: process
  shape: rectangle
}

channel_selector: Channel Selection {
  class: decision
  shape: diamond
}

pagerduty: PagerDuty {
  class: channel
  shape: rectangle
}

email: Email {
  class: channel
  shape: rectangle
}

slack: Slack {
  class: channel
  shape: rectangle
}

templating: Message Templating {
  class: process
  shape: rectangle
}

delivery: Message Delivery {
  class: process
  shape: rectangle
}

confirmation: Delivery Confirmation {
  class: storage
  shape: rectangle
}

metrics -> evaluation: metric data
evaluation -> threshold_check: evaluate conditions
threshold_check -> state_mgr: condition met {
  style.stroke: "#3fb950"
}
threshold_check -> evaluation: condition not met {
  style.stroke: "#8b949e"
}

state_mgr -> pending: new alert
pending -> firing: confirmation period passed
firing -> resolved: condition cleared
firing -> notification_router: trigger notification

notification_router -> channel_selector: select channels
channel_selector -> pagerduty: critical alerts {
  style.stroke: "#d63031"
}
channel_selector -> email: warnings {
  style.stroke: "#fdcb6e"
}
channel_selector -> slack: info alerts {
  style.stroke: "#74b9ff"
}

pagerduty -> templating: format message
email -> templating: format message
slack -> templating: format message

templating -> delivery: send notification
delivery -> confirmation: track delivery
confirmation -> state_mgr: update status