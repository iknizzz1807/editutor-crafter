title: Error Handling and Recovery Flow {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  error_node: {
    style.fill: "#d63031"
    style.font-color: "#ffffff"
    style.stroke: "#e17055"
    style.bold: true
  }
  recovery_node: {
    style.fill: "#00b894"
    style.font-color: "#ffffff"
    style.stroke: "#00a085"
    style.bold: true
  }
  decision_node: {
    style.fill: "#fdcb6e"
    style.font-color: "#2d3436"
    style.stroke: "#e17055"
    style.bold: true
  }
  fallback_node: {
    style.fill: "#6c5ce7"
    style.font-color: "#ffffff"
    style.stroke: "#a29bfe"
    style.bold: true
  }
  container_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

detection: Error Detection System {
  class: container_style
  
  request_validation: Request Validation {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  health_checks: Health Checks {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  monitoring: Performance Monitoring {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

triage: Error Classification {
  shape: diamond
  class: decision_node
}

classification: Error Categories {
  class: container_style
  
  transient: Transient Errors {
    class: error_node
  }
  
  permanent: Permanent Errors {
    class: error_node
  }
  
  resource: Resource Errors {
    class: error_node
  }
  
  model: Model Errors {
    class: error_node
  }
}

recovery_strategies: Recovery Strategies {
  class: container_style
  
  retry: Retry Logic {
    class: recovery_node
  }
  
  circuit_breaker: Circuit Breaker {
    class: recovery_node
  }
  
  load_balancing: Load Balancing {
    class: recovery_node
  }
  
  graceful_degradation: Graceful Degradation {
    class: recovery_node
  }
}

fallback_mechanisms: Fallback Mechanisms {
  class: container_style
  
  cached_response: Cached Response {
    class: fallback_node
  }
  
  default_model: Default Model {
    class: fallback_node
  }
  
  backup_service: Backup Service {
    class: fallback_node
  }
  
  error_response: Error Response {
    class: fallback_node
  }
}

logging: Logging & Alerting {
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

detection.request_validation -> triage: Invalid Request
detection.health_checks -> triage: Service Down
detection.monitoring -> triage: Performance Issue

triage -> classification.transient: Network Timeout
triage -> classification.permanent: Invalid Input
triage -> classification.resource: Memory/GPU Exhaustion
triage -> classification.model: Model Failure

classification.transient -> recovery_strategies.retry: Exponential Backoff
classification.transient -> recovery_strategies.circuit_breaker: Prevent Cascade

classification.permanent -> fallback_mechanisms.error_response: 4xx Response
classification.permanent -> logging: Log & Alert

classification.resource -> recovery_strategies.load_balancing: Redistribute Load
classification.resource -> recovery_strategies.graceful_degradation: Reduce Batch Size

classification.model -> fallback_mechanisms.default_model: Use Backup Model
classification.model -> fallback_mechanisms.cached_response: Return Cached Result

recovery_strategies.retry -> fallback_mechanisms.backup_service: Max Retries Exceeded
recovery_strategies.circuit_breaker -> fallback_mechanisms.cached_response: Circuit Open
recovery_strategies.load_balancing -> fallback_mechanisms.error_response: All Instances Down
recovery_strategies.graceful_degradation -> fallback_mechanisms.default_model: Simplified Processing

fallback_mechanisms.cached_response -> logging: Cache Hit/Miss
fallback_mechanisms.default_model -> logging: Fallback Used
fallback_mechanisms.backup_service -> logging: Service Switch
fallback_mechanisms.error_response -> logging: Error Details

success_path: Successful Recovery {
  class: recovery_node
  near: bottom-right
}

recovery_strategies.retry -> success_path: Retry Succeeded
recovery_strategies.circuit_breaker -> success_path: Circuit Closed
recovery_strategies.load_balancing -> success_path: Load Redistributed
fallback_mechanisms.default_model -> success_path: Fallback Completed