title: Model Deployment and Version Update Flow

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  storage: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  success: {
    style.fill: "#198754"
    style.stroke: "#3fb950"
    style.font-color: "#ffffff"
    style.bold: true
  }
  danger: {
    style.fill: "#dc3545"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
}

start: New Model Version {
  shape: circle
  class: process
}

validate: Model Validation {
  class: process
}

validation_check: Validation Passed? {
  shape: diamond
  class: decision
}

fix_model: Fix Model Issues {
  class: danger
}

staging: Deploy to Staging {
  class: process
}

staging_test: Staging Tests {
  class: process
}

staging_check: Staging Tests Passed? {
  shape: diamond
  class: decision
}

registry: Update Model Registry {
  shape: cylinder
  class: storage
}

canary: Canary Deployment {
  class: process
}

monitor: Monitor Metrics {
  class: process
}

health_check: Health Check Passed? {
  shape: diamond
  class: decision
}

rollback: Rollback to Previous {
  class: danger
}

traffic_split: Increase Traffic Split {
  class: process
}

traffic_check: 100% Traffic? {
  shape: diamond
  class: decision
}

full_deploy: Full Production Deploy {
  class: success
}

cleanup: Cleanup Old Versions {
  class: process
}

complete: Deployment Complete {
  shape: circle
  class: success
}

# Main flow
start -> validate
validate -> validation_check
validation_check -> fix_model: No
validation_check -> staging: Yes
fix_model -> validate: Retry
staging -> staging_test
staging_test -> staging_check
staging_check -> staging: No
staging_check -> registry: Yes
registry -> canary
canary -> monitor
monitor -> health_check
health_check -> rollback: No
health_check -> traffic_split: Yes
rollback -> complete: Notify Team
traffic_split -> traffic_check
traffic_check -> monitor: No
traffic_check -> full_deploy: Yes
full_deploy -> cleanup
cleanup -> complete

# Edge styling
start -> validate: {
  style.stroke: "#8b949e"
}
validate -> validation_check: {
  style.stroke: "#8b949e"
}
validation_check -> fix_model: {
  style.stroke: "#dc3545"
}
validation_check -> staging: {
  style.stroke: "#198754"
}
fix_model -> validate: {
  style.stroke: "#8b949e"
}
staging -> staging_test: {
  style.stroke: "#8b949e"
}
staging_test -> staging_check: {
  style.stroke: "#8b949e"
}
staging_check -> staging: {
  style.stroke: "#dc3545"
}
staging_check -> registry: {
  style.stroke: "#198754"
}
registry -> canary: {
  style.stroke: "#8b949e"
}
canary -> monitor: {
  style.stroke: "#8b949e"
}
monitor -> health_check: {
  style.stroke: "#8b949e"
}
health_check -> rollback: {
  style.stroke: "#dc3545"
}
health_check -> traffic_split: {
  style.stroke: "#198754"
}
rollback -> complete: {
  style.stroke: "#8b949e"
}
traffic_split -> traffic_check: {
  style.stroke: "#8b949e"
}
traffic_check -> monitor: {
  style.stroke: "#ffc107"
}
traffic_check -> full_deploy: {
  style.stroke: "#198754"
}
full_deploy -> cleanup: {
  style.stroke: "#8b949e"
}
cleanup -> complete: {
  style.stroke: "#8b949e"
}