title: Training Pipeline Execution {
  style.font-size: 24
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  container_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  step_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  decision_style: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  parallel_style: {
    style.fill: "#2d3748"
    style.stroke: "#f56565"
    style.font-color: "#e6edf3"
  }
  
  resource_style: {
    style.fill: "#553c9a"
    style.stroke: "#9f7aea"
    style.font-color: "#e6edf3"
  }
}

scheduler: Pipeline Scheduler {
  class: container_style
  
  dag_parser: DAG Parser {
    class: step_style
  }
  
  dep_resolver: Dependency Resolver {
    class: step_style
  }
  
  resource_mgr: Resource Manager {
    class: resource_style
  }
}

queue_system: Execution Queue {
  class: container_style
  
  ready_queue: Ready Queue {
    shape: queue
    class: step_style
  }
  
  running_queue: Running Queue {
    shape: queue
    class: step_style
  }
  
  failed_queue: Failed Queue {
    shape: queue
    class: decision_style
  }
}

execution_engine: Execution Engine {
  class: container_style
  
  step_executor: Step Executor {
    class: step_style
  }
  
  data_router: Data Router {
    class: step_style
  }
  
  failure_handler: Failure Handler {
    class: decision_style
  }
}

parallel_paths: Parallel Execution {
  class: container_style
  
  path_a: Training Path A {
    class: parallel_style
  }
  
  path_b: Training Path B {
    class: parallel_style
  }
  
  path_c: Feature Path C {
    class: parallel_style
  }
  
  barrier: Sync Barrier {
    shape: diamond
    class: decision_style
  }
}

resource_pool: Resource Pool {
  class: container_style
  
  cpu_pool: CPU Pool {
    shape: cylinder
    class: resource_style
  }
  
  gpu_pool: GPU Pool {
    shape: cylinder
    class: resource_style
  }
  
  memory_pool: Memory Pool {
    shape: cylinder
    class: resource_style
  }
}

data_store: Data Store {
  class: container_style
  
  input_data: Input Data {
    shape: cylinder
    class: step_style
  }
  
  intermediate: Intermediate Results {
    shape: cylinder
    class: step_style
  }
  
  artifacts: Model Artifacts {
    shape: cylinder
    class: step_style
  }
}

monitoring: Pipeline Monitor {
  class: container_style
  
  health_check: Health Checker {
    class: step_style
  }
  
  retry_logic: Retry Logic {
    class: decision_style
  }
}

# Main flow
scheduler.dag_parser -> scheduler.dep_resolver: dependencies
scheduler.dep_resolver -> queue_system.ready_queue: schedule steps
scheduler.resource_mgr -> resource_pool.cpu_pool: allocate
scheduler.resource_mgr -> resource_pool.gpu_pool: allocate GPU
scheduler.resource_mgr -> resource_pool.memory_pool: allocate RAM

queue_system.ready_queue -> execution_engine.step_executor: execute
execution_engine.step_executor -> queue_system.running_queue: update status

# Parallel execution
execution_engine.step_executor -> parallel_paths.path_a: spawn
execution_engine.step_executor -> parallel_paths.path_b: spawn
execution_engine.step_executor -> parallel_paths.path_c: spawn

parallel_paths.path_a -> parallel_paths.barrier: complete
parallel_paths.path_b -> parallel_paths.barrier: complete
parallel_paths.path_c -> parallel_paths.barrier: complete
parallel_paths.barrier -> execution_engine.data_router: sync

# Data flow
data_store.input_data -> execution_engine.data_router: raw data
execution_engine.data_router -> data_store.intermediate: processed
data_store.intermediate -> execution_engine.data_router: features
execution_engine.data_router -> data_store.artifacts: models

# Failure handling
execution_engine.step_executor -> execution_engine.failure_handler: on error
execution_engine.failure_handler -> queue_system.failed_queue: failed steps
monitoring.health_check -> execution_engine.failure_handler: detect failures
monitoring.retry_logic -> queue_system.ready_queue: retry
execution_engine.failure_handler -> monitoring.retry_logic: evaluate

# Resource management
resource_pool.cpu_pool -> execution_engine.step_executor: workers
resource_pool.gpu_pool -> parallel_paths.path_a: GPU access
resource_pool.memory_pool -> execution_engine.data_router: buffer space

# Monitoring
execution_engine.step_executor -> monitoring.health_check: status
queue_system.running_queue -> monitoring.health_check: metrics
parallel_paths.barrier -> monitoring.health_check: sync status