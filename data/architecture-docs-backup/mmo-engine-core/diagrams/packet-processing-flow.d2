title: Network Packet Processing Pipeline {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  success: {
    style.fill: "#00b894"
    style.stroke: "#00a085"
    style.font-color: "#ffffff"
    style.bold: true
  }
}

start: Start {
  shape: circle
  class: success
}

receive: Receive UDP Packet {
  class: process
}

decompress: Decompress Packet Data {
  class: process
}

validate: Validate Packet {
  shape: diamond
  class: decision
}

rollback_check: Check Rollback Required {
  shape: diamond
  class: decision
}

apply_rollback: Apply Rollback {
  class: process
}

update_state: Update Game State {
  class: process
}

send_ack: Send Acknowledgment {
  class: process
}

broadcast: Broadcast State Changes {
  class: process
}

drop_packet: Drop Invalid Packet {
  class: error
}

log_error: Log Error {
  class: error
}

complete: Complete {
  shape: circle
  class: success
}

start -> receive: Network layer

receive -> decompress: Raw packet data

decompress -> validate: Decompressed data

validate -> rollback_check: Valid
validate -> drop_packet: Invalid

rollback_check -> apply_rollback: Yes
rollback_check -> update_state: No

apply_rollback -> update_state: State reverted

update_state -> send_ack: State updated

send_ack -> broadcast: ACK sent

broadcast -> complete: Changes propagated

drop_packet -> log_error: Invalid packet
log_error -> complete: Error logged

start.style.fill: "#3fb950"
start.label: ""

complete.style.fill: "#3fb950"
complete.label: ""