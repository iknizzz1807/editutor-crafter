shape: sequence_diagram

client: Client
middleware: Tenant Middleware
resolver: Tenant Resolver
context: Request Context
database: Database
rls: RLS Engine
response: Response Handler

client -> middleware: HTTP Request\n(subdomain/header)
middleware -> resolver: Extract tenant info
resolver -> resolver: Parse subdomain/\nvalidate header
resolver -> middleware: tenant_id
middleware -> context: Inject tenant context
context -> context: Store in request scope
middleware -> database: Query with context
database -> rls: Evaluate RLS policies
rls -> rls: Apply tenant filters\n(WHERE tenant_id = ?)
rls -> database: Filtered results
database -> response: Tenant-scoped data
response -> client: JSON Response

client.style.fill: "#16213e"
client.style.stroke: "#3fb950"
client.style.font-color: "#e6edf3"

middleware.style.fill: "#1a1a2e"
middleware.style.stroke: "#3fb950"
middleware.style.font-color: "#e6edf3"

resolver.style.fill: "#1a1a2e"
resolver.style.stroke: "#3fb950"
resolver.style.font-color: "#e6edf3"

context.style.fill: "#0f3460"
context.style.stroke: "#3fb950"
context.style.font-color: "#e6edf3"
context.style.bold: true

database.style.fill: "#1a1a2e"
database.style.stroke: "#3fb950"
database.style.font-color: "#e6edf3"

rls.style.fill: "#0f3460"
rls.style.stroke: "#3fb950"
rls.style.font-color: "#e6edf3"
rls.style.bold: true

response.style.fill: "#1a1a2e"
response.style.stroke: "#3fb950"
response.style.font-color: "#e6edf3"