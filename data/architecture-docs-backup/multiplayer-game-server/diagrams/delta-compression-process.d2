vars: {
  d2-config: {
    theme-id: 200
  }
}

title: State Delta Compression and Priority System

start: Start {
  shape: circle
  style.fill: "#3fb950"
}

baseline: Track Baseline State {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

current: Current World State {
  shape: rectangle  
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

calculate: Calculate State Delta {
  shape: rectangle
  style.fill: "#1a1a2e"  
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

interest: Interest Management Filter {
  shape: diamond
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

priority: Priority Scoring System {
  shape: rectangle
  style.fill: "#0f3460"
  style.stroke: "#3fb950" 
  style.font-color: "#e6edf3"
  style.bold: true
}

bandwidth: Bandwidth Allocation {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

compress: Delta Compression {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

packet: Construct Update Packet {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

transmit: Transmit to Client {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

discard: Discard Update {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#8b949e"
}

factors: Priority Factors {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

factors: |md
  **Priority Factors:**
  • Distance to client
  • Entity velocity
  • Recent changes
  • Player interactions
  • Visibility culling
|

start -> baseline: {style.stroke: "#8b949e"}
baseline -> current: {style.stroke: "#8b949e"}
current -> calculate: {style.stroke: "#8b949e"}
calculate -> interest: Delta Changes {style.stroke: "#8b949e"}

interest -> priority: Relevant to Client {style.stroke: "#3fb950"}
interest -> discard: Outside Interest {style.stroke: "#8b949e"}

priority -> bandwidth: Scored Updates {style.stroke: "#8b949e"}
bandwidth -> compress: Within Budget {style.stroke: "#8b949e"}
compress -> packet: Compressed Delta {style.stroke: "#8b949e"}
packet -> transmit: Binary Packet {style.stroke: "#8b949e"}

factors -> priority: {style.stroke: "#3fb950"; style.stroke-dash: 5}

transmit -> baseline: Update Baseline {style.stroke: "#8b949e"}