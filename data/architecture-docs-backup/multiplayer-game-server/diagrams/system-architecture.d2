# System Component Architecture
direction: right

clients: Game Clients {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  client1: Client 1
  client2: Client 2
  client3: Client N
}

server: Game Server {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  game_loop: Game Loop {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
  }
  
  prediction: Prediction Engine {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
  }
  
  lag_comp: Lag Compensation {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
  }
  
  state_sync: State Synchronizer {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
  }
  
  anti_cheat: Anti-Cheat System {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
  }
  
  auth_state: Authoritative State {
    shape: cylinder
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
  }
}

network: Network Layer {
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  
  tcp: TCP Connection
  udp: UDP Messages
}

# Client to Network
clients.client1 -> network.tcp: player input
clients.client2 -> network.tcp: player input
clients.client3 -> network.tcp: player input

clients.client1 <- network.udp: state updates
clients.client2 <- network.udp: state updates
clients.client3 <- network.udp: state updates

# Network to Server
network.tcp -> server.game_loop: validated input
network.udp <- server.state_sync: broadcast updates

# Internal Server Flow
server.game_loop -> server.auth_state: update state
server.game_loop -> server.prediction: client actions
server.prediction -> server.lag_comp: predicted state
server.lag_comp -> server.auth_state: validated actions
server.auth_state -> server.state_sync: current state
server.state_sync -> server.anti_cheat: state deltas
server.anti_cheat -> server.game_loop: cheat detection

# Data flow labels
server.game_loop.style.stroke: "#3fb950"
server.game_loop.style.bold: true
server.auth_state.style.stroke: "#3fb950"
server.auth_state.style.bold: true