classes: {
  value_node: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  operation: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  gradient: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.italic: true
  }
}

title: "Computational Graph Example: (a + b) * c" {
  style.font-size: 20
  style.font-color: "#e6edf3"
  near: top-center
}

forward_pass: Forward Pass {
  class: operation
  
  a: "Value(2.0)" {
    class: value_node
  }
  
  b: "Value(3.0)" {
    class: value_node
  }
  
  c: "Value(4.0)" {
    class: value_node
  }
  
  add_op: "ADD\n(a + b)" {
    shape: diamond
    class: operation
  }
  
  sum_result: "Value(5.0)" {
    class: value_node
  }
  
  mul_op: "MUL\n(sum * c)" {
    shape: diamond
    class: operation
  }
  
  final_result: "Value(20.0)" {
    class: value_node
  }
  
  a -> add_op: ""
  b -> add_op: ""
  add_op -> sum_result: ""
  sum_result -> mul_op: ""
  c -> mul_op: ""
  mul_op -> final_result: ""
}

backward_pass: Backward Pass {
  class: gradient
  
  final_grad: "grad = 1.0" {
    class: gradient
  }
  
  mul_back: "∂L/∂inputs" {
    shape: diamond
    class: gradient
  }
  
  sum_grad: "grad = 4.0\n(1.0 * c)" {
    class: gradient
  }
  
  c_grad: "grad = 5.0\n(1.0 * sum)" {
    class: gradient
  }
  
  add_back: "∂L/∂inputs" {
    shape: diamond
    class: gradient
  }
  
  a_grad: "grad = 4.0\n(4.0 * 1)" {
    class: gradient
  }
  
  b_grad: "grad = 4.0\n(4.0 * 1)" {
    class: gradient
  }
  
  final_grad -> mul_back: ""
  mul_back -> sum_grad: ""
  mul_back -> c_grad: ""
  sum_grad -> add_back: ""
  add_back -> a_grad: ""
  add_back -> b_grad: ""
}

computation_graph: Computation Graph Structure {
  class: operation
  
  node_a: "a: Value\ndata=2.0\ngrad=4.0\n_children=()" {
    shape: rectangle
    class: value_node
  }
  
  node_b: "b: Value\ndata=3.0\ngrad=4.0\n_children=()" {
    shape: rectangle
    class: value_node
  }
  
  node_c: "c: Value\ndata=4.0\ngrad=5.0\n_children=()" {
    shape: rectangle
    class: value_node
  }
  
  node_sum: "sum: Value\ndata=5.0\ngrad=4.0\n_children=(a,b)\n_op='+'" {
    shape: rectangle
    class: value_node
  }
  
  node_result: "result: Value\ndata=20.0\ngrad=1.0\n_children=(sum,c)\n_op='*'" {
    shape: rectangle
    class: value_node
  }
  
  node_a -> node_sum: "child"
  node_b -> node_sum: "child"
  node_sum -> node_result: "child"
  node_c -> node_result: "child"
}

legend: Legend {
  class: operation
  near: bottom-right
  
  forward_legend: "Forward: compute values" {
    class: value_node
  }
  
  backward_legend: "Backward: compute gradients" {
    class: gradient
  }
  
  graph_legend: "Graph: parent-child relationships" {
    class: operation
  }
}