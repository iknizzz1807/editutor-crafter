# Training Loop State Machine

# Initial state
init: {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
  label: ""
}

# Training states
forward_pass: Forward Pass {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

loss_computation: Loss Computation {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

gradient_zero: Gradient Zeroing {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

backward_pass: Backward Pass {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

parameter_update: Parameter Update {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

convergence_check: Convergence Check {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# Final state
converged: {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.double-border: true
  style.font-color: "#e6edf3"
  label: "Converged"
}

# State transitions
init -> forward_pass: start training
forward_pass -> loss_computation: compute predictions
loss_computation -> gradient_zero: calculate error
gradient_zero -> backward_pass: clear gradients
backward_pass -> parameter_update: compute gradients
parameter_update -> convergence_check: update weights
convergence_check -> forward_pass: continue (not converged)
convergence_check -> converged: stop (converged)

# Style transitions
init -> forward_pass: {
  style.stroke: "#8b949e"
  style.font-color: "#8b949e"
}

forward_pass -> loss_computation: {
  style.stroke: "#8b949e"
  style.font-color: "#8b949e"
}

loss_computation -> gradient_zero: {
  style.stroke: "#8b949e"
  style.font-color: "#8b949e"
}

gradient_zero -> backward_pass: {
  style.stroke: "#8b949e"
  style.font-color: "#8b949e"
}

backward_pass -> parameter_update: {
  style.stroke: "#8b949e"
  style.font-color: "#8b949e"
}

parameter_update -> convergence_check: {
  style.stroke: "#8b949e"
  style.font-color: "#8b949e"
}

convergence_check -> forward_pass: {
  style.stroke: "#8b949e"
  style.font-color: "#8b949e"
}

convergence_check -> converged: {
  style.stroke: "#3fb950"
  style.font-color: "#3fb950"
  style.bold: true
}