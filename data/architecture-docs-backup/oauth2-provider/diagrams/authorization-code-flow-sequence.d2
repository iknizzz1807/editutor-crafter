title: Authorization Code Grant Flow with PKCE
shape: sequence_diagram

user: User (Browser)
client: Client Application
auth_server: Authorization Server
resource_server: Resource Server

user -> client: 1. Initiate login
client -> client: 2. Generate code_verifier\nand code_challenge
client -> user: 3. Redirect to authorization endpoint\nwith client_id, redirect_uri,\ncode_challenge, code_challenge_method
user -> auth_server: 4. Authorization request\nwith PKCE parameters
auth_server -> user: 5. Display consent screen
user -> auth_server: 6. User grants permission
auth_server -> user: 7. Redirect to client with\nauthorization code
user -> client: 8. Authorization code received\nat redirect_uri
client -> auth_server: 9. Exchange code for tokens\nPOST /token with code,\ncode_verifier, client_id
auth_server -> auth_server: 10. Verify code_verifier\nagainst code_challenge
auth_server -> client: 11. Return access_token,\nrefresh_token, id_token
client -> resource_server: 12. API request with\nBearer access_token
resource_server -> resource_server: 13. Validate JWT token
resource_server -> client: 14. Protected resource data
client -> user: 15. Display user data

user.style.fill: "#1a1a2e"
user.style.stroke: "#3fb950"
user.style.font-color: "#e6edf3"

client.style.fill: "#16213e"
client.style.stroke: "#3fb950"
client.style.font-color: "#e6edf3"

auth_server.style.fill: "#0f3460"
auth_server.style.stroke: "#3fb950"
auth_server.style.font-color: "#e6edf3"
auth_server.style.bold: true

resource_server.style.fill: "#16213e"
resource_server.style.stroke: "#3fb950"
resource_server.style.font-color: "#e6edf3"