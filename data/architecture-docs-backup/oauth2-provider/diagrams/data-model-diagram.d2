classes: {
  entity: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  relationship: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

title: Data Model Relationships {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

oauth_client: OAuth Client {
  shape: class
  class: entity
  - id: "string (PK)"
  - client_id: "string (unique)"
  - client_secret: "string (hashed)"
  - name: string
  - redirect_uris: "string[]"
  - grant_types: "string[]"
  - response_types: "string[]"
  - scopes: "string[]"
  - created_at: timestamp
  - updated_at: timestamp
}

user: User {
  shape: class
  class: entity
  - id: "string (PK)"
  - email: "string (unique)"
  - password_hash: string
  - first_name: string
  - last_name: string
  - email_verified: boolean
  - created_at: timestamp
  - updated_at: timestamp
}

auth_code: Authorization Code {
  shape: class
  class: entity
  - id: "string (PK)"
  - code: "string (unique)"
  - client_id: "string (FK)"
  - user_id: "string (FK)"
  - redirect_uri: string
  - scopes: "string[]"
  - code_challenge: string
  - code_challenge_method: string
  - expires_at: timestamp
  - used: boolean
  - created_at: timestamp
}

access_token: Access Token {
  shape: class
  class: entity
  - id: "string (PK)"
  - token: "string (unique)"
  - client_id: "string (FK)"
  - user_id: "string (FK)"
  - scopes: "string[]"
  - token_type: string
  - expires_at: timestamp
  - revoked: boolean
  - created_at: timestamp
}

refresh_token: Refresh Token {
  shape: class
  class: entity
  - id: "string (PK)"
  - token: "string (unique)"
  - access_token_id: "string (FK)"
  - client_id: "string (FK)"
  - user_id: "string (FK)"
  - scopes: "string[]"
  - expires_at: timestamp
  - revoked: boolean
  - created_at: timestamp
}

consent_record: Consent Record {
  shape: class
  class: entity
  - id: "string (PK)"
  - client_id: "string (FK)"
  - user_id: "string (FK)"
  - scopes: "string[]"
  - granted: boolean
  - expires_at: timestamp
  - created_at: timestamp
  - updated_at: timestamp
}

oauth_client -> auth_code: generates {
  class: relationship
}

user -> auth_code: authorizes {
  class: relationship
}

auth_code -> access_token: exchanges for {
  class: relationship
}

oauth_client -> access_token: owns {
  class: relationship
}

user -> access_token: grants to client {
  class: relationship
}

access_token -> refresh_token: paired with {
  class: relationship
}

oauth_client -> refresh_token: can refresh {
  class: relationship
}

user -> refresh_token: long-term access {
  class: relationship
}

oauth_client -> consent_record: requests consent {
  class: relationship
}

user -> consent_record: grants/denies {
  class: relationship
}