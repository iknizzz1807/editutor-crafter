title: Packet Sniffer System Architecture

classes: {
  container_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  engine_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  data_style: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

network_interface: Network Interface {
  shape: cloud
  class: data_style
}

capture_system: Packet Capture System {
  class: container_style
  
  capture_engine: Capture Engine {
    class: engine_style
    raw_socket: Raw Socket Handler
    libpcap: LibPCAP Interface
    buffer: Packet Buffer {
      shape: cylinder
      class: data_style
    }
  }
  
  capture_engine.raw_socket -> capture_engine.buffer: store packets
  capture_engine.libpcap -> capture_engine.buffer: store packets
}

parsing_pipeline: Parsing Pipeline {
  class: container_style
  
  protocol_parsers: Protocol Parsers {
    class: engine_style
    ethernet: Ethernet Parser
    ip: IP Parser
    tcp_udp: TCP/UDP Parser
    application: Application Parser
  }
  
  protocol_parsers.ethernet -> protocol_parsers.ip: parsed frame
  protocol_parsers.ip -> protocol_parsers.tcp_udp: parsed packet
  protocol_parsers.tcp_udp -> protocol_parsers.application: parsed segment
}

filter_system: Filter System {
  class: container_style
  
  filter_engine: Filter Engine {
    class: engine_style
    bpf: BPF Compiler
    rules: Filter Rules {
      shape: page
      class: data_style
    }
    matcher: Pattern Matcher
  }
  
  filter_engine.bpf -> filter_engine.matcher: compiled filters
  filter_engine.rules -> filter_engine.bpf: filter expressions
}

output_system: Output System {
  class: container_style
  
  output_formatter: Output Formatter {
    class: engine_style
    pcap_writer: PCAP Writer
    text_formatter: Text Formatter
    json_formatter: JSON Formatter
  }
  
  analysis_output: Analysis Output {
    shape: page
    class: data_style
  }
}

network_interface -> capture_system.capture_engine: raw packets
capture_system.capture_engine.buffer -> parsing_pipeline.protocol_parsers: buffered packets
parsing_pipeline.protocol_parsers -> filter_system.filter_engine: parsed packets
filter_system.filter_engine -> output_system.output_formatter: filtered packets
output_system.output_formatter -> output_system.analysis_output: formatted data