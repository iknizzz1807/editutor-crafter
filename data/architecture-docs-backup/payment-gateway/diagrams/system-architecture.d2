direction: right

title: Payment Gateway System Architecture {
  style.font-size: 24
  style.font-color: "#e6edf3"
  style.bold: true
  near: top-center
}

classes: {
  container_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  service_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  database_style: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  external_style: {
    style.fill: "#2d1b69"
    style.stroke: "#fd79a8"
    style.font-color: "#e6edf3"
  }
}

gateway_core: Payment Gateway Core {
  class: container_style
  
  intent_manager: Payment Intent Manager {
    class: service_style
    shape: rectangle
  }
  
  processing_engine: Processing Engine {
    class: service_style
    shape: rectangle
  }
  
  webhook_handler: Webhook Handler {
    class: service_style
    shape: rectangle
  }
  
  intent_manager -> processing_engine: create payment
  processing_engine -> webhook_handler: async status
  webhook_handler -> intent_manager: reconcile state
}

data_layer: Data Layer {
  class: container_style
  
  payments_db: Payments Database {
    shape: cylinder
    class: database_style
  }
  
  transaction_log: Transaction Log {
    shape: cylinder
    class: database_style
  }
  
  idempotency_store: Idempotency Store {
    shape: cylinder
    class: database_style
  }
}

external_providers: External Payment Providers {
  class: container_style
  
  stripe: Stripe API {
    class: external_style
    shape: cloud
  }
  
  paypal: PayPal API {
    class: external_style
    shape: cloud
  }
  
  square: Square API {
    class: external_style
    shape: cloud
  }
}

client_systems: Client Systems {
  class: container_style
  
  web_app: Web Application {
    class: service_style
    shape: rectangle
  }
  
  mobile_app: Mobile App {
    class: service_style
    shape: rectangle
  }
  
  api_clients: API Clients {
    class: service_style
    shape: rectangle
  }
}

# Client connections
client_systems.web_app -> gateway_core.intent_manager: initiate payment
client_systems.mobile_app -> gateway_core.intent_manager: process transaction
client_systems.api_clients -> gateway_core.intent_manager: refund request

# Core to data layer connections
gateway_core.intent_manager -> data_layer.payments_db: store payment intent
gateway_core.intent_manager -> data_layer.idempotency_store: check duplicate
gateway_core.processing_engine -> data_layer.transaction_log: audit trail
gateway_core.webhook_handler -> data_layer.payments_db: update status

# External provider connections
gateway_core.processing_engine -> external_providers.stripe: charge card
gateway_core.processing_engine -> external_providers.paypal: process payment
gateway_core.processing_engine -> external_providers.square: submit transaction

# Webhook connections
external_providers.stripe -> gateway_core.webhook_handler: payment completed
external_providers.paypal -> gateway_core.webhook_handler: status update
external_providers.square -> gateway_core.webhook_handler: event notification

# Response flows
gateway_core.intent_manager -> client_systems.web_app: payment result
gateway_core.intent_manager -> client_systems.mobile_app: transaction status
gateway_core.intent_manager -> client_systems.api_clients: refund confirmation