classes: {
  core_data: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  aggregated_data: {
    style.fill: "#16213e"
    style.stroke: "#e17055"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  connection: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

raw_data: Raw Sample Data {
  class: core_data
  
  sample: Sample {
    shape: rectangle
    class: core_data
    label: |md
      **Sample**
      
      - timestamp: u64
      - thread_id: u32
      - process_id: u32
      - "stack_frames: Vec<StackFrame>"
      - sample_type: SampleType
      
      + "capture_stack(): Result<Sample>"
      + "get_root_frame(): StackFrame"
    |
  }
  
  stack_frame: StackFrame {
    shape: rectangle
    class: core_data
    label: |md
      **StackFrame**
      
      - instruction_pointer: u64
      - "function_name: Option<String>"
      - "file_path: Option<String>"
      - "line_number: Option<u32>"
      - "symbol_id: Option<SymbolId>"
      
      + "resolve_symbol(): Option<Symbol>"
      + "format_location(): String"
    |
  }
  
  allocation: Allocation {
    shape: rectangle
    class: core_data
    label: |md
      **Allocation**
      
      - address: u64
      - size: usize
      - timestamp: u64
      - allocation_type: AllocType
      - "stack_trace: Vec<StackFrame>"
      
      + "calculate_lifetime(): Duration"
      + "get_call_site(): StackFrame"
    |
  }
}

symbol_resolution: Symbol Resolution {
  class: core_data
  
  symbol: Symbol {
    shape: rectangle
    class: core_data
    label: |md
      **Symbol**
      
      - "address_range: (u64, u64)"
      - "name: String"
      - "file_path: String"
      - "line_info: Vec<LineInfo>"
      - symbol_type: SymbolType
      
      + "contains_address(addr: u64): bool"
      + "get_line_number(addr: u64): Option<u32>"
    |
  }
  
  symbol_table: SymbolTable {
    shape: rectangle
    class: core_data
    label: |md
      **SymbolTable**
      
      - "symbols: HashMap<u64, Symbol>"
      - "binary_path: String"
      - load_address: u64
      
      + "resolve(addr: u64): Option<Symbol>"
      + "load_from_binary(): Result<()>"
    |
  }
}

aggregated_data: Aggregated Data {
  class: aggregated_data
  
  flame_node: FlameGraphNode {
    shape: rectangle
    class: aggregated_data
    label: |md
      **FlameGraphNode**
      
      - "function_name: String"
      - "file_location: String"
      - sample_count: u64
      - exclusive_time: Duration
      - inclusive_time: Duration
      - "children: Vec<FlameGraphNode>"
      
      + "add_sample(stack: &Vec<StackFrame>)"
      + "calculate_percentages(total: u64)"
    |
  }
  
  call_graph: CallGraph {
    shape: rectangle
    class: aggregated_data
    label: |md
      **CallGraph**
      
      - "nodes: HashMap<String, CallGraphNode>"
      - "edges: Vec<CallEdge>"
      - total_samples: u64
      
      + "build_from_samples(samples: &[Sample])"
      + "find_hot_paths(): Vec<Vec<String>>"
    |
  }
  
  memory_profile: MemoryProfile {
    shape: rectangle
    class: aggregated_data
    label: |md
      **MemoryProfile**
      
      - "allocations: Vec<Allocation>"
      - peak_usage: usize
      - total_allocated: usize
      - "leak_candidates: Vec<Allocation>"
      
      + "analyze_patterns(): MemoryReport"
      + "detect_leaks(): Vec<Allocation>"
    |
  }
}

raw_data.sample -> raw_data.stack_frame: contains {
  class: connection
}

raw_data.stack_frame -> symbol_resolution.symbol: resolves_to {
  class: connection
}

symbol_resolution.symbol_table -> symbol_resolution.symbol: manages {
  class: connection
}

raw_data.allocation -> raw_data.stack_frame: has_stack_trace {
  class: connection
}

raw_data.sample -> aggregated_data.flame_node: aggregates_into {
  class: connection
  style.stroke-dash: 3
}

raw_data.sample -> aggregated_data.call_graph: builds {
  class: connection
  style.stroke-dash: 3
}

raw_data.allocation -> aggregated_data.memory_profile: contributes_to {
  class: connection
  style.stroke-dash: 3
}

aggregated_data.flame_node -> aggregated_data.flame_node: parent_child {
  class: connection
}

processing_flow: |md
  **Data Processing Pipeline:**
  
  1. Raw samples captured with stack traces
  2. Stack frames resolved using symbol table  
  3. Samples aggregated into flame graph nodes
  4. Memory allocations tracked separately
  5. Call graphs built for analysis
| {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#e17055"
  style.font-color: "#e6edf3"
}