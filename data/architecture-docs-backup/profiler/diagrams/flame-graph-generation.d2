title: Flame Graph Generation Pipeline

classes: {
  input: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  process: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  output: {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

raw_samples: Raw Stack Samples {
  class: input
}

stack_aggregation: Stack Aggregation {
  shape: rectangle
  class: process
}

folding_engine: Folding Algorithm Engine {
  shape: rectangle
  class: process
}

coordinate_calc: SVG Coordinate Calculation {
  shape: rectangle
  class: process
}

interactive_features: Interactive Feature Addition {
  shape: rectangle
  class: process
}

flame_graph: Final Flame Graph SVG {
  class: output
}

aggregation_details: Stack Aggregation {
  dedup: Remove Duplicate Stacks
  merge: Merge Similar Call Paths
  count: Calculate Sample Counts
  
  dedup -> merge: clean stacks
  merge -> count: unified paths
}

folding_details: Folding Algorithm {
  hierarchy: Build Call Hierarchy
  width_calc: Calculate Frame Widths
  depth_assign: Assign Y Coordinates
  
  hierarchy -> width_calc: tree structure
  width_calc -> depth_assign: proportional widths
}

coordinate_details: Coordinate Calculation {
  svg_bounds: Calculate SVG Bounds
  frame_pos: Position Frame Rectangles
  text_layout: Layout Function Names
  
  svg_bounds -> frame_pos: canvas size
  frame_pos -> text_layout: frame positions
}

interactive_details: Interactive Features {
  hover_zones: Add Hover Zones
  zoom_pan: Add Zoom/Pan Logic
  search_index: Build Search Index
  tooltips: Generate Tooltips
  
  hover_zones -> tooltips: hover events
  zoom_pan -> search_index: navigation
}

sufficient_data: Sufficient Sample Data? {
  shape: diamond
  class: decision
}

raw_samples -> stack_aggregation: profiling data
stack_aggregation -> sufficient_data: aggregated samples

sufficient_data -> folding_engine: Yes
sufficient_data -> stack_aggregation: No - collect more {
  style.stroke: "#e17055"
}

folding_engine -> coordinate_calc: folded hierarchy
coordinate_calc -> interactive_features: positioned elements
interactive_features -> flame_graph: complete SVG

stack_aggregation <-> aggregation_details: {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

folding_engine <-> folding_details: {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

coordinate_calc <-> coordinate_details: {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

interactive_features <-> interactive_details: {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}