shape: sequence_diagram

classes: {
  actor: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  system: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  storage: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

application: Application {
  class: actor
}

malloc_interceptor: "Malloc Interceptor" {
  class: system
}

stack_tracer: "Stack Tracer" {
  class: system
}

metadata_store: "Metadata Store" {
  class: storage
}

leak_detector: "Leak Detector" {
  class: system
}

application -> malloc_interceptor: "malloc(size)"
malloc_interceptor -> stack_tracer: "capture_stack_trace()"
stack_tracer -> stack_tracer: "walk_stack_frames()"
stack_tracer -> malloc_interceptor: "stack_trace[]"
malloc_interceptor -> metadata_store: "store_allocation(ptr, size, stack)"
metadata_store -> metadata_store: "create_allocation_record()"
malloc_interceptor -> application: "return ptr"

application -> malloc_interceptor: "free(ptr)"
malloc_interceptor -> metadata_store: "mark_freed(ptr)"
metadata_store -> metadata_store: "update_allocation_status()"
malloc_interceptor -> application: return

leak_detector -> metadata_store: "scan_allocations()"
metadata_store -> leak_detector: "unfree_allocations[]"
leak_detector -> leak_detector: "analyze_leak_patterns()"
leak_detector -> application: "report_memory_leaks()"