title: Profiler State Machine

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  error_state: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  error_transition: {
    style.stroke: "#d63031"
    style.font-color: "#d63031"
  }
}

init: {
  shape: circle
  style.fill: "#3fb950"
  label: ""
}

idle: Idle {
  shape: circle
  class: state
}

sampling: Sampling {
  shape: circle
  class: state
}

symbolizing: Symbolizing {
  shape: circle
  class: state
}

aggregating: Aggregating {
  shape: circle
  class: state
}

error: Error {
  shape: circle
  class: error_state
}

complete: Complete {
  shape: circle
  class: state
  style.double-border: true
}

init -> idle: Initialize {
  class: transition
}

idle -> sampling: Start Profiling\n(timer signal) {
  class: transition
}

sampling -> symbolizing: Sample Complete\n(stack traces collected) {
  class: transition
}

symbolizing -> aggregating: Symbols Resolved\n(debug info processed) {
  class: transition
}

aggregating -> complete: Analysis Complete\n(flame graph ready) {
  class: transition
}

complete -> idle: Reset\n(new session) {
  class: transition
}

sampling -> error: Signal Delivery Failed\nStack Corruption\nTarget Process Dead {
  class: error_transition
}

symbolizing -> error: Missing Debug Info\nCorrupted Symbols\nDWARF Parse Error {
  class: error_transition
}

aggregating -> error: Memory Allocation Failed\nData Corruption\nOutput Write Error {
  class: error_transition
}

error -> idle: Recover\n(cleanup and reset) {
  class: transition
}

error -> error: Retry Failed {
  class: error_transition
}

sampling -> sampling: Continue Sampling\n(periodic timer) {
  class: transition
}