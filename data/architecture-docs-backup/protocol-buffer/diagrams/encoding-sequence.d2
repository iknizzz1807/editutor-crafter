shape: sequence_diagram

schema_parser: Schema Parser {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

message_serializer: Message Serializer {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

wire_type_encoder: Wire Type Encoder {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

varint_encoder: Varint Encoder {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

message_serializer -> schema_parser: parse_schema(proto_def)
schema_parser -> message_serializer: field_definitions

message_serializer -> schema_parser: get_field_info(field_name)
schema_parser -> message_serializer: field_type, field_number

message_serializer -> wire_type_encoder: encode_field_key(field_number, wire_type)
wire_type_encoder -> varint_encoder: encode_varint(key)
varint_encoder -> wire_type_encoder: encoded_key_bytes
wire_type_encoder -> message_serializer: field_key_bytes

message_serializer -> wire_type_encoder: encode_field_value(value, wire_type)
wire_type_encoder -> varint_encoder: encode_varint(length)
varint_encoder -> wire_type_encoder: length_bytes
wire_type_encoder -> message_serializer: encoded_value_bytes

message_serializer -> message_serializer: append_to_buffer(key + value)