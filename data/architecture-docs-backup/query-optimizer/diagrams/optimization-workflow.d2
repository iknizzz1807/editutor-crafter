title: Optimization Process Workflow {
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
  near: top-center
}

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  decision: {
    style.fill: "#16213e"
    style.stroke: "#f39c12"
    style.font-color: "#e6edf3"
  }
  
  data: {
    style.fill: "#0f3460"
    style.stroke: "#74b9ff"
    style.font-color: "#e6edf3"
  }
  
  flow: {
    style.stroke: "#8b949e"
    style.font-color: "#8b949e"
  }
  
  important: {
    style.stroke: "#e74c3c"
    style.stroke-width: 2
    style.font-color: "#8b949e"
  }
}

sql_input: SQL Query {
  shape: page
  class: data
}

parser: SQL Parser {
  shape: rectangle
  class: process
}

ast: Abstract Syntax Tree {
  shape: rectangle
  class: data
}

logical_planner: Logical Planner {
  shape: rectangle
  class: process
}

logical_plan: Logical Plan Tree {
  shape: rectangle
  class: data
}

rule_engine: Rule-Based Optimizer {
  shape: rectangle
  class: process
}

statistics: Statistics Manager {
  shape: cylinder
  class: data
}

cost_estimator: Cost Estimator {
  shape: rectangle
  class: process
}

join_optimizer: Join Order Optimizer {
  shape: rectangle
  class: process
}

search_complete: Search Complete? {
  shape: diamond
  class: decision
}

plan_selector: Plan Selector {
  shape: rectangle
  class: process
}

physical_planner: Physical Planner {
  shape: rectangle
  class: process
}

execution_plan: Physical Execution Plan {
  shape: rectangle
  class: data
}

sql_input -> parser: {
  label: Parse SQL
  class: flow
}

parser -> ast: {
  label: Generate AST
  class: flow
}

ast -> logical_planner: {
  label: Build Logic
  class: flow
}

logical_planner -> logical_plan: {
  label: Create Plan
  class: flow
}

logical_plan -> rule_engine: {
  label: Apply Rules
  class: flow
}

rule_engine -> cost_estimator: {
  label: Estimate Costs
  class: flow
}

statistics -> cost_estimator: {
  label: Table Stats\nIndex Info
  class: flow
}

cost_estimator -> join_optimizer: {
  label: Cost Data
  class: flow
}

join_optimizer -> search_complete: {
  label: Evaluate Options
  class: flow
}

search_complete -> join_optimizer: {
  label: No - Continue Search
  class: important
}

search_complete -> plan_selector: {
  label: Yes - Select Best
  class: flow
}

plan_selector -> physical_planner: {
  label: Chosen Plan
  class: flow
}

physical_planner -> execution_plan: {
  label: Generate Code
  class: flow
}