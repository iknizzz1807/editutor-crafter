title: "Optimizer State Transitions" {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  initial: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
  }
  final: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.double-border: true
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

init: {
  shape: circle
  class: initial
  label: ""
}

parsing: "Parsing" {
  shape: circle
  class: state
}

logical_planning: "Logical\nPlanning" {
  shape: circle
  class: state
}

cost_estimation: "Cost\nEstimation" {
  shape: circle
  class: state
}

join_optimization: "Join\nOptimization" {
  shape: circle
  class: state
}

physical_planning: "Physical\nPlanning" {
  shape: circle
  class: state
}

completed: "Completed" {
  shape: circle
  class: final
}

error: "Error" {
  shape: circle
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
  style.bold: true
}

init -> parsing: "SQL Query" {
  class: transition
}

parsing -> logical_planning: "Parse Tree" {
  class: transition
}

parsing -> error: "Syntax Error" {
  class: transition
}

logical_planning -> cost_estimation: "Logical Plan" {
  class: transition
}

logical_planning -> error: "Invalid Logic" {
  class: transition
}

cost_estimation -> join_optimization: "Statistics\nGathered" {
  class: transition
}

cost_estimation -> error: "Missing Stats" {
  class: transition
}

join_optimization -> physical_planning: "Join Order\nSelected" {
  class: transition
}

join_optimization -> error: "Timeout" {
  class: transition
}

physical_planning -> completed: "Execution\nPlan Ready" {
  class: transition
}

physical_planning -> error: "Resource\nConstraints" {
  class: transition
}