title: Configuration Update Flow

# Style definitions
classes: {
  management: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  validation: {
    style.fill: "#1a1a2e"
    style.stroke: "#f39c12"
    style.font-color: "#e6edf3"
  }
  storage: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  instance: {
    style.fill: "#1a1a2e"
    style.stroke: "#74b9ff"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#2d3436"
    style.stroke: "#fdcb6e"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

# Management layer
management_api: Management API {
  class: management
}

# Validation layer
validation: {
  class: validation
  
  schema_validator: Schema Validator {
    shape: rectangle
  }
  
  rule_validator: Rule Validator {
    shape: rectangle  
  }
  
  conflict_checker: Conflict Checker {
    shape: rectangle
  }
}

# Decision points
valid_check: Valid? {
  shape: diamond
  class: decision
}

# Redis storage
redis: Redis Cluster {
  shape: cylinder
  class: storage
}

# Application instances
instances: Application Instances {
  class: instance
  
  app1: Instance 1 {
    shape: rectangle
  }
  
  app2: Instance 2 {
    shape: rectangle
  }
  
  app3: Instance N {
    shape: rectangle
  }
}

# Notification system
pubsub: Redis Pub/Sub {
  shape: queue
  class: storage
}

# Error handling
error_response: Return Error {
  shape: rectangle
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
}

# Success response  
success_response: Configuration Updated {
  shape: rectangle
  style.fill: "#00b894"
  style.stroke: "#55efc4"
  style.font-color: "#ffffff"
}

# Flow connections
management_api -> validation.schema_validator: 1. Submit rule changes

validation.schema_validator -> validation.rule_validator: 2. Schema OK

validation.rule_validator -> validation.conflict_checker: 3. Rules valid

validation.conflict_checker -> valid_check: 4. Check conflicts

valid_check -> error_response: No - Validation failed {
  style.stroke: "#e17055"
}

valid_check -> redis: Yes - Store new config {
  style.stroke: "#3fb950"
}

redis -> pubsub: 5. Trigger notification

pubsub -> instances.app1: 6. Config change event
pubsub -> instances.app2: 6. Config change event  
pubsub -> instances.app3: 6. Config change event

instances.app1 -> redis: 7. Fetch latest config
instances.app2 -> redis: 7. Fetch latest config
instances.app3 -> redis: 7. Fetch latest config

redis -> success_response: 8. All instances updated