title: Redis Failure Handling Flow {
  near: top-center
  style.font-size: 24
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  decision: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  action: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  success: {
    style.fill: "#00b894"
    style.stroke: "#00a085"
    style.font-color: "#ffffff"
    style.bold: true
  }
}

start: Request Arrives {
  shape: circle
  class: success
}

redis_check: Redis Available? {
  shape: diamond
  class: decision
}

redis_operation: Execute Rate Limit\nCheck in Redis {
  class: action
}

redis_success: Redis Operation\nSuccessful? {
  shape: diamond
  class: decision
}

allow_request: Allow Request {
  class: success
}

deny_request: Deny Request {
  class: error
}

fallback_decision: Fallback Strategy {
  shape: diamond
  class: decision
}

local_cache: Use Local Cache\nFallback {
  class: action
}

fail_open: Fail Open\n(Allow All) {
  class: action
}

fail_closed: Fail Closed\n(Deny All) {
  class: error
}

cache_check: Local Cache\nHit? {
  shape: diamond
  class: decision
}

local_limit: Apply Local\nRate Limit {
  class: action
}

log_error: Log Redis\nFailure {
  class: action
}

circuit_breaker: Update Circuit\nBreaker State {
  class: action
}

retry_logic: Retry with\nBackoff {
  class: action
}

retry_count: Max Retries\nReached? {
  shape: diamond
  class: decision
}

monitor_recovery: Monitor Redis\nRecovery {
  class: action
}

start -> redis_check

redis_check -> redis_operation: Yes
redis_check -> fallback_decision: No

redis_operation -> redis_success

redis_success -> allow_request: Success & Allowed
redis_success -> deny_request: Success & Denied
redis_success -> retry_logic: Timeout/Error

retry_logic -> retry_count
retry_count -> redis_operation: No
retry_count -> fallback_decision: Yes

fallback_decision -> local_cache: Cache Available
fallback_decision -> fail_open: Fail Open Mode
fallback_decision -> fail_closed: Fail Closed Mode

local_cache -> cache_check
cache_check -> local_limit: Hit
cache_check -> fail_open: Miss

local_limit -> allow_request: Within Limit
local_limit -> deny_request: Exceeded

redis_check -> log_error: No
retry_count -> log_error: Yes
log_error -> circuit_breaker
circuit_breaker -> monitor_recovery

monitor_recovery -> redis_check: Recovery Detected