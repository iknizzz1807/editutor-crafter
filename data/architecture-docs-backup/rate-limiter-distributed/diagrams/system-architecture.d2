direction: right

title: System Architecture Overview {
  near: top-center
  style.font-size: 24
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.stroke-width: 2
  }
  
  service: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  storage: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  flow: {
    style.stroke: "#8b949e"
    style.stroke-width: 2
  }
  
  important_flow: {
    style.stroke: "#3fb950"
    style.stroke-width: 3
    style.bold: true
  }
}

applications: Application Instances {
  class: container
  
  app1: App Instance 1 {
    class: service
  }
  
  app2: App Instance 2 {
    class: service
  }
  
  app3: App Instance N {
    class: service
  }
}

rate_limiter: Rate Limiter Service {
  class: container
  
  limiter_core: Rate Limiter Core {
    class: service
  }
  
  algorithms: Algorithms {
    class: service
    label: "Token Bucket\nFixed Window\nSliding Window"
  }
}

redis_cluster: Redis Cluster {
  class: container
  
  redis1: Redis Node 1 {
    shape: cylinder
    class: storage
  }
  
  redis2: Redis Node 2 {
    shape: cylinder
    class: storage
  }
  
  redis3: Redis Node N {
    shape: cylinder
    class: storage
  }
}

management: Management Layer {
  class: container
  
  api: Management API {
    class: service
  }
  
  dashboard: Dashboard {
    class: service
  }
}

# Client requests
client: Client Requests {
  shape: cloud
  class: service
}

# Connections - Request Flow
client -> applications: HTTP Requests {
  class: flow
}

applications.app1 -> rate_limiter.limiter_core: Check Rate Limit {
  class: important_flow
}

applications.app2 -> rate_limiter.limiter_core: Check Rate Limit {
  class: important_flow
}

applications.app3 -> rate_limiter.limiter_core: Check Rate Limit {
  class: important_flow
}

# Rate limiter to Redis
rate_limiter.limiter_core -> redis_cluster.redis1: Read/Write Counters {
  class: important_flow
}

rate_limiter.limiter_core -> redis_cluster.redis2: Read/Write Counters {
  class: important_flow
}

rate_limiter.limiter_core -> redis_cluster.redis3: Read/Write Counters {
  class: important_flow
}

rate_limiter.algorithms -> rate_limiter.limiter_core: Algorithm Logic {
  class: flow
}

# Management connections
management.api -> redis_cluster: Configuration {
  class: flow
}

management.api -> rate_limiter: Policy Management {
  class: flow
}

management.dashboard -> management.api: Admin Interface {
  class: flow
}

# Response flow
applications -> client: Allow/Deny Response {
  class: flow
}

# Data flow indicators
data_flow: |md
  **Data Flow:**
  1. Client requests hit app instances
  2. Apps query rate limiter service
  3. Rate limiter checks Redis counters
  4. Decision flows back to client
  5. Management API controls policies
| {
  shape: page
  near: bottom-left
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}