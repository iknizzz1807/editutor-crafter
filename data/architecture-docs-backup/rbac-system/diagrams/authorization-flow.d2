direction: down
shape: sequence_diagram

classes: {
  actor: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  system: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  storage: {
    style.fill: "#2d3748"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

client: Client Application {
  class: actor
}
gateway: Authorization Gateway {
  class: system
}
rbac: RBAC Engine {
  class: system
}
abac: ABAC Policy Engine {
  class: system
}
resource: Resource Validator {
  class: system
}
audit: Audit Logger {
  class: storage
}

client -> gateway: 1. Authorization Request\n(user, resource, action)
gateway -> rbac: 2. Check User Roles\n& Permissions
rbac -> gateway: 3. RBAC Result\n(allow/deny + context)
gateway -> abac: 4. Evaluate ABAC Policies\n(user attrs, resource attrs, env context)
abac -> gateway: 5. ABAC Decision\n(allow/deny + conditions)
gateway -> resource: 6. Validate Resource Access\n(resource exists, ownership)
resource -> gateway: 7. Resource Validation Result
gateway -> gateway: 8. Combine Decisions\n(RBAC + ABAC + Resource)
gateway -> audit: 9. Log Authorization Decision\n(user, resource, decision, timestamp)
gateway -> client: 10. Final Authorization Response\n(allow/deny + reason)