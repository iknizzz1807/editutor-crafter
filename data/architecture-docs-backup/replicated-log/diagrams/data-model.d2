title: Data Model Relationships

classes: {
  entity_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  flow_style: {
    style.stroke: "#8b949e"
    style.font-color: "#8b949e"
  }
  timestamp_style: {
    style.stroke: "#e17055"
    style.font-color: "#e17055"
  }
  sequence_style: {
    style.stroke: "#74b9ff"
    style.font-color: "#74b9ff"
  }
}

LogEntry: {
  shape: class
  class: entity_style
  - "sequence_number: u64"
  - "timestamp: SystemTime"
  - "data: Vec<u8>"
  - "checksum: u32"
  - "node_id: NodeId"
  + "new(data: Vec<u8>, node_id: NodeId): LogEntry"
  + "verify_checksum(): bool"
  + "calculate_checksum(): u32"
}

NodeMetadata: {
  shape: class
  class: entity_style
  - "node_id: NodeId"
  - "address: SocketAddr"
  - "last_seen: SystemTime"
  - "is_leader: bool"
  - "heartbeat_interval: Duration"
  + "new(node_id: NodeId, address: SocketAddr): NodeMetadata"
  + "update_last_seen(): void"
  + "is_alive(timeout: Duration): bool"
}

ClusterState: {
  shape: class
  class: entity_style
  - "nodes: Map<NodeId, NodeMetadata>"
  - "leader_id: Option<NodeId>"
  - "term: u64"
  - "last_updated: SystemTime"
  - "commit_index: u64"
  + "new(): ClusterState"
  + "add_node(metadata: NodeMetadata): void"
  + "elect_leader(node_id: NodeId): void"
  + "get_alive_nodes(): Vec<NodeMetadata>"
}

ReplicationProgress: {
  shape: class
  class: entity_style
  - "follower_id: NodeId"
  - "next_index: u64"
  - "match_index: u64"
  - "last_response_time: SystemTime"
  - "is_replicating: bool"
  + "new(follower_id: NodeId): ReplicationProgress"
  + "update_progress(index: u64): void"
  + "needs_heartbeat(): bool"
}

sequence_flow: Sequence Number Flow {
  style.fill: "#16213e"
  style.stroke: "#74b9ff"
  style.font-color: "#e6edf3"
}

timestamp_flow: Timestamp Flow {
  style.fill: "#16213e"
  style.stroke: "#e17055"
  style.font-color: "#e6edf3"
}

LogEntry -> sequence_flow: generates {
  class: sequence_style
}

sequence_flow -> ReplicationProgress: tracks progress {
  class: sequence_style
}

sequence_flow -> ClusterState: commit_index {
  class: sequence_style
}

LogEntry -> timestamp_flow: records {
  class: timestamp_style
}

timestamp_flow -> NodeMetadata: last_seen {
  class: timestamp_style
}

timestamp_flow -> ReplicationProgress: last_response_time {
  class: timestamp_style
}

timestamp_flow -> ClusterState: last_updated {
  class: timestamp_style
}

NodeMetadata -> ClusterState: membership {
  class: flow_style
}

ClusterState -> ReplicationProgress: coordinates {
  class: flow_style
}

LogEntry -> ReplicationProgress: replication target {
  class: flow_style
}

note: |md
  ## Key Relationships
  - **Sequence Numbers**: Flow from LogEntry through ReplicationProgress to ClusterState's commit_index
  - **Timestamps**: Track system activity across all components for ordering and timeout detection
  - **Node Management**: NodeMetadata feeds into ClusterState for membership tracking
  - **Replication Coordination**: ClusterState manages ReplicationProgress for each follower
| {
  shape: page
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
  near: bottom-center
}