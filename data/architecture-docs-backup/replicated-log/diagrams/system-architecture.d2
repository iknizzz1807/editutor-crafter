# System Architecture Overview

direction: right

# Define color scheme
classes: {
  cluster_node: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  primary_node: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  core_component: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  client: {
    style.fill: "#2d3748"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

# Client Layer
clients: Client Applications {
  class: core_component
  app1: Web App {
    class: client
  }
  app2: Mobile App {
    class: client
  }
  app3: Service {
    class: client
  }
}

# Core System Components
system: Replicated Log System {
  class: core_component
  
  client_interface: Client Interface {
    class: core_component
    api: REST API
    protocol: gRPC
  }
  
  replication_mgr: Replication Manager {
    class: core_component
    consensus: Consensus Engine
    coordinator: Log Coordinator
  }
  
  failure_detector: Failure Detector {
    class: core_component
    heartbeat: Heartbeat Monitor
    election: Leader Election
  }
}

# Node Cluster
cluster: Node Cluster {
  class: core_component
  
  node1: Node 1 (Primary) {
    class: primary_node
    log1: Log Storage {
      shape: cylinder
    }
    state1: "State: LEADER"
  }
  
  node2: Node 2 (Follower) {
    class: cluster_node
    log2: Log Storage {
      shape: cylinder
    }
    state2: "State: FOLLOWER"
  }
  
  node3: Node 3 (Follower) {
    class: cluster_node
    log3: Log Storage {
      shape: cylinder
    }
    state3: "State: FOLLOWER"
  }
}

# Client connections
clients.app1 -> system.client_interface: append requests
clients.app2 -> system.client_interface: read requests
clients.app3 -> system.client_interface: subscribe

# Internal system connections
system.client_interface -> system.replication_mgr: coordinate writes
system.replication_mgr -> system.failure_detector: health checks
system.failure_detector -> system.replication_mgr: leader status

# System to cluster connections
system.replication_mgr -> cluster.node1: replicate entries
system.replication_mgr -> cluster.node2: replicate entries
system.replication_mgr -> cluster.node3: replicate entries

system.failure_detector <-> cluster.node1: heartbeat
system.failure_detector <-> cluster.node2: heartbeat
system.failure_detector <-> cluster.node3: heartbeat

# Inter-node replication
cluster.node1 -> cluster.node2: log entries {
  style.stroke: "#3fb950"
  style.bold: true
}
cluster.node1 -> cluster.node3: log entries {
  style.stroke: "#3fb950"
  style.bold: true
}

cluster.node2 -> cluster.node1: ack
cluster.node3 -> cluster.node1: ack

# Response flow
cluster.node1 -> system.client_interface: commit status {
  style.stroke: "#8b949e"
}
system.client_interface -> clients: response {
  style.stroke: "#8b949e"
}