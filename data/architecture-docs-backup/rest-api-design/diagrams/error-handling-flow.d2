title: Error Handling and Response Flow

classes: {
  error_handler: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  error_type: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  response: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#2d3436"
    style.stroke: "#fdcb6e"
    style.font-color: "#e6edf3"
  }
}

incoming_request: Incoming Request {
  class: error_handler
}

error_occurs: Error Occurs {
  shape: diamond
  class: decision
}

error_triage: Error Triage {
  shape: diamond
  class: decision
}

validation_error: Validation Error {
  class: error_type
}

auth_error: Authentication Error {
  class: error_type
}

rate_limit_error: Rate Limiting Error {
  class: error_type
}

system_error: System Error {
  class: error_type
}

error_logger: Error Logger {
  class: error_handler
}

context_gatherer: Context Gatherer {
  class: error_handler
}

response_formatter: Response Formatter {
  class: error_handler
}

validation_response: 400 Bad Request {
  class: response
}

auth_response: 401 Unauthorized {
  class: response
}

rate_limit_response: 429 Too Many Requests {
  class: response
}

system_response: 500 Internal Server Error {
  class: response
}

client_response: HTTP Response to Client {
  class: response
  style.stroke: "#d63031"
  style.bold: true
}

incoming_request -> error_occurs: execution

error_occurs -> error_triage: error detected
error_occurs -> client_response: success path {
  style.stroke: "#00b894"
}

error_triage -> validation_error: validation failed
error_triage -> auth_error: auth failed
error_triage -> rate_limit_error: rate exceeded
error_triage -> system_error: internal failure

validation_error -> context_gatherer: gather field details
auth_error -> context_gatherer: gather auth context
rate_limit_error -> context_gatherer: gather rate info
system_error -> error_logger: log stack trace

context_gatherer -> response_formatter: format error details
error_logger -> response_formatter: sanitize error

response_formatter -> validation_response: validation errors
response_formatter -> auth_response: auth errors
response_formatter -> rate_limit_response: rate limit errors
response_formatter -> system_response: system errors

validation_response -> client_response: structured validation details
auth_response -> client_response: auth challenge
rate_limit_response -> client_response: retry headers
system_response -> client_response: generic error message