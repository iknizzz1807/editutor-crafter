direction: right

classes: {
  entity: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  relation: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

title: Data Model Relationships {
  near: top-center
  style.font-size: 18
  style.font-color: "#e6edf3"
  style.bold: true
}

ProxyConfig: {
  shape: class
  class: entity
  - "listen_port: u16"
  - "ssl_enabled: bool"
  - "max_connections: usize"
  - "backend_servers: Vec<BackendServer>"
  - "cache_settings: CacheSettings"
  + "load_from_file(path: String): Result<ProxyConfig>"
  + "validate(): bool"
}

BackendServer: {
  shape: class
  class: entity
  - "host: String"
  - "port: u16"
  - "weight: u32"
  - "health_status: HealthStatus"
  - "max_connections: usize"
  - "current_connections: AtomicUsize"
  + "is_healthy(): bool"
  + "connect(): Result<Connection>"
}

Connection: {
  shape: class
  class: entity
  - "id: ConnectionId"
  - "client_addr: SocketAddr"
  - "backend_addr: Option<SocketAddr>"
  - "created_at: Instant"
  - "last_used: Instant"
  - "state: ConnectionState"
  + "send_request(req: HttpRequest): Result<()>"
  + "recv_response(): Result<HttpResponse>"
  + "close(): Result<()>"
}

HttpRequest: {
  shape: class
  class: entity
  - "method: HttpMethod"
  - "uri: String"
  - "version: HttpVersion"
  - "headers: HeaderMap"
  - "body: Option<Vec<u8>>"
  - "connection_id: ConnectionId"
  + "parse(buffer: Buffer): Result<HttpRequest>"
  + "to_bytes(): Vec<u8>"
  + "get_cache_key(): String"
}

HttpResponse: {
  shape: class
  class: entity
  - "status_code: u16"
  - "version: HttpVersion"
  - "headers: HeaderMap"
  - "body: Option<Vec<u8>>"
  - "created_at: Instant"
  + "parse(buffer: Buffer): Result<HttpResponse>"
  + "to_bytes(): Vec<u8>"
  + "is_cacheable(): bool"
  + "get_ttl(): Option<Duration>"
}

CacheEntry: {
  shape: class
  class: entity
  - "key: String"
  - "response: HttpResponse"
  - "created_at: Instant"
  - "expires_at: Instant"
  - "hit_count: AtomicU64"
  - "content_length: usize"
  + "is_expired(): bool"
  + "is_fresh(): bool"
  + "update_stats(): ()"
}

ProxyConfig -> BackendServer: "1..N\ncontains" {
  class: relation
}

ProxyConfig -> Connection: "1..N\nmanages" {
  class: relation
}

Connection -> HttpRequest: "1..1\nprocesses" {
  class: relation
}

Connection -> HttpResponse: "1..1\nreturns" {
  class: relation
}

BackendServer -> Connection: "1..N\naccepts" {
  class: relation
}

HttpRequest -> CacheEntry: "0..1\nlookup by key" {
  class: relation
}

HttpResponse -> CacheEntry: "0..1\nstored as" {
  class: relation
}

CacheEntry -> HttpResponse: "1..1\ncontains" {
  class: relation
}