direction: right

# Client Request State Machine
title: Client Request State Machine

classes: {
  state_normal: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    shape: circle
  }
  state_error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    shape: circle
  }
  state_final: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
    shape: circle
  }
  start_state: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    label: ""
    shape: circle
  }
}

init: Initial {
  class: start_state
}

idle: Idle {
  class: state_normal
}

connecting: Connecting {
  class: state_normal
}

sending: Sending Request {
  class: state_normal
}

waiting: Waiting for Response {
  class: state_normal
}

receiving: Receiving Response {
  class: state_normal
}

completed: Completed {
  class: state_final
}

timeout_state: Timeout {
  class: state_error
}

error_state: Error {
  class: state_error
}

init -> idle: start client

idle -> connecting: initiate_request()

connecting -> sending: connection_established()
connecting -> error_state: connection_failed()

sending -> waiting: request_sent()
sending -> error_state: send_failed()

waiting -> receiving: response_available()
waiting -> timeout_state: timeout_expired()
waiting -> error_state: connection_lost()

receiving -> completed: response_complete()
receiving -> error_state: receive_failed()

timeout_state -> idle: retry_request()
timeout_state -> completed: give_up()

error_state -> idle: retry_request()
error_state -> completed: abort_request()

completed -> idle: new_request()