direction: right

classes: {
  primary: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  secondary: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  relationship: {
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

SagaDefinition: {
  shape: class
  class: primary
  - "id: string"
  - "name: string"
  - "version: string"
  - "description: string"
  - "timeout: Duration"
  - "created_at: DateTime"
  - "updated_at: DateTime"
  + "validate(): ValidationResult"
  + "get_steps(): List<StepDefinition>"
  + "create_instance(): SagaInstance"
}

SagaInstance: {
  shape: class
  class: primary
  - "id: string"
  - "definition_id: string"
  - "status: SagaStatus"
  - "current_step: string"
  - "context: Map<string, any>"
  - "started_at: DateTime"
  - "completed_at: DateTime"
  - "error_message: string"
  + "start(): void"
  + "complete(): void"
  + "fail(error: string): void"
  + "compensate(): void"
}

StepDefinition: {
  shape: class
  class: secondary
  - "id: string"
  - "saga_definition_id: string"
  - "name: string"
  - "sequence_order: int"
  - "action_type: ActionType"
  - "action_config: Map<string, any>"
  - "compensation_config: Map<string, any>"
  - "timeout: Duration"
  - "retry_policy: RetryPolicy"
  + "execute(context: Map<string, any>): StepResult"
  + "compensate(context: Map<string, any>): CompensationResult"
}

StepExecution: {
  shape: class
  class: secondary
  - "id: string"
  - "saga_instance_id: string"
  - "step_definition_id: string"
  - "status: StepStatus"
  - "attempt_count: int"
  - "input_data: Map<string, any>"
  - "output_data: Map<string, any>"
  - "started_at: DateTime"
  - "completed_at: DateTime"
  - "error_message: string"
  + "start(): void"
  + "complete(output: Map<string, any>): void"
  + "fail(error: string): void"
  + "retry(): void"
}

CompensationRecord: {
  shape: class
  class: secondary
  - "id: string"
  - "saga_instance_id: string"
  - "step_execution_id: string"
  - "compensation_action: string"
  - "compensation_data: Map<string, any>"
  - "status: CompensationStatus"
  - "executed_at: DateTime"
  - "error_message: string"
  + "execute(): CompensationResult"
  + "mark_completed(): void"
  + "mark_failed(error: string): void"
}

SagaDefinition -> StepDefinition: "1 to many\ndefines steps" {
  class: relationship
}

SagaDefinition -> SagaInstance: "1 to many\ninstantiates" {
  class: relationship
}

SagaInstance -> StepExecution: "1 to many\nexecutes steps" {
  class: relationship
}

StepDefinition -> StepExecution: "1 to many\nexecuted as" {
  class: relationship
}

StepExecution -> CompensationRecord: "1 to 0..1\ncompensated by" {
  class: relationship
}

title: {
  label: "Saga Data Model Relationships"
  near: top-center
  style.font-size: 24
  style.font-color: "#e6edf3"
  style.bold: true
}