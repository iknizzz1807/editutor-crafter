title: Saga Execution State Machine

direction: right

# Define named styles
classes: {
  initial_state: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#ffffff"
    style.bold: true
  }
  normal_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  final_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
    style.double-border: true
  }
  error_state: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
    style.double-border: true
  }
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  error_transition: {
    style.stroke: "#d63031"
    style.font-color: "#d63031"
  }
  compensation_transition: {
    style.stroke: "#fd79a8"
    style.font-color: "#fd79a8"
  }
}

# Initial state
init: {
  shape: circle
  class: initial_state
  label: ""
}

# States
created: Created {
  shape: circle
  class: normal_state
}

running: Running {
  shape: circle
  class: normal_state
}

compensating: Compensating {
  shape: circle
  class: normal_state
}

completed: Completed {
  shape: circle
  class: final_state
}

failed: Failed {
  shape: circle
  class: error_state
}

# State transitions
init -> created: "Saga Definition\nSubmitted" {
  class: transition
}

created -> running: "Start Execution\nEvent" {
  class: transition
}

running -> completed: "All Steps\nSuccessful" {
  class: transition
}

running -> compensating: "Step Failure\nDetected" {
  class: error_transition
}

compensating -> completed: "Compensation\nSuccessful" {
  class: compensation_transition
}

compensating -> failed: "Compensation\nFailed" {
  class: error_transition
}

running -> failed: "Timeout or\nCritical Error" {
  class: error_transition
}

# Actions and context notes
actions_note: |md
  ## State Actions

  **Created:** Initialize saga context, validate definition
  
  **Running:** Execute forward steps, track progress, handle dependencies
  
  **Compensating:** Execute compensation steps in reverse order
  
  **Completed:** Clean up resources, notify subscribers
  
  **Failed:** Log errors, alert monitoring, preserve state for analysis
| {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: top-right
}

events_note: |md
  ## Triggering Events

  • **Definition Submitted:** New saga registered
  • **Start Execution:** Begin forward step execution  
  • **Step Success/Failure:** Individual step outcomes
  • **Timeout:** Step or saga-level timeouts
  • **Compensation Complete:** All rollback steps finished
| {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: bottom-right
}