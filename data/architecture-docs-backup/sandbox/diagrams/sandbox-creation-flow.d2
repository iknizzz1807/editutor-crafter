direction: down

title: Sandbox Creation Sequence {
  style.font-size: 18
  style.font-color: "#e6edf3"
  style.bold: true
}

classes: {
  process_node: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  action_node: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  decision_node: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

start: Start {
  shape: circle
  class: process_node
}

fork: Fork Process {
  class: action_node
}

namespaces: Create Namespaces {
  class: action_node
}

filesystem: Set up Filesystem {
  class: action_node
}

seccomp: Apply Seccomp Filter {
  class: action_node
}

cgroups: Configure Cgroups {
  class: action_node
}

capabilities: Drop Capabilities {
  class: action_node
}

check: Ready to Execute? {
  shape: diamond
  class: decision_node
}

exec: Exec Target Program {
  class: action_node
}

sandbox: Sandboxed Process {
  shape: circle
  style.fill: "#3fb950"
  style.font-color: "#1a1a2e"
  style.bold: true
  style.double-border: true
}

error: Setup Failed {
  shape: circle
  style.fill: "#d63031"
  style.font-color: "#ffffff"
  style.bold: true
}

start -> fork: {
  style.stroke: "#8b949e"
}

fork -> namespaces: Child process {
  style.stroke: "#8b949e"
}

namespaces -> filesystem: PID, NET, IPC, UTS, MNT {
  style.stroke: "#8b949e"
}

filesystem -> seccomp: chroot, bind mounts {
  style.stroke: "#8b949e"
}

seccomp -> cgroups: Block syscalls {
  style.stroke: "#8b949e"
}

cgroups -> capabilities: Limit resources {
  style.stroke: "#8b949e"
}

capabilities -> check: Remove privileges {
  style.stroke: "#8b949e"
}

check -> exec: Yes {
  style.stroke: "#3fb950"
}

check -> error: No {
  style.stroke: "#d63031"
}

exec -> sandbox: execve() {
  style.stroke: "#3fb950"
}