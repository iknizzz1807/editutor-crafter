Dynamic Secret Lifecycle: {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"

  # States
  init: {
    shape: circle
    style.fill: "#3fb950"
    label: ""
  }

  requested: Requested {
    shape: circle
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }

  active: Active {
    shape: circle
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }

  renewed: Renewed {
    shape: circle
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }

  expired: Expired {
    shape: circle
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.double-border: true
  }

  revoked: Revoked {
    shape: circle
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.double-border: true
  }

  # Cleanup process
  cleanup: Cleanup Process {
    shape: rectangle
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }

  # Transitions
  init -> requested: Create Lease
  requested -> active: Grant Credentials
  active -> renewed: Extend TTL
  renewed -> active: Continue Usage
  active -> expired: TTL Timeout
  active -> revoked: Force Revocation
  renewed -> expired: TTL Timeout
  renewed -> revoked: Force Revocation
  expired -> cleanup: Auto Cleanup
  revoked -> cleanup: Manual Cleanup

  # Process details
  lease_manager: Lease Manager {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    
    ttl_tracker: TTL Tracker
    renewal_handler: Renewal Handler
    revocation_service: Revocation Service
  }

  backend: Secret Backend {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    
    credential_generator: Credential Generator
    resource_cleaner: Resource Cleaner
  }

  # Control flows
  lease_manager.ttl_tracker -> active: Monitor
  lease_manager.renewal_handler -> renewed: Process Renewal
  lease_manager.revocation_service -> revoked: Force Revoke
  backend.credential_generator -> active: Generate Creds
  backend.resource_cleaner -> cleanup: Delete Resources

  # Notes
  note1: |md
    **Lease States:**
    - Requested: Lease creation initiated
    - Active: Credentials issued and valid
    - Renewed: TTL extended, back to active
    - Expired: TTL reached, auto-cleanup
    - Revoked: Manual termination
  | {
    shape: page
    near: top-right
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }

  note2: |md
    **Cleanup Actions:**
    - Delete database users
    - Revoke cloud IAM roles
    - Remove temporary certificates
    - Clear credential cache
  | {
    shape: page
    near: bottom-right
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}