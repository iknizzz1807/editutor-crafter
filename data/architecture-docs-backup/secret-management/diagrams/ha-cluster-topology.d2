classes: {
  leader: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  follower: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  client: {
    style.fill: "#0984e3"
    style.stroke: "#74b9ff"
    style.font-color: "#ffffff"
  }
  lb: {
    style.fill: "#16213e"
    style.stroke: "#fdcb6e"
    style.font-color: "#e6edf3"
  }
  storage: {
    style.fill: "#2d3748"
    style.stroke: "#4fd1c7"
    style.font-color: "#e6edf3"
  }
}

title: High Availability Cluster Topology {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

clients: Client Applications {
  client1: Client 1 {
    class: client
  }
  client2: Client 2 {
    class: client
  }
  client3: Client 3 {
    class: client
  }
  style.fill: "#0f3460"
  style.stroke: "#74b9ff"
  style.font-color: "#e6edf3"
}

load_balancer: Load Balancer {
  class: lb
}

cluster: Vault Cluster {
  node1: Node 1 (Leader) {
    class: leader
    api1: API Server
    storage1: Storage Engine {
      shape: cylinder
      class: storage
    }
    api1 -> storage1: read/write
  }
  
  node2: Node 2 (Follower) {
    class: follower
    api2: API Server
    storage2: Storage Engine {
      shape: cylinder
      class: storage
    }
    api2 -> storage2: read only
  }
  
  node3: Node 3 (Follower) {
    class: follower
    api3: API Server
    storage3: Storage Engine {
      shape: cylinder
      class: storage
    }
    api3 -> storage3: read only
  }
  
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

shared_storage: Shared Storage Backend {
  shape: cylinder
  class: storage
}

clients.client1 -> load_balancer: API requests
clients.client2 -> load_balancer: API requests
clients.client3 -> load_balancer: API requests

load_balancer -> cluster.node1.api1: route to leader
load_balancer -> cluster.node2.api2: route reads
load_balancer -> cluster.node3.api3: route reads

cluster.node1 -> cluster.node2: replicate data
cluster.node1 -> cluster.node3: replicate data

cluster.node2 -> cluster.node1: heartbeat
cluster.node3 -> cluster.node1: heartbeat

cluster.node1.storage1 -> shared_storage: persist secrets
cluster.node2.storage2 -> shared_storage: read secrets
cluster.node3.storage3 -> shared_storage: read secrets

election_note: |md
  **Leader Election**
  - Raft consensus protocol
  - Only leader accepts writes
  - Followers forward writes to leader
| {
  shape: page
  near: bottom-left
  style.fill: "#2d3748"
  style.stroke: "#fdcb6e"
  style.font-color: "#e6edf3"
}

replication_note: |md
  **Replication Flow**
  - Leader replicates to followers
  - Quorum required for writes
  - Followers can serve reads
| {
  shape: page
  near: bottom-right
  style.fill: "#2d3748"
  style.stroke: "#fdcb6e"
  style.font-color: "#e6edf3"
}