title: Document Indexing Flow

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  storage: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  arrow: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

input: Raw Documents {
  shape: page
  class: storage
}

preprocessing: Document Preprocessing {
  class: process
}

chunk_decision: Chunking Required? {
  shape: diamond
  class: decision
}

text_chunking: Text Chunking {
  class: process
}

embedding_gen: Embedding Generation {
  class: process
}

validation: Vector Validation {
  shape: diamond
  class: decision
}

metadata_extract: Metadata Extraction {
  class: process
}

index_update: Index Update {
  class: process
}

vector_index: Vector Index {
  shape: cylinder
  class: storage
}

metadata_store: Metadata Store {
  shape: cylinder
  class: storage
}

error_handler: Error Handler {
  class: process
}

input -> preprocessing: class: arrow
preprocessing -> chunk_decision: Text cleaned & normalized {class: arrow}
chunk_decision -> text_chunking: Yes - Large document {class: arrow}
chunk_decision -> embedding_gen: No - Small document {class: arrow}
text_chunking -> embedding_gen: Text chunks {class: arrow}
embedding_gen -> validation: Vector embeddings {class: arrow}
validation -> metadata_extract: Valid vectors {class: arrow}
validation -> error_handler: Invalid vectors {class: arrow}
metadata_extract -> index_update: Enriched vectors {class: arrow}
index_update -> vector_index: Store vectors {class: arrow}
index_update -> metadata_store: Store metadata {class: arrow}
error_handler -> preprocessing: Retry processing {class: arrow}