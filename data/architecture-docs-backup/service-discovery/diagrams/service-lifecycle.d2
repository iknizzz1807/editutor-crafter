classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  initial_state: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#1a1a2e"
    style.bold: true
  }
  final_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
    style.bold: true
  }
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  critical_transition: {
    style.stroke: "#d63031"
    style.font-color: "#d63031"
    style.bold: true
  }
}

title: Service Instance State Machine {
  style.font-color: "#e6edf3"
  style.font-size: 24
  style.bold: true
  near: top-center
}

init: {
  shape: circle
  label: ""
  class: initial_state
}

unregistered: Unregistered {
  shape: circle
  class: state
}

registered: Registered {
  shape: circle
  class: state
}

healthy: Healthy {
  shape: circle
  class: state
}

unhealthy: Unhealthy {
  shape: circle
  class: state
}

deregistered: Deregistered {
  shape: circle
  class: final_state
}

init -> unregistered: service starts {
  class: transition
}

unregistered -> registered: register() {
  class: transition
}

registered -> healthy: initial health check passes {
  class: transition
}

registered -> unhealthy: initial health check fails {
  class: transition
}

healthy -> unhealthy: health check fails {
  class: critical_transition
}

unhealthy -> healthy: health check passes {
  class: transition
}

healthy -> deregistered: explicit deregister() {
  class: transition
}

unhealthy -> deregistered: explicit deregister() {
  class: transition
}

unhealthy -> deregistered: failure threshold exceeded {
  class: critical_transition
}

registered -> deregistered: explicit deregister() {
  class: transition
}

healthy -> healthy: health check passes {
  class: transition
  style.stroke-dash: 3
}

unhealthy -> unhealthy: health check fails {
  class: critical_transition
  style.stroke-dash: 3
}