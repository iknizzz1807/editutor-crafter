title: Error Handling and Recovery Flow

classes: {
  normal: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  recovery: {
    style.fill: "#00b894"
    style.stroke: "#00cec9"
    style.font-color: "#ffffff"
    style.bold: true
  }
}

monitoring: Health Monitoring {
  class: normal
}

error_detect: Error Detection {
  shape: diamond
  class: decision
}

circuit_breaker: Circuit Breaker {
  class: normal
}

breaker_decision: Breaker Open? {
  shape: diamond
  class: decision
}

fallback_strategies: Fallback Strategies {
  cache_fallback: Cached Data
  local_fallback: Local Service Registry
  default_response: Default Response
  graceful_degradation: Graceful Degradation
  
  cache_fallback.class: recovery
  local_fallback.class: recovery
  default_response.class: recovery
  graceful_degradation.class: recovery
}

failure_scenarios: Failure Types {
  network_partition: Network Partition {
    class: error
  }
  service_outage: Service Outage {
    class: error
  }
  cert_expired: Certificate Expiry {
    class: error
  }
  lb_failure: Load Balancer Failure {
    class: error
  }
}

recovery_process: Recovery Process {
  class: normal
}

health_check: Health Check {
  shape: diamond
  class: decision
}

gradual_recovery: Gradual Recovery {
  class: recovery
}

full_service: Full Service Restored {
  class: recovery
}

monitoring -> error_detect: continuous monitoring

failure_scenarios.network_partition -> error_detect
failure_scenarios.service_outage -> error_detect
failure_scenarios.cert_expired -> error_detect
failure_scenarios.lb_failure -> error_detect

error_detect -> circuit_breaker: error detected
error_detect -> monitoring: no error

circuit_breaker -> breaker_decision

breaker_decision -> fallback_strategies: yes - activate fallback
breaker_decision -> recovery_process: no - allow requests

fallback_strategies.cache_fallback -> recovery_process
fallback_strategies.local_fallback -> recovery_process
fallback_strategies.default_response -> recovery_process
fallback_strategies.graceful_degradation -> recovery_process

recovery_process -> health_check: periodic checks

health_check -> gradual_recovery: service recovering
health_check -> recovery_process: still failing

gradual_recovery -> full_service: recovery complete
gradual_recovery -> health_check: continue monitoring

full_service -> monitoring: resume normal operation