title: Load Balancing Decision Flow

classes: {
  start_end: {
    style.fill: "#3fb950"
    style.font-color: "#ffffff"
    style.stroke: "#3fb950"
    style.bold: true
  }
  decision: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  process: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  endpoint: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

start: Request Arrives {
  shape: circle
  class: start_end
}

config_check: Load Balancing\nAlgorithm? {
  shape: diamond
  class: decision
}

health_check: Check Endpoint\nHealth {
  shape: rectangle
  class: process
}

filter_healthy: Filter Healthy\nEndpoints {
  shape: rectangle
  class: process
}

round_robin: Round Robin\nSelect Next in Rotation {
  shape: rectangle
  class: process
}

least_conn: Least Connections\nFind Min Active Connections {
  shape: rectangle
  class: process
}

weighted: Weighted Distribution\nSelect Based on Weights {
  shape: rectangle
  class: process
}

consistent_hash: Consistent Hashing\nHash Request Key {
  shape: rectangle
  class: process
}

no_healthy: No Healthy\nEndpoints? {
  shape: diamond
  class: decision
}

circuit_breaker: Circuit Breaker\nLogic {
  shape: rectangle
  class: process
}

select_endpoint: Select Target\nEndpoint {
  shape: rectangle
  class: endpoint
}

error_response: Return\n503 Error {
  shape: rectangle
  style.fill: "#d63031"
  style.font-color: "#ffffff"
  style.stroke: "#e17055"
}

forward_request: Forward Request\nto Endpoint {
  shape: circle
  class: start_end
}

start -> config_check
config_check -> health_check

health_check -> filter_healthy
filter_healthy -> no_healthy

no_healthy -> round_robin: Healthy endpoints available
no_healthy -> circuit_breaker: No healthy endpoints

circuit_breaker -> error_response

config_check -> round_robin: Round Robin {
  style.stroke: "#3fb950"
}

config_check -> least_conn: Least Connections {
  style.stroke: "#3fb950"
}

config_check -> weighted: Weighted {
  style.stroke: "#3fb950"
}

config_check -> consistent_hash: Consistent Hash {
  style.stroke: "#3fb950"
}

round_robin -> select_endpoint
least_conn -> select_endpoint
weighted -> select_endpoint
consistent_hash -> select_endpoint

select_endpoint -> forward_request