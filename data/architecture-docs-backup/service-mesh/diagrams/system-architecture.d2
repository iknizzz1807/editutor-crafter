title: Service Mesh Sidecar Architecture

classes: {
  sidecar_component: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  external_service: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  data_flow: {
    style.stroke: "#3fb950"
    style.stroke-width: 2
  }
  control_flow: {
    style.stroke: "#8b949e"
    style.stroke-dash: 3
  }
}

sidecar: Service Mesh Sidecar {
  class: sidecar_component
  
  traffic_interceptor: Traffic Interceptor {
    class: sidecar_component
    shape: rectangle
  }
  
  service_discovery: Service Discovery {
    class: sidecar_component
    shape: rectangle
  }
  
  load_balancer: Load Balancer {
    class: sidecar_component
    shape: rectangle
  }
  
  mtls_manager: mTLS Manager {
    class: sidecar_component
    shape: rectangle
  }
  
  circuit_breaker: Circuit Breaker {
    class: sidecar_component
    shape: rectangle
  }
}

application: Application {
  class: external_service
  shape: rectangle
}

downstream_services: Downstream Services {
  class: external_service
  shape: rectangle
  service_a: Service A
  service_b: Service B
  service_c: Service C
}

kubernetes_api: Kubernetes API {
  class: external_service
  shape: cloud
}

cert_authority: Certificate Authority {
  class: external_service
  shape: hexagon
}

consul: Consul/etcd {
  class: external_service
  shape: cylinder
}

application -> sidecar.traffic_interceptor: Outbound requests {
  class: data_flow
}

sidecar.traffic_interceptor -> application: Inbound requests {
  class: data_flow
}

sidecar.traffic_interceptor -> sidecar.service_discovery: Resolve endpoints {
  class: control_flow
}

sidecar.service_discovery -> sidecar.load_balancer: Available endpoints {
  class: control_flow
}

sidecar.load_balancer -> sidecar.circuit_breaker: Route decision {
  class: control_flow
}

sidecar.circuit_breaker -> sidecar.mtls_manager: Secure connection {
  class: control_flow
}

sidecar.mtls_manager -> downstream_services: mTLS requests {
  class: data_flow
}

downstream_services -> sidecar.mtls_manager: mTLS responses {
  class: data_flow
}

sidecar.service_discovery -> kubernetes_api: Service endpoints {
  class: control_flow
}

sidecar.service_discovery -> consul: Service registry {
  class: control_flow
}

sidecar.mtls_manager -> cert_authority: Certificate requests {
  class: control_flow
}

cert_authority -> sidecar.mtls_manager: Certificates {
  class: control_flow
}

sidecar.circuit_breaker -> sidecar.load_balancer: Health status {
  class: control_flow
}