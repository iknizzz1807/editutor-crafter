title: Traffic Interception Process

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  data: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

incoming_traffic: Incoming Traffic {
  class: data
  shape: cloud
}

iptables: Iptables Rules {
  class: process
}

socket_intercept: Socket Interception {
  class: process
}

protocol_detect: Protocol Detection {
  class: decision
  shape: diamond
}

http_handler: HTTP Handler {
  class: process
}

tcp_handler: TCP Handler {
  class: process
}

forward_decision: Forwarding Decision {
  class: decision
  shape: diamond
}

local_service: Local Service {
  class: data
  shape: cylinder
}

remote_service: Remote Service {
  class: data
  shape: cylinder
}

proxy_enhancements: Proxy Enhancements {
  class: process
  shape: package
}

incoming_traffic -> iptables: network packets

iptables -> socket_intercept: redirect to proxy

socket_intercept -> protocol_detect: captured connection

protocol_detect -> http_handler: HTTP/HTTPS {
  style.stroke: "#3fb950"
}

protocol_detect -> tcp_handler: TCP/other {
  style.stroke: "#8b949e"
}

http_handler -> forward_decision: parsed request

tcp_handler -> forward_decision: raw connection

forward_decision -> local_service: inbound traffic {
  style.stroke: "#3fb950"
}

forward_decision -> proxy_enhancements: outbound traffic {
  style.stroke: "#8b949e"
}

proxy_enhancements -> remote_service: enhanced connection

note: |md
  ## Traffic Flow
  1. **Iptables** redirects packets to proxy
  2. **Socket interception** captures connections
  3. **Protocol detection** identifies traffic type
  4. **Handlers** process protocol-specific logic
  5. **Forwarding** routes to destination
| {
  shape: page
  near: top-right
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}