classes: {
  container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  process: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  action: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
}

start: Device Login Request {
  shape: circle
  class: process
}

device_reg: Device Registration {
  class: container
  
  identify: Identify Device {
    class: process
  }
  
  new_device: New Device? {
    shape: diamond
    class: decision
  }
  
  register: Register Device {
    class: process
  }
  
  identify -> new_device
  new_device -> register: Yes
}

session_check: Session Enumeration {
  class: container
  
  count_sessions: Count Active Sessions {
    class: process
  }
  
  limit_check: Exceeds Limit? {
    shape: diamond
    class: decision
  }
  
  count_sessions -> limit_check
}

enforcement: Concurrent Limit Enforcement {
  class: container
  
  eviction_strategy: Choose Eviction Strategy {
    shape: diamond
    class: decision
  }
  
  oldest_first: Revoke Oldest Session {
    class: action
  }
  
  lru: Revoke LRU Session {
    class: action
  }
  
  device_type: Revoke by Device Type {
    class: action
  }
  
  eviction_strategy -> oldest_first: Oldest First
  eviction_strategy -> lru: Least Recent
  eviction_strategy -> device_type: By Type
}

revocation: Selective Revocation {
  class: container
  
  invalidate: Invalidate Target Session {
    class: action
  }
  
  notify: Notify Other Devices {
    class: process
  }
  
  cleanup: Cleanup Session Data {
    class: process
  }
  
  invalidate -> notify
  notify -> cleanup
}

create_session: Create New Session {
  class: process
}

success: Session Active {
  shape: circle
  class: process
}

start -> device_reg.identify

device_reg.new_device -> session_check.count_sessions: No (Existing Device)
device_reg.register -> session_check.count_sessions

session_check.limit_check -> create_session: No
session_check.limit_check -> enforcement.eviction_strategy: Yes

enforcement.oldest_first -> revocation.invalidate
enforcement.lru -> revocation.invalidate
enforcement.device_type -> revocation.invalidate

revocation.cleanup -> create_session

create_session -> success