title: Session Lifecycle State Machine {
  near: top-center
  style.font-size: 18
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.stroke-width: 2
  }
  
  final_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.stroke-width: 2
    style.double-border: true
  }
  
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    style.stroke-width: 2
  }
  
  security_transition: {
    style.stroke: "#d63031"
    style.font-color: "#d63031"
    style.stroke-width: 2
  }
  
  regeneration: {
    style.stroke: "#f39c12"
    style.font-color: "#f39c12"
    style.stroke-width: 2
    style.stroke-dash: 3
  }
}

init: {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
  label: ""
}

created: Created {
  shape: circle
  class: state
}

active: Active {
  shape: circle
  class: state
}

expired: Expired {
  shape: circle
  class: final_state
}

revoked: Revoked {
  shape: circle
  class: final_state
}

init -> created: Session Request {
  class: transition
}

created -> active: Successful Authentication {
  class: transition
}

created -> revoked: Invalid Credentials {
  class: security_transition
}

created -> expired: Creation Timeout {
  class: transition
}

active -> active: Activity / Heartbeat {
  class: transition
}

active -> active: ID Regeneration\n(Fixation Prevention) {
  class: regeneration
}

active -> expired: Session Timeout\nInactivity Limit {
  class: transition
}

active -> revoked: Explicit Logout {
  class: transition
}

active -> revoked: Security Violation\nSuspicious Activity {
  class: security_transition
}

expired -> revoked: Cleanup Process {
  class: transition
}

fixation_note: |md
  **Session Fixation Prevention**
  
  ID regeneration occurs during:
  • Authentication success
  • Privilege escalation
  • Periodic renewal
  • Security-sensitive operations
| {
  shape: page
  near: bottom-right
  style.fill: "#16213e"
  style.stroke: "#f39c12"
  style.font-color: "#e6edf3"
}

events_note: |md
  **Transition Events**
  
  • **Authentication**: Login validation
  • **Timeout**: Configurable inactivity
  • **Logout**: User-initiated termination  
  • **Security**: Violation detection
  • **Cleanup**: Background processes
| {
  shape: page
  near: bottom-left
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}