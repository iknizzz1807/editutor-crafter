direction: right

classes: {
  struct_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  container_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  composition_style: {
    style.stroke: "#3fb950"
    style.stroke-width: 2
    style.font-color: "#e6edf3"
  }
  association_style: {
    style.stroke: "#8b949e"
    style.stroke-dash: 3
    style.font-color: "#e6edf3"
  }
}

title: Signal Handling Data Structures {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

core_structures: Core Signal Structures {
  class: container_style
  
  signal_handler: SignalHandler {
    shape: class
    class: struct_style
    "- signal_num: int"
    "- handler_func: signal_handler_fn"
    "- flags: int"
    "- old_action: struct sigaction"
    "- is_registered: bool"
    "+ register_handler(): Result<()>"
    "+ unregister_handler(): Result<()>"
    "+ is_signal_safe(): bool"
  }
  
  signal_mask: SignalMask {
    shape: class
    class: struct_style
    "- mask: sigset_t"
    "- old_mask: sigset_t"
    "- is_applied: bool"
    "+ add_signal(sig: int): Result<()>"
    "+ remove_signal(sig: int): Result<()>"
    "+ apply_mask(): Result<()>"
    "+ restore_mask(): Result<()>"
    "+ contains_signal(sig: int): bool"
  }
}

event_integration: Event Integration {
  class: container_style
  
  pipe_notification: PipeNotification {
    shape: class
    class: struct_style
    "- read_fd: int"
    "- write_fd: int"
    "- is_initialized: bool"
    "- buffer: u8[256]"
    "+ create_pipe(): Result<()>"
    "+ write_signal(sig: int): Result<()>"
    "+ read_signals(): Result<Vec<int>>"
    "+ close_pipe(): Result<()>"
  }
  
  event_descriptor: EventDescriptor {
    shape: class
    class: struct_style
    "- fd: int"
    "- events: u32"
    "- handler: event_handler_fn"
    "- is_active: bool"
    "+ register_with_epoll(): Result<()>"
    "+ handle_event(events: u32): Result<()>"
    "+ deregister(): Result<()>"
  }
}

signal_handler -> signal_mask: uses {
  class: association_style
  label: blocks signals
}

signal_handler -> pipe_notification: notifies {
  class: composition_style
  label: self-pipe trick
}

pipe_notification -> event_descriptor: creates {
  class: composition_style
  label: read_fd
}

signal_mask -> event_descriptor: coordinates {
  class: association_style
  label: mask during events
}

relationships_note: |md
  **Key Relationships:**
  - SignalHandler uses SignalMask to block signals during critical sections
  - SignalHandler notifies PipeNotification via self-pipe trick
  - PipeNotification creates EventDescriptor for read_fd integration
  - SignalMask coordinates with EventDescriptor for safe event processing
| {
  shape: page
  near: bottom-center
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}