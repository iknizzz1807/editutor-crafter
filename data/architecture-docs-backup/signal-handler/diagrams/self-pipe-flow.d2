classes: {
  signal_process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  action: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
  }
  success: {
    style.fill: "#00b894"
    style.stroke: "#00cec9"
    style.font-color: "#ffffff"
  }
}

title: Self-Pipe Trick Flow {
  shape: text
  style.font-size: 18
  style.bold: true
  style.font-color: "#e6edf3"
  near: top-center
}

signal_handler: Signal Handler Flow {
  class: signal_process
  
  signal_received: Signal Received {
    class: action
  }
  
  pipe_check: Pipe Available? {
    shape: diamond
    class: decision
  }
  
  write_byte: Write Signal Byte\nto Pipe {
    class: action
  }
  
  check_result: Write\nSuccessful? {
    shape: diamond
    class: decision
  }
  
  handle_eagain: Handle EAGAIN\n(Pipe Full) {
    class: error
  }
  
  continue_handler: Continue\nExecution {
    class: success
  }
  
  signal_received -> pipe_check
  pipe_check -> write_byte: Yes
  pipe_check -> continue_handler: No
  write_byte -> check_result
  check_result -> continue_handler: Yes
  check_result -> handle_eagain: No (EAGAIN)
  handle_eagain -> continue_handler
}

event_loop: Event Loop Flow {
  class: signal_process
  
  poll_events: Poll for Events {
    class: action
  }
  
  pipe_readable: Pipe\nReadable? {
    shape: diamond
    class: decision
  }
  
  read_signal: Read Signal Byte\nfrom Pipe {
    class: action
  }
  
  process_signal: Process Signal\nin Safe Context {
    class: success
  }
  
  other_events: Handle Other\nEvents {
    class: action
  }
  
  poll_events -> pipe_readable
  pipe_readable -> read_signal: Yes
  pipe_readable -> other_events: No
  read_signal -> process_signal
  process_signal -> poll_events
  other_events -> poll_events
}

pipe_connection: Self-Pipe {
  shape: cylinder
  class: signal_process
}

signal_handler.write_byte -> pipe_connection: write()
pipe_connection -> event_loop.read_signal: read()