title: Garbage Collection Lifecycle {
  near: top-center
  style.font-size: 24
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  trigger: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  phase: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  decision: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  reset: {
    style.fill: "#2d1b69"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

start: Start {
  shape: circle
  class: trigger
}

heap_check: Check Heap\nUtilization {
  shape: diamond
  class: decision
}

threshold_check: Above\nThreshold? {
  shape: diamond
  class: decision
}

trigger_gc: Trigger GC\nCollection {
  class: trigger
}

pause_program: Pause Program\nExecution {
  class: phase
}

root_discovery: Root Discovery\nPhase {
  class: phase
}

mark_phase: Mark Phase\nTraverse Objects {
  class: phase
}

mark_complete: All Objects\nMarked? {
  shape: diamond
  class: decision
}

sweep_phase: Sweep Phase\nFree Unmarked {
  class: phase
}

sweep_complete: All Memory\nSwept? {
  shape: diamond
  class: decision
}

reset_marks: Reset Mark Bits {
  class: reset
}

resume_program: Resume Program\nExecution {
  class: phase
}

end: End {
  shape: circle
  class: reset
}

wait: Wait for Next\nAllocation {
  class: phase
}

start -> heap_check: Monitor

heap_check -> threshold_check: Check memory

threshold_check -> wait: No {
  style.stroke: "#8b949e"
}

threshold_check -> trigger_gc: Yes {
  style.stroke: "#3fb950"
  style.bold: true
}

trigger_gc -> pause_program

pause_program -> root_discovery: Find roots\n(stack, globals)

root_discovery -> mark_phase: Begin marking

mark_phase -> mark_complete: Traverse references

mark_complete -> mark_phase: No\nMore objects {
  style.stroke: "#8b949e"
}

mark_complete -> sweep_phase: Yes\nAll marked {
  style.stroke: "#3fb950"
}

sweep_phase -> sweep_complete: Free memory

sweep_complete -> sweep_phase: No\nMore blocks {
  style.stroke: "#8b949e"
}

sweep_complete -> reset_marks: Yes\nSweep done {
  style.stroke: "#3fb950"
}

reset_marks -> resume_program: Clear marks

resume_program -> end: Collection\ncomplete

end -> heap_check: Continue\nmonitoring

wait -> heap_check: Next allocation