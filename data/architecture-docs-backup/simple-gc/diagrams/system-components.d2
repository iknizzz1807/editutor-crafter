title: System Component Architecture

classes: {
  component: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  interface: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  core: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
    style.double-border: true
  }
}

allocator: Allocator {
  class: component
  alloc_interface: "allocate(size) -> *Object" {
    class: interface
  }
  metadata_interface: "set_metadata(obj, type)" {
    class: interface
  }
}

object_model: Object Model {
  class: core
  header: Object Header {
    class: interface
  }
  marking: "mark_bit: bool" {
    class: interface
  }
  refs: "get_references() -> []Object*" {
    class: interface
  }
}

root_discovery: Root Discovery {
  class: component
  scan_stack: "scan_stack_roots()" {
    class: interface
  }
  scan_globals: "scan_global_roots()" {
    class: interface
  }
  scan_registers: "scan_register_roots()" {
    class: interface
  }
}

mark_phase: Mark Phase {
  class: core
  mark_from_roots: "mark_from_roots(roots)" {
    class: interface
  }
  traverse: "traverse_object_graph()" {
    class: interface
  }
  mark_reachable: "mark_reachable(obj)" {
    class: interface
  }
}

sweep_phase: Sweep Phase {
  class: core
  sweep_heap: "sweep_heap()" {
    class: interface
  }
  free_unmarked: "free_unmarked_objects()" {
    class: interface
  }
  reset_marks: "reset_mark_bits()" {
    class: interface
  }
}

allocator -> object_model: creates objects with metadata
object_model -> mark_phase: provides reference traversal
root_discovery -> mark_phase: supplies root set
mark_phase -> object_model: sets mark bits
mark_phase -> sweep_phase: triggers after marking complete
sweep_phase -> object_model: reads mark bits
sweep_phase -> allocator: frees unmarked memory