title: Core Data Model Relationships

classes: {
  primary_entity: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  secondary_entity: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  relationship: {
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  self_ref: {
    style.stroke: "#d63031"
    style.font-color: "#ffffff"
    style.bold: true
  }
}

User: {
  shape: sql_table
  class: primary_entity
  id: "bigint PRIMARY KEY"
  username: "varchar(50) UNIQUE"
  email: "varchar(255) UNIQUE"
  display_name: "varchar(100)"
  bio: "text"
  avatar_url: "varchar(500)"
  is_verified: "boolean DEFAULT false"
  created_at: "timestamp"
  updated_at: "timestamp"
}

Post: {
  shape: sql_table
  class: primary_entity
  id: "bigint PRIMARY KEY"
  user_id: "bigint FOREIGN KEY"
  content: "text"
  image_url: "varchar(500)"
  like_count: "integer DEFAULT 0"
  comment_count: "integer DEFAULT 0"
  created_at: "timestamp"
  updated_at: "timestamp"
}

Follow: {
  shape: sql_table
  class: secondary_entity
  id: "bigint PRIMARY KEY"
  follower_id: "bigint FOREIGN KEY"
  following_id: "bigint FOREIGN KEY"
  created_at: "timestamp"
  
  note: |md
    **Self-referential relationship**
    Both FKs reference User.id
  | {
    shape: page
    style.fill: "#d63031"
    style.font-color: "#ffffff"
    near: top-right
  }
}

Like: {
  shape: sql_table
  class: secondary_entity
  id: "bigint PRIMARY KEY"
  user_id: "bigint FOREIGN KEY"
  post_id: "bigint FOREIGN KEY"
  created_at: "timestamp"
}

Comment: {
  shape: sql_table
  class: secondary_entity
  id: "bigint PRIMARY KEY"
  user_id: "bigint FOREIGN KEY"
  post_id: "bigint FOREIGN KEY"
  content: "text"
  created_at: "timestamp"
  updated_at: "timestamp"
}

Notification: {
  shape: sql_table
  class: secondary_entity
  id: "bigint PRIMARY KEY"
  user_id: "bigint FOREIGN KEY"
  type: "varchar(50)"
  message: "text"
  related_user_id: "bigint FOREIGN KEY"
  related_post_id: "bigint FOREIGN KEY"
  is_read: "boolean DEFAULT false"
  created_at: "timestamp"
}

# Primary relationships
User -> Post: "1:N creates" {
  class: relationship
}

User -> Like: "1:N" {
  class: relationship
}

User -> Comment: "1:N authors" {
  class: relationship
}

Post -> Like: "1:N receives" {
  class: relationship
}

Post -> Comment: "1:N has" {
  class: relationship
}

# Self-referential Follow relationship
User -> Follow: "1:N as follower" {
  class: self_ref
}

User -> Follow: "1:N as following" {
  class: self_ref
}

# Notification relationships
User -> Notification: "1:N receives" {
  class: relationship
}

User -> Notification: "1:N triggers" {
  class: relationship
}

Post -> Notification: "1:N mentioned in" {
  class: relationship
}

patterns_note: |md
  ## Key Patterns
  - **One-to-Many**: User→Posts, User→Comments, Post→Likes
  - **Self-Referential**: Follow table links Users to Users
  - **Junction Tables**: Follow, Like (resolve M:N relationships)
  - **Polymorphic**: Notifications reference multiple entity types
| {
  shape: page
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
  near: bottom-left
}