title: Parser Error Handling Flow

classes: {
  error_type: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  recovery: {
    style.fill: "#0f3460"
    style.stroke: "#74b9ff"
    style.font-color: "#e6edf3"
  }
}

start: Start Parsing {
  shape: circle
  style.fill: "#3fb950"
  style.font-color: "#ffffff"
}

parse_token: Parse Next Token {
  class: process
}

error_detected: Error\nDetected? {
  shape: diamond
  class: decision
}

classify_error: Classify Error Type {
  class: process
}

lexical_error: Lexical Error {
  shape: hexagon
  class: error_type
}

syntax_error: Syntax Error {
  shape: hexagon
  class: error_type
}

semantic_error: Semantic Error {
  shape: hexagon
  class: error_type
}

context_error: Context Error {
  shape: hexagon
  class: error_type
}

report_error: Report Error\nwith Location {
  class: process
}

can_recover: Can\nRecover? {
  shape: diamond
  class: decision
}

skip_strategy: Skip Invalid\nTokens {
  class: recovery
}

sync_strategy: Synchronize to\nNext Statement {
  class: recovery
}

substitute_strategy: Insert Missing\nToken {
  class: recovery
}

continue_parse: Continue\nParsing {
  class: process
}

more_tokens: More\nTokens? {
  shape: diamond
  class: decision
}

end_parse: End Parsing {
  shape: circle
  style.fill: "#e17055"
  style.font-color: "#ffffff"
}

error_summary: Generate Error\nSummary {
  class: process
}

start -> parse_token

parse_token -> error_detected

error_detected -> classify_error: Yes
error_detected -> more_tokens: No

classify_error -> lexical_error: Invalid character
classify_error -> syntax_error: Unexpected token
classify_error -> semantic_error: Type mismatch
classify_error -> context_error: Missing table

lexical_error -> report_error
syntax_error -> report_error
semantic_error -> report_error
context_error -> report_error

report_error -> can_recover

can_recover -> skip_strategy: Minor error
can_recover -> sync_strategy: Major error
can_recover -> substitute_strategy: Missing token
can_recover -> end_parse: Fatal error

skip_strategy -> continue_parse
sync_strategy -> continue_parse
substitute_strategy -> continue_parse

continue_parse -> more_tokens

more_tokens -> parse_token: Yes
more_tokens -> error_summary: No

error_summary -> end_parse