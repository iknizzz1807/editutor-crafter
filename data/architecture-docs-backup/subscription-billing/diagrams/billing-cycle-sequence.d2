direction: right

title: Monthly Billing Cycle Sequence {
  near: top-center
  style.font-size: 18
  style.bold: true
  style.font-color: "#e6edf3"
}

shape: sequence_diagram

billing_engine: Billing Engine {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

usage_tracker: Usage Tracker {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

proration_calc: Proration Calculator {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

invoice_gen: Invoice Generator {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

payment_proc: Payment Processor {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

billing_engine -> usage_tracker: Request usage data for billing period
usage_tracker -> billing_engine: Return aggregated usage metrics

billing_engine -> proration_calc: Calculate prorated amounts for plan changes
proration_calc -> billing_engine: Return proration calculations

billing_engine -> invoice_gen: Generate invoice with usage and prorations
invoice_gen -> billing_engine: Return invoice details

billing_engine -> payment_proc: Process payment for invoice amount
payment_proc -> billing_engine: Return payment confirmation

billing_engine -> invoice_gen: Mark invoice as paid
invoice_gen -> billing_engine: Confirm invoice status update

billing_engine -> usage_tracker: Reset usage counters for new cycle
usage_tracker -> billing_engine: Confirm counter reset