classes: {
  structure: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  buffer: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  state: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

title: Core Data Structures {
  near: top-center
  style.font-size: 20
  style.font-color: "#e6edf3"
}

Session: Session {
  shape: class
  class: structure
  - "id: u32"
  - "pid: Pid"
  - "pty_master: RawFd"
  - "panes: Vec<PaneId>"
  - "active_pane: PaneId"
  - "working_dir: PathBuf"
  + "new(command: &str): Result<Session>"
  + "add_pane(): PaneId"
  + "remove_pane(id: PaneId)"
  + "write_to_pty(data: &[u8])"
}

Pane: Pane {
  shape: class
  class: structure
  - "id: PaneId"
  - "session_id: u32"
  - "buffer: ScreenBuffer"
  - "terminal_state: TerminalState"
  - "layout: PaneLayout"
  - "is_active: bool"
  + "new(session_id: u32): Pane"
  + "resize(rows: u16, cols: u16)"
  + "process_output(data: &[u8])"
  + "render(): Vec<Cell>"
}

ScreenBuffer: ScreenBuffer {
  shape: class
  class: buffer
  - "cells: Vec<Vec<Cell>>"
  - "rows: u16"
  - "cols: u16"
  - "cursor_row: u16"
  - "cursor_col: u16"
  - "scroll_offset: u16"
  - "alternate_screen: bool"
  + "new(rows: u16, cols: u16): ScreenBuffer"
  + "write_char(ch: char, attr: Attributes)"
  + "scroll_up(lines: u16)"
  + "clear_screen()"
  + "get_visible_lines(): &[Vec<Cell>]"
}

TerminalState: TerminalState {
  shape: class
  class: state
  - "cursor_visible: bool"
  - "wrap_mode: bool"
  - "insert_mode: bool"
  - "auto_wrap: bool"
  - "application_keypad: bool"
  - "saved_cursor: CursorState"
  - "tab_stops: Vec<u16>"
  - "charset: CharacterSet"
  + "new(): TerminalState"
  + "save_cursor()"
  + "restore_cursor()"
  + "set_tab_stop(col: u16)"
  + "reset()"
}

Cell: Cell {
  shape: class
  class: buffer
  - "ch: char"
  - "fg_color: Color"
  - "bg_color: Color"
  - "bold: bool"
  - "italic: bool"
  - "underline: bool"
  - "reverse: bool"
}

PaneLayout: PaneLayout {
  shape: class
  class: structure
  - "x: u16"
  - "y: u16"
  - "width: u16"
  - "height: u16"
  - "border: bool"
}

Session -> Pane: "contains" {
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

Pane -> ScreenBuffer: "owns" {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

Pane -> TerminalState: "manages" {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

Pane -> PaneLayout: "positioned by" {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

ScreenBuffer -> Cell: "composed of" {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}