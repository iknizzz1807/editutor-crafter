classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  initial: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#ffffff"
  }
}

title: Escape Sequence Parser State Machine {
  near: top-center
  style.font-size: 18
  style.font-color: "#e6edf3"
  style.bold: true
}

init: {
  shape: circle
  label: ""
  class: initial
}

normal: Normal Text {
  shape: circle
  class: state
}

escape: ESC Detected {
  shape: circle
  class: state
}

csi_start: CSI Start {
  shape: circle
  class: state
}

param_parsing: Parameter Parsing {
  shape: circle
  class: state
}

command_ready: Command Ready {
  shape: circle
  class: state
}

error: Error State {
  shape: circle
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
}

init -> normal: Start {
  class: transition
}

normal -> normal: "Printable chars\n(display on screen)" {
  class: transition
}

normal -> escape: "ESC (0x1B)" {
  class: transition
}

escape -> normal: "Invalid sequence\n(print as text)" {
  class: transition
}

escape -> csi_start: "'[' character\n(CSI sequence)" {
  class: transition
}

escape -> command_ready: "Other escape\n(simple ESC cmd)" {
  class: transition
}

csi_start -> param_parsing: "Digit or ';'\n(parameters start)" {
  class: transition
}

csi_start -> command_ready: "Command letter\n(no parameters)" {
  class: transition
}

csi_start -> error: Invalid character {
  class: transition
}

param_parsing -> param_parsing: "Digits, ';', or ':'\n(continue parameters)" {
  class: transition
}

param_parsing -> command_ready: "Command letter\n(A-Z, a-z)" {
  class: transition
}

param_parsing -> error: Invalid character {
  class: transition
}

command_ready -> normal: "Execute command\nand reset" {
  class: transition
}

error -> normal: "Reset parser\n(skip invalid data)" {
  class: transition
}

legend: |md
  **Parser States:**
  - **Normal**: Processing printable text
  - **ESC Detected**: Found escape character (0x1B)
  - **CSI Start**: Found Control Sequence Introducer (ESC[)
  - **Parameter Parsing**: Collecting numeric parameters
  - **Command Ready**: Complete sequence, execute command
  - **Error**: Invalid sequence, reset and continue
| {
  shape: page
  near: bottom-right
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}