shape: sequence_diagram

client: Client Process
pty_mgr: PTY Manager
kernel: Kernel
shell: Shell Process
master_fd: Master FD
slave_fd: Slave FD

client -> pty_mgr: create_pty()
pty_mgr -> kernel: posix_openpt(O_RDWR | O_NOCTTY)
kernel -> pty_mgr: master_fd
pty_mgr -> kernel: grantpt(master_fd)
pty_mgr -> kernel: unlockpt(master_fd)
pty_mgr -> kernel: ptsname(master_fd)
kernel -> pty_mgr: slave_path (/dev/pts/N)

pty_mgr -> pty_mgr: fork()
pty_mgr -> shell: child process created
shell -> kernel: setsid()
kernel -> shell: new session leader
shell -> kernel: open(slave_path, O_RDWR)
kernel -> shell: slave_fd
shell -> kernel: ioctl(slave_fd, TIOCSCTTY)
shell -> shell: dup2(slave_fd, STDIN_FILENO)
shell -> shell: dup2(slave_fd, STDOUT_FILENO)
shell -> shell: dup2(slave_fd, STDERR_FILENO)
shell -> shell: close(slave_fd)
shell -> kernel: execve("/bin/bash", ...)
kernel -> shell: shell running

pty_mgr -> client: pty_info{master_fd, slave_path, pid}
client -> master_fd: write("ls -la\n")
master_fd -> slave_fd: input data
shell -> slave_fd: read input
shell -> slave_fd: write output
slave_fd -> master_fd: output data
master_fd -> client: read output

classes: {
  dark_theme: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

client.class: dark_theme
pty_mgr.class: dark_theme
kernel.class: dark_theme
shell.class: dark_theme
master_fd.class: dark_theme
slave_fd.class: dark_theme