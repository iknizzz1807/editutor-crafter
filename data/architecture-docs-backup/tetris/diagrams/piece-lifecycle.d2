title: Piece Lifecycle State Machine

classes: {
  initial_state: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#ffffff"
    style.bold: true
  }
  
  active_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  final_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
  }
  
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

init: {
  shape: circle
  class: initial_state
  label: ""
}

spawning: Spawning {
  shape: circle
  class: active_state
}

falling: Falling {
  shape: circle
  class: active_state
}

moving: Moving {
  shape: circle
  class: active_state
}

locking: Locking {
  shape: circle
  class: active_state
}

locked: Locked {
  shape: circle
  class: final_state
}

init -> spawning: piece created {
  class: transition
}

spawning -> falling: spawn complete {
  class: transition
}

falling -> moving: user input {
  class: transition
}

moving -> falling: input processed {
  class: transition
}

falling -> locking: collision detected {
  class: transition
}

moving -> locking: collision detected {
  class: transition
}

locking -> locked: lock delay expired {
  class: transition
}

locking -> moving: valid move input {
  class: transition
}

locking -> falling: valid move clears collision {
  class: transition
}

falling -> falling: gravity tick {
  class: transition
}

moving -> moving: valid move {
  class: transition
}