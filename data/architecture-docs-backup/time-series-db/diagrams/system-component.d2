title: TempoDB High-Level System Architecture

direction: right

# Main containers
client: {
  label: Client Applications
  shape: cloud
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

tempo_core: TempoDB Core System {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  # Write path components
  write_path: Write Path {
    style.fill: "#1a1a2e"
    
    http_api: HTTP API {
      shape: rectangle
      style.bold: true
      style.stroke: "#3fb950"
    }
    
    wal: Write-Ahead Log (WAL) {
      shape: page
      style.fill: "#1a1a2e"
    }
    
    memtable: Memtable {
      shape: rectangle
      style.fill: "#1a1a2e"
    }
  }
  
  # Storage components
  storage: Storage Engine {
    shape: cylinder
    style.fill: "#1a1a2e"
  }
  
  # Read/query components
  query: Query Engine {
    shape: diamond
    style.fill: "#1a1a2e"
  }
  
  # Background process
  compactor: Compactor {
    shape: hexagon
    style.fill: "#1a1a2e"
  }
}

# Client connections
client -> tempo_core.http_api: "Write Requests (HTTP/POST)"
client -> tempo_core.http_api: "Read Queries (HTTP/GET)"

# Write flow (solid arrows)
tempo_core.http_api -> tempo_core.wal: "1. Append to WAL"
tempo_core.wal -> tempo_core.memtable: "2. Write to Memtable"
tempo_core.memtable -> tempo_core.storage: "3. Flush to Storage (async)"

# Read flow (solid arrows)
tempo_core.http_api -> tempo_core.query: "Query Request"
tempo_core.query -> tempo_core.memtable: "Check recent data"
tempo_core.query -> tempo_core.storage: "Fetch from storage"

# Compaction process (dashed arrows)
tempo_core.compactor -> tempo_core.storage: "Compact & Compress" {
  style.stroke-dash: 3
}
tempo_core.storage -> tempo_core.compactor: "Read SSTables" {
  style.stroke-dash: 3
}

# Notes and labels
note: |md
  ## Key Characteristics
  - **Append-heavy writes**
  - **Time-ordered data**
  - **Periodic patterns enable compression**
  - **High write throughput required**
  - **Efficient range queries**
| {
  shape: page
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# Styling for all connections
connections.style.stroke: "#8b949e"
connections.style.font-color: "#8b949e"

# Container styling
tempo_core.style.border-radius: 5
client.style.border-radius: 5
write_path.style.border-radius: 5