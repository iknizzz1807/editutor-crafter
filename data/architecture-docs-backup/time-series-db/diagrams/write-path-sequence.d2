shape: sequence_diagram

client: Client {
  style.fill: "#16213e"
  style.font-color: "#e6edf3"
}
http_api: "HTTP API" {
  style.fill: "#16213e"
  style.font-color: "#e6edf3"
}
wal: "Write-Ahead Log (WAL)" {
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
  style.bold: true
}
memtable: "Memtable (In-Memory)" {
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
  style.bold: true
}
storage: "Storage Engine (TSM File)" {
  shape: cylinder
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
  style.bold: true
}

client -> http_api: 1. Write Request (Time-Series Data)
http_api -> http_api: 2. Validate & Structure
note: "Validate timestamp, series ID, field values" {
  shape: page
  style.fill: "#1a1a2e"
  style.font-color: "#8b949e"
}

http_api -> wal: 3. Append to Log (Immediate Durability)
wal --> http_api: 4. Log Write Confirmed

http_api -> memtable: 5. Insert into In-Memory Buffer
memtable --> http_api: 6. Insert Acknowledged

http_api -> client: 7. Write Acknowledged (Low Latency)

note: "Asynchronous Background Process" {
  shape: page
  style.fill: "#1a1a2e"
  style.font-color: "#8b949e"
}
memtable -> storage: 8. Flush to TSM File (Batched, Compressed)
note: "Triggered by size/time threshold" {
  shape: page
  style.fill: "#1a1a2e"
  style.font-color: "#8b949e"
}
storage --> memtable: 9. Flush Complete (Memory Cleared)