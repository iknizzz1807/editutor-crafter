classes: {
  base_module: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  attention_module: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  layer_module: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  full_model: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

nn_module: Module {
  shape: class
  class: base_module
  - "parameters: Dict"
  - "training: bool"
  + "forward(x: Tensor): Tensor"
  + "backward(grad: Tensor): Tensor"
}

embedding: Embedding {
  shape: class
  class: base_module
  - "vocab_size: int"
  - "d_model: int"
  - "weight: Tensor"
  + "forward(tokens: Tensor): Tensor"
}

pos_encoding: PositionalEncoding {
  shape: class
  class: base_module
  - "d_model: int"
  - "max_len: int"
  - "pe: Tensor"
  + "forward(x: Tensor): Tensor"
}

layer_norm: LayerNorm {
  shape: class
  class: base_module
  - "d_model: int"
  - "eps: float"
  - "gamma: Tensor"
  - "beta: Tensor"
  + "forward(x: Tensor): Tensor"
}

multi_head_attention: MultiHeadAttention {
  shape: class
  class: attention_module
  - "d_model: int"
  - "n_heads: int"
  - "d_k: int"
  - "w_q: Linear"
  - "w_k: Linear"
  - "w_v: Linear"
  - "w_o: Linear"
  + "forward(q: Tensor, k: Tensor, v: Tensor): Tensor"
  + "scaled_dot_product_attention(): Tensor"
}

feed_forward: FeedForward {
  shape: class
  class: base_module
  - "d_model: int"
  - "d_ff: int"
  - "w1: Linear"
  - "w2: Linear"
  + "forward(x: Tensor): Tensor"
}

encoder_layer: EncoderLayer {
  shape: class
  class: layer_module
  - "d_model: int"
  - "self_attention: MultiHeadAttention"
  - "feed_forward: FeedForward"
  - "norm1: LayerNorm"
  - "norm2: LayerNorm"
  - "dropout: float"
  + "forward(x: Tensor, mask: Tensor): Tensor"
}

decoder_layer: DecoderLayer {
  shape: class
  class: layer_module
  - "d_model: int"
  - "self_attention: MultiHeadAttention"
  - "cross_attention: MultiHeadAttention"
  - "feed_forward: FeedForward"
  - "norm1: LayerNorm"
  - "norm2: LayerNorm"
  - "norm3: LayerNorm"
  - "dropout: float"
  + "forward(x: Tensor, encoder_out: Tensor): Tensor"
}

encoder: Encoder {
  shape: class
  class: layer_module
  - "layers: List of EncoderLayer"
  - "num_layers: int"
  + "forward(x: Tensor, mask: Tensor): Tensor"
}

decoder: Decoder {
  shape: class
  class: layer_module
  - "layers: List of DecoderLayer"
  - "num_layers: int"
  + "forward(x: Tensor, encoder_out: Tensor): Tensor"
}

transformer: Transformer {
  shape: class
  class: full_model
  - "d_model: int"
  - "vocab_size: int"
  - "src_embedding: Embedding"
  - "tgt_embedding: Embedding"
  - "pos_encoding: PositionalEncoding"
  - "encoder: Encoder"
  - "decoder: Decoder"
  - "output_projection: Linear"
  + "forward(src: Tensor, tgt: Tensor): Tensor"
  + "encode(src: Tensor): Tensor"
  + "decode(tgt: Tensor, encoder_out: Tensor): Tensor"
}

nn_module -> embedding: inherits {
  style.stroke: "#8b949e"
}
nn_module -> pos_encoding: inherits {
  style.stroke: "#8b949e"
}
nn_module -> layer_norm: inherits {
  style.stroke: "#8b949e"
}
nn_module -> multi_head_attention: inherits {
  style.stroke: "#8b949e"
}
nn_module -> feed_forward: inherits {
  style.stroke: "#8b949e"
}
nn_module -> encoder_layer: inherits {
  style.stroke: "#8b949e"
}
nn_module -> decoder_layer: inherits {
  style.stroke: "#8b949e"
}
nn_module -> encoder: inherits {
  style.stroke: "#8b949e"
}
nn_module -> decoder: inherits {
  style.stroke: "#8b949e"
}
nn_module -> transformer: inherits {
  style.stroke: "#8b949e"
}

encoder_layer -> multi_head_attention: uses {
  style.stroke: "#3fb950"
}
encoder_layer -> feed_forward: uses {
  style.stroke: "#3fb950"
}
encoder_layer -> layer_norm: uses {
  style.stroke: "#3fb950"
}

decoder_layer -> multi_head_attention: uses {
  style.stroke: "#3fb950"
}
decoder_layer -> feed_forward: uses {
  style.stroke: "#3fb950"
}
decoder_layer -> layer_norm: uses {
  style.stroke: "#3fb950"
}

encoder -> encoder_layer: uses {
  style.stroke: "#3fb950"
}
decoder -> decoder_layer: uses {
  style.stroke: "#3fb950"
}

transformer -> embedding: uses {
  style.stroke: "#3fb950"
}
transformer -> pos_encoding: uses {
  style.stroke: "#3fb950"
}
transformer -> encoder: uses {
  style.stroke: "#3fb950"
}
transformer -> decoder: uses {
  style.stroke: "#3fb950"
}