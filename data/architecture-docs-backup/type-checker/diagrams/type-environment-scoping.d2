title: Type Environment Scoping {
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
  near: top-center
}

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  final_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
    style.double-border: true
  }
  
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#8b949e"
  }
  
  important_transition: {
    style.stroke: "#3fb950"
    style.font-color: "#3fb950"
    style.bold: true
  }
}

init: {
  shape: circle
  style.fill: "#3fb950"
  label: ""
}

global_env: Global Environment {
  shape: circle
  class: state
}

function_entry: Function Entry {
  shape: circle
  class: state
}

param_binding: Parameter Binding {
  shape: circle
  class: state
}

body_checking: Body Checking {
  shape: circle
  class: state
}

nested_scope: Nested Scope {
  shape: circle
  class: state
}

block_entry: Block Entry {
  shape: circle
  class: state
}

local_binding: Local Binding {
  shape: circle
  class: state
}

scope_exit: Scope Exit {
  shape: circle
  class: state
}

function_exit: Function Exit {
  shape: circle
  class: final_state
}

init -> global_env: start {
  class: important_transition
}

global_env -> function_entry: enter function {
  class: transition
}

function_entry -> param_binding: extend env with params {
  class: important_transition
}

param_binding -> body_checking: params bound {
  class: transition
}

body_checking -> nested_scope: encounter block {
  class: transition
}

body_checking -> function_exit: function complete {
  class: transition
}

nested_scope -> block_entry: push new scope {
  class: important_transition
}

block_entry -> local_binding: declare variable {
  class: transition
}

local_binding -> local_binding: more declarations {
  class: transition
}

local_binding -> nested_scope: nested block {
  class: transition
}

local_binding -> scope_exit: block end {
  class: transition
}

scope_exit -> body_checking: restore env {
  class: important_transition
}

nested_scope -> scope_exit: no declarations {
  class: transition
}

block_entry -> scope_exit: empty block {
  class: transition
}

env_note: |md
  **Environment Operations:**
  - Push: Create new scope layer
  - Bind: Add variable to current scope
  - Lookup: Search from inner to outer
  - Pop: Restore previous scope
| {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: bottom-right
}