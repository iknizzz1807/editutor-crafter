title: Version Pruning Algorithm

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  action: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  trigger: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
}

start: Start Pruning {
  shape: circle
  class: process
}

check_trigger: Memory Usage > Threshold? {
  shape: diamond
  class: decision
}

select_versions: Select Version Set\nfor Analysis {
  shape: rectangle
  class: action
}

analyze_dominance: Check Version\nDominance {
  shape: diamond
  class: decision
}

mark_dominated: Mark as\nDominated {
  shape: rectangle
  class: action
}

check_concurrent: Has Concurrent\nVersions? {
  shape: diamond
  class: decision
}

preserve_concurrent: Preserve for\nConflict Detection {
  shape: rectangle
  class: action
}

gc_trigger: GC Trigger\nCondition Met? {
  shape: diamond
  class: trigger
}

batch_removal: Batch Remove\nDominated Versions {
  shape: rectangle
  class: action
}

update_metadata: Update Version\nMetadata {
  shape: rectangle
  class: action
}

check_complete: More Versions\nto Process? {
  shape: diamond
  class: decision
}

cleanup: Cleanup and\nCompact Storage {
  shape: rectangle
  class: action
}

end: Pruning Complete {
  shape: circle
  class: process
}

memory_alert: Memory\nPressure Alert {
  shape: rectangle
  class: trigger
}

start -> check_trigger
memory_alert -> check_trigger: triggers

check_trigger -> select_versions: Yes
check_trigger -> end: No

select_versions -> analyze_dominance

analyze_dominance -> mark_dominated: Is Dominated
analyze_dominance -> check_concurrent: Not Dominated

mark_dominated -> gc_trigger

check_concurrent -> preserve_concurrent: Yes
check_concurrent -> gc_trigger: No

preserve_concurrent -> check_complete

gc_trigger -> batch_removal: Yes
gc_trigger -> check_complete: No

batch_removal -> update_metadata
update_metadata -> check_complete

check_complete -> select_versions: Yes
check_complete -> cleanup: No

cleanup -> end