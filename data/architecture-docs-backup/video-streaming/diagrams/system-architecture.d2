title: System Architecture Overview {
  near: top-center
  style.font-size: 24
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.stroke-width: 2
  }
  service: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  storage: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  client: {
    style.fill: "#2d3748"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

upload_service: Upload Service {
  shape: rectangle
  class: container
  
  api: Upload API {
    class: service
  }
  
  chunk_handler: Chunk Handler {
    class: service
  }
  
  api -> chunk_handler: process chunks
}

transcoding_pipeline: Transcoding Pipeline {
  shape: rectangle
  class: container
  
  queue: Job Queue {
    shape: queue
    class: service
  }
  
  transcoder: Video Transcoder {
    class: service
  }
  
  packager: HLS Packager {
    class: service
  }
  
  queue -> transcoder: transcode job
  transcoder -> packager: encoded video
}

streaming_service: Streaming Service {
  shape: rectangle
  class: container
  
  cdn: CDN Edge {
    class: service
  }
  
  manifest: Manifest API {
    class: service
  }
  
  manifest -> cdn: serve segments
}

player_client: Player Client {
  class: client
}

raw_storage: Raw Video Storage {
  shape: cylinder
  class: storage
}

processed_storage: Processed Video Storage {
  shape: cylinder
  class: storage
}

metadata_db: Metadata Database {
  shape: cylinder
  class: storage
}

player_client -> upload_service: upload video {
  style.stroke: "#8b949e"
  style.stroke-width: 2
}

upload_service -> raw_storage: store raw video {
  style.stroke: "#8b949e"
}

upload_service -> transcoding_pipeline: trigger transcoding {
  style.stroke: "#8b949e"
  style.stroke-width: 2
}

transcoding_pipeline -> raw_storage: read raw video {
  style.stroke: "#8b949e"
}

transcoding_pipeline -> processed_storage: store HLS segments {
  style.stroke: "#8b949e"
  style.stroke-width: 2
}

transcoding_pipeline -> metadata_db: update job status {
  style.stroke: "#8b949e"
}

player_client -> streaming_service: request stream {
  style.stroke: "#3fb950"
  style.stroke-width: 3
}

streaming_service -> processed_storage: fetch segments {
  style.stroke: "#3fb950"
  style.stroke-width: 2
}

streaming_service -> metadata_db: get manifest data {
  style.stroke: "#8b949e"
}