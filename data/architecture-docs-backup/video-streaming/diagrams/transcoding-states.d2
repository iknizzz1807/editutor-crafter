classes: {
  state_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  final_state_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
  }
  error_state_style: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  init_state_style: {
    style.fill: "#3fb950"
    style.stroke: "#2d8f47"
    label: ""
  }
  transition_style: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  error_transition_style: {
    style.stroke: "#d63031"
    style.font-color: "#d63031"
  }
}

title: Transcoding Job State Machine {
  style.font-size: 24
  style.font-color: "#e6edf3"
  style.bold: true
}

init: {
  shape: circle
  class: init_state_style
}

pending: Pending {
  shape: circle
  class: state_style
}

processing: Processing {
  shape: circle
  class: state_style
}

completed: Completed {
  shape: circle
  class: final_state_style
}

failed: Failed {
  shape: circle
  class: error_state_style
}

cancelled: Cancelled {
  shape: circle
  class: final_state_style
}

retry_pending: Retry Pending {
  shape: circle
  class: state_style
}

init -> pending: job created {
  class: transition_style
}

pending -> processing: worker picks up job {
  class: transition_style
}

pending -> cancelled: user cancels job {
  class: error_transition_style
}

processing -> completed: FFmpeg succeeds\nHLS segments generated {
  class: transition_style
}

processing -> failed: FFmpeg error\nmax retries exceeded {
  class: error_transition_style
}

processing -> retry_pending: transient error\nretries available {
  class: error_transition_style
}

retry_pending -> processing: worker retries job {
  class: transition_style
}

retry_pending -> failed: max retries reached {
  class: error_transition_style
}

retry_pending -> cancelled: user cancels job {
  class: error_transition_style
}

failed -> pending: admin requeues job {
  class: transition_style
}

notes: |md
  **State Transitions:**
  - Jobs start in **Pending** state
  - **Processing** handles FFmpeg transcoding
  - **Retry Pending** allows graceful error recovery
  - **Failed** state for permanent failures
  - **Completed** when HLS output ready
| {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: bottom-right
}