title: Virtual and Physical Memory Layout

classes: {
  virtual_region: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  physical_frame: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  page_table: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  mapping_arrow: {
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

virtual_space: Virtual Address Space {
  class: virtual_region
  
  code_segment: Code Segment {
    class: virtual_region
    label: "VPN 0-50\n0x00000000-0x00032000"
  }
  
  data_segment: Data Segment {
    class: virtual_region
    label: "VPN 51-100\n0x00033000-0x00064000"
  }
  
  heap: Heap {
    class: virtual_region
    label: "VPN 101-200\n0x00065000-0x000C8000"
  }
  
  stack: Stack {
    class: virtual_region
    label: "VPN 900-1023\n0x00384000-0x003FF000"
  }
}

page_table_container: Page Table {
  class: page_table
  
  pte_0: "PTE 0: Frame 5, Valid" {
    class: page_table
  }
  
  pte_51: "PTE 51: Frame 12, Valid" {
    class: page_table
  }
  
  pte_101: "PTE 101: Frame 3, Valid" {
    class: page_table
  }
  
  pte_102: "PTE 102: Invalid (Swapped)" {
    class: page_table
    style.stroke: "#d63031"
  }
  
  pte_900: "PTE 900: Frame 8, Valid" {
    class: page_table
  }
}

physical_memory: Physical Memory {
  class: physical_frame
  
  frame_3: "Frame 3\n0x3000-0x3FFF" {
    class: physical_frame
  }
  
  frame_5: "Frame 5\n0x5000-0x5FFF" {
    class: physical_frame
  }
  
  frame_8: "Frame 8\n0x8000-0x8FFF" {
    class: physical_frame
  }
  
  frame_12: "Frame 12\n0xC000-0xCFFF" {
    class: physical_frame
  }
}

swap_space: Swap Space {
  style.fill: "#2d1b69"
  style.stroke: "#6c5ce7"
  style.font-color: "#e6edf3"
  
  swap_block: "Swapped Page\nVPN 102 Data" {
    style.fill: "#2d1b69"
    style.stroke: "#6c5ce7"
    style.font-color: "#e6edf3"
  }
}

virtual_space.code_segment -> page_table_container.pte_0: "VPN 0" {
  class: mapping_arrow
}

virtual_space.data_segment -> page_table_container.pte_51: "VPN 51" {
  class: mapping_arrow
}

virtual_space.heap -> page_table_container.pte_101: "VPN 101" {
  class: mapping_arrow
}

virtual_space.heap -> page_table_container.pte_102: "VPN 102" {
  class: mapping_arrow
  style.stroke: "#d63031"
}

virtual_space.stack -> page_table_container.pte_900: "VPN 900" {
  class: mapping_arrow
}

page_table_container.pte_0 -> physical_memory.frame_5: "Frame 5" {
  class: mapping_arrow
}

page_table_container.pte_51 -> physical_memory.frame_12: "Frame 12" {
  class: mapping_arrow
}

page_table_container.pte_101 -> physical_memory.frame_3: "Frame 3" {
  class: mapping_arrow
}

page_table_container.pte_102 -> swap_space.swap_block: "Page Fault" {
  style.stroke: "#d63031"
  style.stroke-dash: 3
  style.font-color: "#d63031"
}

page_table_container.pte_900 -> physical_memory.frame_8: "Frame 8" {
  class: mapping_arrow
}

address_note: |md
  ## Address Translation
  **Virtual Address:** VPN + Offset
  **Physical Address:** Frame + Offset
  
  **Page Size:** 4KB (0x1000 bytes)
  **VPN:** Bits 31-12
  **Offset:** Bits 11-0
| {
  shape: page
  near: top-right
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}