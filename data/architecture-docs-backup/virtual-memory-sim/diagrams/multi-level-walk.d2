direction: right

classes: {
  address: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  table: {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  frame: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

virtual_addr: Virtual Address\n0x12345678 {
  class: address
  shape: rectangle
}

split: Address Split {
  class: process
  shape: diamond
}

dir_index: Directory Index\n(bits 31-22)\n0x048 {
  class: address
  shape: rectangle
}

table_index: Table Index\n(bits 21-12)\n0x345 {
  class: address
  shape: rectangle
}

offset: Page Offset\n(bits 11-0)\n0x678 {
  class: address
  shape: rectangle
}

page_directory: Page Directory {
  class: table
  shape: rectangle
  entry0: Entry 0
  entry72: Entry 72 (0x048) {
    style.fill: "#3fb950"
    style.font-color: "#000"
  }
  entryN: Entry N
}

page_table: Page Table {
  class: table
  shape: rectangle
  entry0: Entry 0
  entry837: Entry 837 (0x345) {
    style.fill: "#3fb950"
    style.font-color: "#000"
  }
  entryM: Entry M
}

physical_frame: Physical Frame\n0xABC000 + 0x678\n= 0xABC678 {
  class: frame
  shape: rectangle
}

cr3: CR3 Register\n(Page Dir Base) {
  class: address
  shape: oval
}

virtual_addr -> split: Parse
split -> dir_index: Extract
split -> table_index: Extract  
split -> offset: Extract

cr3 -> page_directory: Points to

dir_index -> page_directory.entry72: Index into
page_directory.entry72 -> page_table: PTE points to

table_index -> page_table.entry837: Index into
page_table.entry837 -> physical_frame: PFN + offset

offset -> physical_frame: Add to base

note: |md
  **Two-Level Page Table Walk:**
  1. Split virtual address into components
  2. Use directory index to find page table
  3. Use table index to find physical frame
  4. Add offset to get final physical address
| {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  near: bottom-center
}