title: ARIES Recovery Process

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  phase: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  data: {
    style.fill: "#2d3748"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

start: {
  shape: circle
  style.fill: "#3fb950"
  label: "START"
  class: process
}

crash_detected: Crash Detected {
  class: process
}

analysis_phase: {
  title: "ANALYSIS PHASE"
  class: phase
  
  scan_log: Scan WAL Forward {
    class: process
  }
  
  build_att: Build Active Transaction Table {
    class: process
  }
  
  build_dpt: Build Dirty Page Table {
    class: process
  }
  
  find_checkpoint: Find Last Checkpoint {
    class: process
  }
}

redo_phase: {
  title: "REDO PHASE"
  class: phase
  
  find_redo_point: Find Redo Point {
    class: process
  }
  
  scan_forward: Scan Log Forward {
    class: process
  }
  
  check_redo: Page in DPT? {
    shape: diamond
    class: decision
  }
  
  apply_redo: Apply Redo Operation {
    class: process
  }
  
  write_clr: Write CLR {
    class: process
  }
}

undo_phase: {
  title: "UNDO PHASE"
  class: phase
  
  check_active: Active Transactions? {
    shape: diamond
    class: decision
  }
  
  find_last_lsn: Find Largest LSN {
    class: process
  }
  
  undo_operation: Undo Operation {
    class: process
  }
  
  write_clr_undo: Write CLR {
    class: process
  }
  
  remove_txn: Remove from ATT {
    class: process
  }
}

complete: {
  shape: circle
  style.fill: "#3fb950"
  style.double-border: true
  label: "COMPLETE"
  class: process
}

att: Active Transaction Table {
  class: data
  shape: page
}

dpt: Dirty Page Table {
  class: data
  shape: page
}

start -> crash_detected

crash_detected -> analysis_phase.find_checkpoint: Begin Recovery

analysis_phase.find_checkpoint -> analysis_phase.scan_log
analysis_phase.scan_log -> analysis_phase.build_att
analysis_phase.build_att -> analysis_phase.build_dpt
analysis_phase.build_dpt -> att: Creates
analysis_phase.build_dpt -> dpt: Creates

analysis_phase.build_dpt -> redo_phase.find_redo_point: Analysis Complete

redo_phase.find_redo_point -> redo_phase.scan_forward: Start from oldest dirty page
redo_phase.scan_forward -> redo_phase.check_redo: For each log record

redo_phase.check_redo -> redo_phase.apply_redo: Yes
redo_phase.check_redo -> redo_phase.scan_forward: No

redo_phase.apply_redo -> redo_phase.write_clr
redo_phase.write_clr -> redo_phase.scan_forward: Continue

redo_phase.scan_forward -> undo_phase.check_active: End of log reached

undo_phase.check_active -> undo_phase.find_last_lsn: Yes
undo_phase.check_active -> complete: No

undo_phase.find_last_lsn -> undo_phase.undo_operation: Process highest LSN
undo_phase.undo_operation -> undo_phase.write_clr_undo
undo_phase.write_clr_undo -> undo_phase.remove_txn
undo_phase.remove_txn -> undo_phase.check_active: Continue with remaining

att -> redo_phase.check_redo: Referenced by
dpt -> redo_phase.check_redo: Referenced by
att -> undo_phase.check_active: Referenced by