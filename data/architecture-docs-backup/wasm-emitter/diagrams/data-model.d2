classes: {
  type_class: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  ir_class: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  binary_class: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

title: WebAssembly Data Model and Type Relationships {
  near: top-center
  style.font-size: 18
  style.bold: true
  style.font-color: "#e6edf3"
}

types: Type System {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"

  ValueType: ValueType {
    shape: class
    class: type_class
    - "variant: ValueTypeVariant"
    + "is_numeric(): bool"
    + "size_bytes(): u32"
    + "encode(writer: &mut Writer)"
  }

  FunctionType: FunctionType {
    shape: class
    class: type_class
    - "params: Vec<ValueType>"
    - "results: Vec<ValueType>"
    + "new(params: Vec<ValueType>, results: Vec<ValueType>): Self"
    + "encode(writer: &mut Writer)"
    + "param_count(): usize"
  }

  ValueTypeVariant: ValueTypeVariant {
    shape: class
    class: type_class
    - "I32: i32"
    - "I64: i64"
    - "F32: f32"
    - "F64: f64"
  }
}

ir: Intermediate Representation {
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"

  Expression: Expression {
    shape: class
    class: ir_class
    - "instructions: Vec<Instruction>"
    - "result_type: Option<ValueType>"
    + "new(): Self"
    + "push(instr: Instruction)"
    + "compile(): Vec<u8>"
  }

  Instruction: Instruction {
    shape: class
    class: ir_class
    - "opcode: u8"
    - "operands: Vec<Operand>"
    + "encode(): Vec<u8>"
    + "stack_effect(): (u32, u32)"
  }

  LocalVariable: LocalVariable {
    shape: class
    class: ir_class
    - "index: u32"
    - "value_type: ValueType"
    + "new(index: u32, value_type: ValueType): Self"
  }
}

binary: Binary Format {
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"

  Module: Module {
    shape: class
    class: binary_class
    - "sections: Vec<Section>"
    - "magic: u32"
    - "version: u32"
    + "new(): Self"
    + "add_section(section: Section)"
    + "emit(): Vec<u8>"
  }

  Section: Section {
    shape: class
    class: binary_class
    - "section_type: SectionType"
    - "content: Vec<u8>"
    + "new(section_type: SectionType): Self"
    + "encode(): Vec<u8>"
    + "size(): u32"
  }

  SectionType: SectionType {
    shape: class
    class: binary_class
    - "Type: 1"
    - "Function: 3"
    - "Code: 10"
    - "Export: 7"
  }
}

FunctionType -> ValueType: uses
Expression -> Instruction: contains
Expression -> ValueType: produces
LocalVariable -> ValueType: typed by
Module -> Section: contains
Section -> FunctionType: encodes
Section -> Expression: encodes
Instruction -> ValueType: operates on

types -> ir: "defines semantics"
ir -> binary: "compiles to"