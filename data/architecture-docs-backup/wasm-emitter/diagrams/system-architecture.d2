classes: {
  container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  compiler: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  output: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

title: WebAssembly Emitter System Architecture {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

ast_input: AST Input {
  shape: page
  class: output
}

pipeline: Compilation Pipeline {
  class: container
  
  binary_emitter: Binary Format Emitter {
    class: compiler
    shape: rectangle
  }
  
  expr_compiler: Expression Compiler {
    class: compiler
    shape: rectangle
  }
  
  control_compiler: Control Flow Compiler {
    class: compiler
    shape: rectangle
  }
  
  function_system: Function System {
    class: compiler
    shape: rectangle
  }
  
  binary_emitter -> expr_compiler: coordinates
  binary_emitter -> control_compiler: manages
  binary_emitter -> function_system: orchestrates
  expr_compiler -> control_compiler: provides expressions
  control_compiler -> function_system: structured blocks
}

wasm_binary: WebAssembly Binary {
  shape: cylinder
  class: output
}

ast_input -> pipeline.binary_emitter: parse tree
pipeline.binary_emitter -> wasm_binary: encoded output

pipeline.expr_compiler -> pipeline.expr_compiler: stack management {
  style.stroke-dash: 3
  style.font-color: "#8b949e"
}

pipeline.control_compiler -> pipeline.control_compiler: block structure {
  style.stroke-dash: 3
  style.font-color: "#8b949e"
}

pipeline.function_system -> pipeline.function_system: local variables {
  style.stroke-dash: 3
  style.font-color: "#8b949e"
}