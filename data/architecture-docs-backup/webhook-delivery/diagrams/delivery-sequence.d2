shape: sequence_diagram

classes: {
  actor_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  system_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

Event Source: Event Source {
  class: actor_style
}

Ingestion API: Ingestion API {
  class: system_style
}

Message Queue: Message Queue {
  class: system_style
}

Delivery Worker: Delivery Worker {
  class: system_style
}

Target Endpoint: Target Endpoint {
  class: actor_style
}

Retry Handler: Retry Handler {
  class: system_style
}

Dead Letter Queue: Dead Letter Queue {
  class: system_style
}

Event Source -> Ingestion API: POST /webhook/event
Ingestion API -> Message Queue: enqueue event
Message Queue -> Delivery Worker: consume event
Delivery Worker -> Target Endpoint: POST webhook payload
Target Endpoint -> Delivery Worker: HTTP 500 (failure)
Delivery Worker -> Retry Handler: schedule retry
Retry Handler -> Message Queue: requeue with delay
Message Queue -> Delivery Worker: consume retry attempt
Delivery Worker -> Target Endpoint: POST webhook payload (retry)
Target Endpoint -> Delivery Worker: HTTP 200 (success)
Delivery Worker -> Message Queue: ack message
Delivery Worker -> Target Endpoint: POST webhook payload (another event)
Target Endpoint -> Delivery Worker: timeout
Delivery Worker -> Retry Handler: schedule retry
Retry Handler -> Retry Handler: exponential backoff calculation
Retry Handler -> Message Queue: requeue with longer delay
Message Queue -> Delivery Worker: consume final retry
Delivery Worker -> Target Endpoint: POST webhook payload (final attempt)
Target Endpoint -> Delivery Worker: HTTP 500 (failure)
Delivery Worker -> Dead Letter Queue: move to DLQ
Dead Letter Queue -> Delivery Worker: manual retry triggered
Delivery Worker -> Target Endpoint: POST webhook payload
Target Endpoint -> Delivery Worker: HTTP 200 (success)