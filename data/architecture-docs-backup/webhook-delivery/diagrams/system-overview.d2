direction: right

# Core Components
webhook_registry: Webhook Registry {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

delivery_engine: Delivery Engine {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

message_queue: Message Queue {
  shape: queue
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

circuit_breaker: Circuit Breaker {
  shape: hexagon
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

event_logging: Event Logging {
  shape: cylinder
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# External Components
incoming_events: Incoming Events {
  shape: cloud
  style.fill: "#2d3748"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

webhook_endpoints: Webhook Endpoints {
  shape: cloud
  style.fill: "#2d3748"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

# Primary Data Flows
incoming_events -> webhook_registry: Event Registration
webhook_registry -> message_queue: Enqueue Events
message_queue -> delivery_engine: Pull Events
delivery_engine -> circuit_breaker: Check Endpoint Health
circuit_breaker -> webhook_endpoints: HTTP POST
webhook_endpoints -> delivery_engine: Response/Timeout
delivery_engine -> event_logging: Log Delivery Status
circuit_breaker -> event_logging: Log Circuit State

# Retry Flows
delivery_engine -> message_queue: Re-queue Failed Events {
  style.stroke-dash: 3
  style.stroke: "#e17055"
}

# Health Monitoring
delivery_engine -> circuit_breaker: Update Health Metrics {
  style.stroke: "#fdcb6e"
}

# Arrow styling
incoming_events -> webhook_registry: {
  style.stroke: "#8b949e"
}
webhook_registry -> message_queue: {
  style.stroke: "#8b949e"
}
message_queue -> delivery_engine: {
  style.stroke: "#8b949e"
}
delivery_engine -> circuit_breaker: {
  style.stroke: "#8b949e"
}
circuit_breaker -> webhook_endpoints: {
  style.stroke: "#8b949e"
}
webhook_endpoints -> delivery_engine: {
  style.stroke: "#8b949e"
}
delivery_engine -> event_logging: {
  style.stroke: "#8b949e"
}
circuit_breaker -> event_logging: {
  style.stroke: "#8b949e"
}