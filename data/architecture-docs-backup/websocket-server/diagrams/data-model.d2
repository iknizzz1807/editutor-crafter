title: WebSocket Data Model

classes: {
  primary: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  secondary: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  arrow: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

Connection: {
  shape: class
  class: primary
  - "id: string"
  - "client_socket: Socket"
  - "state: ConnectionState"
  - "last_ping: Timestamp"
  - "last_pong: Timestamp"
  - "message_buffer: byte[]"
  - "partial_frame: Frame"
  - "created_at: Timestamp"
  - "is_alive: boolean"
  + "send_frame(frame: Frame): void"
  + "send_message(message: Message): void"
  + "close(): void"
  + "is_healthy(): boolean"
}

Frame: {
  shape: class
  class: primary
  - "fin: boolean"
  - "rsv1: boolean"
  - "rsv2: boolean"
  - "rsv3: boolean"
  - "opcode: OpCode"
  - "masked: boolean"
  - "payload_length: long"
  - "masking_key: byte[4]"
  - "payload: byte[]"
  + "encode(): byte[]"
  + "decode(data: byte[]): Frame"
  + "is_control_frame(): boolean"
  + "is_data_frame(): boolean"
}

Message: {
  shape: class
  class: primary
  - "type: MessageType"
  - "content: byte[]"
  - "text_content: string"
  - "timestamp: Timestamp"
  - "connection_id: string"
  - "fragmented: boolean"
  - "complete: boolean"
  + "to_text(): string"
  + "to_binary(): byte[]"
  + "is_complete(): boolean"
  + "add_fragment(frame: Frame): void"
}

HandshakeRequest: {
  shape: class
  class: primary
  - "method: string"
  - "path: string"
  - "version: string"
  - "headers: Map<string, string>"
  - "websocket_key: string"
  - "websocket_version: string"
  - "websocket_protocol: string"
  - "origin: string"
  + "validate(): boolean"
  + "generate_accept_key(): string"
  + "get_header(name: string): string"
  + "is_valid_websocket(): boolean"
}

OpCode: {
  shape: class
  class: secondary
  - "CONTINUATION: 0x0"
  - "TEXT: 0x1"
  - "BINARY: 0x2"
  - "CLOSE: 0x8"
  - "PING: 0x9"
  - "PONG: 0xA"
}

ConnectionState: {
  shape: class
  class: secondary
  - "CONNECTING: string"
  - "OPEN: string"
  - "CLOSING: string"
  - "CLOSED: string"
}

MessageType: {
  shape: class
  class: secondary
  - "TEXT: string"
  - "BINARY: string"
  - "PING: string"
  - "PONG: string"
  - "CLOSE: string"
}

Connection -> Frame: {
  label: "sends/receives"
  class: arrow
}

Connection -> Message: {
  label: "assembles"
  class: arrow
}

Connection -> HandshakeRequest: {
  label: "created from"
  class: arrow
}

Frame -> OpCode: {
  label: "uses"
  class: arrow
}

Message -> MessageType: {
  label: "categorized by"
  class: arrow
}

Connection -> ConnectionState: {
  label: "tracks"
  class: arrow
}

Frame -> Message: {
  label: "assembled into"
  class: arrow
}