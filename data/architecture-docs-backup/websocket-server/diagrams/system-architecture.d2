title: System Architecture Overview

classes: {
  component: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  phase: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  data_flow: {
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

http_phase: HTTP Upgrade Phase {
  class: phase
  
  client: Client Browser {
    class: component
  }
  
  handshake: Handshake Handler {
    class: component
  }
  
  client -> handshake: HTTP Upgrade Request {
    class: data_flow
  }
  
  handshake -> client: 101 Switching Protocols {
    class: data_flow
  }
}

websocket_phase: WebSocket Communication Phase {
  class: phase
  
  frame_parser: Frame Parser {
    class: component
  }
  
  connection_mgr: Connection Manager {
    class: component
  }
  
  heartbeat: Heartbeat System {
    class: component
  }
  
  frame_parser <-> connection_mgr: Parsed Messages {
    class: data_flow
  }
  
  connection_mgr <-> heartbeat: Connection State {
    class: data_flow
  }
  
  heartbeat -> frame_parser: Ping/Pong Frames {
    class: data_flow
  }
}

http_phase.handshake -> websocket_phase.connection_mgr: Established Connection {
  class: data_flow
  style.stroke-dash: 3
}

websocket_phase.connection_mgr -> websocket_phase.frame_parser: Raw WebSocket Data {
  class: data_flow
}

websocket_phase.frame_parser -> http_phase.client: Framed Messages {
  class: data_flow
}

http_phase.client -> websocket_phase.frame_parser: Incoming Frames {
  class: data_flow
}