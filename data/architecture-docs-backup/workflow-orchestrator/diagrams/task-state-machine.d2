title: Task Instance State Machine

# Initial state
init: {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
  label: ""
  width: 20
  height: 20
}

# States
queued: {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  label: "QUEUED"
}

running: {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  label: "RUNNING"
}

success: {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.double-border: true
  label: "SUCCESS"
}

failed: {
  shape: circle
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
  style.double-border: true
  label: "FAILED"
}

retry: {
  shape: circle
  style.fill: "#fdcb6e"
  style.stroke: "#e84393"
  style.font-color: "#2d3436"
  label: "RETRY"
}

# State transitions
init -> queued: task created
queued -> running: worker assigned
running -> success: task completed
running -> failed: task error
running -> retry: recoverable error
retry -> queued: retry attempt
failed -> queued: manual restart
queued -> failed: validation error

# Self-loop for retry logic
retry -> retry: {
  label: "max retries not reached"
  style.stroke-dash: 3
  style.stroke: "#8b949e"
}

# Connection styling
init -> queued: {
  style.stroke: "#3fb950"
}
queued -> running: {
  style.stroke: "#3fb950"
}
running -> success: {
  style.stroke: "#00b894"
}
running -> failed: {
  style.stroke: "#d63031"
}
running -> retry: {
  style.stroke: "#fdcb6e"
}
retry -> queued: {
  style.stroke: "#e84393"
}
failed -> queued: {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}
queued -> failed: {
  style.stroke: "#d63031"
}