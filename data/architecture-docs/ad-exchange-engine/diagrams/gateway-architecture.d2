direction: right

classes: {
  component: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  critical: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  queue_style: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  worker: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

title: C10M Gateway Internal Architecture {
  near: top-center
  style.font-size: 18
  style.bold: true
  style.font-color: "#e6edf3"
}

network_layer: Network Layer {
  class: component
  
  zero_copy_stack: Zero-Copy Network Stack {
    class: critical
  }
  
  io_uring: io_uring Interface {
    class: component
  }
  
  packet_buffers: Packet Buffers {
    shape: cylinder
    class: component
  }
  
  zero_copy_stack -> io_uring: direct syscalls
  io_uring -> packet_buffers: buffer management
}

connection_layer: Connection Management {
  class: component
  
  conn_pools: Connection Pools {
    class: critical
  }
  
  load_balancer: Load Balancer {
    class: component
  }
  
  health_monitor: Health Monitor {
    class: component
  }
  
  conn_pools -> load_balancer: route selection
  health_monitor -> conn_pools: pool updates
}

processing_layer: Processing Layer {
  class: component
  
  worker_threads: Worker Thread Pool {
    class: critical
  }
  
  thread_1: Worker 1 {
    class: worker
  }
  
  thread_2: Worker 2 {
    class: worker
  }
  
  thread_n: Worker N {
    class: worker
  }
  
  worker_threads -> thread_1
  worker_threads -> thread_2
  worker_threads -> thread_n
}

queue_layer: Lock-Free Queues {
  class: component
  
  ingress_queue: Ingress Queue {
    shape: queue
    class: queue_style
  }
  
  egress_queue: Egress Queue {
    shape: queue
    class: queue_style
  }
  
  priority_queue: Priority Queue {
    shape: queue
    class: critical
  }
}

memory_layer: Memory Management {
  class: component
  
  ring_buffers: Ring Buffers {
    shape: cylinder
    class: critical
  }
  
  memory_pool: Memory Pool {
    shape: cylinder
    class: component
  }
  
  cache_layer: CPU Cache Alignment {
    class: component
  }
  
  memory_pool -> ring_buffers: allocation
  ring_buffers -> cache_layer: optimization
}

network_layer.zero_copy_stack -> queue_layer.ingress_queue: incoming requests
queue_layer.ingress_queue -> processing_layer.worker_threads: distribute work
processing_layer.thread_1 -> queue_layer.priority_queue: high priority
processing_layer.thread_2 -> queue_layer.egress_queue: responses
processing_layer.thread_n -> queue_layer.egress_queue: responses
queue_layer.egress_queue -> connection_layer.conn_pools: send responses
connection_layer.conn_pools -> network_layer.zero_copy_stack: network output

memory_layer.ring_buffers -> processing_layer.worker_threads: zero-copy buffers
memory_layer.memory_pool -> queue_layer.ingress_queue: queue storage
memory_layer.cache_layer -> processing_layer.worker_threads: aligned access