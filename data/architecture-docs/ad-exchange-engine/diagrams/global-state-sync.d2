Multi-Region Budget Synchronization: {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  us_east: "US-East Region" {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"

    budget_cache_us: "Budget Cache (US)" {
      shape: cylinder
      style.fill: "#0f3460"
      style.stroke: "#3fb950"
    }

    sync_service_us: "Sync Service (US)" {
      style.fill: "#1a1a2e"
      style.stroke: "#8b949e"
    }

    rtb_engine_us: "RTB Engine (US)" {
      style.fill: "#1a1a2e"
      style.stroke: "#8b949e"
    }

    rtb_engine_us -> budget_cache_us: check budget
    sync_service_us -> budget_cache_us: update local
  }
  
  eu_west: "EU-West Region" {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"

    budget_cache_eu: "Budget Cache (EU)" {
      shape: cylinder
      style.fill: "#0f3460"
      style.stroke: "#3fb950"
    }

    sync_service_eu: "Sync Service (EU)" {
      style.fill: "#1a1a2e"
      style.stroke: "#8b949e"
    }

    rtb_engine_eu: "RTB Engine (EU)" {
      style.fill: "#1a1a2e"
      style.stroke: "#8b949e"
    }

    rtb_engine_eu -> budget_cache_eu: check budget
    sync_service_eu -> budget_cache_eu: update local
  }
  
  asia_pacific: "Asia-Pacific Region" {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"

    budget_cache_ap: "Budget Cache (AP)" {
      shape: cylinder
      style.fill: "#0f3460"
      style.stroke: "#3fb950"
    }

    sync_service_ap: "Sync Service (AP)" {
      style.fill: "#1a1a2e"
      style.stroke: "#8b949e"
    }

    rtb_engine_ap: "RTB Engine (AP)" {
      style.fill: "#1a1a2e"
      style.stroke: "#8b949e"
    }

    rtb_engine_ap -> budget_cache_ap: check budget
    sync_service_ap -> budget_cache_ap: update local
  }
  
  global_coordinator: "Global Budget Coordinator" {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true

    master_ledger: "Master Ledger" {
      shape: cylinder
      style.fill: "#0f3460"
      style.stroke: "#3fb950"
    }

    settlement_engine: "Settlement Engine" {
      style.fill: "#1a1a2e"
      style.stroke: "#8b949e"
    }

    audit_log: "Audit Log" {
      shape: page
      style.fill: "#0f3460"
      style.stroke: "#3fb950"
    }

    settlement_engine -> master_ledger: reconcile
    settlement_engine -> audit_log: log transactions
  }
  
  event_stream: "Event Stream" {
    shape: queue
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }

  sync_service_us <-> global_coordinator.settlement_engine: budget updates
  sync_service_eu <-> global_coordinator.settlement_engine: budget updates
  sync_service_ap <-> global_coordinator.settlement_engine: budget updates

  sync_service_us -> event_stream: spend events
  sync_service_eu -> event_stream: spend events
  sync_service_ap -> event_stream: spend events

  event_stream -> global_coordinator.settlement_engine: consume events
  
  consistency_note: |md
    ## Eventual Consistency
    - Local caches serve sub-10ms checks
    - Periodic sync prevents overspend
    - Audit trail for reconciliation
  | {
    shape: page
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}