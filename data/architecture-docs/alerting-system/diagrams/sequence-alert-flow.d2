shape: sequence_diagram

title: "Sequence Diagram: End-to-End Alert Flow"

Scheduler: Scheduler
RuleEvaluator: Rule Evaluator {
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
MetricsAPI: Metrics Collector API {
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
Grouper: Alert Grouper {
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
SilencerInhibitor: Silencer & Inhibitor {
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
NotificationRouter: Notification Router {
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
Channel: Notification Channel {
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

Scheduler -> RuleEvaluator: Engine.Run() periodic trigger
RuleEvaluator -> MetricsAPI: Client.Query(rule.Expression)
MetricsAPI -> RuleEvaluator: MetricQueryResult
RuleEvaluator -> RuleEvaluator: Evaluate result vs. threshold
RuleEvaluator -> Grouper: Alert(active=true, labels, annotations)
Grouper -> Grouper: Group with existing alerts
Grouper -> SilencerInhibitor: Grouped alert bundle
SilencerInhibitor -> SilencerInhibitor: Check silence rules & inhibition rules
SilencerInhibitor -> NotificationRouter: Filtered alert bundle
NotificationRouter -> NotificationRouter: Route based on routing tree
NotificationRouter -> Channel: Formatted notification
Channel -> Channel: Deliver (Email, Slack, etc.)