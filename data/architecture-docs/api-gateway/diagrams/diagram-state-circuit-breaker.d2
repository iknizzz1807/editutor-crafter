title: State Machine: Circuit Breaker
description: Shows the three states (Closed, Open, Half-Open) of the circuit breaker for an upstream endpoint. Transitions are triggered by events: failure threshold exceeded (Closed→Open), timer expires (Open→Half-Open), and probe success/failure (Half-Open→Closed/Open).

# Define styles for a dark theme
classes: {
  state_node: {
    shape: circle
    style.stroke: "#3fb950"
    style.fill: "#16213e"
    style.font-color: "#e6edf3"
  }
  init_state: {
    shape: circle
    style.fill: "#3fb950"
    label: ""
    width: 25
    height: 25
  }
  transition_label: {
    style.font-color: "#8b949e"
    style.font-size: 12
  }
}

# Initial state marker
init_state: init {
  class: init_state
}

# States
Closed: Closed State {
  class: state_node
  label: |md
    **Closed**
    *Requests flow normally*
    *Counts failures*
  |
}

Open: Open State {
  class: state_node
  label: |md
    **Open**
    *Requests fail fast*
    *Timer running*
  |
}

Half_Open: Half-Open State {
  class: state_node
  label: |md
    **Half-Open**
    *Allows probe requests*
    *Tests upstream health*
  |
}

# Initial transition
init_state -> Closed

# State transitions
Closed -> Open: "Failure threshold exceeded" {
  class: transition_label
  style.stroke: "#8b949e"
}

Open -> Half_Open: "Timer expires" {
  class: transition_label
  style.stroke: "#8b949e"
}

Half_Open -> Closed: "Probe success" {
  class: transition_label
  style.stroke: "#8b949e"
}

Half_Open -> Open: "Probe failure" {
  class: transition_label
  style.stroke: "#8b949e"
}