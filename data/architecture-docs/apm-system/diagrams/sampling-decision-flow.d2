title: Flowchart: Head-Based and Tail-Based Sampling Decisions

# Define common styling classes
classes: {
  process: {
    shape: rectangle
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    shape: diamond
    style.fill: "#1a1a2e"
    style.stroke: "#faa356"
    style.font-color: "#e6edf3"
  }
  endpoint: {
    shape: circle
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  container_style: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.double-border: true
    style.font-color: "#e6edf3"
  }
  arrow_yes: {
    style.stroke: "#3fb950"
    style.bold: true
  }
  arrow_no: {
    style.stroke: "#f85149"
    style.bold: true
  }
}

# Main containers
head_based: Head-Based Sampling {
  class: container_style
  direction: down

  hb_start: "Incoming Trace" {
    class: endpoint
  }

  hb_hash: "Hash Trace ID" {
    class: process
  }

  hb_compare: "Compare Hash to\nConfigured Rate" {
    class: decision
  }

  hb_keep: "Keep Trace" {
    class: process
  }

  hb_drop: "Drop Trace" {
    class: process
  }

  # Head-based connections
  hb_start -> hb_hash -> hb_compare
  hb_compare -> hb_keep: "Hash < Rate" {
    class: arrow_yes
  }
  hb_compare -> hb_drop: "Hash â‰¥ Rate" {
    class: arrow_no
  }
}

tail_based: Tail-Based Sampling {
  class: container_style
  direction: down

  tb_start: "Completed Trace" {
    class: endpoint
  }

  tb_check: "Check for Errors\nor High Latency" {
    class: decision
  }

  tb_override: "Override Drop Decision\n(Keep Trace)" {
    class: process
  }

  tb_no_override: "No Override\n(Drop Trace)" {
    class: process
  }

  # Tail-based connections
  tb_start -> tb_check
  tb_check -> tb_override: "Yes" {
    class: arrow_yes
  }
  tb_check -> tb_no_override: "No" {
    class: arrow_no
  }
}

# Position containers side by side
head_based.near: top-left
tail_based.near: top-right