title: Data Model Relationships
description: Shows the relationship between the core data structures: AuditEvent contains Metadata, multiple AuditEvents are stored in a Segment, and each LogEntry in the hash chain points to an AuditEvent and the previous LogEntry's hash.

classes: {
  core_class: {
    shape: class
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  component: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

data_model: {
  shape: rectangle
  label: "Data Model"
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.double-border: true

  segment: Segment {
    class: core_class
    label: "Segment\n(Storage Container)"
    - segment_id: "UUID"
    - start_timestamp: "DateTime"
    - end_timestamp: "DateTime"
    - total_events: "int"
    - size_bytes: "int64"
    + "add_event(event: AuditEvent): void"
  }

  audit_event: AuditEvent {
    class: core_class
    label: "AuditEvent\n(Immutable Record)"
    - event_id: "UUID"
    - timestamp: "DateTime"
    - action_type: "string"
    - principal: "string"
    - resource_id: "string"
    - outcome: "string"
    - metadata_ref: "Metadata"
  }

  metadata: Metadata {
    class: component
    label: "Metadata\n(Additional Context)"
    - client_ip: "string"
    - user_agent: "string"
    - request_id: "string"
    - custom_tags: "Map<string, string>"
    - additional_details: "string"
  }

  log_entry: LogEntry {
    class: core_class
    label: "LogEntry\n(Hash Chain Link)"
    - entry_id: "UUID"
    - timestamp: "DateTime"
    - hash: "string"
    - previous_hash: "string"
    - audit_event_ref: "UUID"
    + "calculate_hash(): string"
    + "verify_chain(prev_entry: LogEntry): bool"
  }
}

segment -> audit_event: "contains multiple\n1..*" {
  style.stroke: "#3fb950"
}
audit_event -> metadata: "has one\n1" {
  style.stroke: "#3fb950"
}
log_entry -> audit_event: "references\n1" {
  style.stroke: "#3fb950"
}
log_entry -> log_entry: "points to previous\n(previous_hash)" {
  source-arrowhead: "←"
  target-arrowhead: "→"
  style.stroke: "#3fb950"
  style.stroke-dash: 3
}

note: |md
  **Hash Chain Integrity:**
  Each LogEntry contains a hash of:
  - Its own AuditEvent data
  - The previous LogEntry's hash
  This creates an immutable chain where any modification breaks the hashes.
| {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  near: bottom-right
}