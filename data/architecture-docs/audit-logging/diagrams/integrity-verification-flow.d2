title: Hash Chain Verification Flow

direction: right

classes: {
  process: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    shape: diamond
    style.fill: "#0f3460"
    style.stroke: "#f1c40f"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  terminal: {
    shape: oval
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  data: {
    shape: cylinder
    style.fill: "#1a1a2e"
    style.stroke: "#58a6ff"
    style.font-color: "#e6edf3"
  }
}

start: Start Verification {
  class: terminal
}

read_entry: "Read entry N\n(from immutable storage)" {
  class: process
}

compute_hash: "Compute hash\nhash(event_n + previous_hash)" {
  class: process
}

compare_hash: Hash Match? {
  class: decision
}

increment: "Move to N+1" {
  class: process
}

check_end: End of Chain? {
  class: decision
}

tamper_detected: Tamper Detected! {
  class: terminal
  style.fill: "#301934"
  style.stroke: "#ff5555"
  style.font-color: "#ffffff"
}

chain_verified: Chain Verified {
  class: terminal
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#ffffff"
}

note: |md
  ## Integrity Verification Flow
  Starting from a known-good entry,
  verify each subsequent entry's hash
  matches the computed value.
| {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  style.italic: true
  near: top-right
}

# Flow connections
start -> read_entry: "Start at entry N"
read_entry -> compute_hash
compute_hash -> compare_hash

compare_hash -> tamper_detected: No { style.stroke: "#ff5555"; style.bold: true }
compare_hash -> check_end: Yes { style.stroke: "#3fb950" }

check_end -> chain_verified: Yes { style.stroke: "#3fb950" }
check_end -> increment: No { style.stroke: "#58a6ff" }

increment -> read_entry: "Loop back\n(N = N + 1)" {
  style.stroke: "#58a6ff"
  style.stroke-dash: 3
}

# Data source representation
storage: Immutable Storage {
  class: data
  near: bottom-right
}

read_entry -> storage: "read" {
  style.stroke: "#58a6ff"
  target-arrowhead: "{}"
}