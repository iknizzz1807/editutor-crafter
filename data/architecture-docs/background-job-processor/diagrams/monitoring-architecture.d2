title: Monitoring Data Collection Architecture

classes: {
  dark_container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
  }
  stream_component: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    shape: queue
  }
  data_flow: {
    style.stroke: "#8b949e"
    style.animated: true
  }
}

background_workers: Background Workers {
  class: dark_container
  
  worker1: Worker 1 {
    shape: circle
    style.fill: "#16213e"
    style.stroke: "#3fb950"
  }
  worker2: Worker 2 {
    shape: circle
    style.fill: "#16213e"
    style.stroke: "#3fb950"
  }
  worker3: Worker 3 {
    shape: circle
    style.fill: "#16213e"
    style.stroke: "#3fb950"
  }
  
  note: "Emits:\n• Heartbeats\n• Job completion events" {
    shape: page
    style.fill: "#16213e"
    style.font-color: "#e6edf3"
  }
}

event_stream: Event Stream {
  class: stream_component
  label: "Redis Streams"
}

aggregator: Aggregator {
  shape: parallelogram
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

dashboard_api: Dashboard API {
  shape: hexagon
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

websocket: WebSocket Server {
  shape: cloud
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

ui: Monitoring UI {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.double-border: true
}

# Data flow connections
background_workers.worker1 -> event_stream: "heartbeats\n& events" { class: data_flow }
background_workers.worker2 -> event_stream: "heartbeats\n& events" { class: data_flow }
background_workers.worker3 -> event_stream: "heartbeats\n& events" { class: data_flow }

event_stream -> aggregator: "reads streams" { class: data_flow }
aggregator -> dashboard_api: "aggregated metrics" { class: data_flow }
dashboard_api -> websocket: "pushes updates" { class: data_flow }
websocket -> ui: "real-time data" { class: data_flow }

# HTTP connection for initial load
dashboard_api -> ui: "HTTP API (initial load)" {
  class: data_flow
  style.stroke-dash: 3
}