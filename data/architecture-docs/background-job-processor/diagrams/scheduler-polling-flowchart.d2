title: Scheduler Polling Algorithm Flowchart

direction: right

classes: {
  process: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    shape: diamond
    style.fill: "#0f3460"
    style.stroke: "#f0db4f"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  loop: {
    style.fill: "#1a1a2e"
    style.stroke: "#a855f7"
    style.font-color: "#e6edf3"
    style.font-size: 12
  }
}

start: "Start\nScheduler Polling Cycle" {
  class: process
  style.font-size: 16
}

poll_redis: Poll Redis for due jobs {
  class: process
}

jobs_found: Jobs found? {
  class: decision
}

process_jobs: Process each due job {
  class: loop
  style.stroke-width: 2
}

check_uniqueness: Check job uniqueness {
  class: decision
}

enqueue_job: Enqueue job for execution {
  class: process
}

calculate_next: Calculate next run time {
  class: process
}

update_schedule: Update job schedule in Redis {
  class: process
}

sleep: Sleep until next polling interval {
  class: process
}

skip_job: "Skip job\n(already running)" {
  class: process
  style.fill: "#2d1b69"
  style.stroke: "#a855f7"
}

start -> poll_redis
poll_redis -> jobs_found

jobs_found -> process_jobs: Yes
jobs_found -> sleep: No

process_jobs -> check_uniqueness

check_uniqueness -> enqueue_job: Unique
check_uniqueness -> skip_job: No
skip_job -> calculate_next

enqueue_job -> calculate_next
calculate_next -> update_schedule

update_schedule -> process_jobs: Next job

process_jobs -> sleep: All jobs processed

sleep -> poll_redis