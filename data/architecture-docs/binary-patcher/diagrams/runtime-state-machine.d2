classes: {
  state_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  init_style: {
    shape: circle
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    label: ""
  }
  transition_style: {
    style.stroke: "#8b949e"
    style.font-color: "#8b949e"
  }
}

init: {
  class: init_style
}

DETACHED: {
  class: state_style
  label: |md
**DETACHED**
Process not attached
No modifications
|
}

ATTACHED: {
  class: state_style
  label: |md
**ATTACHED**
Process stopped via ptrace
Ready for memory operations
|
}

MEMORY_MODIFIED: {
  class: state_style
  label: |md
**MEMORY_MODIFIED**
Trampoline injected
Memory protections restored
Ready to resume
|
}

init -> DETACHED: "Initial State" {
  class: transition_style
}

DETACHED -> ATTACHED: ATTACH_CMD {
  class: transition_style
  label: |md
**ATTACH_CMD**
1. ptrace(PTRACE_ATTACH)
2. Wait for SIGSTOP
3. Process stopped
|
}

ATTACHED -> DETACHED: DETACH_CMD {
  class: transition_style
  label: |md
**DETACH_CMD**
1. ptrace(PTRACE_DETACH)
2. Process resumes execution
|
}

ATTACHED -> MEMORY_MODIFIED: PATCH_APPLIED {
  class: transition_style
  label: |md
**PATCH_APPLIED**
1. mprotect(PROT_READ, PROT_WRITE, PROT_EXEC)
2. Write trampoline bytes
3. mprotect(PROT_READ, PROT_EXEC)
4. Flush instruction cache
|
}

MEMORY_MODIFIED -> DETACHED: DETACH_CMD {
  class: transition_style
  label: |md
**DETACH_CMD**
1. ptrace(PTRACE_DETACH)
2. Process resumes with hook active
|
}