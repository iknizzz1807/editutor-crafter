title: System Component Overview

ELFlex: ELFlex Binary Instrumentation Tool {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.double-border: true
  style.font-color: "#e6edf3"
  label: |md
    ## System Component Overview
    Trampoline-based binary instrumentation for ELF executables
  |

  elf_loader: ELF Loader {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    label: |md
      **ELF Loader**
      - Parses ELF executable structure
      - Extracts sections and segments
      - Resolves symbols and relocation info
    |
  }

  patch_planner: Patch Planner {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    label: |md
      **Patch Planner**
      - Analyzes function entry/exit points
      - Determines hook placement strategy
      - Calculates trampoline insertion locations
    |
  }

  trampoline_generator: Trampoline Generator {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    label: |md
      **Trampoline Generator**
      - Creates trampoline assembly code
      - Handles instruction preservation
      - Generates hook redirection logic
    |
  }

  code_injector: Code Injector {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    label: |md
      **Code Injector**
      - Inserts trampolines into binary
      - Updates ELF metadata
      - Manages code cave allocation
    |
  }

  runtime_patcher: Runtime Patcher {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    label: |md
      **Runtime Patcher**
      - Applies dynamic patches at runtime
      - Manages hook execution flow
      - Handles trampoline redirection
    |
  }
}

elf_loader -> patch_planner: "provides binary representation\n(parsed ELF structure, symbols)"
patch_planner -> trampoline_generator: "specifies hook points\n(function addresses, patch types)"
patch_planner -> code_injector: "provides injection plan\n(locations, trampoline requirements)"
trampoline_generator -> code_injector: "supplies trampoline code\n(assembly instructions, hooks)"
code_injector -> runtime_patcher: "delivers instrumented binary\n(with trampolines inserted)"
trampoline_generator -> runtime_patcher: "provides runtime logic\n(hook dispatch, state management)" {
  style.stroke: "#8b949e"
  style.stroke-dash: 2
}

note: |md
  **Architecture Overview:**
  ELFlex modifies ELF executables to inject monitoring hooks
  without breaking structure or execution flow.
| {
  shape: page
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  near: top-center
}

classes: {
  component_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  flow_style: {
    style.stroke: "#8b949e"
    style.font-size: 14
    style.animated: true
  }
}