title: High-Level System Component Diagram

direction: right

classes: {
  container_style: {
    shape: rectangle
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  external_style: {
    shape: rectangle
    style.fill: "#0f3460"
    style.stroke: "#58a6ff"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  component_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  queue_style: {
    shape: queue
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  arrow_style: {
    style.stroke: "#8b949e"
  }
}

ci_system: CI/CD Pipeline Orchestrator {
  class: container_style

  webhook_listener: Webhook Listener {
    class: component_style
    label: "HTTP Server\n(Listens for git events)"
  }

  orchestrator_queue: {
    class: container_style
    label: "Orchestrator/Queue"

    queue: Message Queue {
      class: queue_style
      label: "Pipeline Jobs Queue"
    }

    orchestrator: Orchestrator {
      class: component_style
      label: "Factory Floor Manager\n• Processes webhooks\n• Creates pipeline runs\n• Schedules jobs"
    }

    orchestrator -> queue: enqueue jobs
    queue -> orchestrator: dequeue completed
  }

  worker_pool: Worker Pool {
    class: component_style
    label: "Robotic Stations\n• Executes job steps\n• Runs in Docker containers\n• Parallel execution"
  }

  dashboard_api: Dashboard API {
    class: component_style
    label: "Factory Control Room\n• REST/WebSocket API\n• Real-time status\n• Live log streaming"
  }
}

external: External Systems {
  class: container_style

  git_host: Git Host {
    class: external_style
    label: "GitHub/GitLab\n(Source Code Repository)"
  }

  docker_daemon: Docker Daemon {
    class: external_style
    label: "Container Runtime\n• Provides isolated environments\n• Executes job containers"
  }

  user_browser: User's Browser {
    class: external_style
    label: "Developer Interface\n• Views pipeline status\n• Real-time logs\n• Dashboard UI"
  }
}

# External interactions
git_host -> ci_system.webhook_listener: HTTP POST (Webhook Event)\n(push, pull_request) {
  class: arrow_style
}

ci_system.webhook_listener -> ci_system.orchestrator_queue.orchestrator: Queue Message\n(New Pipeline Run) {
  class: arrow_style
  style.stroke-dash: 2
}

ci_system.orchestrator_queue.queue -> ci_system.worker_pool: Queue Message\n(Job Assignment) {
  class: arrow_style
  style.stroke-dash: 2
}

ci_system.worker_pool -> external.docker_daemon: Docker API Calls\n(Run container, Execute steps) {
  class: arrow_style
}

ci_system.worker_pool -> ci_system.dashboard_api: HTTP + WebSocket\n(Live Log Stream & Status Updates) {
  class: arrow_style
}

ci_system.dashboard_api -> external.user_browser: HTTP/WebSocket\n(Dashboard UI & Real-time Data) {
  class: arrow_style
}

external.user_browser -> ci_system.dashboard_api: HTTP Requests\n(Load dashboard, Manual triggers) {
  class: arrow_style
}

ci_system.worker_pool -> ci_system.orchestrator_queue.orchestrator: Queue Message\n(Job Completion Status) {
  class: arrow_style
  style.stroke-dash: 2
  style.animated: true
}