title: Query Processing Flowchart {
  style.font-size: 24
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
}

start: Start {
  shape: circle
  style.fill: "#3fb950"
  style.font-color: "#000000"
}

parse: Parse Incoming Message {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

parse_error: Parse Error {
  shape: diamond
  style.fill: "#d63031"
  style.font-color: "#ffffff"
  style.stroke: "#e17055"
}

authoritative: Is Query Authoritative? {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

zone_lookup: Lookup in Zone Data {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

check_cache: Check Cache {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

cache_hit: Cache Hit? {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

recursive_resolution: Start Recursive Resolution {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

resolution_error: Resolution Failed? {
  shape: diamond
  style.fill: "#d63031"
  style.font-color: "#ffffff"
  style.stroke: "#e17055"
}

construct_response: Construct Response {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

send_error: Send Error Response {
  style.fill: "#d63031"
  style.font-color: "#ffffff"
  style.stroke: "#e17055"
}

send_response: Send Response {
  style.fill: "#3fb950"
  style.font-color: "#000000"
}

end: End {
  shape: circle
  style.fill: "#3fb950"
  style.font-color: "#000000"
}

# Flow connections
start -> parse
parse -> parse_error
parse_error -> authoritative: Valid
parse_error -> send_error: Invalid

authoritative -> zone_lookup: Yes
authoritative -> check_cache: No

zone_lookup -> construct_response

check_cache -> cache_hit
cache_hit -> construct_response: Hit
cache_hit -> recursive_resolution: Miss

recursive_resolution -> resolution_error
resolution_error -> construct_response: Success
resolution_error -> send_error: Failed

construct_response -> send_response
send_error -> end
send_response -> end

# Style connections
start -> parse: {style.stroke: "#8b949e"}
parse -> parse_error: {style.stroke: "#8b949e"}
parse_error -> authoritative: {style.stroke: "#8b949e"}
parse_error -> send_error: {style.stroke: "#d63031"}
authoritative -> zone_lookup: {style.stroke: "#8b949e"}
authoritative -> check_cache: {style.stroke: "#8b949e"}
zone_lookup -> construct_response: {style.stroke: "#8b949e"}
check_cache -> cache_hit: {style.stroke: "#8b949e"}
cache_hit -> construct_response: {style.stroke: "#8b949e"}
cache_hit -> recursive_resolution: {style.stroke: "#8b949e"}
recursive_resolution -> resolution_error: {style.stroke: "#8b949e"}
resolution_error -> construct_response: {style.stroke: "#8b949e"}
resolution_error -> send_error: {style.stroke: "#d63031"}
construct_response -> send_response: {style.stroke: "#8b949e"}
send_error -> end: {style.stroke: "#d63031"}
send_response -> end: {style.stroke: "#3fb950"}