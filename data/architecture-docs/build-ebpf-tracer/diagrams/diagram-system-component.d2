title: System Component Overview
description: Shows the three main layers (Kernel eBPF, User-space Manager, Terminal Dashboard) and the data flow between them via BPF maps and ring buffers.

# Named styles
classes: {
  dark_container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  dark_component: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  light_arrow: {
    style.stroke: "#8b949e"
    style.stroke-width: 2
  }
  bold_arrow: {
    style.stroke: "#3fb950"
    style.stroke-width: 3
    style.bold: true
  }
}

# Main containers (layers)
kernel_layer: Kernel eBPF {
  class: dark_container
  
  # eBPF programs
  kprobe: Kprobe Programs {
    class: dark_component
    shape: parallelogram
    tooltip: Attaches to kernel function entry/exit points
  }
  
  tracepoint: Tracepoint Programs {
    class: dark_component
    shape: parallelogram
    tooltip: Attaches to stable kernel tracepoints
  }
  
  # BPF data structures
  perf_buffer: Perf Event Ring Buffer {
    class: dark_component
    shape: queue
    tooltip: High-performance circular buffer for event streaming
  }
  
  hash_map: BPF Hash Map {
    class: dark_component
    shape: rectangle
    tooltip: Key-value store for aggregation and state tracking
  }
  
  hist_map: BPF Histogram Map {
    class: dark_component
    shape: rectangle
    tooltip: Pre-binned histogram storage for latency metrics
  }
  
  # Internal connections
  kprobe -> perf_buffer: Event data
  tracepoint -> perf_buffer: Event data
  kprobe -> hash_map: State updates
  tracepoint -> hash_map: State updates
  kprobe -> hist_map: Latency samples
}

user_space_layer: User-space Manager {
  class: dark_container
  
  # User-space components
  loader: eBPF Loader & Attacher {
    class: dark_component
    shape: hexagon
    tooltip: Loads eBPF bytecode and attaches to kernel hooks
  }
  
  buffer_poller: Ring Buffer Poller {
    class: dark_component
    shape: cylinder
    tooltip: Polls perf ring buffer for new events
  }
  
  aggregator: Event Aggregator {
    class: dark_component
    shape: diamond
    tooltip: Aggregates and processes events from multiple sources
  }
  
  map_manager: BPF Map Manager {
    class: dark_component
    shape: rectangle
    tooltip: Reads/writes BPF maps from user space
  }
  
  # Internal connections
  loader -> buffer_poller: Sets up polling
  buffer_poller -> aggregator: Raw events
  map_manager -> aggregator: Map data
}

dashboard_layer: Terminal Dashboard {
  class: dark_container
  
  # UI components
  realtime_display: Real-time Event Display {
    class: dark_component
    shape: page
    tooltip: Live scrolling view of system events
  }
  
  histogram_display: Latency Histogram {
    class: dark_component
    shape: rectangle
    tooltip: Visual representation of latency distribution
  }
  
  connection_view: TCP Connection Viewer {
    class: dark_component
    shape: rectangle
    tooltip: Shows active TCP connections and statistics
  }
  
  controls: Dashboard Controls {
    class: dark_component
    shape: circle
    tooltip: Interactive controls for filtering and pausing
  }
  
  # Internal connections
  realtime_display -> histogram_display: Select event
  controls -> realtime_display: Filter/Pause
  controls -> histogram_display: Update bins
  controls -> connection_view: Refresh rate
}

# Cross-layer data flow
loader -> kprobe: Load & attach program
loader -> tracepoint: Load & attach program

perf_buffer -> buffer_poller: Kernel-to-user events {
  class: bold_arrow
}

hash_map -> map_manager: Read/Write state {
  class: light_arrow
}

hist_map -> map_manager: Read histogram data {
  class: light_arrow
}

aggregator -> realtime_display: Formatted events
aggregator -> histogram_display: Aggregated metrics
aggregator -> connection_view: Connection data

# Additional connections for clarity
map_manager -> histogram_display: Direct histogram read
hash_map -> aggregator: Map updates (via manager) {
  style.stroke-dash: 3
  style.stroke: "#8b949e"
}

# Layout direction
direction: right