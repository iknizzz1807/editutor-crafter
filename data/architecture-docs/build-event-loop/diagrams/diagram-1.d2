title: System Component Overview
description: Shows the main components: Event Loop (with epoll fd), Timer Wheel, Async Task Queue, and HTTP Handler. Arrows indicate data flow and callbacks.

classes: {
  component: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  container: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  important: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
    style.double-border: true
  }
}

system: {
  shape: rectangle
  class: container
  label: "Single-Threaded Event Loop System"
  
  event_loop: Event Loop {
    class: important
    epoll_fd: "epoll file descriptor" {
      shape: page
      style.fill: "#0f3460"
      style.font-color: "#ffffff"
    }
    
    socket_monitor: "Socket Monitor"
    callback_dispatcher: "Callback Dispatcher"
  }
  
  timer_wheel: Timer Wheel {
    class: component
    levels: "Hierarchical Levels"
    pending_timers: "Pending Timer List"
    timer_fd: "timerfd (optional)"
  }
  
  async_queue: Async Task Queue {
    class: component
    tasks: "Task Queue"
    completion_notifier: "Completion Notifier (eventfd)"
  }
  
  http_handler: HTTP Handler {
    class: component
    request_parser: "Request Parser"
    response_builder: "Response Builder"
    connection_manager: "Connection Manager"
  }
}

# Event Loop monitoring connections
event_loop.socket_monitor -> http_handler.connection_manager: "Socket events"
event_loop.socket_monitor <- http_handler.connection_manager: "Register sockets"

# Event Loop monitoring timers
event_loop.epoll_fd -> timer_wheel.timer_fd: "Timer expiration events"
event_loop.callback_dispatcher <- timer_wheel: "Timer callbacks"

# Event Loop monitoring async tasks
event_loop.epoll_fd -> async_queue.completion_notifier: "Task completion events"
event_loop.callback_dispatcher <- async_queue: "Async task results"

# Timer Wheel -> Async Queue (timers enqueuing tasks)
timer_wheel -> async_queue.tasks: "Enqueue scheduled tasks"

# HTTP Handler -> Async Queue (long operations)
http_handler -> async_queue.tasks: "Enqueue async operations"

# Async Queue -> HTTP Handler (results)
async_queue -> http_handler.response_builder: "Async operation results"

# HTTP Handler internal flow
http_handler.request_parser -> http_handler.response_builder: "Parsed request"
http_handler.connection_manager -> http_handler.request_parser: "Incoming data"