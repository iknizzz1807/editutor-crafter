shape: sequence_diagram

# Actors
EventLoop: EventLoop {
  style.font-color: "#e6edf3"
}
Kernel: Kernel {
  style.font-color: "#e6edf3"
}
ReadCallbacks: ReadCallbacks {
  style.font-color: "#e6edf3"
}
WriteCallbacks: WriteCallbacks {
  style.font-color: "#e6edf3"
}
TimerWheel: TimerWheel {
  style.font-color: "#e6edf3"
}
DeferredTasks: DeferredTasks {
  style.font-color: "#e6edf3"
}

# Sequence
EventLoop -> Kernel: epoll_wait(events, timeout) {
  style.stroke: "#3fb950"
  style.bold: true
}
Kernel -> EventLoop: returns with ready fds {
  style.stroke: "#8b949e"
}
note: Blocks until timeout or events available {
  shape: text
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: top-center
}

EventLoop -> ReadCallbacks: process ready read events {
  style.stroke: "#8b949e"
}
ReadCallbacks -> EventLoop: callbacks completed {
  style.stroke: "#8b949e"
}

EventLoop -> WriteCallbacks: process ready write events {
  style.stroke: "#8b949e"
}
WriteCallbacks -> EventLoop: callbacks completed {
  style.stroke: "#8b949e"
}

EventLoop -> TimerWheel: tick() {
  style.stroke: "#3fb950"
  style.bold: true
}
TimerWheel -> EventLoop: run expired timer callbacks {
  style.stroke: "#8b949e"
}

EventLoop -> DeferredTasks: execute() {
  style.stroke: "#3fb950"
  style.bold: true
}
DeferredTasks -> EventLoop: deferred tasks completed {
  style.stroke: "#8b949e"
}

# Return to start of loop
EventLoop -> Kernel: epoll_wait(events, timeout) {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}