title: Collision Detection Pipeline {
  style.font-size: 24
  style.bold: true
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
}

start: Start Frame {
  shape: circle
  style.fill: "#3fb950"
  style.font-color: "#1a1a2e"
  style.bold: true
}

broad_phase: Broad Phase Detection {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  spatial_grid: Spatial Hash Grid {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  quad_tree: Quad Tree {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  bvh: Bounding Volume Hierarchy {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

pair_check: Generate Collision Pairs {
  shape: parallelogram
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

has_pairs: Any Pairs? {
  shape: diamond
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

narrow_phase: Narrow Phase Detection {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  aabb_test: AABB Test {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  sat_test: SAT Algorithm {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  gjk_test: GJK/EPA {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

collision_found: Collision Detected? {
  shape: diamond
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

response: Collision Response {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  separation: Position Separation {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  impulse: Impulse Resolution {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  friction: Friction & Restitution {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

update_physics: Update Physics State {
  shape: parallelogram
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

end: End Frame {
  shape: circle
  style.fill: "#3fb950"
  style.font-color: "#1a1a2e"
  style.bold: true
}

start -> broad_phase: Moving objects {
  style.stroke: "#8b949e"
}

broad_phase -> pair_check: Potential pairs {
  style.stroke: "#8b949e"
}

pair_check -> has_pairs {
  style.stroke: "#8b949e"
}

has_pairs -> narrow_phase: Yes {
  style.stroke: "#8b949e"
}

has_pairs -> end: No {
  style.stroke: "#8b949e"
}

narrow_phase -> collision_found: Test results {
  style.stroke: "#8b949e"
}

collision_found -> response: Yes {
  style.stroke: "#8b949e"
}

collision_found -> update_physics: No {
  style.stroke: "#8b949e"
}

response -> update_physics: Apply forces {
  style.stroke: "#8b949e"
}

update_physics -> end {
  style.stroke: "#8b949e"
}