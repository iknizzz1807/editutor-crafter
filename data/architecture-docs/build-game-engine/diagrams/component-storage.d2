direction: down

title: ECS Component Storage Organization {
  style.font-size: 18
  style.bold: true
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
}

component_storage: Component Storage {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"

  transform_array: Transform {
    shape: sql_table
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    
    entity_0: Entity 0 pos(10,5) rot(0°)
    entity_2: Entity 2 pos(20,8) rot(45°)
    entity_5: Entity 5 pos(15,12) rot(90°)
  }

  velocity_array: Velocity {
    shape: sql_table
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    
    entity_0: Entity 0 vel(2,0)
    entity_2: Entity 2 vel(1,1)
    entity_5: Entity 5 vel(0,3)
  }

  health_array: Health {
    shape: sql_table
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    
    entity_2: Entity 2 hp=100
    entity_3: Entity 3 hp=75
    entity_7: Entity 7 hp=50
  }
}

archetypes: Archetype Organization {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"

  archetype_a: Archetype A {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    
    components_a: Transform + Velocity
    entities_a: Entities 0 2 5
  }

  archetype_b: Archetype B {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    
    components_b: Transform + Health
    entities_b: Entities 3 7
  }

  archetype_c: Archetype C {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    
    components_c: Velocity + Health
    entities_c: Entities 2
  }
}

systems: System Iteration {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"

  movement_system: Movement System {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.bold: true
    
    query: Query Transform + Velocity
    iteration: Iterates Entities 0 2 5
  }

  damage_system: Damage System {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.bold: true
    
    query: Query Health
    iteration: Iterates Entities 2 3 7
  }
}

entity_index: Entity Index {
  shape: sql_table
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"

  entity_0: Entity 0 -> Archetype A
  entity_2: Entity 2 -> Archetypes A B C
  entity_3: Entity 3 -> Archetype B
  entity_5: Entity 5 -> Archetype A
  entity_7: Entity 7 -> Archetype B
}

component_storage.transform_array -> archetypes.archetype_a: dense arrays
component_storage.velocity_array -> archetypes.archetype_a: cache-friendly
component_storage.health_array -> archetypes.archetype_b: iteration

archetypes.archetype_a -> systems.movement_system: efficient
archetypes.archetype_b -> systems.damage_system: query matching

entity_index -> archetypes: maps to
systems.movement_system -> component_storage.transform_array: updates
systems.movement_system -> component_storage.velocity_array: reads

note: |md
  **Key Benefits:**
  • Dense arrays = cache efficiency
  • Archetypes group compatible entities
  • Systems iterate only relevant data
  • No pointer chasing or virtual calls
| {
  shape: page
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#8b949e"
}