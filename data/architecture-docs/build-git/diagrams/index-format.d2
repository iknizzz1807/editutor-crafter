direction: down

title: ".git/index File Structure" {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
}

header: "Index Header" {
  shape: class
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  signature: "4-byte signature\n'DIRC'"
  version: "4-byte version\n(2, 3, or 4)"
  entries_count: "4-byte entry count\n(big-endian)"
}

entries: "Index Entries\n(Sorted by pathname)" {
  shape: class
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  ctime_sec: "4-byte ctime seconds"
  ctime_nano: "4-byte ctime nanoseconds"
  mtime_sec: "4-byte mtime seconds"
  mtime_nano: "4-byte mtime nanoseconds"
  dev: "4-byte device id"
  ino: "4-byte inode number"
  mode: "4-byte file mode"
  uid: "4-byte user id"
  gid: "4-byte group id"
  size: "4-byte file size"
  sha1: "20-byte SHA-1 hash"
  flags: "2-byte flags"
  pathname: "variable-length pathname\n(null-terminated)"
  padding: "0-7 null bytes\n(8-byte alignment)"
}

extensions: "Extensions\n(Optional)" {
  shape: class
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  
  ext_signature: "4-byte extension signature"
  ext_size: "4-byte extension size"
  ext_data: "variable-length data"
}

checksum: "SHA-1 Checksum" {
  shape: class
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  hash: "20-byte SHA-1\nof entire index"
}

note: |md
  **Binary Layout:**
  - Big-endian byte order
  - Entries sorted lexicographically
  - Each entry 8-byte aligned
  - Checksum covers all preceding data
| {
  shape: page
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#3fb950"
}

header -> entries: "Fixed 12-byte header" {
  style.stroke: "#3fb950"
}

entries -> extensions: "Optional extensions\n(version 2+)" {
  style.stroke: "#8b949e"
  style.stroke-dash: 5
}

extensions -> checksum: "Always present" {
  style.stroke: "#3fb950"
}

entries -> checksum: "Direct if no extensions" {
  style.stroke: "#8b949e"
  style.stroke-dash: 5
}