title: Query Execution Flowchart

direction: right

# Main flowchart with dark theme styling
query_flow: {
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"

  # Start
  start: "Start at Root" {
    style: {
      fill: "#1a1a2e"
      stroke: "#3fb950"
      font-color: "#e6edf3"
      bold: true
    }
  }

  # Parse and traverse
  parse_selection: "Parse Selection Set" {
    shape: rectangle
  }
  
  # Main decision
  field_type_decision: "Field Type?" {
    shape: diamond
  }

  # Scalar path
  resolve_scalar: "Resolve Scalar/Enum Field" {
    shape: rectangle
  }

  # Object path
  resolve_object: "Resolve Object Field" {
    shape: rectangle
  }

  # Nested traversal
  nested_selection: "Traverse Nested Selection Set" {
    shape: rectangle
  }

  # Parallel execution branches
  parallel_execution: "Execute Sibling Fields in Parallel" {
    shape: rectangle
    style.stroke-dash: 3
  }

  # Error handling
  error_check: "Error Occurred?" {
    shape: diamond
  }

  # Error handling flow
  handle_error: "Handle Error" {
    shape: rectangle
    style.fill: "#d63031"
    style.font-color: "#ffffff"
  }

  null_propagation_decision: "Field is Non-Null?" {
    shape: diamond
  }

  propagate_null: "Propagate Null to Parent" {
    shape: rectangle
    style.fill: "#f39c12"
    style.font-color: "#2c3e50"
  }

  # Data collection
  collect_data: "Collect Field Data" {
    shape: rectangle
  }

  # Return results
  return_results: "Return Complete Result" {
    shape: rectangle
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }

  # End
  end: "Complete" {
    shape: circle
  }

  # Flow connections
  start -> parse_selection: "Begin execution"
  parse_selection -> parallel_execution
  parallel_execution -> field_type_decision
  
  # Scalar field flow
  field_type_decision -> resolve_scalar: "Scalar/Enum"
  resolve_scalar -> error_check
  
  # Object field flow
  field_type_decision -> resolve_object: "Object"
  resolve_object -> error_check
  error_check -> nested_selection: "No"
  nested_selection -> parse_selection: "Recursive traversal"
  
  # Error flow
  error_check -> handle_error: "Yes"
  handle_error -> null_propagation_decision
  
  # Null propagation logic
  null_propagation_decision -> propagate_null: "Yes"
  null_propagation_decision -> collect_data: "No"
  
  # Data collection flow
  resolve_scalar -> collect_data: "Via error check (no error)"
  propagate_null -> collect_data
  nested_selection -> collect_data: "Via recursive completion"
  
  # Completion flow
  collect_data -> return_results: "All fields resolved"
  return_results -> end
}

# Legend/notes
legend: {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  
  note: |md
  ## Execution Flow Notes
  
  **Parallel Execution:**
  - Sibling fields at same level execute in parallel
  - Parent fields wait for all children to complete
  
  **Error Handling:**
  - Errors are caught at field resolution level
  - Non-null field errors propagate nulls upward
  - Nullable field errors are included in result
  
  **Null Propagation:**
  - If non-null field resolves to null
  - Parent field becomes null (cascades up)
  - Siblings may continue executing unless parent is null
  | {
    shape: page
  }
}