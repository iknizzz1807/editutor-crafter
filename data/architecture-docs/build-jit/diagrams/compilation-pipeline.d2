title: JIT Compilation Pipeline {
  style.font-size: 20
  style.bold: true
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
}

profiling: Profiling System {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  counter: Execution Counter {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
  }
  
  detector: Hot Path Detector {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
  }
  
  counter -> detector: frequency data
}

decision: Compilation Threshold? {
  shape: diamond
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

interpreter: Continue Interpretation {
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

analysis: Bytecode Analysis {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  parser: Bytecode Parser {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
  }
  
  optimizer: IR Optimizer {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
  }
  
  parser -> optimizer: intermediate representation
}

codegen: Native Code Generation {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  x86gen: x86-64 Generator {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
  }
  
  regalloc: Register Allocator {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
  }
  
  x86gen -> regalloc: machine instructions
}

optimization: Runtime Optimization {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  constant: Constant Folding {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
  }
  
  deadcode: Dead Code Elimination {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
  }
  
  constant -> deadcode: optimized IR
}

installation: Code Installation {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  memory: Executable Memory {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
  }
  
  patcher: Code Patcher {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
  }
  
  memory -> patcher: native code
}

execution: Native Execution {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

profiling -> decision: hot path detected
decision -> interpreter: No (Cold)
decision -> analysis: Yes (Hot)
interpreter -> profiling: continue monitoring
analysis -> optimization: bytecode IR
optimization -> codegen: optimized IR
codegen -> installation: native code
installation -> execution: executable code
execution -> profiling: runtime feedback

decision_label: |md
  **Cold**: < 1000 calls
  **Hot**: â‰¥ 1000 calls
| {
  shape: page
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
  style.stroke: "#8b949e"
}