direction: right

# Function Execution State Machine

# States
interpreted: Interpreted {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

profiling: Profiling {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#ffa500"
  style.font-color: "#e6edf3"
}

compiling: Compiling {
  shape: circle
  style.fill: "#0f3460"
  style.stroke: "#ff6b6b"
  style.font-color: "#e6edf3"
}

native: Native Execution {
  shape: circle
  style.fill: "#2d1b69"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

initial: "" {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
  width: 10
  height: 10
}

# State transitions
initial -> interpreted: function created

interpreted -> profiling: invocation count > threshold {
  style.stroke: "#8b949e"
}

profiling -> compiling: hot path detected {
  style.stroke: "#ffa500"
}

compiling -> native: compilation complete {
  style.stroke: "#3fb950"
}

profiling -> interpreted: deoptimization trigger {
  style.stroke: "#ff6b6b"
}

native -> interpreted: invalidation / bailout {
  style.stroke: "#ff6b6b"
}

interpreted -> interpreted: execute bytecode {
  style.stroke: "#8b949e"
}

profiling -> profiling: collect execution data {
  style.stroke: "#8b949e"
}

native -> native: execute machine code {
  style.stroke: "#3fb950"
}

# Notes
cold_note: |md
  **Cold Code**
  Functions with low
  invocation counts
| {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

hot_note: |md
  **Hot Code**
  Frequently executed
  functions ready for
  JIT compilation
| {
  shape: page
  style.fill: "#2d1b69"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

cold_note -- interpreted: {
  style.stroke-dash: 5
  style.stroke: "#8b949e"
}

hot_note -- native: {
  style.stroke-dash: 5
  style.stroke: "#8b949e"
}