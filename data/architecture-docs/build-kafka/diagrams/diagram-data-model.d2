Topic: {
  shape: class
  Name: string
  "Partitions": "Partition[]"
  "Config": "map[string]string"
}

Partition: {
  shape: class
  Topic: string
  PartitionId: int
  LeaderReplica: PartitionReplica
  "Replicas": "PartitionReplica[]"
}

LogSegment: {
  shape: class
  BaseOffset: int64
  Size: int64
  FilePath: string
  "RecordBatches": "RecordBatch[]"
}

RecordBatch: {
  shape: class
  BaseOffset: int64
  LastOffset: int64
  "Records": "Record[]"
}

PartitionReplica: {
  shape: class
  PartitionId: int
  BrokerId: int
  IsLeader: bool
  HighWatermark: int64
  "LogSegments": "LogSegment[]"
}

ConsumerGroup: {
  shape: class
  GroupId: string
  Protocol: string
  State: string
  "Consumers": "Consumer[]"
  "Offsets": "map[Partition]OffsetMetadata"
}

Consumer: {
  shape: class
  ConsumerId: string
  GroupId: string
  "AssignedPartitions": "Partition[]"
}

OffsetMetadata: {
  shape: class
  Partition: Partition
  Offset: int64
  Metadata: string
  CommitTimestamp: int64
}

Broker: {
  shape: class
  BrokerId: int
  Host: string
  Port: int
  "PartitionReplicas": "PartitionReplica[]"
}

Cluster: {
  shape: class
  ClusterId: string
  "Brokers": "Broker[]"
  "Topics": "Topic[]"
  "ConsumerGroups": "ConsumerGroup[]"
}

# Relationships
Cluster -> Broker: "1..n"
Broker -> PartitionReplica: "hosts 0..n"
Topic -> Partition: "1..n"
Partition -> LogSegment: "is a log composed of"
LogSegment -> RecordBatch: "contains 1..n"
ConsumerGroup -> Consumer: "1..n"
ConsumerGroup -> OffsetMetadata: "tracks per partition"

# Styling
Cluster.style: {
  fill: "#0f3460"
  stroke: "#3fb950"
  font-color: "#e6edf3"
  bold: true
}

storage: {
  Topic
  Partition
  LogSegment
  RecordBatch
  style: {
    fill: "#16213e"
    stroke: "#3fb950"
    font-color: "#e6edf3"
  }
}

replication: {
  Broker
  PartitionReplica
  style: {
    fill: "#1a1a2e"
    stroke: "#3fb950"
    font-color: "#e6edf3"
  }
}

consumption: {
  ConsumerGroup
  Consumer
  OffsetMetadata
  style: {
    fill: "#1a1a2e"
    stroke: "#3fb950"
    font-color: "#e6edf3"
  }
}

storage -> replication: "replicates" {
  style: {
    stroke: "#8b949e"
    stroke-dash: 2
  }
}

storage -> consumption: "consumes" {
  style: {
    stroke: "#8b949e"
    stroke-dash: 2
  }
}
