shape: sequence_diagram

Title: Producer Send Sequence {
  style: {
    font-size: 28
    bold: true
    font-color: "#e6edf3"
  }
}

description: |md
  Sequence diagram showing how a producer sends messages to a Kafka broker.
  Steps: 1) Get metadata for topic, 2) Choose partition, 3) Add to batch accumulator,
  4) Send batch to leader, 5) Leader appends to log and responds with ack.
| {
  style: {
    font-size: 14
    italic: true
    font-color: "#8b949e"
  }
}

producer: Producer Client {
  style: {
    fill: "#16213e"
    stroke: "#3fb950"
    font-color: "#e6edf3"
    bold: true
  }
}

metadata_cache: Metadata Cache {
  style: {
    fill: "#0f3460"
    stroke: "#3fb950"
    font-color: "#e6edf3"
  }
}

broker_leader: Broker Leader {
  style: {
    fill: "#16213e"
    stroke: "#3fb950"
    font-color: "#e6edf3"
    bold: true
  }
}

producer -> metadata_cache: 1. getMetadata(topic)
metadata_cache -> producer: return metadata

producer -> producer: 2. choosePartition(record)

producer -> producer: 3. addToBatchAccumulator(record)

producer -> broker_leader: 4. sendBatch(batch, partition)
broker_leader -> broker_leader: 5. appendToLog(batch)
broker_leader -> producer: 6. sendAck(partition, offset)
