title: State Machine: Device Buffer
description: Models the buffer's states (EMPTY, PARTIALLY_FILLED, FULL) and the transitions triggered by events like successful write, successful read, or ioctl CLEAR. Includes conditions (e.g., write only possible if not FULL).

direction: right

classes: {
  state_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  final_state_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
    style.double-border: true
  }
  initial_state: {
    shape: circle
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    label: ""
  }
  transition_label: {
    style.font-color: "#8b949e"
    style.italic: true
  }
}

init: {
  class: initial_state
}

EMPTY: {
  class: state_style
  label: "EMPTY"
  shape: circle
}

PARTIALLY_FILLED: {
  class: state_style
  label: "PARTIALLY_FILLED"
  shape: circle
}

FULL: {
  class: final_state_style
  label: "FULL"
  shape: circle
}

init -> EMPTY

EMPTY -> PARTIALLY_FILLED: "write" {
  class: transition_label
  style.stroke: "#8b949e"
}
EMPTY -> EMPTY: "ioctl CLEAR" {
  class: transition_label
  style.stroke: "#8b949e"
}
EMPTY -- EMPTY: "read" {
  class: transition_label
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

PARTIALLY_FILLED -> FULL: "write (if buffer becomes full)" {
  class: transition_label
  style.stroke: "#8b949e"
}
PARTIALLY_FILLED -- PARTIALLY_FILLED: "write (if buffer not full)" {
  class: transition_label
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}
PARTIALLY_FILLED -> EMPTY: "read (if buffer becomes empty)" {
  class: transition_label
  style.stroke: "#8b949e"
}
PARTIALLY_FILLED -- PARTIALLY_FILLED: "read (if buffer not empty)" {
  class: transition_label
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}
PARTIALLY_FILLED -> EMPTY: "ioctl CLEAR" {
  class: transition_label
  style.stroke: "#8b949e"
}

FULL -> PARTIALLY_FILLED: "read (if buffer not empty)" {
  class: transition_label
  style.stroke: "#8b949e"
}
FULL -> EMPTY: "read (if buffer becomes empty)" {
  class: transition_label
  style.stroke: "#8b949e"
}
FULL -> EMPTY: "ioctl CLEAR" {
  class: transition_label
  style.stroke: "#8b949e"
}

note: |md
  **Write Condition:**
  Write operation is only possible when buffer is not in FULL state.
  If buffer is FULL, write will fail with appropriate error.
| {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: bottom-center
}