title: Document Synchronization Flow

# Styling configuration
vars: {
  container-fill: "#1a1a2e"
  stroke-color: "#3fb950"
  text-color: "#e6edf3"
  arrow-color: "#8b949e"
  error-color: "#f85149"
  decision-color: "#0f3460"
}

# Entry points
didOpen: didOpen {
  shape: oval
  style.fill: ${container-fill}
  style.stroke: ${stroke-color}
  style.font-color: ${text-color}
}

didChange: didChange {
  shape: oval
  style.fill: ${container-fill}
  style.stroke: ${stroke-color}
  style.font-color: ${text-color}
}

didClose: didClose {
  shape: oval
  style.fill: ${container-fill}
  style.stroke: ${stroke-color}
  style.font-color: ${text-color}
}

# Document operations
storeDoc: Store Document {
  style.fill: ${container-fill}
  style.stroke: ${stroke-color}
  style.font-color: ${text-color}
}

versionCheck: Version Check {
  shape: diamond
  style.fill: ${decision-color}
  style.stroke: ${stroke-color}
  style.font-color: ${text-color}
}

applyEdits: Apply Edits {
  style.fill: ${container-fill}
  style.stroke: ${stroke-color}
  style.font-color: ${text-color}
}

triggerAnalysis: Trigger Analysis {
  style.fill: ${container-fill}
  style.stroke: ${stroke-color}
  style.font-color: ${text-color}
}

publishDiagnostics: Publish Diagnostics {
  style.fill: ${container-fill}
  style.stroke: ${stroke-color}
  style.font-color: ${text-color}
}

removeDoc: Remove Document {
  style.fill: ${container-fill}
  style.stroke: ${stroke-color}
  style.font-color: ${text-color}
}

# Error handling
versionError: Version Conflict Error {
  style.fill: ${container-fill}
  style.stroke: ${error-color}
  style.font-color: ${text-color}
}

editError: Edit Application Error {
  style.fill: ${container-fill}
  style.stroke: ${error-color}
  style.font-color: ${text-color}
}

# Document store
docStore: Document Store {
  shape: cylinder
  style.fill: ${container-fill}
  style.stroke: ${stroke-color}
  style.font-color: ${text-color}
}

# Flow connections
didOpen -> storeDoc: new document
storeDoc -> docStore: save

didChange -> versionCheck: with version
versionCheck -> applyEdits: valid version
versionCheck -> versionError: invalid version {style.stroke: ${error-color}}

applyEdits -> docStore: update content
applyEdits -> editError: application failed {style.stroke: ${error-color}}
applyEdits -> triggerAnalysis: success

triggerAnalysis -> publishDiagnostics: analysis complete
publishDiagnostics -> docStore: update diagnostics

didClose -> removeDoc: document URI
removeDoc -> docStore: delete

# Error recovery paths
versionError -> applyEdits: resync document {style.stroke: ${error-color}}
editError -> versionError: request resync {style.stroke: ${error-color}}