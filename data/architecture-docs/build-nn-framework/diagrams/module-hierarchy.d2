direction: down

title: Module System Organization {
  style.font-size: 24
  style.font-color: "#e6edf3"
}

# Base Module Class
module_base: Module (Base Class) {
  shape: class
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  methods: |md
    + parameters()
    + register_parameter()
    + forward()
    + __call__()
    + children()
    + named_modules()
  |
}

# Linear Layer Implementation
linear_module: Linear Layer {
  shape: class
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  params: |md
    weight: Tensor
    bias: Tensor
  |
  
  methods: |md
    + forward(x)
    + __init__(in_features, out_features)
  |
}

# ReLU Layer Implementation
relu_module: ReLU Layer {
  shape: class
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  methods: |md
    + forward(x)
    + __init__()
  |
}

# Sequential Container
sequential_module: Sequential Container {
  shape: class
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  children: |md
    layers: List[Module]
  |
  
  methods: |md
    + forward(x)
    + add_module()
    + __getitem__()
  |
}

# Parameter Registry
param_registry: Parameter Registry {
  shape: cylinder
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  
  data: |md
    name -> parameter mapping
    recursive collection
  |
}

# Module Tree Structure
module_tree: Module Tree {
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  
  root: Sequential {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  layer1: Linear(784, 128) {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  activation: ReLU() {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  layer2: Linear(128, 10) {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  root -> layer1
  root -> activation
  root -> layer2
}

# Inheritance relationships
module_base -> linear_module: inherits {
  style.stroke: "#3fb950"
  style.stroke-dash: 5
}

module_base -> relu_module: inherits {
  style.stroke: "#3fb950"
  style.stroke-dash: 5
}

module_base -> sequential_module: inherits {
  style.stroke: "#3fb950"
  style.stroke-dash: 5
}

# Parameter registration
linear_module -> param_registry: registers parameters {
  style.stroke: "#8b949e"
}

sequential_module -> param_registry: collects recursively {
  style.stroke: "#8b949e"
}

# Module tree connection
sequential_module -> module_tree: creates {
  style.stroke: "#3fb950"
}

# Parameter flow
module_tree -> param_registry: parameter() calls {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}