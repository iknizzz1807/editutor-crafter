direction: down
shape: sequence_diagram

user: User
module: Module {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
tensor: Tensor {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
optimizer: Optimizer {
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
loss: Loss {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

user -> module: forward(input) {
  style.stroke: "#3fb950"
}
module -> tensor: __call__(operations) {
  style.stroke: "#8b949e"
}
tensor -> tensor: build computation graph {
  style.stroke: "#8b949e"
}
tensor -> module: output tensor {
  style.stroke: "#8b949e"
}
module -> user: predictions {
  style.stroke: "#3fb950"
}

user -> loss: compute_loss(predictions, targets) {
  style.stroke: "#3fb950"
}
loss -> tensor: loss operations {
  style.stroke: "#8b949e"
}
tensor -> tensor: extend computation graph {
  style.stroke: "#8b949e"
}
tensor -> loss: loss tensor {
  style.stroke: "#8b949e"
}
loss -> user: loss value {
  style.stroke: "#3fb950"
}

user -> optimizer: zero_grad() {
  style.stroke: "#3fb950"
}
optimizer -> tensor: clear gradients {
  style.stroke: "#8b949e"
}

user -> loss: backward() {
  style.stroke: "#3fb950"
  style.bold: true
}
loss -> tensor: start backpropagation {
  style.stroke: "#3fb950"
  style.bold: true
}
tensor -> tensor: reverse topological traversal {
  style.stroke: "#3fb950"
  style.bold: true
}
tensor -> tensor: apply chain rule {
  style.stroke: "#8b949e"
}
tensor -> tensor: accumulate gradients {
  style.stroke: "#8b949e"
}
tensor -> module: gradients computed {
  style.stroke: "#8b949e"
}

user -> optimizer: step() {
  style.stroke: "#3fb950"
}
optimizer -> module: get parameters {
  style.stroke: "#8b949e"
}
module -> optimizer: parameter tensors {
  style.stroke: "#8b949e"
}
optimizer -> tensor: update weights {
  style.stroke: "#3fb950"
}
tensor -> tensor: apply gradient updates {
  style.stroke: "#8b949e"
}
tensor -> optimizer: parameters updated {
  style.stroke: "#8b949e"
}
optimizer -> user: step complete {
  style.stroke: "#3fb950"
}