vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}

title: |md
  # GDT Descriptor Binary Layout â€” 8-Byte Microscopic View
| {near: top-center}

byte_map: "8-Byte Descriptor Physical Memory Layout" {
  style: {
    fill: "#0f172a"
    stroke: "#334155"
    border-radius: 10
    font-size: 14
    bold: true
  }

  b0: "Byte 0\nLimit[7:0]\n0xFF" {
    style: {
      fill: "#1e3a5f"
      stroke: "#60a5fa"
      font-color: "#60a5fa"
      font-size: 12
      border-radius: 4
    }
  }
  b1: "Byte 1\nLimit[15:8]\n0xFF" {
    style: {
      fill: "#1e3a5f"
      stroke: "#60a5fa"
      font-color: "#60a5fa"
      font-size: 12
      border-radius: 4
    }
  }
  b2: "Byte 2\nBase[7:0]\n0x00" {
    style: {
      fill: "#1e3a4f"
      stroke: "#34d399"
      font-color: "#34d399"
      font-size: 12
      border-radius: 4
    }
  }
  b3: "Byte 3\nBase[15:8]\n0x00" {
    style: {
      fill: "#1e3a4f"
      stroke: "#34d399"
      font-color: "#34d399"
      font-size: 12
      border-radius: 4
    }
  }
  b4: "Byte 4\nBase[23:16]\n0x00" {
    style: {
      fill: "#1e3a4f"
      stroke: "#34d399"
      font-color: "#34d399"
      font-size: 12
      border-radius: 4
    }
  }
  b5: "Byte 5\nAccess Byte\nCRITICAL" {
    style: {
      fill: "#3b1a1a"
      stroke: "#ff6b6b"
      font-color: "#ff6b6b"
      font-size: 12
      border-radius: 4
      bold: true
    }
  }
  b6: "Byte 6\nFlags[7:4] +\nLimit[19:16]" {
    style: {
      fill: "#2d1f4a"
      stroke: "#c084fc"
      font-color: "#c084fc"
      font-size: 12
      border-radius: 4
    }
  }
  b7: "Byte 7\nBase[31:24]\n0x00" {
    style: {
      fill: "#1e3a4f"
      stroke: "#34d399"
      font-color: "#34d399"
      font-size: 12
      border-radius: 4
    }
  }

  b0 -> b1: "Limit low word\nbytes 0-1" {
    style: { stroke: "#60a5fa"; font-color: "#60a5fa"; font-size: 11 }
  }
  b1 -> b2: "split fields\n(non-contiguous)" {
    style: { stroke: "#475569"; font-color: "#94a3b8"; font-size: 10; stroke-dash: 3 }
  }
  b2 -> b3: "Base[23:0]\nbytes 2-4" {
    style: { stroke: "#34d399"; font-color: "#34d399"; font-size: 11 }
  }
  b3 -> b4 {
    style: { stroke: "#34d399" }
  }
  b4 -> b5: "wrong bits here\n= triple fault" {
    style: { stroke: "#ff6b6b"; font-color: "#ff6b6b"; font-size: 11; bold: true }
  }
  b5 -> b6: "flags nibble\n+ limit high" {
    style: { stroke: "#c084fc"; font-color: "#c084fc"; font-size: 11 }
  }
  b6 -> b7: "Base high byte" {
    style: { stroke: "#34d399"; font-color: "#34d399"; font-size: 11 }
  }
}

access_byte: "Access Byte (Byte 5) Bit-Level Dissection" {
  style: {
    fill: "#1a0a0a"
    stroke: "#ff6b6b"
    border-radius: 10
    font-size: 14
    bold: true
  }

  header: "Bit positions: [7] P | [6:5] DPL | [4] S | [3:1] Type | [0] A\nTriple fault if P=0, DPL wrong, or Type bits incorrect" {
    shape: text
    style: { font-color: "#fbbf24"; font-size: 12 }
  }

  bit7: "Bit 7\nP = Present\nMUST = 1\nP=0 causes GPF" {
    style: {
      fill: "#3b1a1a"
      stroke: "#ff6b6b"
      font-color: "#ff6b6b"
      border-radius: 4
      font-size: 11
    }
  }
  bit65: "Bits [6:5]\nDPL = Ring\n00 = Ring 0\n11 = Ring 3" {
    style: {
      fill: "#2d1f4a"
      stroke: "#c084fc"
      font-color: "#c084fc"
      border-radius: 4
      font-size: 11
    }
  }
  bit4: "Bit 4\nS = Descriptor\n1 = Code/Data\n0 = System" {
    style: {
      fill: "#1a2a1a"
      stroke: "#6bcb77"
      font-color: "#6bcb77"
      border-radius: 4
      font-size: 11
    }
  }
  bit31_code: "Bits [3:1]\nType for CODE\nbit3=1 executable\nbit1=1 readable" {
    style: {
      fill: "#1a1a3b"
      stroke: "#60a5fa"
      font-color: "#60a5fa"
      border-radius: 4
      font-size: 11
    }
  }
  bit31_data: "Bits [3:1]\nType for DATA\nbit3=0 no exec\nbit1=1 writable" {
    style: {
      fill: "#1a2a3b"
      stroke: "#38bdf8"
      font-color: "#38bdf8"
      border-radius: 4
      font-size: 11
    }
  }
  bit0: "Bit 0\nA = Accessed\nInit = 0\nCPU sets to 1" {
    style: {
      fill: "#1a1a1a"
      stroke: "#9ca3af"
      font-color: "#9ca3af"
      border-radius: 4
      font-size: 11
    }
  }

  hex_table: "Access Byte Values\n\n0x9A = 1001 1010  Kernel Code R0  P=1 DPL=00 S=1 Type=1010\n0x92 = 1001 0010  Kernel Data R0  P=1 DPL=00 S=1 Type=0010\n0xFA = 1111 1010  User Code  R3  P=1 DPL=11 S=1 Type=1010\n0xF2 = 1111 0010  User Data  R3  P=1 DPL=11 S=1 Type=0010\n0x00 = 0000 0000  NULL entry      All zero  loading = GPF" {
    style: {
      fill: "#0a0a1a"
      stroke: "#475569"
      font-color: "#e2e8f0"
      border-radius: 4
      font-size: 11
      font: mono
    }
  }

  bit7 -> bit65: "DPL sets\nring level" {
    style: { stroke: "#c084fc"; font-color: "#c084fc"; font-size: 10 }
  }
  bit65 -> bit4: "S=1 required\nfor code/data" {
    style: { stroke: "#6bcb77"; font-color: "#6bcb77"; font-size: 10 }
  }
  bit4 -> bit31_code: "Code segment\npath" {
    style: { stroke: "#60a5fa"; font-color: "#60a5fa"; font-size: 10 }
  }
  bit4 -> bit31_data: "Data segment\npath" {
    style: { stroke: "#38bdf8"; font-color: "#38bdf8"; font-size: 10 }
  }
  bit31_code -> bit0 {
    style: { stroke: "#9ca3af"; stroke-dash: 3 }
  }
  bit31_data -> bit0 {
    style: { stroke: "#9ca3af"; stroke-dash: 3 }
  }
  bit0 -> hex_table: "correct values\nfor all 5 entries" {
    style: { stroke: "#6bcb77"; font-color: "#6bcb77"; font-size: 10 }
  }
}

flags_nibble: "Byte 6 Flags Nibble [7:4] and Limit High [3:0]" {
  style: {
    fill: "#0d1b2a"
    stroke: "#c084fc"
    border-radius: 10
    font-size: 14
    bold: true
  }

  g_bit: "Bit 7\nG = Granularity\n1 = 4KB pages\n0 = byte units\nMUST=1 for 4GB" {
    style: {
      fill: "#2d1f4a"
      stroke: "#c084fc"
      font-color: "#c084fc"
      border-radius: 4
      font-size: 11
    }
  }
  db_bit: "Bit 6\nD/B = Default\n1 = 32-bit ops\n0 = 16-bit ops\nMUST=1 for 32-bit" {
    style: {
      fill: "#2d1f4a"
      stroke: "#c084fc"
      font-color: "#c084fc"
      border-radius: 4
      font-size: 11
    }
  }
  l_bit: "Bit 5\nL = Long mode\n0 = 32-bit seg\n1 = 64-bit seg\nMUST=0 for 32-bit" {
    style: {
      fill: "#1a1a1a"
      stroke: "#9ca3af"
      font-color: "#9ca3af"
      border-radius: 4
      font-size: 11
    }
  }
  avl_bit: "Bit 4\nAVL = Available\nfor OS use\nTypically 0\nignored by CPU" {
    style: {
      fill: "#1a1a1a"
      stroke: "#9ca3af"
      font-color: "#9ca3af"
      border-radius: 4
      font-size: 11
    }
  }
  limit_high: "Bits [3:0]\nLimit[19:16]\n= 0xF for 4GB\nwith G=1: 0xFFFFF\nx 4KB = 4GB-4096" {
    style: {
      fill: "#1e3a5f"
      stroke: "#60a5fa"
      font-color: "#60a5fa"
      border-radius: 4
      font-size: 11
    }
  }

  combined: "Byte 6 = 0xCF for all flat segments\n= 1100 1111\nG=1 D/B=1 L=0 AVL=0 Limit[19:16]=0xF" {
    style: {
      fill: "#1a2a1a"
      stroke: "#6bcb77"
      font-color: "#6bcb77"
      border-radius: 6
      font-size: 12
      bold: true
    }
  }

  g_bit -> combined: "G=1\n4KB granularity" {
    style: { stroke: "#6bcb77"; font-color: "#6bcb77"; font-size: 10 }
  }
  db_bit -> combined: "D/B=1\n32-bit default" {
    style: { stroke: "#6bcb77"; font-color: "#6bcb77"; font-size: 10 }
  }
  l_bit -> combined: "L=0\nnot long mode" {
    style: { stroke: "#9ca3af"; font-color: "#9ca3af"; font-size: 10; stroke-dash: 3 }
  }
  avl_bit -> combined {
    style: { stroke: "#9ca3af"; stroke-dash: 3 }
  }
  limit_high -> combined: "0xF in low nibble" {
    style: { stroke: "#60a5fa"; font-color: "#60a5fa"; font-size: 10 }
  }
}

entry_table: "All 5 Required GDT Entries Side-by-Side" {
  style: {
    fill: "#0a0a1a"
    stroke: "#334155"
    border-radius: 10
    font-size: 14
    bold: true
  }

  null_entry: "Entry 0: NULL DESCRIPTOR\nSelector: 0x00\nLimit[15:0] = 0x0000\nBase[15:0]  = 0x0000\nBase[23:16] = 0x00\nAccess      = 0x00\nFlags+Lim   = 0x00\nBase[31:24] = 0x00\n\nLoading CS=0x00 ALWAYS = GPF\nCatches uninitialized segment regs" {
    style: {
      fill: "#1a1a1a"
      stroke: "#9ca3af"
      font-color: "#9ca3af"
      border-radius: 6
      font-size: 11
    }
  }

  kcode_entry: "Entry 1: KERNEL CODE Ring 0\nSelector: 0x08  index=1 RPL=0\nLimit[15:0] = 0xFFFF\nBase[15:0]  = 0x0000 flat\nBase[23:16] = 0x00   flat\nAccess      = 0x9A  1001 1010\n  P=1 DPL=00 S=1 Type=1010\nFlags+Lim   = 0xCF  G=1 D=1 0xF\nBase[31:24] = 0x00   flat\n\nExecutable+Readable Ring0 4GB" {
    style: {
      fill: "#0d2a0d"
      stroke: "#6bcb77"
      font-color: "#6bcb77"
      border-radius: 6
      font-size: 11
    }
  }

  kdata_entry: "Entry 2: KERNEL DATA Ring 0\nSelector: 0x10  index=2 RPL=0\nLimit[15:0] = 0xFFFF\nBase[15:0]  = 0x0000 flat\nBase[23:16] = 0x00   flat\nAccess      = 0x92  1001 0010\n  P=1 DPL=00 S=1 Type=0010\nFlags+Lim   = 0xCF  G=1 D=1 0xF\nBase[31:24] = 0x00   flat\n\nWritable Data Ring0 4GB" {
    style: {
      fill: "#0d2a0d"
      stroke: "#6bcb77"
      font-color: "#6bcb77"
      border-radius: 6
      font-size: 11
    }
  }

  ucode_entry: "Entry 3: USER CODE Ring 3\nSelector: 0x1B  index=3 RPL=3\nLimit[15:0] = 0xFFFF\nBase[15:0]  = 0x0000 flat\nBase[23:16] = 0x00   flat\nAccess      = 0xFA  1111 1010\n  P=1 DPL=11 S=1 Type=1010\nFlags+Lim   = 0xCF  G=1 D=1 0xF\nBase[31:24] = 0x00   flat\n\nExecutable+Readable Ring3 4GB" {
    style: {
      fill: "#1a0d2a"
      stroke: "#c084fc"
      font-color: "#c084fc"
      border-radius: 6
      font-size: 11
    }
  }

  udata_entry: "Entry 4: USER DATA Ring 3\nSelector: 0x23  index=4 RPL=3\nLimit[15:0] = 0xFFFF\nBase[15:0]  = 0x0000 flat\nBase[23:16] = 0x00   flat\nAccess      = 0xF2  1111 0010\n  P=1 DPL=11 S=1 Type=0010\nFlags+Lim   = 0xCF  G=1 D=1 0xF\nBase[31:24] = 0x00   flat\n\nWritable Data Ring3 4GB" {
    style: {
      fill: "#1a0d2a"
      stroke: "#c084fc"
      font-color: "#c084fc"
      border-radius: 6
      font-size: 11
    }
  }

  null_entry -> kcode_entry: "index 0 to 1\nnull required by spec" {
    style: { stroke: "#475569"; font-color: "#94a3b8"; font-size: 10; stroke-dash: 3 }
  }
  kcode_entry -> kdata_entry: "both Ring 0\nDPL=00" {
    style: { stroke: "#6bcb77"; font-color: "#6bcb77"; font-size: 10 }
  }
  kdata_entry -> ucode_entry: "DPL flips\n00 to 11" {
    style: { stroke: "#fbbf24"; font-color: "#fbbf24"; font-size: 10 }
  }
  ucode_entry -> udata_entry: "both Ring 3\nDPL=11" {
    style: { stroke: "#c084fc"; font-color: "#c084fc"; font-size: 10 }
  }
}

selector_math: "Segment Selector Bit Arithmetic" {
  style: {
    fill: "#0f172a"
    stroke: "#38bdf8"
    border-radius: 10
    font-size: 14
    bold: true
  }

  selector_bits: "16-bit Selector Layout\n\nBits [15:3] = GDT Index (13 bits)\nBit  [2]    = TI: 0=GDT 1=LDT\nBits [1:0]  = RPL Requested Privilege\n              0=ring0  3=ring3" {
    style: {
      fill: "#0f2a3a"
      stroke: "#38bdf8"
      font-color: "#38bdf8"
      border-radius: 6
      font-size: 12
    }
  }

  calc_table: "Selector Calculations\n\nNull   idx=0  0<<3|0 = 0x00  N/A\nKCode  idx=1  1<<3|0 = 0x08  RPL=R0\nKData  idx=2  2<<3|0 = 0x10  RPL=R0\nUCode  idx=3  3<<3|3 = 0x1B  RPL=R3\nUData  idx=4  4<<3|3 = 0x23  RPL=R3\nTSS    idx=5  5<<3|0 = 0x28  ltr" {
    style: {
      fill: "#0a1520"
      stroke: "#475569"
      font-color: "#e2e8f0"
      border-radius: 4
      font-size: 11
      font: mono
    }
  }

  rpl_warning: "RPL Security Check\nCPU enforces: max(CPL, RPL) <= DPL\n\nUser loads 0x08 RPL=0 into DS:\n  CPL=3 RPL=0 DPL=0\n  max(3,0)=3 > DPL=0 = GPF\n\nKernel segments stay kernel-only\nvia hardware enforcement" {
    style: {
      fill: "#3b1a1a"
      stroke: "#ff6b6b"
      font-color: "#fbbf24"
      border-radius: 6
      font-size: 11
      bold: true
    }
  }

  selector_bits -> calc_table: "index x 8\nsets upper bits" {
    style: { stroke: "#38bdf8"; font-color: "#38bdf8"; font-size: 10 }
  }
  calc_table -> rpl_warning: "RPL bits protect\ncross-ring access" {
    style: { stroke: "#ff6b6b"; font-color: "#ff6b6b"; font-size: 10 }
  }
}

danger_zones: "Access Byte Errors That ALWAYS Triple Fault" {
  style: {
    fill: "#1a0505"
    stroke: "#ff4444"
    border-radius: 10
    font-size: 14
    bold: true
    stroke-width: 3
  }

  danger1: "DANGER: P bit = 0\n0x1A instead of 0x9A\n\nCPU loads segment register\nReads descriptor: P=0\nRaises Segment Not Present\nHandler also has bad descriptor\nDOUBLE FAULT then TRIPLE FAULT\n\nFix: Always set bit 7 of access byte" {
    style: {
      fill: "#2a0a0a"
      stroke: "#ff6b6b"
      font-color: "#ff9999"
      border-radius: 6
      font-size: 11
    }
  }

  danger2: "DANGER: S bit = 0 for code/data\n0x82 instead of 0x92\n\nCPU reads as System descriptor type\ngate/LDT/TSS interpretation\nType bits mean different things\nFirst memory access = GPF triple fault\n\nFix: Bit 4 S=1 for code and data segs" {
    style: {
      fill: "#2a0a0a"
      stroke: "#ff6b6b"
      font-color: "#ff9999"
      border-radius: 6
      font-size: 11
    }
  }

  danger3: "DANGER: No far jump after CR0.PE=1\nForgetting jmp 0x08:label\n\nCS still has real-mode value\nCPU pipeline decoded instructions\nas real-mode; executes as 32-bit\nFirst operand mismatch = GPF\nthen TRIPLE FAULT\n\nFix: MANDATORY far jump after CR0.PE=1" {
    style: {
      fill: "#2a1a0a"
      stroke: "#fbbf24"
      font-color: "#fde68a"
      border-radius: 6
      font-size: 11
    }
  }

  danger4: "DANGER: D/B bit = 0 in 32-bit mode\n0x4F instead of 0xCF\n\nCPU defaults to 16-bit operand size\nFirst 32-bit instruction uses wrong width\nStack push/pop corrupts ESP\nSilent corruption then crash later\n\nFix: Bit 6 of byte 6 must = 1 for 32-bit" {
    style: {
      fill: "#2a0a0a"
      stroke: "#ff6b6b"
      font-color: "#ff9999"
      border-radius: 6
      font-size: 11
    }
  }

  danger1 -> danger2: "both immediate\nfault on load" {
    style: { stroke: "#ff4444"; font-color: "#ff4444"; font-size: 10 }
  }
  danger2 -> danger3: "different cause\nsame triple fault" {
    style: { stroke: "#ff4444"; font-color: "#ff4444"; font-size: 10 }
  }
  danger3 -> danger4: "D/B causes\nsilent corruption" {
    style: { stroke: "#fbbf24"; font-color: "#fbbf24"; font-size: 10 }
  }
}

nasm_source: "NASM Source Annotated with Field Positions" {
  style: {
    fill: "#0a0f1a"
    stroke: "#475569"
    border-radius: 10
    font-size: 14
    bold: true
  }

  note_fields: "Fields are NON-CONTIGUOUS by Intel 286 extension design\nBase and Limit are split across non-adjacent bytes\nBackward-compat decision from 1985 that persists today" {
    style: {
      fill: "#1a1a2a"
      stroke: "#475569"
      font-color: "#94a3b8"
      border-radius: 4
      font-size: 11
    }
  }

  null_desc: "Entry 0: NULL\ndq 0\n8 zero bytes\nselector 0x00 = GPF if loaded" {
    style: {
      fill: "#1a1a1a"
      stroke: "#9ca3af"
      font-color: "#9ca3af"
      border-radius: 4
      font-size: 11
    }
  }

  kcode_desc: "Entry 1: Kernel Code Ring 0\ndw 0xFFFF  ; Limit[15:0]\ndw 0x0000  ; Base[15:0] flat\ndb 0x00    ; Base[23:16] flat\ndb 0x9A    ; CRITICAL ACCESS BYTE\ndb 0xCF    ; G=1 D/B=1 Limit=0xF\ndb 0x00    ; Base[31:24] flat" {
    style: {
      fill: "#0d2a0d"
      stroke: "#6bcb77"
      font-color: "#6bcb77"
      border-radius: 4
      font-size: 11
      font: mono
    }
  }

  kdata_desc: "Entry 2: Kernel Data Ring 0\ndw 0xFFFF\ndw 0x0000\ndb 0x00\ndb 0x92    ; writable data\ndb 0xCF\ndb 0x00" {
    style: {
      fill: "#0d2a0d"
      stroke: "#6bcb77"
      font-color: "#6bcb77"
      border-radius: 4
      font-size: 11
      font: mono
    }
  }

  ucode_desc: "Entry 3: User Code Ring 3\ndw 0xFFFF\ndw 0x0000\ndb 0x00\ndb 0xFA    ; DPL=11 code\ndb 0xCF\ndb 0x00" {
    style: {
      fill: "#1a0d2a"
      stroke: "#c084fc"
      font-color: "#c084fc"
      border-radius: 4
      font-size: 11
      font: mono
    }
  }

  udata_desc: "Entry 4: User Data Ring 3\ndw 0xFFFF\ndw 0x0000\ndb 0x00\ndb 0xF2    ; DPL=11 data\ndb 0xCF\ndb 0x00" {
    style: {
      fill: "#1a0d2a"
      stroke: "#c084fc"
      font-color: "#c084fc"
      border-radius: 4
      font-size: 11
      font: mono
    }
  }

  gdtr_desc: "GDTR descriptor\ngdt_descriptor:\n  dw gdt_end - gdt_start - 1\n  dd gdt_start\n\nlgdt [gdt_descriptor]\nLoads 6-byte GDTR register\ninto CPU hardware register" {
    style: {
      fill: "#1a2a3a"
      stroke: "#38bdf8"
      font-color: "#38bdf8"
      border-radius: 4
      font-size: 11
      font: mono
    }
  }

  note_fields -> null_desc {
    style: { stroke: "#475569"; stroke-dash: 3 }
  }
  null_desc -> kcode_desc: "index 0 to 1" {
    style: { stroke: "#475569"; font-color: "#94a3b8"; font-size: 10 }
  }
  kcode_desc -> kdata_desc: "index 1 to 2" {
    style: { stroke: "#6bcb77"; font-color: "#6bcb77"; font-size: 10 }
  }
  kdata_desc -> ucode_desc: "index 2 to 3\nDPL 00 to 11" {
    style: { stroke: "#fbbf24"; font-color: "#fbbf24"; font-size: 10 }
  }
  ucode_desc -> udata_desc: "index 3 to 4" {
    style: { stroke: "#c084fc"; font-color: "#c084fc"; font-size: 10 }
  }
  udata_desc -> gdtr_desc: "lgdt loads\nall 5 entries" {
    style: { stroke: "#38bdf8"; font-color: "#38bdf8"; font-size: 10 }
  }
}

byte_map -> access_byte: "Byte 5 is the\nmost critical field" {
  style: {
    stroke: "#ff6b6b"
    font-color: "#ff6b6b"
    font-size: 12
    bold: true
    stroke-width: 2
  }
}
byte_map -> flags_nibble: "Byte 6 controls\n32-bit vs 16-bit mode" {
  style: { stroke: "#c084fc"; font-color: "#c084fc"; font-size: 11 }
}
access_byte -> entry_table: "These hex values\napply to all 5 entries" {
  style: { stroke: "#6bcb77"; font-color: "#6bcb77"; font-size: 11 }
}
flags_nibble -> entry_table: "0xCF identical\nacross all 5 entries" {
  style: { stroke: "#6bcb77"; font-color: "#6bcb77"; font-size: 11 }
}
entry_table -> selector_math: "Selectors encode\nindex plus RPL bits" {
  style: { stroke: "#38bdf8"; font-color: "#38bdf8"; font-size: 11 }
}
access_byte -> danger_zones: "Wrong bits here\n= triple fault path" {
  style: {
    stroke: "#ff4444"
    font-color: "#ff4444"
    font-size: 12
    bold: true
    stroke-width: 2
    animated: true
  }
}
danger_zones -> nasm_source: "Correct values\nshown in source" {
  style: { stroke: "#6bcb77"; font-color: "#6bcb77"; font-size: 11 }
}
entry_table -> nasm_source: "Source maps\ndirectly to table" {
  style: { stroke: "#475569"; font-color: "#94a3b8"; font-size: 10; stroke-dash: 3 }
}
selector_math -> nasm_source: "0x08 0x10 0x1B 0x23\nverifiable from source" {
  style: { stroke: "#475569"; font-color: "#94a3b8"; font-size: 10; stroke-dash: 3 }
}

legend: Legend {
  near: bottom-center
  style: {
    fill: "#1a1a2e"
    stroke: "#444466"
    border-radius: 8
    font-size: 13
  }
  l1: "Red = Danger / Triple-fault if wrong" {
    shape: text
    style.font-color: "#ff6b6b"
    style.bold: true
  }
  l2: "Green = Safe / Correct for flat model" {
    shape: text
    style.font-color: "#6bcb77"
    style.bold: true
  }
  l3: "Purple = Metadata / Control bits" {
    shape: text
    style.font-color: "#c084fc"
    style.bold: true
  }
  l4: "Blue = Data / Address fields" {
    shape: text
    style.font-color: "#60a5fa"
    style.bold: true
  }
  l5: "Gray = Unused / Always zero" {
    shape: text
    style.font-color: "#9ca3af"
  }
}