vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}

title: VGA Text Buffer Memory Layout {
  near: top-center
  shape: text
  style: {
    font-size: 32
    bold: true
    underline: true
  }
}

direction: right

vga_buffer: "VGA Text Buffer @ 0xB8000" {
  style: {
    fill: "#1a1a2e"
    stroke: "#4a4a6a"
    stroke-width: 3
    border-radius: 8
    font-color: white
  }

  header_row: "Row 0" {
    grid-columns: 5
    grid-gap: 0
    style.fill: "#16213e"
    
    cell_0_0: "Cell [0,0]"
    cell_0_1: "Cell [0,1]"
    cell_0_2: "..."
    cell_0_78: "Cell [0,78]"
    cell_0_79: "Cell [0,79]"
  }
  
  dots_1: |md
    ⋮
  | {shape: text}
  
  middle_row: "Row 12" {
    grid-columns: 5
    grid-gap: 0
    style.fill: "#16213e"
    
    cell_12_0: "Cell [12,0]"
    cell_12_1: "Cell [12,1]"
    cell_12_2: "..."
    cell_12_78: "Cell [12,78]"
    cell_12_79: "Cell [12,79]"
  }
  
  dots_2: |md
    ⋮
  | {shape: text}
  
  footer_row: "Row 24" {
    grid-columns: 5
    grid-gap: 0
    style.fill: "#16213e"
    
    cell_24_0: "Cell [24,0]"
    cell_24_1: "Cell [24,1]"
    cell_24_2: "..."
    cell_24_78: "Cell [24,78]"
    cell_24_79: "Cell [24,79]"
  }
  
  header_row -> dots_1 -> middle_row -> dots_2 -> footer_row
}

cell_detail: "Character Cell Detail (2 bytes)" {
  style: {
    fill: "#0f0f23"
    stroke: "#6a6a8a"
    border-radius: 6
  }
  
  offset_0: "+0" {
    shape: text
    style.font-color: "#888"
  }
  
  char_byte: "Character Byte" {
    style: {
      fill: "#4a90d9"
      font-color: white
      bold: true
    }
  }
  
  offset_1: "+1" {
    shape: text
    style.font-color: "#888"
  }
  
  attr_byte: "Attribute Byte" {
    style: {
      fill: "#7b68ee"
      font-color: white
      bold: true
    }
  }
  
  offset_0 -> char_byte -> offset_1 -> attr_byte
}

attribute_encoding: "Attribute Byte Encoding" {
  style: {
    fill: "#1a1a2e"
    stroke: "#4a4a6a"
    border-radius: 6
  }
  
  bits_7_4: "Bits 7-4: Background" {
    style: {
      fill: "#2d5a27"
      font-color: white
    }
  }
  
  bits_3_0: "Bits 3-0: Foreground" {
    style: {
      fill: "#8b4513"
      font-color: white
    }
  }
  
  bit_7: "Bit 7: Blink" {
    style: {
      fill: "#8b0000"
      font-color: white
      font-size: 12
    }
  }
  
  bits_7_4 -> bits_3_0
  bits_7_4 -> bit_7
}

color_palette: "VGA Color Palette" {
  grid-columns: 4
  grid-gap: 4
  
  c0: "0: Black" {style.fill: "#000000"; style.font-color: white}
  c1: "1: Blue" {style.fill: "#0000aa"; style.font-color: white}
  c2: "2: Green" {style.fill: "#00aa00"; style.font-color: white}
  c3: "3: Cyan" {style.fill: "#00aaaa"; style.font-color: white}
  c4: "4: Red" {style.fill: "#aa0000"; style.font-color: white}
  c5: "5: Magenta" {style.fill: "#aa00aa"; style.font-color: white}
  c6: "6: Brown" {style.fill: "#aa5500"; style.font-color: white}
  c7: "7: Light Grey" {style.fill: "#aaaaaa"; style.font-color: black}
  c8: "8: Dark Grey" {style.fill: "#555555"; style.font-color: white}
  c9: "9: Light Blue" {style.fill: "#5555ff"; style.font-color: white}
  c10: "10: Light Green" {style.fill: "#55ff55"; style.font-color: black}
  c11: "11: Light Cyan" {style.fill: "#55ffff"; style.font-color: black}
  c12: "12: Light Red" {style.fill: "#ff5555"; style.font-color: black}
  c13: "13: Light Magenta" {style.fill: "#ff55ff"; style.font-color: black}
  c14: "14: Yellow" {style.fill: "#ffff55"; style.font-color: black}
  c15: "15: White" {style.fill: "#ffffff"; style.font-color: black}
}

memory_layout: "Memory Layout" {
  style: {
    fill: "#0f0f23"
    stroke: "#4a4a6a"
    border-radius: 6
  }
  
  addr_b8000: "0xB8000" {
    style: {
      fill: "#6a5acd"
      font-color: white
      font: mono
    }
  }
  
  buffer_size: "4000 bytes (80×25×2)" {
    style: {
      fill: "#2f4f4f"
      font-color: white
    }
  }
  
  addr_b8fa0: "0xB8FA0" {
    style: {
      fill: "#6a5acd"
      font-color: white
      font: mono
    }
  }
  
  growth: |md
    ↑ Growth Direction
  | {shape: text}
  
  growth -> addr_b8000 -> buffer_size -> addr_b8fa0
}

vga_buffer -> cell_detail
cell_detail -> attribute_encoding
attribute_encoding -> color_palette
vga_buffer -> memory_layout