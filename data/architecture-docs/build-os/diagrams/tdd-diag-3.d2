vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}
title: |md
  # GDT Entry — 64-bit Segment Descriptor (8 Bytes)
  Access byte bit fields + concrete hex values for all five GDT entries
| {near: top-center}
# ── BYTE LAYOUT ROW ──────────────────────────────────────────────────────────
layout: {
  grid-columns: 8
  grid-gap: 0
  b0: "Byte 0\n+0" {
    style.fill: "#7C3AED"
    style.font-color: white
    style.stroke: "#4C1D95"
    style.stroke-width: 2
    style.bold: true
  }
  b1: "Byte 1\n+1" {
    style.fill: "#7C3AED"
    style.font-color: white
    style.stroke: "#4C1D95"
    style.stroke-width: 2
    style.bold: true
  }
  b2: "Byte 2\n+2" {
    style.fill: "#1D4ED8"
    style.font-color: white
    style.stroke: "#1E3A8A"
    style.stroke-width: 2
    style.bold: true
  }
  b3: "Byte 3\n+3" {
    style.fill: "#1D4ED8"
    style.font-color: white
    style.stroke: "#1E3A8A"
    style.stroke-width: 2
    style.bold: true
  }
  b4: "Byte 4\n+4" {
    style.fill: "#1D4ED8"
    style.font-color: white
    style.stroke: "#1E3A8A"
    style.stroke-width: 2
    style.bold: true
  }
  b5: "Byte 5\n+5" {
    style.fill: "#B45309"
    style.font-color: white
    style.stroke: "#78350F"
    style.stroke-width: 3
    style.bold: true
  }
  b6: "Byte 6\n+6" {
    style.fill: "#065F46"
    style.font-color: white
    style.stroke: "#022C22"
    style.stroke-width: 2
    style.bold: true
  }
  b7: "Byte 7\n+7" {
    style.fill: "#1D4ED8"
    style.font-color: white
    style.stroke: "#1E3A8A"
    style.stroke-width: 2
    style.bold: true
  }
}
fields: {
  grid-columns: 8
  grid-gap: 0
  f0: "limit_low\n[15:0]\nbits 15–0" {
    style.fill: "#EDE9FE"
    style.stroke: "#7C3AED"
    style.stroke-width: 2
    style.font-size: 11
  }
  f1: "limit_low\n[15:0]\nbits 15–0" {
    style.fill: "#EDE9FE"
    style.stroke: "#7C3AED"
    style.stroke-width: 2
    style.font-size: 11
  }
  f2: "base_low\n[15:0]\nbits 15–0" {
    style.fill: "#DBEAFE"
    style.stroke: "#1D4ED8"
    style.stroke-width: 2
    style.font-size: 11
  }
  f3: "base_low\n[15:0]\nbits 15–0" {
    style.fill: "#DBEAFE"
    style.stroke: "#1D4ED8"
    style.stroke-width: 2
    style.font-size: 11
  }
  f4: "base_mid\n[23:16]\nbits 23–16" {
    style.fill: "#DBEAFE"
    style.stroke: "#1D4ED8"
    style.stroke-width: 2
    style.font-size: 11
  }
  f5: "ACCESS BYTE\nP·DPL·S·E·DC·RW·A\n(see detail)" {
    style.fill: "#FEF3C7"
    style.stroke: "#B45309"
    style.stroke-width: 3
    style.bold: true
    style.font-size: 11
  }
  f6: "FLAGS + limit_hi\nG·DB·L·AVL | [19:16]\n(see detail)" {
    style.fill: "#D1FAE5"
    style.stroke: "#065F46"
    style.stroke-width: 2
    style.font-size: 11
  }
  f7: "base_high\n[31:24]\nbits 31–24" {
    style.fill: "#DBEAFE"
    style.stroke: "#1D4ED8"
    style.stroke-width: 2
    style.font-size: 11
  }
}
# ── ACCESS BYTE BIT FIELD DETAIL (Byte 5) ────────────────────────────────────
access_detail: "ACCESS BYTE — Byte 5 Bit Fields" {
  style.fill: "#FFFBEB"
  style.stroke: "#B45309"
  style.stroke-width: 2
  style.border-radius: 4
  bits: {
    grid-columns: 8
    grid-gap: 0
    bit7: "Bit 7\nP\nPresent" {
      style.fill: "#FDE68A"
      style.stroke: "#B45309"
      style.stroke-width: 2
      style.bold: true
      style.font-size: 12
    }
    bit65: "Bits 6:5\nDPL\nPriv Level" {
      style.fill: "#FDE68A"
      style.stroke: "#B45309"
      style.stroke-width: 2
      style.bold: true
      style.font-size: 12
    }
    bit4: "Bit 4\nS\nDescr Type" {
      style.fill: "#FDE68A"
      style.stroke: "#B45309"
      style.stroke-width: 2
      style.bold: true
      style.font-size: 12
    }
    bit3: "Bit 3\nE\nExecutable" {
      style.fill: "#FDE68A"
      style.stroke: "#B45309"
      style.stroke-width: 2
      style.bold: true
      style.font-size: 12
    }
    bit2: "Bit 2\nDC\nDir/Conform" {
      style.fill: "#FDE68A"
      style.stroke: "#B45309"
      style.stroke-width: 2
      style.bold: true
      style.font-size: 12
    }
    bit1: "Bit 1\nRW\nRead/Write" {
      style.fill: "#FDE68A"
      style.stroke: "#B45309"
      style.stroke-width: 2
      style.bold: true
      style.font-size: 12
    }
    bit0: "Bit 0\nA\nAccessed" {
      style.fill: "#FDE68A"
      style.stroke: "#B45309"
      style.stroke-width: 2
      style.bold: true
      style.font-size: 12
    }
    bitpad: "" {
      style.opacity: 0
    }
  }
  vals_null: {
    grid-columns: 8
    grid-gap: 0
    v7: "0" {style.fill: "#F3F4F6"; style.stroke: "#D1D5DB"; style.font-size: 13; style.bold: true}
    v65: "00" {style.fill: "#F3F4F6"; style.stroke: "#D1D5DB"; style.font-size: 13; style.bold: true}
    v4: "0" {style.fill: "#F3F4F6"; style.stroke: "#D1D5DB"; style.font-size: 13; style.bold: true}
    v3: "0" {style.fill: "#F3F4F6"; style.stroke: "#D1D5DB"; style.font-size: 13; style.bold: true}
    v2: "0" {style.fill: "#F3F4F6"; style.stroke: "#D1D5DB"; style.font-size: 13; style.bold: true}
    v1: "0" {style.fill: "#F3F4F6"; style.stroke: "#D1D5DB"; style.font-size: 13; style.bold: true}
    v0: "0" {style.fill: "#F3F4F6"; style.stroke: "#D1D5DB"; style.font-size: 13; style.bold: true}
    vlabel: "Null\n0x00" {style.fill: "#6B7280"; style.font-color: white; style.font-size: 11; style.bold: true}
  }
  vals_kcode: {
    grid-columns: 8
    grid-gap: 0
    v7: "1" {style.fill: "#EDE9FE"; style.stroke: "#7C3AED"; style.font-size: 13; style.bold: true}
    v65: "00" {style.fill: "#EDE9FE"; style.stroke: "#7C3AED"; style.font-size: 13; style.bold: true}
    v4: "1" {style.fill: "#EDE9FE"; style.stroke: "#7C3AED"; style.font-size: 13; style.bold: true}
    v3: "1" {style.fill: "#EDE9FE"; style.stroke: "#7C3AED"; style.font-size: 13; style.bold: true}
    v2: "0" {style.fill: "#EDE9FE"; style.stroke: "#7C3AED"; style.font-size: 13; style.bold: true}
    v1: "1" {style.fill: "#EDE9FE"; style.stroke: "#7C3AED"; style.font-size: 13; style.bold: true}
    v0: "0" {style.fill: "#EDE9FE"; style.stroke: "#7C3AED"; style.font-size: 13; style.bold: true}
    vlabel: "K. Code\n0x9A" {style.fill: "#7C3AED"; style.font-color: white; style.font-size: 11; style.bold: true}
  }
  vals_kdata: {
    grid-columns: 8
    grid-gap: 0
    v7: "1" {style.fill: "#DBEAFE"; style.stroke: "#1D4ED8"; style.font-size: 13; style.bold: true}
    v65: "00" {style.fill: "#DBEAFE"; style.stroke: "#1D4ED8"; style.font-size: 13; style.bold: true}
    v4: "1" {style.fill: "#DBEAFE"; style.stroke: "#1D4ED8"; style.font-size: 13; style.bold: true}
    v3: "0" {style.fill: "#DBEAFE"; style.stroke: "#1D4ED8"; style.font-size: 13; style.bold: true}
    v2: "0" {style.fill: "#DBEAFE"; style.stroke: "#1D4ED8"; style.font-size: 13; style.bold: true}
    v1: "1" {style.fill: "#DBEAFE"; style.stroke: "#1D4ED8"; style.font-size: 13; style.bold: true}
    v0: "0" {style.fill: "#DBEAFE"; style.stroke: "#1D4ED8"; style.font-size: 13; style.bold: true}
    vlabel: "K. Data\n0x92" {style.fill: "#1D4ED8"; style.font-color: white; style.font-size: 11; style.bold: true}
  }
  vals_ucode: {
    grid-columns: 8
    grid-gap: 0
    v7: "1" {style.fill: "#FCE7F3"; style.stroke: "#BE185D"; style.font-size: 13; style.bold: true}
    v65: "11" {style.fill: "#FCE7F3"; style.stroke: "#BE185D"; style.font-size: 13; style.bold: true; style.font-color: "#BE185D"}
    v4: "1" {style.fill: "#FCE7F3"; style.stroke: "#BE185D"; style.font-size: 13; style.bold: true}
    v3: "1" {style.fill: "#FCE7F3"; style.stroke: "#BE185D"; style.font-size: 13; style.bold: true}
    v2: "0" {style.fill: "#FCE7F3"; style.stroke: "#BE185D"; style.font-size: 13; style.bold: true}
    v1: "1" {style.fill: "#FCE7F3"; style.stroke: "#BE185D"; style.font-size: 13; style.bold: true}
    v0: "0" {style.fill: "#FCE7F3"; style.stroke: "#BE185D"; style.font-size: 13; style.bold: true}
    vlabel: "U. Code\n0xFA" {style.fill: "#BE185D"; style.font-color: white; style.font-size: 11; style.bold: true}
  }
  vals_udata: {
    grid-columns: 8
    grid-gap: 0
    v7: "1" {style.fill: "#FEF9C3"; style.stroke: "#92400E"; style.font-size: 13; style.bold: true}
    v65: "11" {style.fill: "#FEF9C3"; style.stroke: "#92400E"; style.font-size: 13; style.bold: true; style.font-color: "#92400E"}
    v4: "1" {style.fill: "#FEF9C3"; style.stroke: "#92400E"; style.font-size: 13; style.bold: true}
    v3: "0" {style.fill: "#FEF9C3"; style.stroke: "#92400E"; style.font-size: 13; style.bold: true}
    v2: "0" {style.fill: "#FEF9C3"; style.stroke: "#92400E"; style.font-size: 13; style.bold: true}
    v1: "1" {style.fill: "#FEF9C3"; style.stroke: "#92400E"; style.font-size: 13; style.bold: true}
    v0: "0" {style.fill: "#FEF9C3"; style.stroke: "#92400E"; style.font-size: 13; style.bold: true}
    vlabel: "U. Data\n0xF2" {style.fill: "#92400E"; style.font-color: white; style.font-size: 11; style.bold: true}
  }
}
# ── FLAGS BYTE DETAIL (Byte 6) ────────────────────────────────────────────────
flags_detail: "FLAGS + LIMIT[19:16] — Byte 6 Bit Fields" {
  style.fill: "#ECFDF5"
  style.stroke: "#065F46"
  style.stroke-width: 2
  style.border-radius: 4
  bits: {
    grid-columns: 4
    grid-gap: 0
    bit7: "Bit 7\nG\nGranularity\n1=4KB pages" {
      style.fill: "#A7F3D0"
      style.stroke: "#065F46"
      style.stroke-width: 2
      style.bold: true
      style.font-size: 11
    }
    bit6: "Bit 6\nDB\n32-bit seg\n1=32-bit" {
      style.fill: "#A7F3D0"
      style.stroke: "#065F46"
      style.stroke-width: 2
      style.bold: true
      style.font-size: 11
    }
    bit5: "Bit 5\nL\n64-bit seg\n0 for 32-bit" {
      style.fill: "#A7F3D0"
      style.stroke: "#065F46"
      style.stroke-width: 2
      style.bold: true
      style.font-size: 11
    }
    bit4: "Bit 4\nAVL\nOS available\nignored" {
      style.fill: "#A7F3D0"
      style.stroke: "#065F46"
      style.stroke-width: 2
      style.bold: true
      style.font-size: 11
    }
  }
  limit_hi: {
    grid-columns: 4
    grid-gap: 0
    lh3: "Bit 3\nlimit[19]\n" {style.fill: "#EDE9FE"; style.stroke: "#7C3AED"; style.font-size: 11}
    lh2: "Bit 2\nlimit[18]\n" {style.fill: "#EDE9FE"; style.stroke: "#7C3AED"; style.font-size: 11}
    lh1: "Bit 1\nlimit[17]\n" {style.fill: "#EDE9FE"; style.stroke: "#7C3AED"; style.font-size: 11}
    lh0: "Bit 0\nlimit[16]\n" {style.fill: "#EDE9FE"; style.stroke: "#7C3AED"; style.font-size: 11}
  }
  all_entries: |md
    **All five entries: flags nibble = 0xC, limit_hi nibble = 0xF → byte 6 = 0xCF**
    | Entry | G | DB | L | AVL | limit[19:16] | Byte 6 |
    |-------|---|----|---|-----|--------------|--------|
    | Null  | 0 |  0 | 0 |  0  |    0x0       | 0x00   |
    | Kernel Code (0x08) | **1** | **1** | 0 | 0 | **0xF** | **0xCF** |
    | Kernel Data (0x10) | **1** | **1** | 0 | 0 | **0xF** | **0xCF** |
    | User Code (0x18) | **1** | **1** | 0 | 0 | **0xF** | **0xCF** |
    | User Data (0x20) | **1** | **1** | 0 | 0 | **0xF** | **0xCF** |
  |
}
# ── COMPLETE FIVE-ENTRY GDT TABLE ─────────────────────────────────────────────
gdt_table: "Complete Five-Entry GDT — All Eight Bytes Per Entry" {
  style.fill: "#F8FAFC"
  style.stroke: "#334155"
  style.stroke-width: 2
  style.border-radius: 4
  table: |md
    | Idx | Selector | Name | Byte0 limit[7:0] | Byte1 limit[15:8] | Byte2 base[7:0] | Byte3 base[15:8] | Byte4 base[23:16] | Byte5 ACCESS | Byte6 FLAGS+lim | Byte7 base[31:24] | Base | Limit | DPL |
    |-----|----------|------|------|------|------|------|------|------|------|------|------|------|-----|
    | 0 | 0x00 | **Null** | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | **0x00** | **0x00** | 0x00 | 0 | 0 | — |
    | 1 | 0x08 | **Kernel Code** | 0xFF | 0xFF | 0x00 | 0x00 | 0x00 | **0x9A** | **0xCF** | 0x00 | 0x00000000 | 4 GB | Ring 0 |
    | 2 | 0x10 | **Kernel Data** | 0xFF | 0xFF | 0x00 | 0x00 | 0x00 | **0x92** | **0xCF** | 0x00 | 0x00000000 | 4 GB | Ring 0 |
    | 3 | 0x18 | **User Code** | 0xFF | 0xFF | 0x00 | 0x00 | 0x00 | **0xFA** | **0xCF** | 0x00 | 0x00000000 | 4 GB | Ring 3 |
    | 4 | 0x20 | **User Data** | 0xFF | 0xFF | 0x00 | 0x00 | 0x00 | **0xF2** | **0xCF** | 0x00 | 0x00000000 | 4 GB | Ring 3 |
  |
}
# ── ACCESS BYTE QUICK DECODE ──────────────────────────────────────────────────
decode: "Access Byte Hex → Bit Decode" {
  style.fill: "#F1F5F9"
  style.stroke: "#475569"
  style.stroke-width: 2
  style.border-radius: 4
  rows: {
    grid-columns: 5
    grid-gap: 0
    h0: "Hex" {style.fill: "#334155"; style.font-color: white; style.bold: true}
    h1: "Binary" {style.fill: "#334155"; style.font-color: white; style.bold: true}
    h2: "P·DPL·S" {style.fill: "#334155"; style.font-color: white; style.bold: true}
    h3: "E·DC·RW·A" {style.fill: "#334155"; style.font-color: white; style.bold: true}
    h4: "Meaning" {style.fill: "#334155"; style.font-color: white; style.bold: true}
    r0hex: "0x00" {style.fill: "#F3F4F6"; style.stroke: "#D1D5DB"; style.bold: true}
    r0bin: "0000 0000" {style.fill: "#F3F4F6"; style.stroke: "#D1D5DB"; style.font: mono}
    r0pds: "0·00·0" {style.fill: "#F3F4F6"; style.stroke: "#D1D5DB"}
    r0erwa: "0·0·0·0" {style.fill: "#F3F4F6"; style.stroke: "#D1D5DB"}
    r0m: "Null — not present" {style.fill: "#F3F4F6"; style.stroke: "#D1D5DB"}
    r1hex: "0x9A" {style.fill: "#EDE9FE"; style.stroke: "#7C3AED"; style.bold: true}
    r1bin: "1001 1010" {style.fill: "#EDE9FE"; style.stroke: "#7C3AED"; style.font: mono}
    r1pds: "1·00·1" {style.fill: "#EDE9FE"; style.stroke: "#7C3AED"}
    r1erwa: "1·0·1·0" {style.fill: "#EDE9FE"; style.stroke: "#7C3AED"}
    r1m: "Kernel code: present, ring0, code, readable" {style.fill: "#EDE9FE"; style.stroke: "#7C3AED"}
    r2hex: "0x92" {style.fill: "#DBEAFE"; style.stroke: "#1D4ED8"; style.bold: true}
    r2bin: "1001 0010" {style.fill: "#DBEAFE"; style.stroke: "#1D4ED8"; style.font: mono}
    r2pds: "1·00·1" {style.fill: "#DBEAFE"; style.stroke: "#1D4ED8"}
    r2erwa: "0·0·1·0" {style.fill: "#DBEAFE"; style.stroke: "#1D4ED8"}
    r2m: "Kernel data: present, ring0, data, writable" {style.fill: "#DBEAFE"; style.stroke: "#1D4ED8"}
    r3hex: "0xFA" {style.fill: "#FCE7F3"; style.stroke: "#BE185D"; style.bold: true}
    r3bin: "1111 1010" {style.fill: "#FCE7F3"; style.stroke: "#BE185D"; style.font: mono}
    r3pds: "1·11·1" {style.fill: "#FCE7F3"; style.stroke: "#BE185D"; style.font-color: "#BE185D"; style.bold: true}
    r3erwa: "1·0·1·0" {style.fill: "#FCE7F3"; style.stroke: "#BE185D"}
    r3m: "User code: present, ring3, code, readable" {style.fill: "#FCE7F3"; style.stroke: "#BE185D"}
    r4hex: "0xF2" {style.fill: "#FEF9C3"; style.stroke: "#92400E"; style.bold: true}
    r4bin: "1111 0010" {style.fill: "#FEF9C3"; style.stroke: "#92400E"; style.font: mono}
    r4pds: "1·11·1" {style.fill: "#FEF9C3"; style.stroke: "#92400E"; style.font-color: "#92400E"; style.bold: true}
    r4erwa: "0·0·1·0" {style.fill: "#FEF9C3"; style.stroke: "#92400E"}
    r4m: "User data: present, ring3, data, writable" {style.fill: "#FEF9C3"; style.stroke: "#92400E"}
  }
}
# ── GDTR PSEUDO-DESCRIPTOR ────────────────────────────────────────────────────
gdtr: "GDTR Pseudo-Descriptor (6 bytes, loaded via LGDT)" {
  style.fill: "#FFF7ED"
  style.stroke: "#C2410C"
  style.stroke-width: 2
  style.border-radius: 4
  fields_gdtr: {
    grid-columns: 3
    grid-gap: 0
    fh: "Bytes 0–1\nlimit (uint16_t)" {style.fill: "#FED7AA"; style.stroke: "#C2410C"; style.bold: true}
    fb: "Bytes 2–5\nbase (uint32_t)" {style.fill: "#FED7AA"; style.stroke: "#C2410C"; style.bold: true}
    fv: "Values" {style.fill: "#FED7AA"; style.stroke: "#C2410C"; style.bold: true}
    fh2: "5 × 8 − 1 = 39\n0x0027" {style.fill: "#FFEDD5"; style.stroke: "#C2410C"; style.font: mono}
    fb2: "(uint32_t)&gdt[0]\nlinear addr of GDT" {style.fill: "#FFEDD5"; style.stroke: "#C2410C"; style.font: mono}
    fv2: "sizeof(gdt)=40 bytes\ncovers all 5 entries" {style.fill: "#FFEDD5"; style.stroke: "#C2410C"}
  }
  note: |md
    **struct gdtr { uint16_t limit; uint32_t base; } \_\_attribute\_\_((packed));  // sizeof == 6**
    lgdt [gdtr]  → loads CPU GDTR register; after this, all segment selectors resolve against this table.
  |
}
# ── ANNOTATIONS ──────────────────────────────────────────────────────────────
note_flat: |md
  **Flat Memory Model:** All code/data segments have Base=0x00000000 and Limit=0xFFFFFFFF.
  Segmentation is effectively a no-op — virtual address = linear address.
  **Isolation is enforced entirely by the DPL field (ring 0 vs ring 3) and paging.**
| {near: bottom-center}
# ── CONNECTIONS ──────────────────────────────────────────────────────────────
layout -> fields: "field names" {style.stroke-dash: 4; style.stroke: "#64748B"}
fields.f5 -> access_detail: "expand bit fields" {style.stroke: "#B45309"; style.stroke-width: 2}
fields.f6 -> flags_detail: "expand bit fields" {style.stroke: "#065F46"; style.stroke-width: 2}
access_detail -> gdt_table: "concrete hex values" {style.stroke: "#334155"; style.stroke-dash: 3}
flags_detail -> gdt_table: "concrete hex values" {style.stroke: "#334155"; style.stroke-dash: 3}
gdt_table -> decode: "hex decode" {style.stroke: "#475569"; style.stroke-dash: 3}
gdt_table -> gdtr: "loaded by LGDT" {style.stroke: "#C2410C"; style.stroke-width: 2}