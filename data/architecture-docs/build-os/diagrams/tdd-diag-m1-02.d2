vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}
shape: sequence_diagram
BIOS
MBR: "MBR (0x7C00)"
Stage2: "Stage 2 Loader"
CPU: "CPU (x86)"
Kernel: "kernel_main()"
POST: {
  BIOS -> BIOS: "1. Power-On Self Test (POST)"
  BIOS -> BIOS: "2. Initialize hardware, check RAM"
}
Boot: {
  BIOS -> MBR: "3. Load sector 0 to 0x7C00"
  BIOS -> MBR: "4. Verify boot signature 0x55AA"
  BIOS -> MBR: "5. Jump to 0x7C00 (DL=boot drive)"
}
RealMode: {
  MBR -> MBR: "6. Set up segments (DS=ES=SS=0)"
  MBR -> MBR: "7. Set up stack (SP=0x7C00)"
  MBR -> MBR: "8. Enable A20 line"
  MBR -> CPU: "9. Load GDT (lgdt)"
}
ProtMode: {
  MBR -> CPU: "10. Set CR0.PE=1"
  MBR -> CPU: "11. Far jump (flush pipeline)"
  CPU -> CPU: "12. Now in 32-bit protected mode"
}
KernelLoad: {
  MBR -> Stage2: "13. Load Stage 2 from disk"
  Stage2 -> Stage2: "14. Load kernel to 0x100000"
  Stage2 -> Stage2: "15. Reload segment registers (0x10)"
  Stage2 -> Stage2: "16. Set kernel stack (ESP=0x90000)"
}
Entry: {
  Stage2 -> Kernel: "17. Jump to kernel_entry (0x100000)"
  Kernel -> Kernel: "18. Zero BSS section"
  Kernel -> Kernel: "19. Call kernel_main()"
  Kernel -> Kernel: "20. Init VGA, serial, kprintf"
  Kernel -> Kernel: "21. System ready!"
}