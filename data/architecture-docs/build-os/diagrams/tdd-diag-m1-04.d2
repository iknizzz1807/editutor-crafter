vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}
title: |md
  # GDT Segment Descriptor: Bit-Level Layout
  **8 bytes (64 bits) | Little-endian memory order**
| {near: top-center}
direction: right
descriptor: {
  grid-rows: 8
  grid-columns: 2
  grid-gap: 0
  b7: "**Byte 7**"
  b7.class: header
  b7_val: "`Base [31:24]`"
  b7_val.class: data
  b6: "**Byte 6**"
  b6.class: header
  b6_val: "`Flags[7:4] | Limit[19:16]`"
  b6_val.class: data
  b5: "**Byte 5**"
  b5.class: header
  b5_val: "`Access Byte`"
  b5_val.class: data
  b4: "**Byte 4**"
  b4.class: header
  b4_val: "`Base [23:16]`"
  b4_val.class: data
  b3: "**Byte 3**"
  b3.class: header
  b3_val: "`Base [15:8]`"
  b3_val.class: data
  b2: "**Byte 2**"
  b2.class: header
  b2_val: "`Base [7:0]`"
  b2_val.class: data
  b1: "**Byte 1**"
  b1.class: header
  b1_val: "`Limit [15:8]`"
  b1_val.class: data
  b0: "**Byte 0**"
  b0.class: header
  b0_val: "`Limit [7:0]`"
  b0_val.class: data
}
access_byte: {
  label: "Access Byte (Byte 5)"
  bits: {
    grid-rows: 3
    grid-columns: 8
    grid-gap: 2
    b7: "**7**"
    b7.class: bit-label
    b6: "**6**"
    b6.class: bit-label
    b5: "**5**"
    b5.class: bit-label
    b4: "**4**"
    b4.class: bit-label
    b3: "**3**"
    b3.class: bit-label
    b2: "**2**"
    b2.class: bit-label
    b1: "**1**"
    b1.class: bit-label
    b0: "**0**"
    b0.class: bit-label
    name7: "P"
    name7.class: field-name
    name6: "DPL"
    name6.class: field-name
    name5: "DPL"
    name5.class: field-name
    name4: "S"
    name4.class: field-name
    name3: "E"
    name3.class: field-name
    name2: "DC"
    name2.class: field-name
    name1: "RW"
    name1.class: field-name
    name0: "A"
    name0.class: field-name
    val7: "Present"
    val7.class: field-desc
    val6: "Privilege"
    val6.class: field-desc
    val5: "Level"
    val5.class: field-desc
    val4: "System"
    val4.class: field-desc
    val3: "Exec"
    val3.class: field-desc
    val2: "Dir/Conf"
    val2.class: field-desc
    val1: "R/W"
    val1.class: field-desc
    val0: "Accessed"
    val0.class: field-desc
  }
}
flags_byte: {
  label: "Flags (Byte 6, high nibble)"
  fbits: {
    grid-rows: 3
    grid-columns: 4
    grid-gap: 2
    fb7: "**7**"
    fb7.class: bit-label
    fb6: "**6**"
    fb6.class: bit-label
    fb5: "**5**"
    fb5.class: bit-label
    fb4: "**4**"
    fb4.class: bit-label
    fname7: "G"
    fname7.class: field-name
    fname6: "D/B"
    fname6.class: field-name
    fname5: "L"
    fname5.class: field-name
    fname4: "AVL"
    fname4.class: field-name
    fval7: "Granularity"
    fval7.class: field-desc
    fval6: "Size"
    fval6.class: field-desc
    fval5: "Long"
    fval5.class: field-desc
    fval4: "Available"
    fval4.class: field-desc
  }
}
example: {
  label: "Example: Kernel Code Segment (0x00CF9A000000FFFF)"
  ex: {
    grid-rows: 8
    grid-columns: 2
    grid-gap: 0
    exb7: "**Byte 7**"
    exb7.class: ex-header
    exb7v: "`0x00` Base[31:24]=0"
    exb7v.class: ex-data
    exb6: "**Byte 6**"
    exb6.class: ex-header
    exb6v: "`0xCF` G=1,D=1,L=0,Limit[19:16]=0xF"
    exb6v.class: ex-data
    exb5: "**Byte 5**"
    exb5.class: ex-header
    exb5v: "`0x9A` P=1,DPL=0,S=1,E=1,DC=0,RW=1,A=0"
    exb5v.class: ex-data
    exb4: "**Byte 4**"
    exb4.class: ex-header
    exb4v: "`0x00` Base[23:16]=0"
    exb4v.class: ex-data
    exb3: "**Byte 3**"
    exb3.class: ex-header
    exb3v: "`0x00` Base[15:8]=0"
    exb3v.class: ex-data
    exb2: "**Byte 2**"
    exb2.class: ex-header
    exb2v: "`0x00` Base[7:0]=0"
    exb2v.class: ex-data
    exb1: "**Byte 1**"
    exb1.class: ex-header
    exb1v: "`0xFF` Limit[15:8]=0xFF"
    exb1v.class: ex-data
    exb0: "**Byte 0**"
    exb0.class: ex-header
    exb0v: "`0xFF` Limit[7:0]=0xFF"
    exb0v.class: ex-data
  }
  result: |md
    **Result**: Base=0x00000000, Limit=0xFFFFF (4GB with G=1)
    Ring 0 code segment, readable, 32-bit default
  |
}
legend: {
  label: "Selector Calculation"
  sel: |md
    Selector = (Index x 8) | TI | RPL
    Index 1 -> Selector 0x08 (Kernel CS)
    Index 2 -> Selector 0x10 (Kernel DS)
    Index 3 -> Selector 0x18 (User CS)
    Index 4 -> Selector 0x20 (User DS)
    TI (Table Indicator): 0=GDT, 1=LDT
    RPL (Requested Privilege Level): 0-3
  |
}
classes: {
  header: {
    style: {
      fill: "#9B59B6"
      font-color: white
      bold: true
      stroke: "#8E44AD"
    }
  }
  data: {
    style: {
      fill: "#3498DB"
      font-color: white
      font: mono
      stroke: "#2980B9"
    }
  }
  bit-label: {
    style: {
      fill: "#E8E8E8"
      font-color: "#333"
      font-size: 14
      bold: true
    }
  }
  field-name: {
    style: {
      fill: "#F39C12"
      font-color: white
      bold: true
    }
  }
  field-desc: {
    style: {
      fill: "#ECF0F1"
      font-color: "#2C3E50"
      font-size: 12
    }
  }
  ex-header: {
    style: {
      fill: "#27AE60"
      font-color: white
      bold: true
      stroke: "#1E8449"
    }
  }
  ex-data: {
    style: {
      fill: "#2ECC71"
      font-color: white
      font: mono
      font-size: 12
      stroke: "#27AE60"
    }
  }
}
legend -> access_byte
access_byte -> flags_byte
flags_byte -> example
example -> legend