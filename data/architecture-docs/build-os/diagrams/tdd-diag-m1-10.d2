vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}
title: |md
  # VGA Text Mode Buffer Layout
  80x25 Character Buffer at Physical Address 0xB8000
| {
  near: top-center
}
direction: right
memory_map: {
  label: "Physical Memory Region"
  style.fill: "#E8E8E8"
  style.stroke: "#666666"
  reserved_low: {
    label: "0x00000 - 0xA0000\nReserved / BIOS"
    style.fill: "#CCCCCC"
    style.stroke: "#888888"
  }
  vga_region: {
    label: "VGA Text Buffer\n0xB8000 - 0xBFFFF"
    style.fill: "#4A90D9"
    style.stroke: "#2E5A8A"
    style.font-color: white
  }
  reserved_high: {
    label: "0xC0000 - 0xFFFFF\nBIOS ROM"
    style.fill: "#CCCCCC"
    style.stroke: "#888888"
  }
  reserved_low -> vga_region -> reserved_high
}
buffer_structure: {
  label: "VGA Buffer Structure (4000 bytes total)"
  style.fill: "#E3F2FD"
  style.stroke: "#1565C0"
  cell_example: {
    label: "Each Cell = 2 Bytes"
    style.fill: "#BBDEFB"
    style.stroke: "#1976D2"
    char_byte: {
      label: "Character Byte\n(ASCII 0-255)"
      style.fill: "#90CAF9"
      style.stroke: "#1565C0"
      width: 120
    }
    attr_byte: {
      label: "Attribute Byte\n(Colors)"
      style.fill: "#CE93D8"
      style.stroke: "#7B1FA2"
      width: 120
    }
    char_byte -> attr_byte
  }
  rows: {
    label: "80 Columns x 25 Rows"
    style.fill: "#E1F5FE"
    style.stroke: "#0288D1"
    row0: {
      label: "Row 0 (0x00-0x9F)\n160 bytes"
      style.fill: "#B3E5FC"
      style.stroke: "#0288D1"
    }
    row1: {
      label: "Row 1 (0xA0-0x13F)\n160 bytes"
      style.fill: "#81D4FA"
      style.stroke: "#0288D1"
    }
    row_ellipsis: {
      label: "..."
      shape: text
      style.fill: transparent
    }
    row24: {
      label: "Row 24 (0xF00-0xF9F)\n160 bytes"
      style.fill: "#4FC3F7"
      style.stroke: "#0288D1"
    }
    row0 -> row1 -> row_ellipsis -> row24
  }
  cell_example -> rows
}
attribute_byte: {
  label: "Attribute Byte Format"
  style.fill: "#F3E5F5"
  style.stroke: "#7B1FA2"
  bits_layout: {
    label: |md
      **Bit 7**: Blink / Bright BG  
      **Bits 6-4**: Background Color (0-7)  
      **Bits 3-0**: Foreground Color (0-15)
    |
    shape: text
    style.fill: transparent
  }
  color_table: {
    label: "Color Codes"
    style.fill: "#EDE7F6"
    style.stroke: "#5E35B1"
    fg_colors: {
      label: |md
        **Foreground (0-15):**
        0=Black, 1=Blue, 2=Green  
        3=Cyan, 4=Red, 5=Magenta  
        6=Brown, 7=Light Grey  
        8=Dark Grey, 9=Light Blue  
        10=Light Green, 11=Light Cyan  
        12=Light Red, 13=Light Magenta  
        14=Yellow, 15=White
      |
      shape: text
      style.fill: transparent
    }
    bg_colors: {
      label: |md
        **Background (0-7):**
        Same colors 0-7  
        (No bright backgrounds  
        unless bit 7 set)
      |
      shape: text
      style.fill: transparent
    }
  }
  bits_layout -> color_table
}
addressing: {
  label: "Address Calculation"
  style.fill: "#FFF3E0"
  style.stroke: "#E65100"
  formula: {
    label: |md
      **Cell Address:**  
      `0xB8000 + (row x 160) + (col x 2)`  
      **Example:** Row 5, Col 10  
      = 0xB8000 + (5 x 160) + (10 x 2)  
      = 0xB8000 + 800 + 20  
      = **0xB8324**
    |
    shape: text
    style.fill: transparent
  }
  cursor_pos: {
    label: |md
      **Cursor Position:**  
      I/O Ports 0x3D4-0x3D5  
      Read/Write cursor position  
      for hardware cursor display
    |
    shape: text
    style.fill: transparent
  }
  formula -> cursor_pos
}
memory_map -> buffer_structure
buffer_structure -> attribute_byte
attribute_byte -> addressing
legend: {
  near: bottom-center
  label: |md
    **Legend:** Character Data (Blue) | Attribute/Color Data (Purple) | Address Info (Orange)
  |
  shape: text
}