vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
  colors: {
    header: "#8B5CF6"
    data: "#3B82F6"
    pointer: "#F97316"
    reserved: "#9CA3AF"
  }
}
title: |md
  # IDT Gate Descriptor: Bit-Level Layout
  **8 bytes (64 bits) per entry**
| {near: top-center}
IDT_Entry: {
  grid-columns: 4
  grid-gap: 0
  byte_label: |md
    **Byte**
  |
  byte_label.class: header_cell
  bytes_01: |md
    **0-1**
  |
  bytes_01.class: header_cell
  bytes_23: |md
    **2-3**
  |
  bytes_23.class: header_cell
  bytes_47: |md
    **4-7**
  |
  bytes_47.class: header_cell
  field_label: |md
    **Field**
  |
  field_label.class: header_cell
  offset_low: |md
    Offset Low
    [15:0]
  |
  offset_low.class: data_cell
  selector: |md
    Segment
    Selector
  |
  selector.class: data_cell
  rest: |md
    Reserved | Attr | Reserved | Offset High
  |
  rest.class: mixed_cell
  bits_label: |md
    **Bits**
  |
  bits_label.class: header_cell
  bits_01: |md
    0-15
    (16 bits)
  |
  bits_01.class: data_cell
  bits_23: |md
    16-31
    (16 bits)
  |
  bits_23.class: data_cell
  bits_47: |md
    32-63
    (32 bits)
  |
  bits_47.class: mixed_cell
  desc_label: |md
    **Purpose**
  |
  desc_label.class: header_cell
  desc_01: |md
    Handler address
    lower 16 bits
  |
  desc_01.class: data_cell
  desc_23: |md
    Code segment
    (e.g., 0x08)
  |
  desc_23.class: data_cell
  desc_47: |md
    See detail below
  |
  desc_47.class: mixed_cell
}
Attribute_Byte: {
  label: "Attribute Byte (Byte 5)"
  grid-columns: 4
  grid-gap: 0
  bit7: |md
    **7**
    P
  |
  bit7.class: attr_present
  bit6_5: |md
    **6-5**
    DPL
  |
  bit6_5.class: attr_dpl
  bit4: |md
    **4**
    S
  |
  bit4.class: attr_system
  bit3_0: |md
    **3-0**
    Type
  |
  bit3_0.class: attr_type
}
Bytes_4_6_7: {
  label: "Bytes 4, 6, 7 Detail"
  grid-columns: 3
  grid-gap: 4
  byte4: |md
    ### Byte 4
    **Reserved**
    Must be 0x00
  |
  byte4.class: reserved_cell
  byte6: |md
    ### Byte 6
    **Flags + Limit High**
    Bits 7: G (Granularity)
    Bit 6: D/B (Size)
    Bit 5: L (Long mode)
    Bit 4: AVL (Available)
    Bits 3-0: Offset [19:16]
  |
  byte6.class: flags_cell
  byte7: |md
    ### Byte 7
    **Offset High**
    Handler address
    upper 8 bits
    [31:24]
  |
  byte7.class: offset_high_cell
}
Type_Field: {
  label: "Type Field Values (Bits 3-0)"
  grid-columns: 2
  grid-gap: 4
  interrupt: |md
    #### 32-bit Interrupt Gate
    **0xE (1110b)**
    - Disables interrupts on entry
    - Most common for hardware IRQs
    - Use: 0x8E (P=1, DPL=0)
  |
  interrupt.class: type_int
  trap: |md
    #### 32-bit Trap Gate
    **0xF (1111b)**
    - Keeps interrupt flag unchanged
    - Used for syscalls (DPL=3)
    - Use: 0xEF (P=1, DPL=3)
  |
  trap.class: type_trap
}
Complete_Example: {
  label: "Complete Example: Interrupt Gate (Kernel)"
  grid-columns: 1
  example: |md
    Entry for IRQ handler at address 0x00123456:
    Byte 0: 0x56  ← Offset[15:0] low
    Byte 1: 0x34  ← Offset[15:0] high
    Byte 2: 0x08  ← Selector (kernel CS)
    Byte 3: 0x00  ← Reserved
    Byte 4: 0x8E  ← P=1, DPL=0, S=0, Type=0xE
    Byte 5: 0x00  ← Flags=0, Offset[19:16]=0
    Byte 6: 0x00  ← Offset[31:24]=0
    Little-endian: 0x008E0000083456
  |
  example.class: example_cell
}
classes: {
  header_cell: {
    style: {
      fill: "${colors.header}"
      font-color: white
      bold: true
      stroke: "#7C3AED"
    }
  }
  data_cell: {
    style: {
      fill: "${colors.data}"
      font-color: white
      stroke: "#2563EB"
    }
  }
  mixed_cell: {
    style: {
      fill: "${colors.reserved}"
      font-color: white
      stroke: "#6B7280"
    }
  }
  reserved_cell: {
    style: {
      fill: "${colors.reserved}"
      font-color: "#374151"
      stroke: "#9CA3AF"
    }
  }
  attr_present: {
    style: {
      fill: "#10B981"
      font-color: white
      bold: true
    }
  }
  attr_dpl: {
    style: {
      fill: "#F59E0B"
      font-color: white
      bold: true
    }
  }
  attr_system: {
    style: {
      fill: "#6366F1"
      font-color: white
      bold: true
    }
  }
  attr_type: {
    style: {
      fill: "#EC4899"
      font-color: white
      bold: true
    }
  }
  flags_cell: {
    style: {
      fill: "#8B5CF6"
      font-color: white
      stroke: "#7C3AED"
    }
  }
  offset_high_cell: {
    style: {
      fill: "#3B82F6"
      font-color: white
      stroke: "#2563EB"
    }
  }
  type_int: {
    style: {
      fill: "#059669"
      font-color: white
      stroke: "#047857"
    }
  }
  type_trap: {
    style: {
      fill: "#DC2626"
      font-color: white
      stroke: "#B91C1C"
    }
  }
  example_cell: {
    style: {
      fill: "#1F2937"
      font-color: "#10B981"
      font: mono
      stroke: "#374151"
    }
  }
}
IDT_Entry -> Attribute_Byte: "Byte 5 detail"
Attribute_Byte -> Bytes_4_6_7: "Other bytes"
Bytes_4_6_7 -> Type_Field: "Type values"
Type_Field -> Complete_Example: "Example"
style: {
  fill: "#F3F4F6"
  stroke: "#E5E7EB"
  font-size: 14
}