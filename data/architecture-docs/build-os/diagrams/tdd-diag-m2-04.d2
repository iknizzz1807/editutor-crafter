vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}
title: |md
  # CPU Exception Vectors 0-31
  x86 Protected Mode Exception Reference
| {near: top-center}
# Vector table header
header: {
  grid-columns: 4
  v0: "Vector" {class: header-cell}
  v1: "Exception" {class: header-cell}
  v2: "Error Code" {class: header-cell}
  v3: "Common Cause" {class: header-cell}
}
# Exception entries with error code (need special handling)
has_error: {
  style.fill: "#FFE4E1"
  style.stroke: "#CD5C5C"
}
# Fatal/unrecoverable exceptions
fatal: {
  style.fill: "#FFB6C1"
  style.stroke: "#DC143C"
}
# Standard exceptions (no error code)
standard: {
  style.fill: "#E6F3FF"
  style.stroke: "#4682B4"
}
# Reserved/undefined vectors
reserved: {
  style.fill: "#F5F5F5"
  style.stroke: "#D3D3D3"
}
# Row 0: Divide Error
row0: {
  grid-columns: 4
  c0: "0 (0x00)" {class: standard}
  c1: "#DE - Divide Error" {class: standard}
  c2: "No" {class: standard}
  c3: "DIV/IDIV with zero divisor or quotient overflow" {class: standard}
}
# Row 1: Debug
row1: {
  grid-columns: 4
  c0: "1 (0x01)" {class: standard}
  c1: "#DB - Debug Exception" {class: standard}
  c2: "No" {class: standard}
  c3: "Single-step, breakpoint DR, or ICE" {class: standard}
}
# Row 2: NMI
row2: {
  grid-columns: 4
  c0: "2 (0x02)" {class: standard}
  c1: "NMI - Non-Maskable Interrupt" {class: standard}
  c2: "No" {class: standard}
  c3: "Hardware emergency (parity error, bus fault)" {class: standard}
}
# Row 3: Breakpoint
row3: {
  grid-columns: 4
  c0: "3 (0x03)" {class: standard}
  c1: "#BP - Breakpoint" {class: standard}
  c2: "No" {class: standard}
  c3: "INT3 instruction (0xCC) for debuggers" {class: standard}
}
# Row 4: Overflow
row4: {
  grid-columns: 4
  c0: "4 (0x04)" {class: standard}
  c1: "#OF - Overflow" {class: standard}
  c2: "No" {class: standard}
  c3: "INTO instruction with OF flag set" {class: standard}
}
# Row 5: BOUND
row5: {
  grid-columns: 4
  c0: "5 (0x05)" {class: standard}
  c1: "#BR - BOUND Range Exceeded" {class: standard}
  c2: "No" {class: standard}
  c3: "BOUND instruction array index violation" {class: standard}
}
# Row 6: Invalid Opcode
row6: {
  grid-columns: 4
  c0: "6 (0x06)" {class: standard}
  c1: "#UD - Invalid Opcode" {class: standard}
  c2: "No" {class: standard}
  c3: "Undefined instruction, UD2, or wrong mode" {class: standard}
}
# Row 7: Device Not Available
row7: {
  grid-columns: 4
  c0: "7 (0x07)" {class: standard}
  c1: "#NM - Device Not Available" {class: standard}
  c2: "No" {class: standard}
  c3: "FPU/x87 instruction with CR0.EM=1 or TS=1" {class: standard}
}
# Row 8: Double Fault (FATAL, has error code)
row8: {
  grid-columns: 4
  c0: "8 (0x08)" {class: fatal}
  c1: "#DF - Double Fault" {class: fatal}
  c2: "Yes (always 0)" {class: fatal}
  c3: "Exception during exception handler (kernel bug)" {class: fatal}
}
# Row 9: Coprocessor Segment Overrun
row9: {
  grid-columns: 4
  c0: "9 (0x09)" {class: standard}
  c1: "Coprocessor Segment Overrun" {class: standard}
  c2: "No" {class: standard}
  c3: "FPU operand wraps 64KB segment (386 only)" {class: standard}
}
# Row 10: Invalid TSS (has error code)
row10: {
  grid-columns: 4
  c0: "10 (0x0A)" {class: has_error}
  c1: "#TS - Invalid TSS" {class: has_error}
  c2: "Yes (selector)" {class: has_error}
  c3: "Task switch with invalid TSS descriptor" {class: has_error}
}
# Row 11: Segment Not Present (has error code)
row11: {
  grid-columns: 4
  c0: "11 (0x0B)" {class: has_error}
  c1: "#NP - Segment Not Present" {class: has_error}
  c2: "Yes (selector)" {class: has_error}
  c3: "Load segment with P=0 in descriptor" {class: has_error}
}
# Row 12: Stack Segment Fault (has error code)
row12: {
  grid-columns: 4
  c0: "12 (0x0C)" {class: has_error}
  c1: "#SS - Stack Segment Fault" {class: has_error}
  c2: "Yes (selector)" {class: has_error}
  c3: "Stack op with SS limit violation or P=0" {class: has_error}
}
# Row 13: General Protection (has error code)
row13: {
  grid-columns: 4
  c0: "13 (0x0D)" {class: has_error}
  c1: "#GP - General Protection" {class: has_error}
  c2: "Yes (selector)" {class: has_error}
  c3: "Privilege violation, bad selector, or any protection fault" {class: has_error}
}
# Row 14: Page Fault (has error code)
row14: {
  grid-columns: 4
  c0: "14 (0x0E)" {class: has_error}
  c1: "#PF - Page Fault" {class: has_error}
  c2: "Yes (P/W/U/R bits)" {class: has_error}
  c3: "Page not present, protection, or reserved bit" {class: has_error}
}
# Row 15: Reserved
row15: {
  grid-columns: 4
  c0: "15 (0x0F)" {class: reserved}
  c1: "(Reserved)" {class: reserved}
  c2: "-" {class: reserved}
  c3: "Intel reserved - do not use" {class: reserved}
}
# Row 16: x87 FPU Error
row16: {
  grid-columns: 4
  c0: "16 (0x10)" {class: standard}
  c1: "#MF - x87 FPU Floating-Point Error" {class: standard}
  c2: "No" {class: standard}
  c3: "FPU exception pending (CR0.NE=0 systems)" {class: standard}
}
# Row 17: Alignment Check (has error code)
row17: {
  grid-columns: 4
  c0: "17 (0x11)" {class: has_error}
  c1: "#AC - Alignment Check" {class: has_error}
  c2: "Yes (always 0)" {class: has_error}
  c3: "Misaligned access with CR0.AM=1 and EFLAGS.AC=1" {class: has_error}
}
# Row 18: Machine Check (FATAL)
row18: {
  grid-columns: 4
  c0: "18 (0x12)" {class: fatal}
  c1: "#MC - Machine Check" {class: fatal}
  c2: "No (model-specific)" {class: fatal}
  c3: "CPU internal error (ECC, cache, bus)" {class: fatal}
}
# Row 19: SIMD Exception
row19: {
  grid-columns: 4
  c0: "19 (0x13)" {class: standard}
  c1: "#XM - SIMD Floating-Point" {class: standard}
  c2: "No" {class: standard}
  c3: "SSE/AVX exception (divide by zero, overflow)" {class: standard}
}
# Row 20: Virtualization
row20: {
  grid-columns: 4
  c0: "20 (0x14)" {class: standard}
  c1: "#VE - Virtualization Exception" {class: standard}
  c2: "No" {class: standard}
  c3: "EPT violation with VMX enabled" {class: standard}
}
# Row 21: Control Protection
row21: {
  grid-columns: 4
  c0: "21 (0x15)" {class: standard}
  c1: "#CP - Control Protection" {class: standard}
  c2: "Yes" {class: standard}
  c3: "CET/Shadow stack violation" {class: standard}
}
# Rows 22-31: Reserved
row22_31: {
  grid-columns: 4
  c0: "22-31" {class: reserved}
  c1: "(Reserved)" {class: reserved}
  c2: "-" {class: reserved}
  c3: "Intel reserved for future use" {class: reserved}
}
# Legend
legend: {
  near: bottom-center
  legend_title: "Legend" {
    shape: text
    style.bold: true
  }
  leg: {
    grid-columns: 4
    l1: "Blue" {class: standard}
    l2: "Standard exception (no error code)" {style.stroke-width: 0}
    l3: "" {style.fill: transparent; style.stroke-width: 0}
    l4: "" {style.fill: transparent; style.stroke-width: 0}
    l5: "Pink border" {class: has_error}
    l6: "Has error code on stack" {style.stroke-width: 0}
    l7: "" {style.fill: transparent; style.stroke-width: 0}
    l8: "" {style.fill: transparent; style.stroke-width: 0}
    l9: "Red" {class: fatal}
    l10: "Fatal/Abort exception" {style.stroke-width: 0}
    l11: "" {style.fill: transparent; style.stroke-width: 0}
    l12: "" {style.fill: transparent; style.stroke-width: 0}
    l13: "Gray" {class: reserved}
    l14: "Reserved vector" {style.stroke-width: 0}
    l15: "" {style.fill: transparent; style.stroke-width: 0}
    l16: "" {style.fill: transparent; style.stroke-width: 0}
  }
}
# Error code format note
error_code_note: ||md
  ## Error Code Format (when present)
  | Bit | Name | Meaning |
  |-----|------|---------|
  | 0 | EXT | 1 = external event, 0 = internal |
  | 1 | IDT | 1 = index in IDT, 0 = GDT/LDT |
  | 2 | TI | 1 = LDT, 0 = GDT |
  | 3-15 | Index | Selector index |
  **Page Fault (#PF) special format:**
  | Bit | Name | 0 = | 1 = |
  |-----|------|-----|-----|
  | 0 | P | Not present | Protection violation |
  | 1 | W | Read | Write |
  | 2 | U | Supervisor | User mode |
  | 3 | R | - | Reserved bit set |
  | 4 | I | - | Instruction fetch |
|| {near: center-right}
# Classes
classes: {
  header-cell: {
    style: {
      bold: true
      fill: "#4A90D9"
      font-color: white
    }
  }
}