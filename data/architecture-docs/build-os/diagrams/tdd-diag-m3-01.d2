vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}
title: |md
  # E820 Memory Map: Physical Memory Layout
  BIOS-reported memory regions with types, addresses, and sizes
| {near: top-center}
direction: right
# Legend
legend: {
  legend_title: Legend
  grid-columns: 2
  usable: "Usable RAM" {
    style.fill: "#90EE90"
    style.stroke: "#228B22"
  }
  reserved: "Reserved (BIOS/MMIO)" {
    style.fill: "#FFB6C1"
    style.stroke: "#DC143C"
  }
  acpi: "ACPI Tables" {
    style.fill: "#87CEEB"
    style.stroke: "#4169E1"
  }
  style.fill: "#F5F5F5"
  style.stroke: "#333333"
  style.border-radius: 4
}
# Memory regions from E820 BIOS call
memory_map: {
  label: "Physical Address Space (32-bit)"
  # Base memory - conventional low memory
  ivt: "0x00000000\nIVT + BDA\n(1 KB)" {
    style.fill: "#FFB6C1"
    style.stroke: "#DC143C"
    style.stroke-width: 2
  }
  low_mem: "0x00000400\nConventional Memory\n(~639 KB usable)" {
    style.fill: "#90EE90"
    style.stroke: "#228B22"
    style.stroke-width: 2
  }
  # EBDA and video memory gap
  ebda: "0x00080000\nEBDA + Video ROM\n(~128 KB)" {
    style.fill: "#FFB6C1"
    style.stroke: "#DC143C"
    style.stroke-width: 2
  }
  vga_mem: "0x000A0000\nVGA Video Memory\n(128 KB)" {
    style.fill: "#DDA0DD"
    style.stroke: "#800080"
    style.stroke-width: 2
  }
  # BIOS ROM area
  bios_rom: "0x000F0000\nBIOS ROM + Extensions\n(64 KB)" {
    style.fill: "#FFB6C1"
    style.stroke: "#DC143C"
    style.stroke-width: 2
  }
  # Extended memory - main usable region
  ext_mem: "0x00100000 (1 MB)\nExtended Memory\n(Usable RAM - varies)" {
    style.fill: "#90EE90"
    style.stroke: "#228B22"
    style.stroke-width: 3
    width: 300
  }
  # ACPI region (example location)
  acpi_region: "0x00FF0000\nACPI Tables\n(~64 KB)" {
    style.fill: "#87CEEB"
    style.stroke: "#4169E1"
    style.stroke-width: 2
  }
  # MMIO region for devices
  mmio_high: "0xFE000000\nMemory-Mapped I/O\n(Device registers)" {
    style.fill: "#FFB6C1"
    style.stroke: "#DC143C"
    style.stroke-width: 2
  }
  # Layout connections (vertical stack showing memory order)
  ivt -> low_mem: "contiguous"
  low_mem -> ebda: ""
  ebda -> vga_mem: ""
  vga_mem -> bios_rom: ""
  bios_rom -> ext_mem: "gap to 1MB"
  ext_mem -> acpi_region: ""
  acpi_region -> mmio_high: ""
}
# Detail table for E820 entries
e820_table: {
  label: "E820 Entry Format (24 bytes)"
  entry_struct: {
    shape: class
    label: "struct multiboot_mmap_entry"
    size_field: "+0x00: uint32_t size"
    base_field: "+0x04: uint64_t base_addr"
    length_field: "+0x0C: uint64_t length"
    type_field: "+0x14: uint32_t type"
  }
  type_codes: |md
    **Type Values:**
    - `1` = Usable (RAM)
    - `2` = Reserved
    - `3` = ACPI Reclaimable
    - `4` = ACPI NVS
    - `5` = Bad Memory
  |
  style.fill: "#F0F0F0"
  style.stroke: "#333333"
}
# Memory region detail panel
region_details: {
  label: "Typical Memory Regions"
  grid-columns: 1
  region_0: "Region 0: Base=0x00000000, Len=0x0009FC00, Type=USABLE" {
    style.fill: "#90EE90"
    style.font-size: 14
  }
  region_1: "Region 1: Base=0x0009FC00, Len=0x00000400, Type=RESERVED" {
    style.fill: "#FFB6C1"
    style.font-size: 14
  }
  region_2: "Region 2: Base=0x000E0000, Len=0x00020000, Type=RESERVED" {
    style.fill: "#FFB6C1"
    style.font-size: 14
  }
  region_3: "Region 3: Base=0x00100000, Len=0x1FE00000, Type=USABLE" {
    style.fill: "#90EE90"
    style.font-size: 14
  }
  region_4: "Region 4: Base=0xFE000000, Len=0x02000000, Type=RESERVED" {
    style.fill: "#FFB6C1"
    style.font-size: 14
  }
  style.fill: "#FFFFFF"
  style.stroke: "#666666"
}
# Key addresses annotation
key_addrs: {
  label: "Key Addresses"
  addr_1mb: |md
    **1 MB Boundary (0x100000)**
    - First safe location for kernel
    - Above all legacy reserved regions
    - Standard kernel load address
  |
  addr_vga: |md
    **VGA Buffer (0xB8000)**
    - Text mode video memory
    - 80Ã—25 character cells
    - 2 bytes per cell (char + attr)
  |
  addr_4gb: |md
    **4 GB Limit (0xFFFFFFFF)**
    - Maximum 32-bit address
    - High MMIO region below this
  |
  style.fill: "#FFFACD"
  style.stroke: "#DAA520"
}
# Connections
memory_map -> region_details: "Example entries"
e820_table -> memory_map: "describes"
legend -> memory_map: ""
key_addrs -> memory_map: ""