vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}
title: |md
  # Two-Level Page Table Hierarchy
  x86 32-bit Paging Structure
| {near: top-center}
direction: right
CR3: {
  label: "CR3 Register\n(Page Directory Base)"
  shape: cylinder
  style.fill: "#9B59B6"
  style.stroke: "#7D3C98"
  style.font-color: white
  style.bold: true
}
pd_index: |md
  **PD Index**
  Bits 31-22
  (10 bits â†’ 1024 entries)
| {near: top-left}
Page_Directory: {
  label: "Page Directory\n(4KB, 1024 entries)"
  shape: rectangle
  style.fill: "#3498DB"
  style.stroke: "#2980B9"
  style.font-color: white
  pd_entry_0: "Entry 0" {style.fill: "#5DADE2"}
  pd_entry_1: "Entry 1" {style.fill: "#5DADE2"}
  pd_entry_2: "..." {style.fill: "#85C1E9"}
  pd_entry_3: "Entry 1023" {style.fill: "#5DADE2"}
}
pt_index: |md
  **PT Index**
  Bits 21-12
  (10 bits â†’ 1024 entries)
| {near: top-left}
Page_Table_0: {
  label: "Page Table 0\n(4KB, 1024 entries)"
  shape: rectangle
  style.fill: "#1ABC9C"
  style.stroke: "#16A085"
  style.font-color: white
  pt_entry_0: "Entry 0" {style.fill: "#48C9B0"}
  pt_entry_1: "Entry 1" {style.fill: "#48C9B0"}
  pt_entry_2: "..." {style.fill: "#76D7C4"}
  pt_entry_3: "Entry 1023" {style.fill: "#48C9B0"}
}
Page_Table_767: {
  label: "Page Table 767\n(Kernel Space)"
  shape: rectangle
  style.fill: "#E74C3C"
  style.stroke: "#C0392B"
  style.font-color: white
  pt_k_entry: "Kernel\nMappings" {style.fill: "#F1948A"}
}
page_offset: |md
  **Page Offset**
  Bits 11-0
  (12 bits â†’ 4096 bytes)
| {near: top-left}
Physical_Memory: {
  label: "Physical Memory"
  shape: rectangle
  style.fill: "#27AE60"
  style.stroke: "#1E8449"
  style.font-color: white
  frame_0: "Frame 0\n(4KB)" {style.fill: "#58D68D"}
  frame_1: "Frame 1\n(4KB)" {style.fill: "#58D68D"}
  frame_2: "..." {style.fill: "#82E0AA"}
  frame_3: "Frame N\n(4KB)" {style.fill: "#58D68D"}
}
Virtual_Address: {
  label: "Virtual Address (32-bit)"
  shape: rectangle
  style.fill: "#F39C12"
  style.stroke: "#D68910"
  style.font-color: white
  style.bold: true
  va_bits: |md
    31    22 21    12 11         0
    â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚PD Idxâ”‚PT Idxâ”‚ Page Offset â”‚
    â”‚10 bitsâ”‚10 bitsâ”‚  12 bits   â”‚
    â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  |
}
CR3 -> Page_Directory: "Points to PD\n(4KB aligned)" {
  style.stroke: "#7D3C98"
  style.stroke-width: 3
}
Page_Directory.pd_entry_0 -> Page_Table_0: "PDE[0] â†’ PT0" {
  label: "Entry contains\nPT physical addr"
  style.stroke: "#2980B9"
}
Page_Directory.pd_entry_3 -> Page_Table_767: "PDE[767] â†’ PT767" {
  style.stroke: "#2980B9"
  style.stroke-dash: 3
}
Page_Table_0.pt_entry_0 -> Physical_Memory.frame_0: "PTE â†’ Frame" {
  label: "Entry contains\nframe physical addr"
  style.stroke: "#16A085"
}
Page_Table_0.pt_entry_3 -> Physical_Memory.frame_3: "PTE â†’ Frame" {
  style.stroke: "#16A085"
  style.stroke-dash: 3
}
Virtual_Address -> Page_Directory: "Bits 31-22\nselect PDE" {
  style.stroke: "#D68910"
  style.animated: true
}
Virtual_Address -> Page_Table_0: "Bits 21-12\nselect PTE" {
  style.stroke: "#D68910"
  style.animated: true
  style.stroke-dash: 5
}
Virtual_Address -> Physical_Memory: "Bits 11-0\noffset in frame" {
  style.stroke: "#D68910"
  style.stroke-dash: 3
}
Legend: {
  near: bottom-center
  style.fill: transparent
  colors: |md
    **Legend:**
    ğŸŸ£ CR3 Register (Purple)
    ğŸ”µ Page Directory (Blue)
    ğŸŸ¢ Page Table - User (Teal)
    ğŸ”´ Page Table - Kernel (Red)
    ğŸŸ¢ Physical Memory (Green)
    ğŸŸ  Virtual Address (Orange)
  |
}