vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
  colors: {
    header: "#8B5CF6"
    data: "#3B82F6"
    free: "#22C55E"
    padding: "#9CA3AF"
    pointer: "#F97316"
    bit: "#6366F1"
    label: "#64748B"
  }
}
title: |md
  # Page Directory/Table Entry Format
  **4-byte PDE/PTE Structure (32 bits)**
| {near: top-center}
direction: right
# 32-bit entry breakdown
entry_layout: {
  label: ""
  # Bit position labels
  bit_labels: {
    grid-columns: 32
    grid-gap: 0
    b0: "0" {style: {font-size: 10; fill: ${colors.label}}}
    b1: "1" {style: {font-size: 10; fill: ${colors.label}}}
    b2: "2" {style: {font-size: 10; fill: ${colors.label}}}
    b3: "3" {style: {font-size: 10; fill: ${colors.label}}}
    b4: "4" {style: {font-size: 10; fill: ${colors.label}}}
    b5: "5" {style: {font-size: 10; fill: ${colors.label}}}
    b6: "6" {style: {font-size: 10; fill: ${colors.label}}}
    b7: "7" {style: {font-size: 10; fill: ${colors.label}}}
    b8: "8" {style: {font-size: 10; fill: ${colors.label}}}
    b9: "9" {style: {font-size: 10; fill: ${colors.label}}}
    b10: "10" {style: {font-size: 10; fill: ${colors.label}}}
    b11: "11" {style: {font-size: 10; fill: ${colors.label}}}
    b12: "12" {style: {font-size: 10; fill: ${colors.label}}}
    b13: "13" {style: {font-size: 10; fill: ${colors.label}}}
    b14: "14" {style: {font-size: 10; fill: ${colors.label}}}
    b15: "15" {style: {font-size: 10; fill: ${colors.label}}}
    b16: "16" {style: {font-size: 10; fill: ${colors.label}}}
    b17: "17" {style: {font-size: 10; fill: ${colors.label}}}
    b18: "18" {style: {font-size: 10; fill: ${colors.label}}}
    b19: "19" {style: {font-size: 10; fill: ${colors.label}}}
    b20: "20" {style: {font-size: 10; fill: ${colors.label}}}
    b21: "21" {style: {font-size: 10; fill: ${colors.label}}}
    b22: "22" {style: {font-size: 10; fill: ${colors.label}}}
    b23: "23" {style: {font-size: 10; fill: ${colors.label}}}
    b24: "24" {style: {font-size: 10; fill: ${colors.label}}}
    b25: "25" {style: {font-size: 10; fill: ${colors.label}}}
    b26: "26" {style: {font-size: 10; fill: ${colors.label}}}
    b27: "27" {style: {font-size: 10; fill: ${colors.label}}}
    b28: "28" {style: {font-size: 10; fill: ${colors.label}}}
    b29: "29" {style: {font-size: 10; fill: ${colors.label}}}
    b30: "30" {style: {font-size: 10; fill: ${colors.label}}}
    b31: "31" {style: {font-size: 10; fill: ${colors.label}}}
  }
  # Visual bit fields
  bits: {
    grid-columns: 32
    grid-gap: 0
    # Bits 0-11: Flags
    p: "P" {
      width: 24
      style: {fill: "#EF4444"; font-color: white; font-size: 12; bold: true}
      tooltip: "Present: 1=page in memory"
    }
    rw: "R/W" {
      width: 24
      style: {fill: "#F97316"; font-color: white; font-size: 12; bold: true}
      tooltip: "Read/Write: 0=RO, 1=RW"
    }
    us: "U/S" {
      width: 24
      style: {fill: "#EAB308"; font-color: white; font-size: 12; bold: true}
      tooltip: "User/Supervisor: 0=ring0, 1=ring3+"
    }
    pwt: "PWT" {
      width: 24
      style: {fill: "#84CC16"; font-color: white; font-size: 12; bold: true}
      tooltip: "Page Write-Through"
    }
    pcd: "PCD" {
      width: 24
      style: {fill: "#22C55E"; font-color: white; font-size: 12; bold: true}
      tooltip: "Page Cache Disable"
    }
    a: "A" {
      width: 24
      style: {fill: "#14B8A6"; font-color: white; font-size: 12; bold: true}
      tooltip: "Accessed: set by CPU on read"
    }
    d: "D" {
      width: 24
      style: {fill: "#06B6D4"; font-color: white; font-size: 12; bold: true}
      tooltip: "Dirty: set by CPU on write"
    }
    ps: "PS" {
      width: 24
      style: {fill: "#0EA5E9"; font-color: white; font-size: 12; bold: true}
      tooltip: "Page Size: 0=4KB, 1=4MB"
    }
    g: "G" {
      width: 24
      style: {fill: "#3B82F6"; font-color: white; font-size: 12; bold: true}
      tooltip: "Global: not flushed on CR3 reload"
    }
    avl0: "0" {
      width: 24
      style: {fill: "#8B5CF6"; font-color: white; font-size: 12; bold: true}
      tooltip: "Available for OS use"
    }
    avl1: "0" {
      width: 24
      style: {fill: "#8B5CF6"; font-color: white; font-size: 12; bold: true}
      tooltip: "Available for OS use"
    }
    avl2: "0" {
      width: 24
      style: {fill: "#8B5CF6"; font-color: white; font-size: 12; bold: true}
      tooltip: "Available for OS use"
    }
    # Bits 12-31: Frame Address (20 bits)
    fa0: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa1: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa2: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa3: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa4: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa5: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa6: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa7: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa8: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa9: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa10: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa11: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa12: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa13: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa14: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa15: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa16: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa17: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa18: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
    fa19: {
      width: 36
      label: ""
      style: {fill: ${colors.data}; font-color: white; font-size: 11}
    }
  }
}
# Field groupings
groupings: {
  grid-columns: 3
  grid-gap: 40
  flags_box: "Flags (bits 0-11)" {
    width: 300
    style: {fill: transparent; stroke: ${colors.header}; stroke-dash: 3}
  }
  frame_box: "Frame Address (bits 12-31)" {
    width: 500
    style: {fill: transparent; stroke: ${colors.data}; stroke-dash: 3}
  }
  spacer: "" {
    width: 100
    style: {fill: transparent}
  }
}
legend_header: |md
  ### Flag Definitions
|
legend: {
  shape: sql_table
  width: 500
  Bit: int {constraint: primary_key}
  Name: string
  Description: string
  0: "0"; "P (Present)"; "1 = page present in memory"
  1: "1"; "R/W (Read/Write)"; "0 = read-only, 1 = read/write"
  2: "2"; "U/S (User/Supervisor)"; "0 = ring 0 only, 1 = ring 3+"
  3: "3"; "PWT"; "Page-level write-through"
  4: "4"; "PCD"; "Page-level cache disable"
  5: "5"; "A (Accessed)"; "Set by CPU on read access"
  6: "6"; "D (Dirty)"; "Set by CPU on write access"
  7: "7"; "PS (Page Size)"; "0 = 4KB page, 1 = 4MB page (PDE)"
  8: "8"; "G (Global)"; "Not flushed on CR3 reload"
  9: "9-11"; "AVL (Available)"; "Available for OS use"
  10: "12-31"; "Frame Address"; "Physical frame address (4KB aligned)"
}
constants_header: |md
  ### Predefined Constants
|
flag_constants: {
  shape: sql_table
  width: 280
  Constant: string {constraint: primary_key}
  Value: string
  0: "PTE_PRESENT"; "0x001"
  1: "PTE_WRITABLE"; "0x002"
  2: "PTE_USER"; "0x004"
  3: "PTE_WRITETHROUGH"; "0x008"
  4: "PTE_CACHE_DISABLE"; "0x010"
  5: "PTE_ACCESSED"; "0x020"
  6: "PTE_DIRTY"; "0x040"
  7: "PTE_HUGE"; "0x080"
  8: "PTE_GLOBAL"; "0x100"
  9: "PTE_FRAME"; "0xFFFFF000"
}
usage_examples: {
  shape: sql_table
  width: 300
  Example: string {constraint: primary_key}
  Value: string
  0: "Kernel page (RW)"; "0x003"
  1: "User page (RW)"; "0x007"
  2: "Read-only user"; "0x005"
  3: "4MB kernel page"; "0x083"
}
example_header: |md
  ### Example Entry: Kernel Code Page
|
example_bits: {
  grid-columns: 32
  grid-gap: 0
  e0: "1" {style: {fill: "#EF4444"; font-color: white; font-size: 11}}
  e1: "1" {style: {fill: "#F97316"; font-color: white; font-size: 11}}
  e2: "0" {style: {fill: "#64748B"; font-color: white; font-size: 11}}
  e3: "0" {style: {fill: "#64748B"; font-color: white; font-size: 11}}
  e4: "0" {style: {fill: "#64748B"; font-color: white; font-size: 11}}
  e5: "0" {style: {fill: "#64748B"; font-color: white; font-size: 11}}
  e6: "0" {style: {fill: "#64748B"; font-color: white; font-size: 11}}
  e7: "0" {style: {fill: "#64748B"; font-color: white; font-size: 11}}
  e8: "0" {style: {fill: "#64748B"; font-color: white; font-size: 11}}
  e9: "0" {style: {fill: "#64748B"; font-color: white; font-size: 11}}
  e10: "0" {style: {fill: "#64748B"; font-color: white; font-size: 11}}
  e11: "0" {style: {fill: "#64748B"; font-color: white; font-size: 11}}
  f0: "" {style: {fill: ${colors.data}; font-color: white}}
  f1: "" {style: {fill: ${colors.data}; font-color: white}}
  f2: "" {style: {fill: ${colors.data}; font-color: white}}
  f3: "" {style: {fill: ${colors.data}; font-color: white}}
  f4: "" {style: {fill: ${colors.data}; font-color: white}}
  f5: "" {style: {fill: ${colors.data}; font-color: white}}
  f6: "" {style: {fill: ${colors.data}; font-color: white}}
  f7: "" {style: {fill: ${colors.data}; font-color: white}}
  f8: "" {style: {fill: ${colors.data}; font-color: white}}
  f9: "" {style: {fill: ${colors.data}; font-color: white}}
  f10: "" {style: {fill: ${colors.data}; font-color: white}}
  f11: "" {style: {fill: ${colors.data}; font-color: white}}
  f12: "" {style: {fill: ${colors.data}; font-color: white}}
  f13: "" {style: {fill: ${colors.data}; font-color: white}}
  f14: "" {style: {fill: ${colors.data}; font-color: white}}
  f15: "" {style: {fill: ${colors.data}; font-color: white}}
  f16: "" {style: {fill: ${colors.data}; font-color: white}}
  f17: "" {style: {fill: ${colors.data}; font-color: white}}
  f18: "" {style: {fill: ${colors.data}; font-color: white}}
  f19: "" {style: {fill: ${colors.data}; font-color: white}}
}
example_explanation: |md
  **Value: 0x00100XXX** (frame at 0xXXX000)
  - **P=1**: Page is present
  - **R/W=1**: Read/write enabled
  - **U/S=0**: Kernel only (ring 0)
  - **Frame**: Physical address of 4KB page
|
byte_layout_header: |md
  ### Byte Layout (Little-Endian)
|
byte_layout: {
  grid-columns: 4
  grid-gap: 0
  byte0: {
    label: "Byte 0\n(Limit [7:0])"
    shape: rectangle
    width: 100
    height: 60
    style: {fill: ${colors.header}; font-color: white; font-size: 11}
  }
  byte1: {
    label: "Byte 1\n(Limit [15:8])"
    shape: rectangle
    width: 100
    height: 60
    style: {fill: ${colors.header}; font-color: white; font-size: 11}
  }
  byte2: {
    label: "Byte 2\n(Base [7:0])"
    shape: rectangle
    width: 100
    height: 60
    style: {fill: ${colors.data}; font-color: white; font-size: 11}
  }
  byte3: {
    label: "Byte 3\n(Base [15:8])"
    shape: rectangle
    width: 100
    height: 60
    style: {fill: ${colors.data}; font-color: white; font-size: 11}
  }
  byte4: {
    label: "Byte 4\n(Base [23:16])"
    shape: rectangle
    width: 100
    height: 60
    style: {fill: ${colors.data}; font-color: white; font-size: 11}
  }
  byte5: {
    label: "Byte 5\n(Access)"
    shape: rectangle
    width: 100
    height: 60
    style: {fill: "#EF4444"; font-color: white; font-size: 11}
  }
  byte6: {
    label: "Byte 6\n(Flags + Limit)"
    shape: rectangle
    width: 100
    height: 60
    style: {fill: "#F97316"; font-color: white; font-size: 11}
  }
  byte7: {
    label: "Byte 7\n(Base [31:24])"
    shape: rectangle
    width: 100
    height: 60
    style: {fill: ${colors.data}; font-color: white; font-size: 11}
  }
}
byte_note: |md
  **Note:** PDE/PTE is simpler than GDT - only 4 bytes:
  - Bytes 0-1: Low 16 bits of frame address + flags in low 12 bits
  - Bytes 2-3: High 16 bits of frame address
|
size_annotation: |md
  **sizeof = 4 bytes (32 bits)**
  - Frame address must be 4KB aligned (bits 0-11 always 0 in address)
  - Combined with flags in bits 0-11 for storage efficiency
| {shape: text; style: {fill: ${colors.padding}; font-color: "#1F2937"}}