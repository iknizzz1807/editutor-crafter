vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}
title: |md
  # Syscall Dispatch Table
  Function pointer array indexed by syscall number
| {near: top-center}
syscall_table: {
  shape: sql_table
  label: "syscall_table[]"
  "[0]": "sys_exit"
  "[1]": "sys_read"
  "[2]": "sys_write"
  "[3]": "sys_getpid"
  "[4]": "sys_yield"
}
sys_exit: {
  label: "sys_exit(status: int)"
  shape: class
  +status: int
  +void
}
sys_read: {
  label: "sys_read(fd, buf, count)"
  shape: class
  +fd: int
  +buf: void*
  +count: int
  +return: int
}
sys_write: {
  label: "sys_write(fd, buf, count)"
  shape: class
  +fd: int
  +buf: const void*
  +count: int
  +return: int
}
sys_getpid: {
  label: "sys_getpid()"
  shape: class
  +return: int
}
sys_yield: {
  label: "sys_yield()"
  shape: class
  +void
}
syscall_dispatch: {
  label: "syscall_dispatch(num, arg1, arg2, arg3)"
  shape: class
  +num: uint32_t
  +arg1: uint32_t
  +arg2: uint32_t
  +arg3: uint32_t
  +return: int32_t
}
syscall_dispatch -> syscall_table: "index by num\nrange check" {
  style.stroke-dash: 3
}
syscall_table."[0]" -> sys_exit: "handler"
syscall_table."[1]" -> sys_read: "handler"
syscall_table."[2]" -> sys_write: "handler"
syscall_table."[3]" -> sys_getpid: "handler"
syscall_table."[4]" -> sys_yield: "handler"
syscall_entry: {
  label: "syscall_entry\n(assembly stub)"
  shape: rectangle
}
syscall_entry -> syscall_dispatch: "call" {
  label: |md
    EAX = syscall num
    EBX, ECX, EDX = args
  |
}
syscall_entry.style.fill: "#E8D4B8"
syscall_table.style.fill: "#B8D4E8"
sys_exit.style.fill: "#D4E8B8"
sys_read.style.fill: "#D4E8B8"
sys_write.style.fill: "#D4E8B8"
sys_getpid.style.fill: "#D4E8B8"
sys_yield.style.fill: "#D4E8B8"
syscall_dispatch.style.fill: "#E8B8D4"
legend: {
  near: bottom-right
  label: |md
    **Index → Handler Mapping**
    - `syscall_table[num]` returns function pointer
    - Out-of-range `num` → returns `-1` (error)
    - Each handler: `int32_t (*)(uint32_t, uint32_t, uint32_t)`
  |
}
legend.style.fill: "#F5F5F5"
legend.style.stroke: "#CCCCCC"