title: Rendering Pipeline Flowchart {
  style.font-size: 24
  style.font-color: "#e6edf3"
  style.bold: true
}

start: Start {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
}

pixel_select: Select Pixel Coordinates {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

sample_loop: Multi-sampling Loop\n(Antialiasing) {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

ray_gen: Generate Primary Ray\n(Camera + Jitter) {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

intersect_test: Intersection Testing\n(Hit Objects?) {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

bg_color: Background Color\n(Sky/Environment) {
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

material_scatter: Material Scattering\n(Diffuse/Metal/Glass) {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

depth_check: Ray Depth Limit\nReached? {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

spawn_ray: Spawn Secondary Ray\n(Reflection/Refraction) {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

color_accum: Color Accumulation\n(Attenuation Ã— Incoming) {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

samples_done: All Samples\nComplete? {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

average_color: Average Color Samples {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

gamma_correct: Gamma Correction\n(HDR to Display) {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

write_pixel: Write Pixel to Image {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

all_pixels: All Pixels\nProcessed? {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

final_output: Final Image Output {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
  style.bold: true
}

# Flow connections
start -> pixel_select
pixel_select -> sample_loop
sample_loop -> ray_gen
ray_gen -> intersect_test
intersect_test -> bg_color: No Hit
intersect_test -> material_scatter: Hit Object
material_scatter -> depth_check
depth_check -> color_accum: Max Depth
depth_check -> spawn_ray: Continue
spawn_ray -> intersect_test: Recursive Ray
bg_color -> color_accum
color_accum -> samples_done
samples_done -> sample_loop: More Samples {
  style.stroke: "#8b949e"
}
samples_done -> average_color: Done
average_color -> gamma_correct
gamma_correct -> write_pixel
write_pixel -> all_pixels
all_pixels -> pixel_select: Next Pixel {
  style.stroke: "#8b949e"
}
all_pixels -> final_output: Complete