direction: right

title: High-Level System Architecture {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

client: Client Applications {
  shape: cloud
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

network: Network Layer {
  tcp_server: TCP Server {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  connection_handler: Connection Handler {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  tcp_server -> connection_handler: manage connections
  
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

protocol: Protocol Layer {
  resp_parser: RESP Parser {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  serializer: Response Serializer {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  resp_parser -> serializer: parsed commands
  
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

command: Command Layer {
  dispatcher: Command Dispatcher {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  handlers: Command Handlers {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  dispatcher -> handlers: route commands
  
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

storage: Storage Layer {
  memory_store: In-Memory Store {
    shape: cylinder
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  data_structures: Data Structures {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  memory_store -> data_structures: organize data
  
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

persistence: Persistence Layer {
  rdb_snapshots: RDB Snapshots {
    shape: page
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  aof_log: AOF Log {
    shape: page
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# Client connection flow
client -> network.tcp_server: TCP connections {
  style.stroke: "#3fb950"
  style.bold: true
}

# Request flow down
network.connection_handler -> protocol.resp_parser: raw bytes {
  style.stroke: "#8b949e"
}

protocol.resp_parser -> command.dispatcher: parsed commands {
  style.stroke: "#8b949e"
}

command.handlers -> storage.memory_store: read/write data {
  style.stroke: "#8b949e"
}

# Response flow back
storage.memory_store -> command.handlers: query results {
  style.stroke: "#8b949e"
}

command.handlers -> protocol.serializer: command responses {
  style.stroke: "#8b949e"
}

protocol.serializer -> network.connection_handler: RESP responses {
  style.stroke: "#8b949e"
}

network.connection_handler -> client: TCP responses {
  style.stroke: "#3fb950"
  style.bold: true
}

# Persistence interactions
storage.memory_store -> persistence.rdb_snapshots: periodic snapshots {
  style.stroke: "#8b949e"
  style.stroke-dash: 5
}

command.handlers -> persistence.aof_log: write operations {
  style.stroke: "#8b949e"
  style.stroke-dash: 5
}

persistence.rdb_snapshots -> storage.memory_store: restore on startup {
  style.stroke: "#8b949e"
  style.stroke-dash: 5
}

persistence.aof_log -> storage.memory_store: replay operations {
  style.stroke: "#8b949e"
  style.stroke-dash: 5
}