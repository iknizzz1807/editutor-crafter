title: "Flowchart: Parser Algorithm"
desc: "A flowchart detailing the recursive descent parsing algorithm"

# Colors and theme
vars: {
  colors: {
    dark-bg: "#0f3460"
    container-bg: "#16213e"
    accent: "#3fb950"
    text: "#e6edf3"
    arrow: "#8b949e"
  }
}

# Global styling
classes: {
  all: {
    style.font-color: ${colors.text}
  }
  container: {
    style.fill: ${colors.container-bg}
    style.stroke: ${colors.accent}
    style.stroke-width: 2
  }
  decision: {
    shape: diamond
    style.fill: ${colors.container-bg}
    style.stroke: ${colors.accent}
    style.stroke-width: 2
    style.font-color: ${colors.text}
  }
  process: {
    shape: rectangle
    style.fill: ${colors.container-bg}
    style.stroke: ${colors.accent}
    style.stroke-width: 2
    style.font-color: ${colors.text}
  }
  terminal: {
    shape: oval
    style.fill: ${colors.container-bg}
    style.stroke: ${colors.accent}
    style.stroke-width: 2
    style.font-color: ${colors.text}
  }
}

# Flowchart nodes
start: "Start parsing" {
  class: terminal
}

get_tokens: "Receive token list\nfrom lexer" {
  class: process
}

check_command: "Check for command\n(word token)" {
  class: decision
}

command_error: "Syntax error:\nNo command found" {
  class: terminal
}

parse_redirections: "Parse redirections\n(> output, < input, 2>&1)" {
  class: process
}

check_pipe: "Check for pipe operator (|)" {
  class: decision
}

parse_right_side: "Recursively parse\nright side of pipe" {
  class: process
}

build_pipe_node: "Build pipe AST node\nwith left and right children" {
  class: process
}

build_command_node: "Build command AST node\nwith command and redirections" {
  class: process
}

return_ast: "Return completed AST" {
  class: terminal
}

# Flowchart connections
start -> get_tokens
get_tokens -> check_command

check_command -> command_error: "No"
check_command -> parse_redirections: "Yes"

parse_redirections -> check_pipe

check_pipe -> parse_right_side: "Yes (pipe found)"
check_pipe -> build_command_node: "No"

parse_right_side -> build_pipe_node

build_pipe_node -> return_ast
build_command_node -> return_ast

# Add notes for clarity
note: "Recursive Descent Parsing Algorithm\nfor Shell Commands" {
  style: {
    fill: ${colors.dark-bg}
    stroke: ${colors.accent}
    font-color: ${colors.text}
  }
}

note2: "The parser recursively builds an\nAbstract Syntax Tree (AST)" {
  style: {
    fill: ${colors.dark-bg}
    stroke: ${colors.accent}
    font-color: ${colors.text}
  }
}

# Connection styling
connections: {
  style: {
    stroke: ${colors.arrow}
    font-color: ${colors.text}
  }
}