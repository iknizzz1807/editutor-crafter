# State Machine: Job Lifecycle

canvas: {
  theme: dark
}

title: State Machine: Job Lifecycle

# States
foreground: Foreground {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.stroke-width: 3
  style.font-color: "#e6edf3"
}

background: Background {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.stroke-width: 2
  style.font-color: "#e6edf3"
}

stopped: Stopped {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.stroke-width: 2
  style.font-color: "#e6edf3"
}

done: Done (Zombie) {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.stroke-width: 2
  style.font-color: "#e6edf3"
}

# Initial state
initial: {
  shape: circle
  style.fill: "#e6edf3"
}

# Reaped state (terminal)
reaped: Reaped {
  shape: circle
  style.double-border: true
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# Transitions
initial -> background: "& launches\n(background job)"
initial -> foreground: "launch without &"

foreground -> stopped: "Ctrl+Z\n(SIGTSTP)"
stopped -> background: "bg command"
stopped -> foreground: "fg command"
background -> foreground: "fg command"

foreground -> done: "process exit\n(SIGCHLD)"
background -> done: "process exit\n(SIGCHLD)"
stopped -> done: "process exit\n(SIGCHLD)"

done -> reaped: "SIGCHLD handled\n(waitpid reaps zombie)" {
  style.stroke-dash: 3
}

# Styling
done.style: {
  stroke-dash: 2
}

# Notes
note: |md
  **Process States:**
  - **Foreground**: Process controls terminal, receives SIGINT (Ctrl+C)
  - **Background**: Process runs detached from terminal
  - **Stopped**: Process paused by SIGTSTP (Ctrl+Z)
  - **Done (Zombie)**: Process terminated but not yet reaped by parent
| {
  shape: page
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}