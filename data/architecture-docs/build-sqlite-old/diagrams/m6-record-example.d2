vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}

record_encoding: "SQL Record Layout: (1, 'ABC', NULL)" {
  style: {
    stroke: "#512da8"
    stroke-width: 2
    stroke-dash: 4
  }

  header: "RECORD HEADER" {
    shape: sql_table
    style: {
      fill: "#d1c4e9"
      stroke: "#512da8"
    }
    
    "0x00": "Header Size (Varint: 4)" {constraint: "1 byte"}
    "0x01": "Serial Type Col 1 (1: i8)" {constraint: "1 byte"}
    "0x02": "Serial Type Col 2 (19: str3)" {constraint: "1 byte"}
    "0x03": "Serial Type Col 3 (0: NULL)" {constraint: "1 byte"}
  }

  data_payload: "RECORD DATA" {
    shape: sql_table
    style: {
      fill: "#bbdefb"
      stroke: "#1976d2"
    }

    "0x04": "Value: 1 (0x01)" {constraint: "1 byte"}
    "0x05-07": "Value: 'ABC' (0x41 0x42 0x43)" {constraint: "3 bytes"}
    "0x08": "[NULL EMPTY]" {
      constraint: "0 bytes"
      style.fill: "#eeeeee"
    }
  }
}

# FIXED: explanation moved to root level to resolve 'constant near keys' error
explanation: |md
  ### Serialization Logic
  - **Header**: Tracks metadata and field offsets.
  - **Varint**: MSB-encoded size.
  - **Serial Types**: Define data width for each column.
  - **NULL Handling**: Type 0 defined in header; 0 bytes consumed in payload.
| {
  near: bottom-center
}

# Pointer logic (Orange)
record_encoding.header."0x00" -> record_encoding.data_payload."0x04": "Header size defines data start" {
  style: {
    stroke: orange
    stroke-dash: 3
    animated: true
  }
}

info: "sizeof=8 bytes (one cache line segment)" {
  shape: text
  style: {
    font-size: 14
    italic: true
    bold: true
  }
  near: bottom-right
}