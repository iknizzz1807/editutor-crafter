vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}

AST_Node_Layout: {
  grid-columns: 3
  grid-gap: 0
  
  # Headers
  offset_h: "Offset" { style.bold: true; style.stroke-width: 0 }
  label_h: "AST Node Memory Layout (64B Cache Line Aligned)" { style.bold: true; style.stroke-width: 0 }
  size_h: "Size" { style.bold: true; style.stroke-width: 0 }

  # Common Header Section (Purple)
  off_00: "0x00" { style.stroke-width: 0 }
  node_type_field: "type (ASTNodeType)" {
    style: {
      fill: "#9b59b6"
      font-color: white
      bold: true
    }
  }
  sz_00: "4B" { style.stroke-width: 0 }

  off_04: "0x04" { style.stroke-width: 0 }
  line_field: "line (uint32_t)" {
    style: {
      fill: "#9b59b6"
      font-color: white
    }
  }
  sz_04: "4B" { style.stroke-width: 0 }

  off_08: "0x08" { style.stroke-width: 0 }
  col_field: "col (uint32_t)" {
    style: {
      fill: "#9b59b6"
      font-color: white
    }
  }
  sz_08: "4B" { style.stroke-width: 0 }

  off_0C: "0x0C" { style.stroke-width: 0 }
  pad_header: "alignment_padding" {
    style: {
      fill: "#7f8c8d"
      font-color: white
    }
  }
  sz_0C: "4B" { style.stroke-width: 0 }

  # BinaryExpr Variant Label
  sep_1: "" { style.stroke-width: 0 }
  variant_1: "VARIANT: BinaryExpr (Data Union)" {
    style: {
      stroke-dash: 3
      italic: true
      font-size: 10
    }
  }
  sep_2: "" { style.stroke-width: 0 }

  # BinaryExpr Variant Data
  off_10_v1: "0x10" { style.stroke-width: 0 }
  op_field: "op (TokenType)" {
    style: {
      fill: "#3498db"
      font-color: white
    }
  }
  sz_10_v1: "4B" { style.stroke-width: 0 }

  off_14_v1: "0x14" { style.stroke-width: 0 }
  pad_v1: "padding" {
    style: {
      fill: "#7f8c8d"
      font-color: white
    }
  }
  sz_14_v1: "4B" { style.stroke-width: 0 }

  off_18_v1: "0x18" { style.stroke-width: 0 }
  ptr_left: "left (ASTNode*)" {
    style: {
      fill: "#e67e22"
      font-color: white
    }
  }
  sz_18_v1: "8B" { style.stroke-width: 0 }

  off_20_v1: "0x20" { style.stroke-width: 0 }
  ptr_right: "right (ASTNode*)" {
    style: {
      fill: "#e67e22"
      font-color: white
    }
  }
  sz_20_v1: "8B" { style.stroke-width: 0 }

  off_28_v1: "0x28" { style.stroke-width: 0 }
  free_v1: "unused_union_space" {
    style: {
      fill: "#2ecc71"
      font-color: white
    }
  }
  sz_28_v1: "24B" { style.stroke-width: 0 }

  # Cache Line Boundary
  bound_off: "" { style.stroke-width: 0 }
  boundary: "-------------------- CACHE LINE BOUNDARY (64B) --------------------" {
    style: {
      stroke-dash: 5
      font-size: 8
      bold: true
    }
  }
  bound_sz: "" { style.stroke-width: 0 }

  # SelectStmt Variant Label
  sep_3: "" { style.stroke-width: 0 }
  variant_2: "VARIANT: SelectStmt (Data Union)" {
    style: {
      stroke-dash: 3
      italic: true
      font-size: 10
    }
  }
  sep_4: "" { style.stroke-width: 0 }

  # SelectStmt Variant Data
  off_10_v2: "0x10" { style.stroke-width: 0 }
  res_cols: "result_columns (ASTNode*)" {
    style: {
      fill: "#e67e22"
      font-color: white
    }
  }
  sz_10_v2: "8B" { style.stroke-width: 0 }

  off_18_v2: "0x18" { style.stroke-width: 0 }
  tbl: "table_name (char*)" {
    style: {
      fill: "#e67e22"
      font-color: white
    }
  }
  sz_18_v2: "8B" { style.stroke-width: 0 }

  off_20_v2: "0x20" { style.stroke-width: 0 }
  where_clause: "where_clause (ASTNode*)" {
    style: {
      fill: "#e67e22"
      font-color: white
    }
  }
  sz_20_v2: "8B" { style.stroke-width: 0 }

  off_28_v2: "0x28" { style.stroke-width: 0 }
  ptr_limit: "limit_clause (ASTNode*)" {
    style: {
      fill: "#e67e22"
      font-color: white
    }
  }
  sz_28_v2: "8B" { style.stroke-width: 0 }

  off_30_v2: "0x30" { style.stroke-width: 0 }
  distinct_field: "is_distinct (uint32_t flags)" {
    style: {
      fill: "#3498db"
      font-color: white
    }
  }
  sz_30_v2: "4B" { style.stroke-width: 0 }

  off_34_v2: "0x34" { style.stroke-width: 0 }
  free_v2: "remaining_padding" {
    style: {
      fill: "#7f8c8d"
      font-color: white
    }
  }
  sz_34_v2: "12B" { style.stroke-width: 0 }

  # Annotations/Footer
  footer_1: "" { style.stroke-width: 0 }
  summary: |md
    **sizeof(ASTNode)** = 64 bytes  
    **Alignment**: 8-byte (Pointer width)  
    **Allocation**: Contiguous Arena Block
  | {
    style.stroke-width: 0
  }
  footer_2: "" { style.stroke-width: 0 }
}