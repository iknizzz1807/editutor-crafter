vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}

direction: right

Explanation: |md
  # Nested Loop Join
  The simplest, yet most dangerous join algorithm.
  For every row in the outer table, we scan the entire inner table.
  
  **Complexity**: $O(N \times M)$
| {
  near: top-center
  shape: text
}

Execution_Engine: {
  link: "#anchor-join"
  style: {
    fill: "#f5f5f5"
    stroke: "#333"
    stroke-width: 2
    shadow: true
  }

  Outer_Loop: {
    label: "Outer Loop\n(Table A)"
    shape: rectangle
    style: {
      fill: "#bbdefb"
      stroke: "#1976d2"
      border-radius: 8
    }
  }

  Inner_Loop: {
    label: "Inner Loop\n(Table B)"
    shape: rectangle
    style: {
      fill: "#ffccbc"
      stroke: "#d84315"
      border-radius: 8
    }
  }

  Comparator: {
    label: "Check Match\nA.id == B.user_id"
    shape: diamond
    style: {
      fill: "#fff9c4"
      stroke: "#fbc02d"
    }
  }

  Result_Buffer: {
    label: "Result Set"
    shape: queue
    style: {
      fill: "#c8e6c9"
      stroke: "#388e3c"
    }
  }

  # Control Flow
  Outer_Loop -> Inner_Loop: "Get A[i]"
  Inner_Loop -> Comparator: "Get B[j]"
  
  Comparator -> Result_Buffer: "Match" {
    style: {
      stroke: "#2e7d32"
      stroke-width: 2
      font-color: "#2e7d32"
    }
  }
  
  Comparator -> Inner_Loop: "No Match / Next B" {
    style: {
      stroke: "#d84315"
      stroke-dash: 3
    }
  }
  
  Inner_Loop -> Outer_Loop: "End of B / Next A" {
    style: {
      stroke: "#1976d2"
      stroke-dash: 3
    }
  }
}

Memory_Space: {
  link: "#anchor-join"
  style: {
    fill: "#263238"
    stroke: "#cfd8dc"
    font-color: white
  }

  Table_A: "Users (Outer)" {
    shape: sql_table
    style: {
      fill: "#e3f2fd"
      stroke: "#1e88e5"
      font-color: black
    }
    id: int
    name: varchar
    
    # Data visualization hack
    "Row 1": "1 | Alice" {constraint: primary_key}
    "Row 2": "2 | Bob" {
      style: {
        fill: "#1976d2"
        font-color: white
        bold: true
      }
    }
    "Row 3": "3 | Charlie"
  }

  Table_B: "Orders (Inner)" {
    shape: sql_table
    style: {
      fill: "#fbe9e7"
      stroke: "#ff5722"
      font-color: black
    }
    oid: int
    user_id: int {constraint: foreign_key}
    
    # Data visualization hack
    "Row 1": "101 | 2" {
      style: {
        fill: "#d84315"
        font-color: white
        bold: true
      }
    }
    "Row 2": "102 | 1"
    "Row 3": "103 | 2"
  }
}

# Cursors
Cursor_A: {
  shape: hexagon
  label: "Cursor A"
  link: "#anchor-join"
  style: {
    fill: "#1976d2"
    font-color: white
  }
}

Cursor_B: {
  shape: hexagon
  label: "Cursor B"
  link: "#anchor-join"
  style: {
    fill: "#d84315"
    font-color: white
  }
}

# Wiring
Execution_Engine.Outer_Loop -> Cursor_A: "Controls"
Execution_Engine.Inner_Loop -> Cursor_B: "Controls"

Cursor_A -> Memory_Space.Table_A."Row 2": "Current A Row" {
  style: {
    stroke: "#1976d2"
    stroke-width: 3
  }
}

Cursor_B -> Memory_Space.Table_B."Row 1": "Scanning B..." {
  style: {
    stroke: "#d84315"
    stroke-width: 3
    stroke-dash: 3
    animated: true
  }
}