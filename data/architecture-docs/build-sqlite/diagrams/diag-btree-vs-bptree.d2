vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}

title: "B-tree vs B+tree: Where Data Lives" {
  near: top-center
  shape: text
  style: {
    font-size: 32
    bold: true
    underline: true
  }
}

direction: right

classes: {
  internal-data: {
    style: {
      fill: "#E8F5E9"
      stroke: "#2E7D32"
      stroke-width: 2
    }
  }
  leaf-data: {
    style: {
      fill: "#C8E6C9"
      stroke: "#1B5E20"
      stroke-width: 3
    }
  }
  internal-key-only: {
    style: {
      fill: "#E3F2FD"
      stroke: "#1565C0"
      stroke-width: 2
    }
  }
  leaf-key-data: {
    style: {
      fill: "#BBDEFB"
      stroke: "#0D47A1"
      stroke-width: 3
    }
  }
  pointer: {
    shape: circle
    width: 20
    height: 20
    style: {
      fill: "#757575"
      stroke: "#424242"
    }
  }
  data-block: {
    style: {
      fill: "#FFECB3"
      stroke: "#FF8F00"
      stroke-dash: 2
    }
  }
  link-arrow: {
    style: {
      stroke: "#D32F2F"
      stroke-width: 3
      animated: true
    }
  }
}

btree_section: "B-tree (Table Storage)" {
  style: {
    fill: "#FAFAFA"
    stroke: "#2E7D32"
    stroke-width: 2
    border-radius: 8
  }

  btree_desc: |md
    **Data in ALL nodes**
    - Internal nodes contain full records
    - Leaf nodes contain full records  
    - No leaf linking (separate traversals)
    - Used for: table primary storage
  | {
    near: top-center
  }

  btree_root: "Root [K50\n+ Row Data]" {
    class: internal-data
    width: 120
    height: 60
  }

  btree_left: "Internal [K25\n+ Row Data]" {
    class: internal-data
    width: 120
    height: 60
  }

  btree_right: "Internal [K75\n+ Row Data]" {
    class: internal-data
    width: 120
    height: 60
  }

  btree_ll: "Leaf [K10\n+ Row]" {
    class: leaf-data
    width: 100
    height: 55
  }

  btree_lm: "Leaf [K25\n+ Row]" {
    class: leaf-data
    width: 100
    height: 55
  }

  btree_rl: "Leaf [K50\n+ Row]" {
    class: leaf-data
    width: 100
    height: 55
  }

  btree_rr: "Leaf [K90\n+ Row]" {
    class: leaf-data
    width: 100
    height: 55
  }

  btree_root -> btree_left: "< K50"
  btree_root -> btree_right: ">= K50"

  btree_left -> btree_ll: "< K25"
  btree_left -> btree_lm: ">= K25"

  btree_right -> btree_rl: "< K75"
  btree_right -> btree_rr: ">= K75"

  btree_note: "Data at every level" {
    shape: text
    style: {
      italic: true
      font-color: "#2E7D32"
    }
  }
}

bplustree_section: "B+tree (Index Storage)" {
  style: {
    fill: "#FAFAFA"
    stroke: "#1565C0"
    stroke-width: 2
    border-radius: 8
  }

  bptree_desc: |md
    **Data ONLY in leaves**
    - Internal nodes: keys + pointers only
    - Leaf nodes: keys + (rowid pointers)
    - Leaves linked for range scans
    - Used for: secondary indexes
  | {
    near: top-center
  }

  bptree_root: "Root [K50]" {
    class: internal-key-only
    width: 100
    height: 50
  }

  bptree_left: "Internal [K25]" {
    class: internal-key-only
    width: 100
    height: 50
  }

  bptree_right: "Internal [K75]" {
    class: internal-key-only
    width: 100
    height: 50
  }

  bptree_ll: "Leaf [K10,K20\n-> rowids]" {
    class: leaf-key-data
    width: 120
    height: 55
  }

  bptree_lm: "Leaf [K25,K40\n-> rowids]" {
    class: leaf-key-data
    width: 120
    height: 55
  }

  bptree_rl: "Leaf [K50,K60\n-> rowids]" {
    class: leaf-key-data
    width: 120
    height: 55
  }

  bptree_rr: "Leaf [K75,K90\n-> rowids]" {
    class: leaf-key-data
    width: 120
    height: 55
  }

  bptree_root -> bptree_left: "< K50"
  bptree_root -> bptree_right: ">= K50"

  bptree_left -> bptree_ll: "< K25"
  bptree_left -> bptree_lm: ">= K25"

  bptree_right -> bptree_rl: "< K75"
  bptree_right -> bptree_rr: ">= K75"

  bptree_ll <-> bptree_lm: {
    class: link-arrow
  }
  bptree_lm <-> bptree_rl: {
    class: link-arrow
  }
  bptree_rl <-> bptree_rr: {
    class: link-arrow
  }

  bptree_note: "Keys only in internal nodes" {
    shape: text
    style: {
      italic: true
      font-color: "#1565C0"
    }
  }

  leaf_chain_label: "Linked leaves for range scans" {
    shape: text
    near: bottom-center
    style: {
      font-color: "#D32F2F"
      bold: true
    }
  }
}

comparison: Comparison {
  near: bottom-center
  style: {
    fill: "#F5F5F5"
    stroke: "#9E9E9E"
    border-radius: 8
  }

  grid-columns: 2
  grid-gap: 40

  btree_col: |md
    ### B-tree Characteristics

    | Aspect | Behavior |
    |--------|----------|
    | Data location | All nodes |
    | Node size | Larger (full rows) |
    | Fan-out | Lower (fewer keys) |
    | Tree height | Taller |
    | Range scan | Re-traverse tree |
    | Use case | Table storage |
  |

  bptree_col: |md
    ### B+tree Characteristics

    | Aspect | Behavior |
    |--------|----------|
    | Data location | Leaves only |
    | Node size | Smaller (keys only) |
    | Fan-out | Higher (more keys) |
    | Tree height | Shorter |
    | Range scan | Follow leaf links |
    | Use case | Secondary indexes |
  |
}

legend: Legend {
  near: bottom-right
  style: {
    fill: "#FFF8E1"
    stroke: "#FFB300"
    border-radius: 4
  }

  grid-columns: 2
  grid-gap: 15

  legend_data: "Full Record/Data" {
    class: leaf-data
    width: 100
  }

  legend_key: "Key + Pointer Only" {
    class: internal-key-only
    width: 100
  }
}