vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}
title: |md
  # EXPLAIN Command Output
  `EXPLAIN SELECT * FROM users WHERE age > 18`
| {near: top-center}
direction: right
explanation: {
  style.fill: "#f0f4f8"
  style.stroke: "#94a3b8"
  style.border-radius: 8
  desc: |md
    ## What EXPLAIN Shows
    The `EXPLAIN` command reveals the **bytecode execution plan** 
    that the VDBE will execute. Each row represents one instruction
    with its operands and purpose.
    This transparency enables:
    - Query debugging
    - Performance optimization
    - Understanding index usage
  |
}
example: {
  style.fill: "#1e293b"
  style.stroke: "#475569"
  style.border-radius: 8
  style.font-color: "#e2e8f0"
  style.font: mono
  header: {
    style.fill: "#334155"
    style.stroke: "#475569"
    style.border-radius: [8, 8, 0, 0]
    label: |md
      addr  opcode         p1    p2    p3    p4          comment
      ----  -------------  ----  ----  ----  ----------  -------------------
    |
  }
  instructions: {
    style.fill: "#1e293b"
    rows: |md
      0     Init           0     10    0                 Start at addr 10
      1     OpenRead       0     2     0     3           Open table 'users' (3 cols)
      2     Rewind         0     9     0                 Position at first row
      3       Column       0     1     1                 Read 'age' column → r1
      4       Le           1     8     2     18          if age<=18 goto 8
      5       Column       0     0     2                 Read 'id' column → r2
      6       Column       0     2     3                 Read 'name' column → r3
      7       ResultRow    2     2     0                 Output r2, r3 (id, name)
      8     Next           0     3     0                 Advance cursor; loop to 3
      9     Halt           0     0     0                 End execution
      10    Noop           0     0     0                 (entry point)
    |
  }
}
legend: {
  style.fill: "#fefce8"
  style.stroke: "#ca8a04"
  style.border-radius: 8
  title: "Column Legend" {
    style.bold: true
    style.font-size: 16
  }
  addr: {
    label: "addr"
    desc: "Instruction address (line number)"
  }
  opcode: {
    label: "opcode"
    desc: "Operation to perform"
  }
  p1_p3: {
    label: "p1, p2, p3"
    desc: "Numeric operands (registers, cursors, addresses)"
  }
  p4: {
    label: "p4"
    desc: "String/pointer operand (constants, names)"
  }
  comment: {
    label: "comment"
    desc: "Human-readable explanation"
  }
  addr -> opcode: "executed in order" {
    style.stroke-dash: 3
    style.stroke: "#ca8a04"
  }
}
flow: {
  style.fill: "#f8fafc"
  style.stroke: "#cbd5e1"
  style.border-radius: 8
  title: "Execution Flow" {
    style.bold: true
  }
  start: "Init (addr 0)"
  open: "OpenRead\n(Open table)"
  rewind: "Rewind\n(Go to first row)"
  loop_check: "Loop:\nCheck if rows remain"
  column_read: "Column\n(Read age)"
  compare: "Le\n(age <= 18?)"
  output: "ResultRow\n(Output matched row)"
  next: "Next\n(Move to next row)"
  halt: "Halt\n(Done)"
  start -> open
  open -> rewind
  rewind -> loop_check
  loop_check -> column_read: "rows exist"
  column_read -> compare
  compare -> output: "age > 18\n(condition met)"
  compare -> next: "age <= 18\n(skip row)"
  output -> next
  next -> loop_check: "more rows"
  loop_check -> halt: "no more rows"
  start.style.fill: "#dcfce7"
  start.style.stroke: "#16a34a"
  halt.style.fill: "#fee2e2"
  halt.style.stroke: "#dc2626"
  output.style.fill: "#dbeafe"
  output.style.stroke: "#2563eb"
  compare.style.fill: "#fef3c7"
  compare.style.stroke: "#d97706"
}
explanation -> example
example -> legend
legend -> flow