vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}
title: |md
  # LRU List Operations
  **Doubly-Linked List for Buffer Pool Eviction**
| {near: top-center}
direction: right
section_before: {
  label: "BEFORE: Page Access (move to head)"
  list_before: {
    label: ""
    head_before: "HEAD\n(MRU)" {
      shape: rectangle
      style: {
        fill: "#ACE1AF"
        stroke: "#2E7D32"
        stroke-width: 2
      }
    }
    p3_before: "Page 3" {
      shape: rectangle
      style.fill: "#E8F5E9"
    }
    p7_before: "Page 7" {
      shape: rectangle
      style.fill: "#E8F5E9"
    }
    p2_before: "Page 2\n(ACCESSED)" {
      shape: rectangle
      style: {
        fill: "#FFF9C4"
        stroke: "#F57C00"
        stroke-width: 3
      }
    }
    p9_before: "Page 9" {
      shape: rectangle
      style.fill: "#E8F5E9"
    }
    tail_before: "TAIL\n(LRU)" {
      shape: rectangle
      style: {
        fill: "#FFCDD2"
        stroke: "#C62828"
        stroke-width: 2
      }
    }
    head_before -> p3_before -> p7_before -> p2_before -> p9_before -> tail_before
    head_before <- p3_before <- p7_before <- p2_before <- p9_before <- tail_before
  }
  note_before: |md
    **Current State:**
    - Page 2 is in middle of list
    - Page 2 is accessed (read/write)
    - Must move to HEAD (MRU position)
  | {
    shape: text
    style.font-size: 12
  }
}
section_operation: {
  label: ""
  arrow: "→" {
    shape: text
    style: {
      font-size: 48
      font-color: "#1565C0"
    }
  }
  operation_box: {
    label: "Move Operation"
    style: {
      fill: "#E3F2FD"
      stroke: "#1565C0"
      stroke-dash: 3
    }
    op: |md
      **Steps:**
      1. Remove Page 2 from current position
         - Update neighbors' pointers
      2. Insert at HEAD
         - Page 2 → prev = NULL
         - Page 2 → next = old HEAD
         - old HEAD → prev = Page 2
      3. Update HEAD pointer
    | {shape: text}
  }
}
section_after: {
  label: "AFTER: Page Moved to Head"
  list_after: {
    label: ""
    p2_after: "Page 2\n(ACCESSED)\nNOW AT HEAD" {
      shape: rectangle
      style: {
        fill: "#C8E6C9"
        stroke: "#2E7D32"
        stroke-width: 3
      }
    }
    head_after: "Page 3\n(old HEAD)" {
      shape: rectangle
      style.fill: "#E8F5E9"
    }
    p7_after: "Page 7" {
      shape: rectangle
      style.fill: "#E8F5E9"
    }
    p9_after: "Page 9" {
      shape: rectangle
      style.fill: "#E8F5E9"
    }
    tail_after: "TAIL\n(LRU)" {
      shape: rectangle
      style: {
        fill: "#FFCDD2"
        stroke: "#C62828"
        stroke-width: 2
      }
    }
    p2_after -> head_after -> p7_after -> p9_after -> tail_after
    p2_after <- head_after <- p7_after <- p9_after <- tail_after
    head_ptr: "HEAD →" {
      shape: text
      style: {
        font-color: "#2E7D32"
        bold: true
      }
    }
    head_ptr -> p2_after: "" {style.stroke: "#2E7D32"}
  }
  note_after: |md
    **Result:**
    - Page 2 is now at HEAD (MRU)
    - List order reflects access recency
    - Most recently used → Least recently used
  | {
    shape: text
    style.font-size: 12
  }
}
section_eviction: {
  label: "Eviction: Remove from Tail"
  evict_box: {
    label: ""
    evict_list: {
      label: ""
      e_head: "HEAD" {
        shape: rectangle
        style.fill: "#E8F5E9"
      }
      e_p3: "Page 3" {style.fill: "#E8F5E9"}
      e_p7: "Page 7" {style.fill: "#E8F5E9"}
      e_p9: "Page 9" {style.fill: "#E8F5E9"}
      e_tail: "Page 12\nVICTIM" {
        shape: rectangle
        style: {
          fill: "#FFCDD2"
          stroke: "#C62828"
          stroke-width: 3
          animated: true
        }
      }
      e_head -> e_p3 -> e_p7 -> e_p9 -> e_tail
      e_head <- e_p3 <- e_p7 <- e_p9 <- e_tail
    }
    evict_arrow: "→ EVICT →" {
      shape: text
      style: {
        font-size: 24
        font-color: "#C62828"
        bold: true
      }
    }
    evict_result: {
      label: ""
      r_head: "HEAD" {
        shape: rectangle
        style.fill: "#E8F5E9"
      }
      r_p3: "Page 3" {style.fill: "#E8F5E9"}
      r_p7: "Page 7" {style.fill: "#E8F5E9"}
      r_p9: "Page 9\n(new TAIL)" {
        style: {
          fill: "#FFCDD2"
          stroke: "#C62828"
        }
      }
      r_head -> r_p3 -> r_p7 -> r_p9
      r_head <- r_p3 <- r_p7 <- r_p9
    }
    evict_note: |md
      **Eviction Steps:**
      1. Select TAIL (least recently used)
      2. Check pin_count == 0 (not in use)
      3. If dirty: write to disk first
      4. Remove from list
      5. Update TAIL pointer
      6. Frame is now free for new page
    | {shape: text}
  }
}
section_legend: {
  label: "Legend"
  style.fill: "#FAFAFA"
  mru: "MRU (Most Recently Used)" {
    style: {
      fill: "#ACE1AF"
      stroke: "#2E7D32"
    }
  }
  lru: "LRU (Least Recently Used)" {
    style: {
      fill: "#FFCDD2"
      stroke: "#C62828"
    }
  }
  normal: "Normal Page" {
    style: {
      fill: "#E8F5E9"
      stroke: "#81C784"
    }
  }
  accessed: "Accessed Page" {
    style: {
      fill: "#FFF9C4"
      stroke: "#F57C00"
    }
  }
  victim: "Eviction Victim" {
    style: {
      fill: "#FFCDD2"
      stroke: "#C62828"
      animated: true
    }
  }
}
section_before -> section_operation -> section_after
section_after -> section_eviction: "" {
  style: {
    stroke: "#9E9E9E"
    stroke-dash: 5
  }
}
section_eviction -> section_legend: "" {
  style: {
    stroke: "#9E9E9E"
    stroke-dash: 5
  }
}