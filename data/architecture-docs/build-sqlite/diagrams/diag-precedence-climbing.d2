vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}

classes: {
  header: {
    style: {
      fill: "#1565C0"
      font-color: white
      bold: true
    }
  }
}

title: |md
  # Expression Precedence: How AND/OR Are Parsed
| {near: top-center}

section_wrong: "WRONG: Left-to-Right Parsing" {
  style.fill: "#FFE4E1"
  style.stroke: "#DC143C"
  style.border-radius: 8
  
  wrong_label: |md
    **Naive interpretation:**
    Evaluate left-to-right
    `(a OR b) AND c`
  |
  
  wrong_tree: {
    AND_top: AND {
      style.fill: "#FF6B6B"
      style.stroke: "#DC143C"
      style.font-color: white
    }
    
    OR_sub: OR {
      style.fill: "#FFB3B3"
      style.stroke: "#DC143C"
    }
    
    a1: a {shape: circle; style.fill: "#FFF0F0"}
    b1: b {shape: circle; style.fill: "#FFF0F0"}
    c1: c {shape: circle; style.fill: "#FFF0F0"}
    
    AND_top -> OR_sub
    AND_top -> c1
    
    OR_sub -> a1
    OR_sub -> b1
  }
  
  wrong_result: |md
    **Result:** If `a=TRUE, b=FALSE, c=FALSE`
    - `(TRUE OR FALSE) = TRUE`
    - `TRUE AND FALSE = FALSE`
    - **Final: FALSE** ✗
  | {style.fill: white}
}

section_correct: "CORRECT: Precedence-Based Parsing" {
  style.fill: "#E8F5E9"
  style.stroke: "#2E7D32"
  style.border-radius: 8
  
  correct_label: |md
    **SQL precedence rules:**
    AND binds tighter than OR
    `a OR (b AND c)`
  |
  
  correct_tree: {
    OR_top: OR {
      style.fill: "#4CAF50"
      style.stroke: "#2E7D32"
      style.font-color: white
    }
    
    AND_sub: AND {
      style.fill: "#A5D6A7"
      style.stroke: "#2E7D32"
    }
    
    a2: a {shape: circle; style.fill: "#F1F8E9"}
    b2: b {shape: circle; style.fill: "#F1F8E9"}
    c2: c {shape: circle; style.fill: "#F1F8E9"}
    
    OR_top -> a2
    OR_top -> AND_sub
    
    AND_sub -> b2
    AND_sub -> c2
  }
  
  correct_result: |md
    **Result:** If `a=TRUE, b=FALSE, c=FALSE`
    - `(FALSE AND FALSE) = FALSE`
    - `TRUE OR FALSE = TRUE`
    - **Final: TRUE** ✓
  | {style.fill: white}
}

section_precedence: "SQL Operator Precedence Table" {
  style.fill: "#E3F2FD"
  style.stroke: "#1565C0"
  style.border-radius: 8
  
  precedence_title: |md
    ### Precedence (Highest to Lowest)
  |
  
  table: {
    grid-columns: 3
    grid-gap: 0
    
    h1: "Level" {class: header}
    h2: "Operator" {class: header}
    h3: "Associativity" {class: header}
    
    r1_l: "1 (highest)"
    r1_o: "NOT"
    r1_a: "Right"
    
    r2_l: "2"
    r2_o: "=, <>, <, >, <=, >="
    r2_a: "Left"
    
    r3_l: "3"
    r3_o: "AND"
    r3_a: "Left"
    
    r4_l: "4 (lowest)"
    r4_o: "OR"
    r4_a: "Left"
  }
}

section_explanation: |md
  ## Why This Matters
  
  **AND binds tighter** (like multiplication) — evaluated first
  
  **OR binds looser** (like addition) — evaluated later
  
  Use parentheses to override:
  sql
  -- Force OR first:
  (a OR b) AND c
  
  -- Default (AND first):
  a OR b AND c
  
| {
  near: bottom-center
  style.fill: "#FFF8E1"
  style.border-radius: 8
}

section_wrong -- section_correct: "Same input, different results!" {
  style.stroke-dash: 5
  style.stroke: "#9E9E9E"
}