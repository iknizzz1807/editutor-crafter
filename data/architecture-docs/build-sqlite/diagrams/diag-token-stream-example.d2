vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
  colors: {
    keyword: "#2563EB"
    identifier: "#059669"
    operator: "#DC2626"
    literal: "#7C3AED"
    punctuation: "#6B7280"
    eof: "#9CA3AF"
    stream_bg: "#F8FAFC"
    token_bg: "#FFFFFF"
  }
}
direction: right
title: |md
  # Token Stream: SELECT Statement
  `SELECT * FROM users WHERE id = 42`
| {near: top-center}
source_input: {
  label: |md
    **Input String**
    sql
    SELECT * FROM users WHERE id = 42
    
  |
  style: {
    fill: ${colors.stream_bg}
    stroke: "#CBD5E1"
    stroke-width: 2
    border-radius: 8
  }
}
tokenizer: {
  label: Tokenizer\n(FSM)
  shape: hexagon
  style: {
    fill: "#FEF3C7"
    stroke: "#F59E0B"
    stroke-width: 2
  }
}
source_input -> tokenizer: "character\nstream" {
  style: {
    stroke: "#94A3B8"
    stroke-width: 2
    animated: true
  }
}
token_stream: {
  label: "Token Stream (Array)"
  style: {
    fill: ${colors.stream_bg}
    stroke: "#94A3B8"
    stroke-width: 2
    border-radius: 8
  }
  grid-columns: 1
  grid-gap: 4
  t0: {
    label: |md
      **[0] KEYWORD**
      `SELECT`
      L:1, C:1
    |
    style: {
      fill: ${colors.keyword}
      font-color: white
      border-radius: 6
    }
  }
  t1: {
    label: |md
      **[1] PUNCTUATION**
      `*`
      L:1, C:8
    |
    style: {
      fill: ${colors.punctuation}
      font-color: white
      border-radius: 6
    }
  }
  t2: {
    label: |md
      **[2] KEYWORD**
      `FROM`
      L:1, C:10
    |
    style: {
      fill: ${colors.keyword}
      font-color: white
      border-radius: 6
    }
  }
  t3: {
    label: |md
      **[3] IDENTIFIER**
      `users`
      L:1, C:15
    |
    style: {
      fill: ${colors.identifier}
      font-color: white
      border-radius: 6
    }
  }
  t4: {
    label: |md
      **[4] KEYWORD**
      `WHERE`
      L:1, C:21
    |
    style: {
      fill: ${colors.keyword}
      font-color: white
      border-radius: 6
    }
  }
  t5: {
    label: |md
      **[5] IDENTIFIER**
      `id`
      L:1, C:27
    |
    style: {
      fill: ${colors.identifier}
      font-color: white
      border-radius: 6
    }
  }
  t6: {
    label: |md
      **[6] OPERATOR**
      `=`
      L:1, C:30
    |
    style: {
      fill: ${colors.operator}
      font-color: white
      border-radius: 6
    }
  }
  t7: {
    label: |md
      **[7] INTEGER**
      `42`
      L:1, C:32
    |
    style: {
      fill: ${colors.literal}
      font-color: white
      border-radius: 6
    }
  }
  t8: {
    label: |md
      **[8] EOF**
      `(end)`
      L:1, C:34
    |
    style: {
      fill: ${colors.eof}
      font-color: white
      border-radius: 6
    }
  }
}
tokenizer -> token_stream: "typed tokens\nwith positions" {
  style: {
    stroke: "#059669"
    stroke-width: 2
    animated: true
  }
}
legend: {
  near: bottom-center
  label: |md
    **Token Data Structure**
    c
    typedef struct {
      TokenType type;   // KEYWORD, IDENTIFIER, etc.
      char* value;      // "SELECT", "users", "42"
      int line;         // 1-based line number
      int column;       // 1-based column number
    } Token;
    
  |
  style: {
    fill: "#F1F5F9"
    stroke: "#CBD5E1"
    border-radius: 8
  }
}
legend_tokens: {
  near: bottom-center
  direction: right
  lk: {
    label: KEYWORD
    style: {
      fill: ${colors.keyword}
      font-color: white
      border-radius: 4
    }
  }
  li: {
    label: IDENTIFIER
    style: {
      fill: ${colors.identifier}
      font-color: white
      border-radius: 4
    }
  }
  lo: {
    label: OPERATOR
    style: {
      fill: ${colors.operator}
      font-color: white
      border-radius: 4
    }
  }
  ll: {
    label: LITERAL
    style: {
      fill: ${colors.literal}
      font-color: white
      border-radius: 4
    }
  }
  lp: {
    label: PUNCTUATION
    style: {
      fill: ${colors.punctuation}
      font-color: white
      border-radius: 4
    }
  }
  le: {
    label: EOF
    style: {
      fill: ${colors.eof}
      font-color: white
      border-radius: 4
    }
  }
}
note_fsm: |md
  **FSM States:**
  - `START` → classify first char
  - `IDENTIFIER` → accumulate alphanum
  - `NUMBER` → accumulate digits
  - `STRING` → handle quotes
  - `OPERATOR` → check 2-char ops
| {
  near: center-left
  style: {
    fill: "#FEF9C3"
    stroke: "#EAB308"
    border-radius: 6
    font-size: 12
  }
}