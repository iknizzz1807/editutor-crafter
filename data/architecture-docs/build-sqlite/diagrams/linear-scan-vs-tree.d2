vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}

classes: {
  page: {
    shape: page
    width: 60
    height: 80
    style: {
      fill: "#2d2d2d"
      stroke: "#777"
      stroke-width: 2
    }
  }
  target: {
    shape: page
    width: 60
    height: 80
    style: {
      fill: "#ff5252"
      stroke: "#ff0000"
      stroke-width: 3
      font-color: white
      bold: true
    }
  }
  found: {
    shape: rectangle
    width: 100
    height: 40
    style: {
      fill: "#4caf50"
      stroke: "#00e676"
      stroke-width: 3
      font-color: white
      bold: true
      border-radius: 5
    }
  }
  tree_node: {
    shape: rectangle
    width: 100
    height: 40
    style: {
      fill: "#2d2d2d"
      stroke: "#777"
      border-radius: 5
    }
  }
  stats_box: {
    shape: text
    style: {
      font-size: 14
      font: mono
    }
  }
}

direction: right

# LEFT SIDE: LINEAR SCAN
Linear_Nightmare: "The Linear Scan (O(N))" {
  link: "#ms-btree"
  direction: right
  style: {
    fill: "#1a1a1a"
    stroke: "#ff5252"
    stroke-dash: 3
  }
  
  # The Tape
  p1: "Page 1" { class: page }
  p2: "Page 2" { class: page }
  p3: "Page 3" { class: page }
  dots: "..." { 
    shape: text
    style: { font-size: 24 }
  }
  p999: "Page 999" { class: page }
  p1000: "Page 1000\n(TARGET)" { class: target }

  # The slow crawl
  p1 -> p2 -> p3 -> dots -> p999 -> p1000: "Next..." {
    style: {
      stroke: "#ff5252"
      stroke-width: 2
    }
  }

  # Stats attached to the end
  stats: |md
    ### Cost Analysis
    - **Ops**: 1,000 Reads
    - **I/O**: 4GB Read
    - **Time**: ~10s
    - **CPU**: 100%
  | {
    class: stats_box
  }

  p1000 -> stats { style: { opacity: 0 } }
}

# RIGHT SIDE: B-TREE
BTree_Dream: "The B-Tree Seek (O(log N))" {
  link: "#ms-btree"
  direction: down
  style: {
    fill: "#1a1a1a"
    stroke: "#4caf50"
    stroke-dash: 3
  }

  # Level 1
  Root: "Root Node\n[Keys 1-10000]" {
    class: tree_node
    style: { fill: "#444" }
  }

  # Level 2
  L2_A: "Internal\n[1-5000]" { class: tree_node }
  L2_B: "Internal\n[5001-10000]" { 
    class: tree_node
    style: { fill: "#2e5c31" }
  }

  # Level 3
  L3_A: "Leaf [5000-6000]" { class: tree_node }
  L3_B: "Leaf [Target]" { class: found }
  L3_C: "Leaf [8000-9000]" { class: tree_node }

  # Traversal
  Root -> L2_A: { style: { opacity: 0.3 } }
  Root -> L2_B: "Jump 1" {
    style: {
      stroke: "#00e676"
      stroke-width: 4
    }
  }

  L2_B -> L3_A: { style: { opacity: 0.3 } }
  L2_B -> L3_B: "Jump 2" {
    style: {
      stroke: "#00e676"
      stroke-width: 4
    }
  }
  L2_B -> L3_C: { style: { opacity: 0.3 } }

  # Stats attached to the bottom
  stats_tree: |md
    ### Cost Analysis
    - **Ops**: 2 Reads
    - **I/O**: 8KB Read
    - **Time**: ~0.2ms
    - **CPU**: < 1%
  | {
    class: stats_box
  }

  L3_B -> stats_tree { style: { opacity: 0 } }
}

# Connector
Linear_Nightmare -> BTree_Dream: "VS" {
  style: {
    stroke-width: 0
    font-size: 40
    font-color: "#aaa"
  }
}