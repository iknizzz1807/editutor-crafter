layout-engine: elk
direction: down
vars: {
  d2-config: {
    theme-id: 200
  }
}

SlottedPage: "B-Tree Slotted Page Layout (sizeof=4096 bytes)" {
  style.stroke-width: 4

  Header: "PAGE HEADER" {
    style.fill: "#6a5acd"
    style.font-color: white

    row0: {
      shape: sql_table
      "0x00": "Page Type" {constraint: "1B"}
      "0x01": "Freeblock Ptr" {constraint: "2B"}
      "0x03": "Cell Count" {constraint: "2B"}
      "0x05": "Cell Content Start" {constraint: "2B"}
      "0x07": "Frag Free Count" {constraint: "1B"}
      "0x08": "Right Child ID (Internal)" {constraint: "4B"}
    }
  }

  PointerArray: "CELL POINTER ARRAY (Growth: Downward ↓)" {
    shape: sql_table
    style.fill: "#ff8c00"
    
    ptr_0: "0x0C: Offset[0]" {constraint: "2B"}
    ptr_1: "0x0E: Offset[1]" {constraint: "2B"}
    ptr_n: "0x...: Offset[n]" {constraint: "2B"}

    ptr_0 -> ptr_1 -> ptr_n: {
      style: {
        stroke-width: 2
        stroke: black
      }
    }
  }

  FreeSpace: "UNALLOCATED SPACE (Free)" {
    style.fill: "#2e8b57"
    style.stroke-dash: 5
    style.opacity: 0.6
    
    annotation: "Size = ContentStart - (HeaderSize + 2 * CellCount)" {
      shape: text
    }
  }

  CellContentArea: "CELL CONTENT AREA (Growth: Upward ↑)" {
    style.fill: "#4682b4"

    CellN: "Cell [N] (VarSize)"
    Cell1: "Cell [1] (VarSize)"
    Cell0: "Cell [0] (VarSize)"

    Cell0 -> Cell1 -> CellN: {
      style: {
        stroke-width: 2
        stroke: black
      }
    }
  }

  PageBoundary: "0x0FFF (End of Page)" {
    shape: text
    style.bold: true
  }

  Header.row0 -> PointerArray.ptr_0: "Fixed Offset"
  PointerArray.ptr_n -> FreeSpace: "Growth boundary"
  FreeSpace -> CellContentArea.CellN: "Data boundary"
}

legend: "Color Legend" {
  near: top-right
  Header: {style.fill: "#6a5acd"; label: "Header"}
  Pointers: {style.fill: "#ff8c00"; label: "Pointers"}
  Free: {style.fill: "#2e8b57"; label: "Free Space"}
  Data: {style.fill: "#4682b4"; label: "Cell Data"}
}