direction: right

title: Slotted Page Layout (4096 bytes)

# Memory address scale
scale: {
  shape: sequence_diagram
  addr_0: "0x0000"
  addr_12: "0x0008-0x000C"
  addr_ptr: "0x000C+"
  addr_free: "(variable)"
  addr_content: "0x0FFF ↓"
}

# Main page container
page_container: {
  shape: rectangle
  width: 800
  
  # Page Header Section
  header: {
    shape: rectangle
    style.fill: "#E3F2FD"
    style.stroke: "#1565C0"
    width: 800
    label: "Page Header\n\n┌─────────────────────────────────────────┐\n│ Offset │ Field              │ Size    │\n├─────────────────────────────────────────┤\n│ 0      │ Page Type          │ 1 byte  │\n│ 1-2    │ First Freeblock    │ 2 bytes │\n│ 3-4    │ Cell Count         │ 2 bytes │\n│ 5-6    │ Cell Content Start │ 2 bytes │\n│ 7      │ Fragmented Bytes   │ 1 byte  │\n│ 8-11   │ Rightmost Pointer* │ 4 bytes │\n└─────────────────────────────────────────┘\n*Internal pages only (total: 12 bytes)\nLeaf pages: 8 bytes total"
  }
  
  # Cell Pointer Array Section
  cell_pointers: {
    shape: rectangle
    style.fill: "#FFF3E0"
    style.stroke: "#EF6C00"
    width: 800
    label: "Cell Pointer Array (grows →)\n\n┌────────┬────────┬────────┬────────┬─────────┐\n│ ptr[0] │ ptr[1] │ ptr[2] │ ptr[3] │ ...     │\n│ 2 bytes│ 2 bytes│ 2 bytes│ 2 bytes│         │\n└────────┴────────┴────────┴────────┴─────────┘\nEach pointer: offset to cell in content area\nSorted by key for binary search"
  }
  
  # Free Space Section  
  free_space: {
    shape: rectangle
    style.fill: "#F5F5F5"
    style.stroke: "#757575"
    width: 800
    label: "Free Space\n\nGap between pointer array and cell content\n┌─────────────────────────────────────────────────────────┐\n│                                                         │\n│              (unallocated bytes)                        │\n│                                                         │\n└─────────────────────────────────────────────────────────┘"
  }
  
  # Cell Content Section
  cell_content: {
    shape: rectangle
    style.fill: "#E8F5E9"
    style.stroke: "#2E7D32"
    width: 800
    label: "Cell Content Area (grows ←)\n\n┌─────────┬────────┬────────┬────────┬────────┐\n│ ...     │ cell[3]│ cell[2]│ cell[1]│ cell[0]│\n│         │ var    │ var    │ var    │ var    │\n└─────────┴────────┴────────┴────────┴────────┘\nCells contain: payload size, rowid (table only), payload, overflow ptr"
  }
}

# Byte offset scale
offset_scale: {
  shape: rectangle
  style.fill: "#FAFAFA"
  style.stroke: "#BDBDBD"
  width: 800
  label: "Byte Offset Scale\n\n0      8/12    8+2n     cell_content_start      4095\n|──────|───────|─────────────────────────|──────|\n ↑      ↑        ↑                         ↑\nstart  header   end of                    page\n       end      pointers                  end"
}

# Growth direction indicators
growth_header: {
  shape: text
  label: "← Fixed Size"
}

growth_pointers: {
  shape: text
  label: "Grows → (toward higher addresses)"
}

growth_content: {
  shape: text
  label: "Grows ← (toward lower addresses)"
}

# Page types reference
page_types: {
  shape: rectangle
  style.fill: "#FCE4EC"
  style.stroke: "#C2185B"
  label: "Page Type Codes\n\n┌─────────────────┬────────┬───────────────┐\n│ Type            │ Code   │ Header Size   │\n├─────────────────┼────────┼───────────────┤\n│ Table Leaf      │ 0x0D   │ 8 bytes       │\n│ Table Internal  │ 0x05   │ 12 bytes      │\n│ Index Leaf      │ 0x0A   │ 8 bytes       │\n│ Index Internal  │ 0x02   │ 12 bytes      │\n└─────────────────┴────────┴───────────────┘"
}

# Boundary details
boundaries: {
  shape: rectangle
  style.fill: "#EDE7F6"
  style.stroke: "#5E35B1"
  label: "Key Boundaries & Offsets\n\n┌──────────────────────────────────────────────────────────┐\n│ Boundary                  │ Calculation                │\n├──────────────────────────────────────────────────────────┤\n│ Header End                │ 8 (leaf) or 12 (internal)  │\n│ Pointer Array Start       │ = Header End               │\n│ Pointer Array End         │ = Header End + (2 × count) │\n│ Cell Content Start        │ stored in header at 5-6    │\n│ Free Space Start          │ = Pointer Array End        │\n│ Free Space End            │ = Cell Content Start       │\n│ Page End                  │ = 4095 (page_size - 1)     │\n└──────────────────────────────────────────────────────────┘"
}

# Cell structure detail
cell_detail: {
  shape: rectangle
  style.fill: "#E0F7FA"
  style.stroke: "#00838F"
  label: "Cell Structure (Table Leaf)\n\n┌─────────────────────────────────────────────────────┐\n│ Field          │ Size      │ Description          │\n├─────────────────────────────────────────────────────┤\n│ Payload Size   │ varint    │ Total payload bytes  │\n│ Row ID         │ varint    │ Primary key value    │\n│ Payload        │ N bytes   │ Actual row data      │\n│ Overflow Ptr*  │ 4 bytes   │ *if payload > local  │\n└─────────────────────────────────────────────────────┘"
}

# Layout connections
page_container.header -> page_container.cell_pointers: "offset 8/12\n\n↓"
page_container.cell_pointers -> page_container.free_space: "offset varies\n(8 + 2×n)\n\n↓"
page_container.free_space -> page_container.cell_content: "cell_content_start\n(from header)\n\n↓"

# External references
page_types -> page_container.header: "determines\nheader size"
boundaries -> page_container: "defines\nregions"
cell_detail -> page_container.cell_content: "cell format"