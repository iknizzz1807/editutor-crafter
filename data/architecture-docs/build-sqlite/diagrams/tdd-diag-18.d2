direction: right

title: Page Header Fields Memory Layout | 8 bytes (Leaf) / 12 bytes (Internal)

# Byte position markers
byte_0: {
  shape: text
  label: "0"
}

byte_1: {
  shape: text
  label: "1"
}

byte_2: {
  shape: text
  label: "2"
}

byte_3: {
  shape: text
  label: "3"
}

byte_4: {
  shape: text
  label: "4"
}

byte_5: {
  shape: text
  label: "5"
}

byte_6: {
  shape: text
  label: "6"
}

byte_7: {
  shape: text
  label: "7"
}

byte_8: {
  shape: text
  label: "8"
}

byte_9: {
  shape: text
  label: "9"
}

byte_10: {
  shape: text
  label: "10"
}

byte_11: {
  shape: text
  label: "11"
}

# Header structure
header_container: {
  label: "PageHeader Structure"
  
  leaf_header: {
    label: "Leaf Page Header (8 bytes)"
    
    page_type: {
      label: "PageType\nuint8\n1 byte"
      shape: rectangle
      style.fill: "#E3F2FD"
      style.stroke: "#1976D2"
    }
    
    first_freeblock: {
      label: "FirstFreeblock\nuint16\n2 bytes"
      shape: rectangle
      style.fill: "#FFF3E0"
      style.stroke: "#F57C00"
    }
    
    cell_count: {
      label: "CellCount\nuint16\n2 bytes"
      shape: rectangle
      style.fill: "#E8F5E9"
      style.stroke: "#388E3C"
    }
    
    cell_content_start: {
      label: "CellContentStart\nuint16\n2 bytes"
      shape: rectangle
      style.fill: "#FCE4EC"
      style.stroke: "#C2185B"
    }
    
    fragmented_bytes: {
      label: "FragmentedBytes\nuint8\n1 byte"
      shape: rectangle
      style.fill: "#F3E5F5"
      style.stroke: "#7B1FA2"
    }
  }
  
  internal_extension: {
    label: "Internal Page Extension (+4 bytes)"
    
    rightmost_pointer: {
      label: "RightMostPointer\nuint32\n4 bytes"
      shape: rectangle
      style.fill: "#ECEFF1"
      style.stroke: "#455A64"
    }
  }
}

# Memory layout grid
memory_layout: {
  label: "Byte-Level Memory Layout (Big-Endian)"
  
  row_offset: {
    label: "Offset"
    shape: rectangle
    style.fill: "#37474F"
    style.font-color: white
  }
  
  row_0_3: {
    label: "Bytes 0-3"
    shape: rectangle
    style.fill: "#37474F"
    style.font-color: white
  }
  
  row_4_7: {
    label: "Bytes 4-7"
    shape: rectangle
    style.fill: "#37474F"
    style.font-color: white
  }
  
  row_8_11: {
    label: "Bytes 8-11"
    shape: rectangle
    style.fill: "#37474F"
    style.font-color: white
  }
  
  # Data rows
  offset_0: {
    label: "0"
    shape: rectangle
    style.fill: "#CFD8DC"
  }
  
  byte_0_box: {
    label: "PageType"
    shape: rectangle
    style.fill: "#E3F2FD"
    style.stroke: "#1976D2"
  }
  
  byte_1_2_box: {
    label: "FirstFreeblock"
    shape: rectangle
    style.fill: "#FFF3E0"
    style.stroke: "#F57C00"
  }
  
  byte_3_4_box: {
    label: "CellCount"
    shape: rectangle
    style.fill: "#E8F5E9"
    style.stroke: "#388E3C"
  }
  
  offset_4: {
    label: "4"
    shape: rectangle
    style.fill: "#CFD8DC"
  }
  
  byte_5_6_box: {
    label: "CellContentStart"
    shape: rectangle
    style.fill: "#FCE4EC"
    style.stroke: "#C2185B"
  }
  
  byte_7_box: {
    label: "FragBytes"
    shape: rectangle
    style.fill: "#F3E5F5"
    style.stroke: "#7B1FA2"
  }
  
  reserved_8: {
    label: "—"
    shape: rectangle
    style.fill: "#FAFAFA"
    style.stroke: "#BDBDBD"
  }
  
  offset_8: {
    label: "8"
    shape: rectangle
    style.fill: "#CFD8DC"
  }
  
  byte_8_11_box: {
    label: "RightMostPointer"
    shape: rectangle
    style.fill: "#ECEFF1"
    style.stroke: "#455A64"
  }
}

# Legend
legend: {
  label: "Field Legend"
  
  page_type_legend: {
    label: "PageType (uint8): 0x0D=TableLeaf, 0x05=TableInt, 0x0A=IndexLeaf, 0x02=IndexInt"
    shape: text
  }
  
  freeblock_legend: {
    label: "FirstFreeblock (uint16): Offset to first freeblock chain, 0 if none"
    shape: text
  }
  
  cellcount_legend: {
    label: "CellCount (uint16): Number of cells stored on this page"
    shape: text
  }
  
  contentstart_legend: {
    label: "CellContentStart (uint16): Offset to cell content area start, 0 means 65536"
    shape: text
  }
  
  frag_legend: {
    label: "FragmentedBytes (uint8): Count of fragmented free bytes within cell area"
    shape: text
  }
  
  rightmost_legend: {
    label: "RightMostPointer (uint32): Rightmost child page number (INTERNAL PAGES ONLY)"
    shape: text
    style.font-color: "#455A64"
  }
}

# Size summary
size_summary: {
  label: "Header Size Summary"
  
  leaf_size: {
    label: "Leaf Pages: 8 bytes (PageType → FragmentedBytes)"
    shape: rectangle
    style.fill: "#E8F5E9"
    style.stroke: "#388E3C"
  }
  
  internal_size: {
    label: "Internal Pages: 12 bytes (includes RightMostPointer)"
    shape: rectangle
    style.fill: "#ECEFF1"
    style.stroke: "#455A64"
  }
  
  note: {
    label: "Note: RightMostPointer stores page number of rightmost child\nfor B-tree traversal when no left pointer matches"
    shape: text
    style.font-color: "#616161"
  }
}

# Connections for visual flow
leaf_header -> internal_extension: {
  label: "+4 bytes for internal pages"
  style.stroke: "#455A64"
  style.stroke-dash: 3
}