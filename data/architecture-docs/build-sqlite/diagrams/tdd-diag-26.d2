direction: right

title: DML Execution Flow

# Input nodes
SQL_Statement: {
  shape: oval
  label: "SQL Statement\n(INSERT/UPDATE/DELETE)"
}

# INSERT Flow
INSERT_Input: {
  shape: diamond
  label: "INSERT"
}

Validate_Constraints: {
  shape: rectangle
  label: "Validate Constraints\n(NOT NULL, UNIQUE,\nCHECK, FK)"
}

Serialize_Row: {
  shape: rectangle
  label: "Serialize Row\n(Row â†’ Bytes)"
}

BTree_Insert: {
  shape: rectangle
  label: "B-tree Insert\n(Page Split if needed)"
}

# UPDATE Flow
UPDATE_Input: {
  shape: diamond
  label: "UPDATE"
}

Table_Scan: {
  shape: rectangle
  label: "Table Scan\n(Cursor Traversal)"
}

Filter_Where_UPDATE: {
  shape: diamond
  label: "WHERE Filter\n(3VL Evaluation)"
}

Modify_Row: {
  shape: rectangle
  label: "Modify Row\n(Update Columns)"
}

Reinsert_Row: {
  shape: rectangle
  label: "Delete + Reinsert\n(B-tree Update)"
}

# DELETE Flow
DELETE_Input: {
  shape: diamond
  label: "DELETE"
}

Filter_Where_DELETE: {
  shape: diamond
  label: "WHERE Filter\n(3VL Evaluation)"
}

BTree_Delete: {
  shape: rectangle
  label: "B-tree Delete\n(Mark as Free)"
}

# Output
Result: {
  shape: oval
  label: "Result\n(Rows Affected)"
}

# Connections
SQL_Statement -> INSERT_Input
SQL_Statement -> UPDATE_Input
SQL_Statement -> DELETE_Input

# INSERT path
INSERT_Input -> Validate_Constraints: "1"
Validate_Constraints -> Serialize_Row: "2"
Serialize_Row -> BTree_Insert: "3"
BTree_Insert -> Result

# UPDATE path
UPDATE_Input -> Table_Scan: "1"
Table_Scan -> Filter_Where_UPDATE: "2"
Filter_Where_UPDATE -> Modify_Row: "3\n(match)"
Modify_Row -> Reinsert_Row: "4"
Reinsert_Row -> Result
Filter_Where_UPDATE -> Table_Scan: "no match\n(loop)"

# DELETE path
DELETE_Input -> Table_Scan: "1"
Table_Scan -> Filter_Where_DELETE: "2"
Filter_Where_DELETE -> BTree_Delete: "3\n(match)"
BTree_Delete -> Result
Filter_Where_DELETE -> Table_Scan: "no match\n(loop)"