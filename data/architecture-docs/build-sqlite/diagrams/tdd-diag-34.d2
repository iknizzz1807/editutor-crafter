direction: right
title: Selectivity Threshold Visualization {
  shape: text
  near: top-center
  style: {
    font-size: 24
    bold: true
    underline: true
  }
}

# Cost Chart Area
chart_area: {
  shape: rectangle
  style.fill: "#f8f9fa"
  width: 600
  height: 400

  # Y-Axis (Cost)
  y_axis: {
    shape: rectangle
    style: {
      fill: "#e9ecef"
      stroke: "#495057"
    }
    width: 10
    height: 300
  }

  # X-Axis (Selectivity)
  x_axis: {
    shape: rectangle
    style: {
      fill: "#e9ecef"
      stroke: "#495057"
    }
    width: 500
    height: 10
  }

  # Zone 1: Index Wins (< 5%)
  zone_index_wins: {
    shape: rectangle
    style.fill: "#d4edda"
    style.stroke: "#28a745"
    style.opacity: 0.7
    width: 25
    height: 300
  }

  # Zone 2: Either (5-20%)
  zone_either: {
    shape: rectangle
    style.fill: "#fff3cd"
    style.stroke: "#ffc107"
    style.opacity: 0.7
    width: 75
    height: 300
  }

  # Zone 3: Table Scan Wins (> 20%)
  zone_table_wins: {
    shape: rectangle
    style.fill: "#f8d7da"
    style.stroke: "#dc3545"
    style.opacity: 0.7
    width: 400
    height: 300
  }

  # Cost curve labels
  index_curve_label: "Index Scan Cost\n(↑ with selectivity)" {
    shape: text
    style: {
      font-size: 12
      fill: "#007bff"
    }
  }

  table_curve_label: "Table Scan Cost\n(relatively flat)" {
    shape: text
    style: {
      font-size: 12
      fill: "#6c757d"
    }
  }
}

# Axis Labels
y_label: "Cost (I/O + CPU)" {
  shape: text
  style: {
    font-size: 14
    bold: true
  }
}

x_label: "Selectivity (%)" {
  shape: text
  style: {
    font-size: 14
    bold: true
  }
}

# Zone Labels Below
zone_labels: {
  shape: rectangle

  label1: "< 5%\nINDEX WINS" {
    shape: text
    style: {
      fill: "#28a745"
      font-size: 11
      bold: true
    }
  }

  label2: "5-20%\nEITHER" {
    shape: text
    style: {
      fill: "#ffc107"
      font-size: 11
      bold: true
    }
  }

  label3: "> 20%\nTABLE SCAN WINS" {
    shape: text
    style: {
      fill: "#dc3545"
      font-size: 11
      bold: true
    }
  }
}

# Threshold Marker
threshold_marker: {
  shape: diamond
  style: {
    fill: "#17a2b8"
    stroke: "#17a2b8"
  }
  width: 20
  height: 20
}

threshold_label: "Crossing Point\n(~20%)" {
  shape: text
  style: {
    font-size: 12
    bold: true
    fill: "#17a2b8"
  }
}

# Legend
legend: {
  shape: rectangle
  style: {
    fill: "#ffffff"
    stroke: "#dee2e6"
    stroke-dash: 4
  }

  title: "Legend" {
    shape: text
    style: {
      bold: true
      font-size: 14
    }
  }

  curve1: "─── Index Scan Cost" {
    shape: text
    style.fill: "#007bff"
  }

  curve2: "─── Table Scan Cost" {
    shape: text
    style.fill: "#6c757d"
  }

  threshold: "◆ Cost Crossover" {
    shape: text
    style.fill: "#17a2b8"
  }
}

# Key Insight Box
insight_box: {
  shape: rectangle
  style: {
    fill: "#e7f3ff"
    stroke: "#0056b3"
    stroke-dash: 3
  }
  width: 500

  text: "Key Insight: At low selectivity, index scan wins despite random I/O cost because few rows are accessed.\nAt high selectivity, table scan wins because sequential I/O beats fetching most rows randomly.\nBreak-even occurs around 20% selectivity (IndexSelectivityThreshold = 0.2)" {
    shape: text
    style: {
      font-size: 12
    }
  }
}

# Cost Model Reference
cost_reference: {
  shape: rectangle
  style.fill: "#f5f5f5"

  seq_io: "SequentialIOCost = 1.0 (table scan)" {
    shape: text
    style: { font-size: 11 }
  }

  rand_io: "RandomIOCost = 10.0 (index lookup)" {
    shape: text
    style: { font-size: 11 }
  }

  threshold: "IndexSelectivityThreshold = 0.2 (20%)" {
    shape: text
    style: { font-size: 11 }
  }
}

# Flow arrows showing decision
decision_flow: {
  low_sel: {
    shape: rectangle
    style.fill: "#d4edda"

    text: "Low Selectivity\n(< 20%)" {
      shape: text
    }
  }

  arrow1: low_sel -> choose {
    label: "→"
    style: {
      stroke: "#28a745"
      stroke-width: 3
    }
  }

  choose: {
    shape: diamond
    style.fill: "#fff3cd"
    label: "Choose\nAccess\nPath"
  }

  arrow2: choose -> index_path {
    label: "index"
    style: {
      stroke: "#28a745"
      stroke-width: 2
    }
  }

  arrow3: choose -> table_path {
    label: "table"
    style: {
      stroke: "#dc3545"
      stroke-width: 2
    }
  }

  index_path: {
    shape: rectangle
    style.fill: "#d4edda"
    text: "IndexScanPath\n(Fewer I/Os)"
  }

  table_path: {
    shape: rectangle
    style.fill: "#f8d7da"
    text: "TableScanPath\n(Better sequential)"
  }
}