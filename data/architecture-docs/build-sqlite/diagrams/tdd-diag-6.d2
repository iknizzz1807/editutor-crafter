direction: down
title: Expression Precedence Parsing Algorithm

vars: {
  box-style: {
    stroke: "#2563eb"
    fill: "#eff6ff"
    border-radius: 8
  }
  decision-style: {
    stroke: "#9333ea"
    fill: "#faf5ff"
  }
  loop-style: {
    stroke: "#059669"
    fill: "#ecfdf5"
  }
}

start: {
  shape: oval
  label: "Start"
  style.fill: "#dcfce7"
}

parse_primary: {
  label: "Parse Primary\nExpression\n(literal, variable,\nor parenthesized)"
  style: ${box-style}
}

check_op: {
  shape: diamond
  label: "Current Op\nPrecedence\n>= minPrec?"
  style: ${decision-style}
}

exit_loop: {
  shape: diamond
  label: "No more\noperators?"
  style: ${decision-style}
}

consume_op: {
  label: "Consume\nOperator"
  style: ${box-style}
}

calc_prec: {
  label: "Calculate\nnextMinPrec:\n(opPrec + 1)\nfor higher\nprecedence"
  style: ${box-style}
}

parse_right: {
  label: "Parse Right\nOperand\n(with nextMinPrec)"
  style: ${box-style}
}

build_node: {
  label: "Build Binary\nExpression Node:\n(left, op, right)"
  style: ${box-style}
}

update_left: {
  label: "left = new\nBinary Node"
  style: ${box-style}
}

return_expr: {
  shape: oval
  label: "Return\nExpression\nNode"
  style.fill: "#fef3c7"
}

loop_frame: {
  label: "Precedence Loop"
  style: ${loop-style}
  
  inner_check: {
    shape: diamond
    label: "opPrec >=\nminPrec?"
    style: ${decision-style}
  }
  
  inner_consume: {
    label: "Consume Op"
    style: ${box-style}
  }
  
  inner_right: {
    label: "Parse Right\n(nextMinPrec)"
    style: ${box-style}
  }
  
  inner_build: {
    label: "Build\nBinary Node"
    style: ${box-style}
  }
  
  inner_check -> inner_consume: "Yes"
  inner_consume -> inner_right
  inner_right -> inner_build
  inner_build -> inner_check: "Loop"
}

start -> parse_primary
parse_primary -> check_op

check_op -> consume_op: "Yes"
check_op -> return_expr: "No"

consume_op -> calc_prec
calc_prec -> parse_right
parse_right -> build_node
build_node -> update_left
update_left -> check_op: "Continue\nLoop"

exit_loop -> return_expr: "Yes"

legend: {
  label: "Legend"
  
  box_legend: {
    label: "Processing Step"
    style: ${box-style}
  }
  
  decision_legend: {
    shape: diamond
    label: "Decision"
    style: ${decision-style}
  }
  
  oval_legend: {
    shape: oval
    label: "Start/End"
    style.fill: "#dcfce7"
  }
}

legend_box: {
  label: "Precedence Climbing\nKey Points"
  style.fill: "#fef9c3"
  
  point1: "• Left-associative: opPrec + 1"
  point2: "• Right-associative: opPrec"
  point3: "• Handles nested expressions"
  point4: "• Single pass, O(n) complexity"
}