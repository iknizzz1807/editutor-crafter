direction: down

title: SELECT Statement AST Structure {
  shape: text
  style: {
    font-size: 24
    bold: true
    underline: true
  }
}

legend: {
  shape: rectangle
  style.fill: "#E8F4FD"
  
  "AST Node Types": {
    shape: text
    style.font-size: 14
    style.bold: true
  }
  
  struct_node: "Struct (Container)" {
    shape: rectangle
    style.fill: "#DBEEFC"
  }
  
  field_node: "Field (Property)" {
    shape: rectangle
    style.fill: "#F0FDF4"
  }
  
  type_node: "Type Annotation" {
    shape: text
    style.italic: true
    style.font-color: "#6B7280"
  }
  
  example_node: "Example Value" {
    shape: rectangle
    style.fill: "#FEF3C7"
  }
}

SelectStatement: {
  shape: rectangle
  style.fill: "#DBEEFC"
  style.stroke: "#2563EB"
  style.stroke-width: 2
  label: "SelectStatement\n(struct)"
  
  Pos: {
    shape: rectangle
    style.fill: "#F0FDF4"
    label: "Pos: Position"
  }
  
  Columns: {
    shape: rectangle
    style.fill: "#F0FDF4"
    label: "Columns\n[]ColumnSelection"
    
    ColumnSelection: {
      shape: rectangle
      style.fill: "#FEF3C7"
      label: "ColumnSelection"
      
      Star: "* (all columns)" {
        shape: text
      }
      Column: "ColumnName: string" {
        shape: text
      }
      Alias: "AS alias (optional)" {
        shape: text
      }
    }
  }
  
  FromTable: {
    shape: rectangle
    style.fill: "#F0FDF4"
    label: "FromTable: string"
  }
  
  Alias: {
    shape: rectangle
    style.fill: "#F0FDF4"
    label: "Alias: string\n(optional)"
  }
  
  Where: {
    shape: rectangle
    style.fill: "#F0FDF4"
    label: "Where: Expression\n(optional)"
    
    Expression: {
      shape: rectangle
      style.fill: "#FEF3C7"
      label: "Expression Interface"
      
      BinaryExpr: "BinaryExpr (AND, OR, =, <, >)" {
        shape: text
      }
      LiteralExpr: "LiteralExpr (123, 'text')" {
        shape: text
      }
      ColumnExpr: "ColumnExpr (column_name)" {
        shape: text
      }
      FunctionExpr: "FunctionExpr (COUNT, SUM)" {
        shape: text
      }
    }
  }
  
  GroupBy: {
    shape: rectangle
    style.fill: "#F0FDF4"
    label: "GroupBy\n[]Expression\n(optional)"
  }
  
  Having: {
    shape: rectangle
    style.fill: "#F0FDF4"
    label: "Having: Expression\n(optional)"
  }
  
  OrderBy: {
    shape: rectangle
    style.fill: "#F0FDF4"
    label: "OrderBy\n[]OrderByColumn\n(optional)"
    
    OrderByColumn: {
      shape: rectangle
      style.fill: "#FEF3C7"
      label: "OrderByColumn"
      
      Column: "Column: Expression" {
        shape: text
      }
      Direction: "Direction: ASC | DESC" {
        shape: text
      }
    }
  }
  
  Limit: {
    shape: rectangle
    style.fill: "#F0FDF4"
    label: "Limit: *int\n(optional)"
  }
  
  Offset: {
    shape: rectangle
    style.fill: "#F0FDF4"
    label: "Offset: *int\n(optional)"
  }
}

SelectStatement -> SelectStatement.Pos
SelectStatement -> SelectStatement.Columns
SelectStatement -> SelectStatement.FromTable
SelectStatement -> SelectStatement.Alias
SelectStatement -> SelectStatement.Where
SelectStatement -> SelectStatement.GroupBy
SelectStatement -> SelectStatement.Having
SelectStatement -> SelectStatement.OrderBy
SelectStatement -> SelectStatement.Limit
SelectStatement -> SelectStatement.Offset

SelectStatement.Columns -> SelectStatement.Columns.ColumnSelection
SelectStatement.Where -> SelectStatement.Where.Expression
SelectStatement.OrderBy -> SelectStatement.OrderBy.OrderByColumn

example_query: {
  shape: rectangle
  style.fill: "#F3E8FF"
  style.stroke: "#7C3AED"
  style.stroke-width: 2
  
  title: "Example Query" {
    shape: text
    style.font-size: 16
    style.bold: true
  }
  
  sql: "SELECT id, name AS username\nFROM users\nWHERE age > 18\nORDER BY name ASC\nLIMIT 10" {
    shape: text
    style.font: mono
    style.font-size: 12
  }
}

example_ast: {
  shape: rectangle
  style.fill: "#ECFDF5"
  style.stroke: "#059669"
  style.stroke-width: 2
  
  title: "Parsed AST Tree" {
    shape: text
    style.font-size: 16
    style.bold: true
  }
  
  root: "SelectStatement" {
    shape: rectangle
    style.fill: "#DBEEFC"
    style.bold: true
  }
  
  cols: "Columns: [ColumnSelection{name:'id'}, ColumnSelection{name:'name', alias:'username'}]" {
    shape: rectangle
    style.fill: "#F0FDF4"
  }
  
  from: "FromTable: 'users'" {
    shape: rectangle
    style.fill: "#F0FDF4"
  }
  
  where: "Where: BinaryExpr{op:'>', left:ColumnExpr{'age'}, right:LiteralExpr{18}}" {
    shape: rectangle
    style.fill: "#F0FDF4"
  }
  
  order: "OrderBy: [OrderByColumn{Column:ColumnExpr{'name'}, Direction:ASC}]" {
    shape: rectangle
    style.fill: "#F0FDF4"
  }
  
  limit: "Limit: *int(10)" {
    shape: rectangle
    style.fill: "#F0FDF4"
  }
  
  root -> cols
  root -> from
  root -> where
  root -> order
  root -> limit
}

legend -> SelectStatement: "Type Reference" {
  style.stroke-dash: 3
  style.stroke: "#9CA3AF"
}

example_query -> example_ast: "Parser\nTransforms" {
  style.stroke: "#7C3AED"
  style.stroke-width: 2
  style.animated: true
}

group_labels: {
  shape: text
  style.font-size: 11
  style.font-color: "#6B7280"
  label: "M2: SQL Parser Module | AST Structure for SELECT Statements\nGenerated from TDD build-sqlite-m2 | Diagram ID: diag-select-ast"
}