direction: right
vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}
START: {
  shape: circle
  label: "START"
}
IN_IDENTIFIER: {
  shape: rectangle
  label: "IN_IDENTIFIER"
}
IN_NUMBER: {
  shape: rectangle
  label: "IN_NUMBER"
}
IN_STRING: {
  shape: rectangle
  label: "IN_STRING"
}
IN_QUOTED_ID: {
  shape: rectangle
  label: "IN_QUOTED_ID"
}
IN_LINE_COMMENT: {
  shape: rectangle
  label: "IN_LINE_COMMENT"
}
IN_BLOCK_COMMENT: {
  shape: rectangle
  label: "IN_BLOCK_COMMENT"
}
IN_BLOB: {
  shape: rectangle
  label: "IN_BLOB"
}
IN_OPERATOR: {
  shape: rectangle
  label: "IN_OPERATOR"
}
EMIT_IDENTIFIER: {
  shape: oval
  label: "EMIT\nIDENTIFIER/KEYWORD"
  style.fill: "#90EE90"
}
EMIT_NUMBER: {
  shape: oval
  label: "EMIT\nNUMBER"
  style.fill: "#90EE90"
}
EMIT_STRING: {
  shape: oval
  label: "EMIT\nSTRING"
  style.fill: "#90EE90"
}
EMIT_QUOTED_ID: {
  shape: oval
  label: "EMIT\nQUOTED_ID"
  style.fill: "#90EE90"
}
EMIT_OPERATOR: {
  shape: oval
  label: "EMIT\nOPERATOR"
  style.fill: "#90EE90"
}
EMIT_PUNCTUATION: {
  shape: oval
  label: "EMIT\nPUNCTUATION"
  style.fill: "#90EE90"
}
SKIP_WHITESPACE: {
  shape: oval
  label: "SKIP\nWHITESPACE"
  style.fill: "#FFB6C1"
}
SKIP_COMMENT: {
  shape: oval
  label: "SKIP\nCOMMENT"
  style.fill: "#FFB6C1"
}
ERROR: {
  shape: diamond
  label: "ERROR"
  style.fill: "#FF6B6B"
}
START -> IN_IDENTIFIER: "[a-zA-Z_]"
START -> IN_NUMBER: "[0-9] or '.'"
START -> IN_STRING: "'"
START -> IN_QUOTED_ID: "\""
START -> IN_LINE_COMMENT: "--"
START -> IN_BLOCK_COMMENT: "/*"
START -> IN_BLOB: "x' or X'"
START -> IN_OPERATOR: "[+-*/<>=!&|]"
START -> EMIT_PUNCTUATION: "[(),;]"
START -> SKIP_WHITESPACE: "[ \\t\\n\\r]"
START -> ERROR: "invalid char"
IN_IDENTIFIER -> IN_IDENTIFIER: "[a-zA-Z0-9_]"
IN_IDENTIFIER -> EMIT_IDENTIFIER: "other"
EMIT_IDENTIFIER -> START: "continue"
IN_NUMBER -> IN_NUMBER: "[0-9]"
IN_NUMBER -> IN_NUMBER: ". (decimal)"
IN_NUMBER -> IN_NUMBER: "[eE] (exponent)"
IN_NUMBER -> IN_NUMBER: "[+-] (after e)"
IN_NUMBER -> EMIT_NUMBER: "other"
EMIT_NUMBER -> START: "continue"
IN_STRING -> IN_STRING: "regular char"
IN_STRING -> EMIT_STRING: "' (end)"
IN_STRING -> IN_STRING: "'' (escaped quote)"
IN_STRING -> ERROR: "unterminated"
EMIT_STRING -> START: "continue"
IN_QUOTED_ID -> IN_QUOTED_ID: "regular char"
IN_QUOTED_ID -> EMIT_QUOTED_ID: "\" (end)"
IN_QUOTED_ID -> IN_QUOTED_ID: "\"\" (escaped quote)"
IN_QUOTED_ID -> ERROR: "unterminated"
EMIT_QUOTED_ID -> START: "continue"
IN_LINE_COMMENT -> IN_LINE_COMMENT: "non-newline"
IN_LINE_COMMENT -> SKIP_COMMENT: "\\n"
SKIP_COMMENT -> START: "continue"
IN_BLOCK_COMMENT -> IN_BLOCK_COMMENT: "non-*"
IN_BLOCK_COMMENT -> IN_BLOCK_COMMENT: "* (check for /)"
IN_BLOCK_COMMENT -> SKIP_COMMENT: "*/"
IN_BLOCK_COMMENT -> ERROR: "unterminated"
IN_BLOB -> IN_BLOB: "[0-9a-fA-F]"
IN_BLOB -> EMIT_STRING: "' (end)"
IN_BLOB -> ERROR: "invalid hex"
IN_BLOB -> ERROR: "unterminated"
IN_OPERATOR -> IN_OPERATOR: "continuation\n(==, !=, <=, >=, ||)"
IN_OPERATOR -> EMIT_OPERATOR: "other"
EMIT_OPERATOR -> START: "continue"
SKIP_WHITESPACE -> START: "continue"
ERROR -> START: "recover"
legend: |md
  # State Machine Legend
  - ○ Circle = Start/Entry State
  - □ Box = Processing State
  - ⬭ Oval = Emit/Skip Action
  - ◇ Diamond = Error State
  - Green = Token Emitted
  - Pink = Input Skipped
  - Red = Error Condition
|