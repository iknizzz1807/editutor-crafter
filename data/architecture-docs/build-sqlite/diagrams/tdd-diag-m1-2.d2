direction: down
title: Token Data Structure Memory Layout {
  shape: text
  style.font-size: 28
  style.bold: true
  style.underline: true
}
group: Token Struct (32 bytes) {
  style.fill: "#E3F2FD"
  style.stroke: "#1976D2"
  token_header: {
    shape: text
    style.bold: true
    style.font-size: 16
    label: "Token"
  }
  grid: {
    shape: rectangle
    style.fill: "#FAFAFA"
    cell_type: {
      shape: rectangle
      label: "type\n(TokenType)\n4 bytes"
      style.fill: "#BBDEFB"
      style.stroke: "#1976D2"
    }
    cell_pad1: {
      shape: rectangle
      label: "padding\n4 bytes"
      style.fill: "#FFECB3"
      style.stroke: "#FF8F00"
    }
    cell_value: {
      shape: rectangle
      label: "value\n(char*)\n8 bytes"
      style.fill: "#C8E6C9"
      style.stroke: "#388E3C"
    }
    cell_line: {
      shape: rectangle
      label: "line\n(int)\n4 bytes"
      style.fill: "#BBDEFB"
      style.stroke: "#1976D2"
    }
    cell_col: {
      shape: rectangle
      label: "column\n(int)\n4 bytes"
      style.fill: "#BBDEFB"
      style.stroke: "#1976D2"
    }
    cell_len: {
      shape: rectangle
      label: "length\n(int)\n4 bytes"
      style.fill: "#BBDEFB"
      style.stroke: "#1976D2"
    }
    cell_pad2: {
      shape: rectangle
      label: "padding\n4 bytes"
      style.fill: "#FFECB3"
      style.stroke: "#FF8F00"
    }
    cell_type -- cell_pad1 -- cell_value -- cell_line -- cell_col -- cell_len -- cell_pad2: {
      style.stroke: transparent
    }
  }
  offsets: {
    shape: rectangle
    style.fill: "#FAFAFA"
    off0: {
      shape: text
      label: "Offset 0"
    }
    off4: {
      shape: text
      label: "Offset 4"
    }
    off8: {
      shape: text
      label: "Offset 8"
    }
    off16: {
      shape: text
      label: "Offset 16"
    }
    off20: {
      shape: text
      label: "Offset 20"
    }
    off24: {
      shape: text
      label: "Offset 24"
    }
    off28: {
      shape: text
      label: "Offset 28"
    }
    off0 -- off4 -- off8 -- off16 -- off20 -- off24 -- off28: {
      style.stroke: transparent
    }
  }
}
group: TokenStream Struct {
  style.fill: "#F3E5F5"
  style.stroke: "#7B1FA2"
  stream_header: {
    shape: text
    style.bold: true
    style.font-size: 16
    label: "TokenStream"
  }
  stream_grid: {
    shape: rectangle
    style.fill: "#FAFAFA"
    cell_tokens: {
      shape: rectangle
      label: "tokens\n(Token*)\n8 bytes"
      style.fill: "#E1BEE7"
      style.stroke: "#7B1FA2"
    }
    cell_count: {
      shape: rectangle
      label: "count\n(size_t)\n8 bytes"
      style.fill: "#C8E6C9"
      style.stroke: "#388E3C"
    }
    cell_cap: {
      shape: rectangle
      label: "capacity\n(size_t)\n8 bytes"
      style.fill: "#C8E6C9"
      style.stroke: "#388E3C"
    }
    cell_tokens -- cell_count -- cell_cap: {
      style.stroke: transparent
    }
  }
  stream_offsets: {
    shape: rectangle
    style.fill: "#FAFAFA"
    soff0: {
      shape: text
      label: "Offset 0"
    }
    soff8: {
      shape: text
      label: "Offset 8"
    }
    soff16: {
      shape: text
      label: "Offset 16"
    }
    soff0 -- soff8 -- soff16: {
      style.stroke: transparent
    }
  }
}
group: Dynamic Array Visualization {
  style.fill: "#E8F5E9"
  style.stroke: "#388E3C"
  arr_header: {
    shape: text
    style.bold: true
    style.font-size: 14
    label: "tokens array (heap allocated)"
  }
  arr_cells: {
    shape: rectangle
    style.fill: "#FAFAFA"
    t0: {
      shape: rectangle
      label: "Token[0]"
      style.fill: "#BBDEFB"
      style.stroke: "#1976D2"
    }
    t1: {
      shape: rectangle
      label: "Token[1]"
      style.fill: "#BBDEFB"
      style.stroke: "#1976D2"
    }
    t2: {
      shape: rectangle
      label: "Token[2]"
      style.fill: "#BBDEFB"
      style.stroke: "#1976D2"
    }
    tdots: {
      shape: text
      label: "..."
    }
    tn: {
      shape: rectangle
      label: "Token[n-1]"
      style.fill: "#BBDEFB"
      style.stroke: "#1976D2"
    }
    t0 -- t1 -- t2 -- tdots -- tn: {
      style.stroke: transparent
    }
  }
}
pointer_arrow: stream_grid.cell_tokens -> arr_cells.t0: {
  style.stroke: "#7B1FA2"
  style.stroke-dash: 3
  label: "points to"
}
legend: {
  shape: rectangle
  style.fill: "#FAFAFA"
  style.stroke: "#666666"
  leg_title: {
    shape: text
    style.bold: true
    label: "Legend"
  }
  leg_data: {
    shape: rectangle
    label: "Data field"
    style.fill: "#BBDEFB"
    style.stroke: "#1976D2"
  }
  leg_ptr: {
    shape: rectangle
    label: "Pointer"
    style.fill: "#C8E6C9"
    style.stroke: "#388E3C"
  }
  leg_pad: {
    shape: rectangle
    label: "Padding"
    style.fill: "#FFECB3"
    style.stroke: "#FF8F00"
  }
  leg_title -- leg_data -- leg_ptr -- leg_pad: {
    style.stroke: transparent
  }
}