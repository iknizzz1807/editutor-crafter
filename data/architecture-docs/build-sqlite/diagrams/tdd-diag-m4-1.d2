direction: right
BufferPool: {
  label: BufferPool
  shape: rectangle
  style.fill: "#E3F2FD"
  style.stroke: "#1565C0"
  header: {
    label: "struct BufferPool"
    shape: rectangle
    style.fill: "#1565C0"
    style.font-color: white
    style.stroke: "#0D47A1"
  }
  fields: {
    shape: rectangle
    style.fill: "#FAFAFA"
    label: |md
      Frame* frames;
      int frame_count;
      PageTable* page_table;
      LRUList* lru_list;
      int64_t hits;
      int64_t misses;
      int64_t evictions;
      int64_t dirty_writes;
      FileManager* file_manager;
    |
  }
  header -> fields
}
FramesArray: {
  label: "frames[] (Contiguous Array)"
  shape: rectangle
  style.fill: "#E8F5E9"
  style.stroke: "#2E7D32"
  frame0: {
    label: "Frame[0]\n───────\nPageId: 5\npin_count: 1\ndirty: true\ndata[4096]"
    shape: rectangle
    style.fill: "#C8E6C9"
  }
  frame1: {
    label: "Frame[1]\n───────\nPageId: 12\npin_count: 0\ndirty: false\ndata[4096]"
    shape: rectangle
    style.fill: "#A5D6A7"
  }
  frame2: {
    label: "Frame[2]\n───────\nPageId: 3\npin_count: 2\ndirty: true\ndata[4096]"
    shape: rectangle
    style.fill: "#C8E6C9"
  }
  frame3: {
    label: "Frame[3]\n───────\nPageId: ∅\npin_count: 0\ndirty: false\ndata[4096]"
    shape: rectangle
    style.fill: "#FFCDD2"
    style.stroke: "#C62828"
  }
  dots: {
    label: "..."
    shape: text
  }
  frameN: {
    label: "Frame[N-1]\n───────\nPageId: 8\npin_count: 0\ndirty: false\ndata[4096]"
    shape: rectangle
    style.fill: "#A5D6A7"
  }
  frame0 -> frame1 -> frame2 -> frame3 -> dots -> frameN
}
PageTable: {
  label: "page_table (Hash Map: PageId → Frame*)"
  shape: rectangle
  style.fill: "#FFF3E0"
  style.stroke: "#EF6C00"
  buckets: {
    label: "Buckets (Array)"
    shape: rectangle
    style.fill: "#FFE0B2"
    b0: { label: "[0]"; shape: rectangle }
    b1: { label: "[1]"; shape: rectangle }
    b2: { label: "[2]"; shape: rectangle }
    b3: { label: "[...]"; shape: rectangle }
    b4: { label: "[N]"; shape: rectangle }
    b0 -> b1 -> b2 -> b3 -> b4
  }
  chain0: {
    label: "Entry\n{key:5, val:*Frame[0]}"
    shape: rectangle
    style.fill: "#FFCC80"
  }
  chain1: {
    label: "Entry\n{key:12, val:*Frame[1]}"
    shape: rectangle
    style.fill: "#FFCC80"
  }
  chain2a: {
    label: "Entry\n{key:3, val:*Frame[2]}"
    shape: rectangle
    style.fill: "#FFCC80"
  }
  chain2b: {
    label: "Entry\n{key:8, val:*Frame[N-1]}"
    shape: rectangle
    style.fill: "#FFCC80"
  }
  b0 -> chain0
  b1 -> chain1
  b2 -> chain2a -> chain2b
}
LRUList: {
  label: "lru_list (Doubly-Linked List)"
  shape: rectangle
  style.fill: "#F3E5F5"
  style.stroke: "#7B1FA2"
  pointers: {
    shape: rectangle
    style.fill: "#E1BEE7"
    label: |md
      head → MRU
      tail → LRU
    |
  }
  node1: {
    label: "Frame[1]\nPageId: 12\n⟷"
    shape: rectangle
    style.fill: "#CE93D8"
  }
  node2: {
    label: "Frame[N-1]\nPageId: 8\n⟷"
    shape: rectangle
    style.fill: "#CE93D8"
  }
  node3: {
    label: "Frame[3]\nPageId: ∅\n(free)"
    shape: rectangle
    style.fill: "#CE93D8"
  }
  pointers -> node1
  node1 -> node2 -> node3
}
Statistics: {
  label: "Statistics Counters"
  shape: rectangle
  style.fill: "#ECEFF1"
  style.stroke: "#455A64"
  hits: {
    label: "hits: 15,847"
    shape: rectangle
    style.fill: "#B0BEC5"
  }
  misses: {
    label: "misses: 1,203"
    shape: rectangle
    style.fill: "#90A4AE"
  }
  evictions: {
    label: "evictions: 89"
    shape: rectangle
    style.fill: "#78909C"
  }
  dirty_writes: {
    label: "dirty_writes: 234"
    shape: rectangle
    style.fill: "#607D8B"
    style.font-color: white
  }
  hits -> misses -> evictions -> dirty_writes
}
BufferPool.fields -> FramesArray: {
  label: frames
  style.stroke: "#2E7D32"
  style.stroke-dash: 3
}
BufferPool.fields -> PageTable: {
  label: page_table
  style.stroke: "#EF6C00"
  style.stroke-dash: 3
}
BufferPool.fields -> LRUList: {
  label: lru_list
  style.stroke: "#7B1FA2"
  style.stroke-dash: 3
}
BufferPool.fields -> Statistics: {
  label: counters
  style.stroke: "#455A64"
  style.stroke-dash: 3
}
PageTable.chain0 -> FramesArray.frame0: {
  label: ptr
  style.stroke: "#1565C0"
}
PageTable.chain1 -> FramesArray.frame1: {
  style.stroke: "#1565C0"
}
PageTable.chain2a -> FramesArray.frame2: {
  style.stroke: "#1565C0"
}
PageTable.chain2b -> FramesArray.frameN: {
  style.stroke: "#1565C0"
}
LRUList.node1 -> FramesArray.frame1: {
  label: ref
  style.stroke: "#7B1FA2"
  style.stroke-dash: 5
}
LRUList.node3 -> FramesArray.frame3: {
  label: ref
  style.stroke: "#7B1FA2"
  style.stroke-dash: 5
}
Legend: {
  label: Legend
  shape: rectangle
  style.fill: "#FAFAFA"
  lru: { label: "In LRU List (pin_count=0)"; shape: text }
  pinned: { label: "Pinned (pin_count>0)"; shape: text }
  free: { label: "Free Frame (PageId=∅)"; shape: text }
  lru -> pinned -> free
}
FramesArray.frame1 -> Legend.lru: {
  style.opacity: 0
}