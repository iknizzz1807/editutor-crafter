direction: right
title: Varint Encoding Algorithm {
  near: top-center
  shape: text
  style: {
    font-size: 24
    bold: true
  }
}
# INPUT
input: {
  shape: rectangle
  label: "Input Value\n16384"
  style.fill: "#E3F2FD"
}
# STEP 1: Calculate Bytes Needed
step1_group: {
  label: Step 1: Calculate Bytes Needed
  step1_box: {
    shape: rectangle
    label: "16384 in binary:\n100 0000 0000 0000\n\n14 bits → needs 3 bytes\n(7 bits per byte, high bit\nreserved for continuation)"
    style.fill: "#FFF3E0"
  }
}
# STEP 2: Split into 7-bit Groups
step2_group: {
  label: Step 2: Split into 7-bit Groups
  step2_box: {
    shape: rectangle
    label: "Split 16384 into 7-bit chunks\n(big-endian: MSB first)\n\nChunk 1: 0000001 (1)\nChunk 2: 0000000 (0)\nChunk 3: 0000000 (0)"
    style.fill: "#E8F5E9"
  }
}
# STEP 3: Add Continuation Bits
step3_group: {
  label: Step 3: Add Continuation Bits
  step3_box: {
    shape: rectangle
    label: "Add high bit:\n1 = more bytes follow\n0 = final byte\n\nByte 1: 1|0000001 → 10000001 (0x81)\nByte 2: 1|0000000 → 10000000 (0x80)\nByte 3: 0|0000000 → 00000000 (0x00)"
    style.fill: "#FCE4EC"
  }
}
# STEP 4: Final Encoding
step4_group: {
  label: Step 4: Final Encoding
  step4_box: {
    shape: rectangle
    label: "Encoded bytes:\n[0x81, 0x80, 0x00]\n\nHex: 81 80 00\nBinary: 10000001 10000000 00000000"
    style.fill: "#E1BEE7"
  }
}
# DECODE SECTION
decode_title: {
  shape: text
  label: "## Decode Process (Reverse)"
  style: {
    font-size: 18
    bold: true
  }
}
# DECODE STEP 1
decode1_group: {
  label: Decode Step 1: Read Bytes
  decode1_box: {
    shape: rectangle
    label: "Read: [0x81, 0x80, 0x00]\n\nByte 1: 0x81 → high bit=1 (continue)\nByte 2: 0x80 → high bit=1 (continue)\nByte 3: 0x00 → high bit=0 (stop)"
    style.fill: "#B3E5FC"
  }
}
# DECODE STEP 2
decode2_group: {
  label: Decode Step 2: Extract 7-bit Payloads
  decode2_box: {
    shape: rectangle
    label: "Mask off high bits:\n0x81 & 0x7F = 0000001\n0x80 & 0x7F = 0000000\n0x00 & 0x7F = 0000000"
    style.fill: "#C8E6C9"
  }
}
# DECODE STEP 3
decode3_group: {
  label: Decode Step 3: Reconstruct Value
  decode3_box: {
    shape: rectangle
    label: "Shift and combine:\n(1 << 14) | (0 << 7) | 0\n= 16384 + 0 + 0\n= 16384 ✓"
    style.fill: "#FFCDD2"
  }
}
# OUTPUT
output: {
  shape: rectangle
  label: "Decoded Value\n16384"
  style.fill: "#E3F2FD"
}
# Connections
input -> step1_group -> step2_group -> step3_group -> step4_group
step4_group -> decode1_group -> decode2_group -> decode3_group -> output
# Summary box
summary: {
  shape: rectangle
  label: "Summary:\n• Original: 16384 (2 bytes in fixed-width)\n• Varint: 3 bytes\n• Overhead: +1 byte for this value\n• Benefit: Small values (0-127) use only 1 byte"
  style.fill: "#FFFDE7"
  style.stroke: "#FBC02D"
}
step4_group -> summary