direction: down
title: Node Split Sequence {
  near: top-center
  shape: text
  style: {
    font-size: 28
    bold: true
    underline: true
  }
}
step_1_before: {
  label: "1. BEFORE: Full Page (Overflow)"
  shape: rectangle
  style.fill: "#ffcccc"
  style.stroke: "#cc0000"
  style.stroke-width: 3
  full_page: {
    label: "Page P (FULL)\n─────────────\n| Cell 1: K=10 |\n| Cell 2: K=20 |\n| Cell 3: K=30 |\n| Cell 4: K=40 |\n| Cell 5: K=50 |\n| Cell 6: K=60 |\n─────────────\nPage: 85% full\nCannot insert K=35!"
    shape: rectangle
    style.fill: "#ffdddd"
  }
}
arrow_1_2: {
  label: "Insert K=35\ntriggers split"
  shape: text
  style.font-size: 12
}
step_2_allocate: {
  label: "2. ALLOCATE: New Sibling Page"
  shape: rectangle
  style.fill: "#e6f3ff"
  style.stroke: "#0066cc"
  style.stroke-width: 3
  original_page: {
    label: "Page P\n─────────────\n| Cells 1-6  |\n| (to be     |\n|  split)    |\n─────────────"
    shape: rectangle
    style.fill: "#fff2cc"
  }
  new_sibling: {
    label: "Page Q (NEW)\n─────────────\n|   Empty    |\n|   (newly   |\n| allocated) |\n─────────────\nPage ID: 47"
    shape: rectangle
    style.fill: "#ccffcc"
  }
}
arrow_2_3: {
  label: "Allocate page\nfrom free list"
  shape: text
  style.font-size: 12
}
step_3_collect: {
  label: "3. COLLECT & SORT: All Cells"
  shape: rectangle
  style.fill: "#f5f5f5"
  style.stroke: "#666666"
  style.stroke-width: 3
  cell_array: {
    label: "Sorted Cell Array\n─────────────────────────\n| K=10 | K=20 | K=30 | K=35 | K=40 | K=50 | K=60 |\n─────────────────────────\n        ↑ 50% split point (cell 4 of 7)"
    shape: rectangle
    style.fill: "#ffffff"
  }
}
arrow_3_4: {
  label: "Calculate\nsplit point"
  shape: text
  style.font-size: 12
}
step_4_redistribute: {
  label: "4. REDISTRIBUTE: Split Cells"
  shape: rectangle
  style.fill: "#e6ffe6"
  style.stroke: "#009933"
  style.stroke-width: 3
  left_page: {
    label: "Page P (Left)\n─────────────\n| K=10       |\n| K=20       |\n| K=30       |\n─────────────\n3 cells (43%)"
    shape: rectangle
    style.fill: "#ccffcc"
  }
  right_page: {
    label: "Page Q (Right)\n─────────────\n| K=40       |\n| K=50       |\n| K=60       |\n─────────────\n3 cells (43%)"
    shape: rectangle
    style.fill: "#ccffcc"
  }
  separator: {
    label: "Separator Key\nK=35"
    shape: diamond
    style.fill: "#ffcc00"
  }
}
arrow_4_5: {
  label: "Promote\nseparator"
  shape: text
  style.font-size: 12
}
decision_point: {
  label: "Is P the root?"
  shape: diamond
  style.fill: "#ffe6cc"
  style.stroke: "#ff6600"
}
arrow_yes: {
  label: "YES"
  shape: text
  style.font-size: 11
}
step_5a_new_root: {
  label: "5a. CREATE NEW ROOT"
  shape: rectangle
  style.fill: "#ffffcc"
  style.stroke: "#cc9900"
  style.stroke-width: 3
  new_root: {
    label: "NEW ROOT\n─────────────\n| Ptr→P | K=35 | Ptr→Q |\n─────────────\nPage ID: 100"
    shape: rectangle
    style.fill: "#ffffaa"
  }
  child_p: {
    label: "Page P\n| K=10 |\n| K=20 |\n| K=30 |"
    shape: rectangle
    style.fill: "#ccffcc"
  }
  child_q: {
    label: "Page Q\n| K=40 |\n| K=50 |\n| K=60 |"
    shape: rectangle
    style.fill: "#ccffcc"
  }
  new_root -> child_p: "left"
  new_root -> child_q: "right"
}
arrow_no: {
  label: "NO"
  shape: text
  style.font-size: 11
}
step_5b_update_parent: {
  label: "5b. UPDATE EXISTING PARENT"
  shape: rectangle
  style.fill: "#e6ccff"
  style.stroke: "#6600cc"
  style.stroke-width: 3
  parent_node: {
    label: "Parent Node\n─────────────────────────\nBEFORE: | ... | Ptr→P | K=70 | ... |\nAFTER:  | ... | Ptr→P | K=35 | Ptr→Q | K=70 | ... |"
    shape: rectangle
    style.fill: "#f0e6ff"
  }
  insert_note: {
    label: "Insert (K=35, Ptr→Q)\nafter Ptr→P in parent"
    shape: text
    style.font-size: 11
    style.italic: true
  }
}
final_result: {
  label: "RESULT: Balanced B-Tree"
  shape: rectangle
  style.fill: "#ccffcc"
  style.stroke: "#006600"
  style.stroke-width: 4
  result_tree: {
    label: "           [Root]\n             |\n        [K=35]\n        /    \\\n    [P]        [Q]\n  K=10-30    K=40-60\n\nTree height: +1 (if new root)\nAll pages: ~50% full"
    shape: text
    style.font-size: 12
  }
}
step_1_before -> step_2_allocate
step_2_allocate -> step_3_collect
step_3_collect -> step_4_redistribute
step_4_redistribute -> decision_point
decision_point -> step_5a_new_root: arrow_yes
decision_point -> step_5b_update_parent: arrow_no
step_5a_new_root -> final_result
step_5b_update_parent -> final_result
legend: {
  label: "LEGEND"
  shape: rectangle
  style.fill: "#f9f9f9"
  style.stroke: "#cccccc"
  cell_note: {
    label: "Cell = (Key, Value/Pointer)"
    shape: text
    style.font-size: 10
  }
  k_note: {
    label: "K = Key value"
    shape: text
    style.font-size: 10
  }
  ptr_note: {
    label: "Ptr = Child page pointer"
    shape: text
    style.font-size: 10
  }
  split_note: {
    label: "Split point = floor(n/2)"
    shape: text
    style.font-size: 10
  }
}