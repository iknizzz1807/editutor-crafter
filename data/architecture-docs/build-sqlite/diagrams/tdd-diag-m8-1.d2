direction: right
ANALYZE_Command: {
  shape: hexagon
  label: "ANALYZE"
  style.fill: "#E1F5FE"
}
Table_Scanner: {
  label: "Table Scanner"
  shape: rectangle
  style.fill: "#FFF3E0"
  rows_counter: {
    label: "Count Rows"
    shape: step
  }
  pages_counter: {
    label: "Count Pages"
    shape: step
  }
}
Index_Iterator: {
  label: "Index Iterator\n(for each index)"
  shape: rectangle
  style.fill: "#E8F5E9"
  distinct_counter: {
    label: "Count Distinct\nValues"
    shape: step
  }
  nulls_counter: {
    label: "Count Nulls"
    shape: step
  }
  minmax_finder: {
    label: "Find Min/Max"
    shape: step
  }
}
Statistics_Aggregator: {
  label: "Statistics\nAggregator"
  shape: diamond
  style.fill: "#F3E5F5"
}
sqlite_stat1: {
  label: "sqlite_stat1\ntable"
  shape: cylinder
  style.fill: "#FFEBEE"
  columns: {
    label: |md
      - tbl (table name)
      - idx (index name)
      - stat (statistic blob)
    |
    shape: text
    style.font-size: 12
  }
}
ANALYZE_Command -> Table_Scanner: {
  label: "initiate"
  style.stroke-dash: 3
}
Table_Scanner.rows_counter -> Table_Scanner.pages_counter
Table_Scanner.pages_counter -> Index_Iterator: {
  label: "table stats\ncollected"
}
Index_Iterator.distinct_counter -> Index_Iterator.nulls_counter
Index_Iterator.nulls_counter -> Index_Iterator.minmax_finder
Index_Iterator.minmax_finder -> Index_Iterator.distinct_counter: {
  label: "next index"
  style.stroke-dash: 3
}
Index_Iterator -> Statistics_Aggregator: {
  label: "index stats\ncollected"
}
Statistics_Aggregator -> sqlite_stat1: {
  label: "INSERT\nstatistics"
  style.stroke-width: 3
}
legend: {
  label: |md
    ## Flow Legend
    - **Solid line**: Data flow
    - **Dashed line**: Control flow / iteration
  |
  shape: text
  near: bottom-right
}