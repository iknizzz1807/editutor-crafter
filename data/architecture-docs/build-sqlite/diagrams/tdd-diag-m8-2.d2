direction: down
title: Selectivity Estimation Logic
vars: {
  header-color: "#1a365d"
  box-color: "#e2e8f0"
  decision-color: "#fef3c7"
  formula-color: "#dcfce7"
  result-color: "#f0fdf4"
}
estimate_selectivity: {
  label: "estimate_selectivity(predicate, stats)"
  shape: rectangle
  style.fill: "${header-color}"
  style.font-color: white
  style.stroke: "#0f172a"
}
predicate_type: {
  label: "Predicate\nType?"
  shape: diamond
  style.fill: "${decision-color}"
}
equality_check: {
  label: "col = value"
  shape: rectangle
  style.fill: "${box-color}"
}
equality_formula: {
  label: "sel = 1 / distinct_count"
  shape: rectangle
  style.fill: "${formula-color}"
  style.stroke: "#16a34a"
}
equality_example: {
  label: "Example:\nstatus = 'active'\n100 distinct values\n→ sel = 0.01"
  shape: rectangle
  style.fill: "${result-color}"
}
range_check: {
  label: "col BETWEEN\nlow AND high"
  shape: rectangle
  style.fill: "${box-color}"
}
range_formula: {
  label: "sel = (high - low) / (max - min)"
  shape: rectangle
  style.fill: "${formula-color}"
  style.stroke: "#16a34a"
}
range_example: {
  label: "Example:\nage BETWEEN 20 AND 40\nmin=0, max=100\n→ sel = 20/100 = 0.20"
  shape: rectangle
  style.fill: "${result-color}"
}
and_check: {
  label: "a AND b"
  shape: rectangle
  style.fill: "${box-color}"
}
and_formula: {
  label: "sel = sel_a × sel_b"
  shape: rectangle
  style.fill: "${formula-color}"
  style.stroke: "#16a34a"
}
and_example: {
  label: "Example:\na=1 (sel=0.1) AND b>5 (sel=0.3)\n→ sel = 0.1 × 0.3 = 0.03"
  shape: rectangle
  style.fill: "${result-color}"
}
or_check: {
  label: "a OR b"
  shape: rectangle
  style.fill: "${box-color}"
}
or_formula: {
  label: "sel = sel_a + sel_b - (sel_a × sel_b)"
  shape: rectangle
  style.fill: "${formula-color}"
  style.stroke: "#16a34a"
}
or_example: {
  label: "Example:\na=1 (sel=0.1) OR b>5 (sel=0.3)\n→ sel = 0.1 + 0.3 - 0.03 = 0.37"
  shape: rectangle
  style.fill: "${result-color}"
}
default_check: {
  label: "Other\n(Unknown)"
  shape: rectangle
  style.fill: "${box-color}"
}
default_formula: {
  label: "sel = 0.5 (heuristic)"
  shape: rectangle
  style.fill: "${formula-color}"
  style.stroke: "#16a34a"
}
output: {
  label: "Return: Estimated\nRow Fraction [0.0, 1.0]"
  shape: rectangle
  style.fill: "${header-color}"
  style.font-color: white
}
estimate_selectivity -> predicate_type
predicate_type -> equality_check: "Equality"
equality_check -> equality_formula
equality_formula -> equality_example
equality_example -> output
predicate_type -> range_check: "Range"
range_check -> range_formula
range_formula -> range_example
range_example -> output
predicate_type -> and_check: "AND"
and_check -> and_formula
and_formula -> and_example
and_example -> output
predicate_type -> or_check: "OR"
or_check -> or_formula
or_formula -> or_example
or_example -> output
predicate_type -> default_check: "Default"
default_check -> default_formula
default_formula -> output