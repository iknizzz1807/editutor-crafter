direction: right
legend: {
    shape: rectangle
    label: "Journal File Format\nRollback Journal - Module M9"
    note: {
        shape: text
        label: "**Total Header Size: 32 bytes**\n**Page Record Size: 4100 bytes**\n(4 bytes page_id + 4096 bytes page_data)"
    }
}
journal_file: {
    shape: rectangle
    style.fill: "#f8f9fa"
    style.stroke: "#343a40"
    label: ""
    header: {
        shape: rectangle
        style.fill: "#e3f2fd"
        style.stroke: "#1976d2"
        label: ""
        width: 600
        row1: {
            shape: rectangle
            label: ""
            magic: {
                shape: rectangle
                width: 150
                height: 60
                style.fill: "#bbdefb"
                style.stroke: "#1976d2"
                label: "Magic\n0xD9D50589\nBytes 0-3"
            }
            version: {
                shape: rectangle
                width: 150
                height: 60
                style.fill: "#bbdefb"
                style.stroke: "#1976d2"
                label: "Version\n1\nBytes 4-7"
            }
            page_size: {
                shape: rectangle
                width: 150
                height: 60
                style.fill: "#bbdefb"
                style.stroke: "#1976d2"
                label: "Page Size\n4096\nBytes 8-11"
            }
            seq: {
                shape: rectangle
                width: 150
                height: 60
                style.fill: "#bbdefb"
                style.stroke: "#1976d2"
                label: "Checkpoint\nSeq\nBytes 12-15"
            }
        }
        row2: {
            shape: rectangle
            label: ""
            salt1: {
                shape: rectangle
                width: 150
                height: 60
                style.fill: "#c8e6c9"
                style.stroke: "#388e3c"
                label: "Salt 1\n(random)\nBytes 16-19"
            }
            salt2: {
                shape: rectangle
                width: 150
                height: 60
                style.fill: "#c8e6c9"
                style.stroke: "#388e3c"
                label: "Salt 2\n(random)\nBytes 20-23"
            }
            checksum1: {
                shape: rectangle
                width: 150
                height: 60
                style.fill: "#fff9c4"
                style.stroke: "#f57f17"
                label: "Checksum 1\nBytes 24-27"
            }
            checksum2: {
                shape: rectangle
                width: 150
                height: 60
                style.fill: "#fff9c4"
                style.stroke: "#f57f17"
                label: "Checksum 2\nBytes 28-31"
            }
        }
        header_label: {
            shape: text
            label: "**JOURNAL HEADER (32 bytes)**"
            style.font-size: 14
        }
        row1 -> row2
        header_label -> row1
    }
    records: {
        shape: rectangle
        label: ""
        width: 600
        record_label: {
            shape: text
            label: "**PAGE RECORDS (repeated)**"
            style.font-size: 14
        }
        record1: {
            shape: rectangle
            label: ""
            page_id1: {
                shape: rectangle
                width: 100
                height: 80
                style.fill: "#ffcdd2"
                style.stroke: "#d32f2f"
                label: "Page ID\nu32\n4 bytes"
            }
            page_data1: {
                shape: rectangle
                width: 480
                height: 80
                style.fill: "#f5f5f5"
                style.stroke: "#757575"
                label: "Page Data\n4096 bytes\n(full page copy)"
            }
        }
        record2: {
            shape: rectangle
            label: ""
            page_id2: {
                shape: rectangle
                width: 100
                height: 80
                style.fill: "#ffcdd2"
                style.stroke: "#d32f2f"
                label: "Page ID\nu32\n4 bytes"
            }
            page_data2: {
                shape: rectangle
                width: 480
                height: 80
                style.fill: "#f5f5f5"
                style.stroke: "#757575"
                label: "Page Data\n4096 bytes\n(full page copy)"
            }
        }
        ellipsis: {
            shape: text
            label: "..."
            style.font-size: 24
        }
        recordN: {
            shape: rectangle
            label: ""
            page_idN: {
                shape: rectangle
                width: 100
                height: 80
                style.fill: "#ffcdd2"
                style.stroke: "#d32f2f"
                label: "Page ID\nu32\n4 bytes"
            }
            page_dataN: {
                shape: rectangle
                width: 480
                height: 80
                style.fill: "#f5f5f5"
                style.stroke: "#757575"
                label: "Page Data\n4096 bytes\n(full page copy)"
            }
        }
        record_label -> record1 -> record2 -> ellipsis -> recordN
    }
    alignment_note: {
        shape: rectangle
        style.fill: "#e8f5e9"
        style.stroke: "#4caf50"
        width: 600
        label: "**Record Alignment**\n• Each page record is 4100 bytes (4 + 4096)\n• Records are contiguous (no padding)\n• All values are big-endian encoded\n• Journal ends after last page record"
    }
    header -> records -> alignment_note
}
legend -> journal_file