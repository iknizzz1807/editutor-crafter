title: Transaction State Machine

# States
IDLE: {
  label: "IDLE\nInitial/End State"
  style.fill: "#16213e"
  style.font-color: "#e6edf3"
}
ACTIVE: {
  label: "ACTIVE\nTransaction in Progress"
  style.fill: "#16213e"
  style.font-color: "#e6edf3"
}
COMMITTING: {
  label: "COMMITTING\nWriting to Journal"
  style.fill: "#16213e"
  style.font-color: "#e6edf3"
}
ROLLBACK_STATE: {
  label: "ROLLBACK\nUndoing Changes"
  style.fill: "#0f3460"
  style.font-color: "#e6edf3"
  style.stroke: "#3fb950"
  style.stroke-width: 3
}

# Initial state marker
start: {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
}
start -> IDLE: "Start"

# Normal transaction flow
IDLE -> ACTIVE: "BEGIN"
ACTIVE -> COMMITTING: "COMMIT"
COMMITTING -> IDLE: "Journal flush\ncomplete"

# Explicit rollback flow
ACTIVE -> IDLE: "ROLLBACK\n(explicit)"

# Error transitions (all to rollback)
ACTIVE -> ROLLBACK_STATE: "ERROR"
COMMITTING -> ROLLBACK_STATE: "ERROR"
ROLLBACK_STATE -> IDLE: "Rollback\ncomplete"