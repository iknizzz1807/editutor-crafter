shape: sequence_diagram

Title: Sequence Diagram: Tracing a Single Syscall {
  style.font-size: 32
  style.bold: true
}

Tracer: {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

Tracee: {
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

Kernel: {
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  style.bold: true
}

Log: {
  style.fill: "#1a1a2e"
  style.stroke: "#ff7b72"
  style.font-color: "#e6edf3"
}

Tracer -> Kernel: waitpid() for syscall entry
Kernel -> Tracer: Tracee stopped at syscall entry
Tracer -> Kernel: PTRACE_GETREGS
Kernel -> Tracer: Returns registers (RAX=syscall#, RDI, RSI, RDX...)
Tracer -> Kernel: PTRACE_PEEKDATA (read string args)
Kernel -> Tracer: Returns memory content
Tracer -> Log: "Syscall entry: open(path=\"/etc/passwd\", flags=O_RDONLY)"
Tracer -> Kernel: PTRACE_SYSCALL (resume until exit)
Tracee -> Kernel: Execute syscall
Tracer -> Kernel: waitpid() for syscall exit
Kernel -> Tracer: Tracee stopped at syscall exit
Tracer -> Kernel: PTRACE_GETREGS
Kernel -> Tracer: Returns registers (RAX=return value, RDX=error flag)
Tracer -> Log: "Syscall exit: open returned fd=3"