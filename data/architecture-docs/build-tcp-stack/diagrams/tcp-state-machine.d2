direction: right
shape: circle

CLOSED {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#8b949e"
}

LISTEN {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#8b949e"
}

SYN_SENT {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#8b949e"
}

SYN_RCVD {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#8b949e"
}

ESTABLISHED {
  style.fill: "#16213e"
  style.font-color: "#ffffff"
  style.stroke: "#3fb950"
  style.bold: true
}

FIN_WAIT_1 {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#8b949e"
}

FIN_WAIT_2 {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#8b949e"
}

CLOSE_WAIT {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#8b949e"
}

CLOSING {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#8b949e"
}

LAST_ACK {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#8b949e"
}

TIME_WAIT {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#8b949e"
}

# Initial state marker
start: ( ) -> CLOSED
start.style.stroke-width: 0
start.style.fill: "#3fb950"

# Three-way handshake path (active open)
CLOSED -> SYN_SENT: active open\nsend SYN {
  style.stroke: "#3fb950"
  style.bold: true
}
SYN_SENT -> SYN_RCVD: receive SYN\nsend SYN+ACK {
  style.stroke: "#3fb950"
  style.bold: true
}
SYN_RCVD -> ESTABLISHED: receive ACK {
  style.stroke: "#3fb950"
  style.bold: true
}

# Three-way handshake path (passive open)
CLOSED -> LISTEN: passive open {
  style.stroke: "#3fb950"
  style.bold: true
}
LISTEN -> SYN_RCVD: receive SYN\nsend SYN+ACK {
  style.stroke: "#3fb950"
  style.bold: true
}

# Simultaneous open
SYN_SENT -> SYN_RCVD: receive SYN\nsend SYN+ACK {
  style.stroke: "#3fb950"
  style.bold: true
}
SYN_RCVD -> ESTABLISHED: receive ACK {
  style.stroke: "#3fb950"
  style.bold: true
}

# Established to close (four-way handshake - active close)
ESTABLISHED -> FIN_WAIT_1: active close\nsend FIN {
  style.stroke: "#ff7b72"
  style.bold: true
}
FIN_WAIT_1 -> FIN_WAIT_2: receive ACK {
  style.stroke: "#ff7b72"
  style.bold: true
}
FIN_WAIT_2 -> TIME_WAIT: receive FIN\nsend ACK {
  style.stroke: "#ff7b72"
  style.bold: true
}

# Established to close (four-way handshake - passive close)
ESTABLISHED -> CLOSE_WAIT: receive FIN\nsend ACK {
  style.stroke: "#ff7b72"
  style.bold: true
}
CLOSE_WAIT -> LAST_ACK: send FIN {
  style.stroke: "#ff7b72"
  style.bold: true
}
LAST_ACK -> CLOSED: receive ACK {
  style.stroke: "#ff7b72"
  style.bold: true
}

# Simultaneous close
FIN_WAIT_1 -> CLOSING: receive FIN {
  style.stroke: "#ff7b72"
  style.bold: true
}
CLOSING -> TIME_WAIT: receive ACK {
  style.stroke: "#ff7b72"
  style.bold: true
}

# Other transitions
SYN_SENT -> CLOSED: timeout
SYN_RCVD -> LISTEN: timeout/reset
LISTEN -> CLOSED: close
TIME_WAIT -> CLOSED: timeout (2MSL)

# Final state marker
TIME_WAIT -> end: ( )
end.style.stroke-width: 0
end.style.fill: "#3fb950"

# Group for handshake states
three_way_handshake: {
  shape: rectangle
  label: Three-Way Handshake
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.stroke-dash: 3
  SYN_SENT; SYN_RCVD; ESTABLISHED
}

# Group for close states
four_way_close: {
  shape: rectangle
  label: Four-Way Close
  style.fill: "#0f3460"
  style.stroke: "#ff7b72"
  style.stroke-dash: 3
  FIN_WAIT_1; FIN_WAIT_2; CLOSE_WAIT; LAST_ACK; CLOSING; TIME_WAIT
}