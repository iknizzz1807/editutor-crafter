{
  "title": "Build Your Own Text Editor: Design Document",
  "overview": "This system implements a terminal-based text editor that manages file content in memory while providing real-time visual feedback through ANSI escape sequences. The key architectural challenge is coordinating between raw terminal I/O, in-memory text buffer operations, and efficient screen rendering without flicker.",
  "sections": [
    {
      "id": "context-problem",
      "title": "Context and Problem Statement",
      "summary": "Explores why building a terminal text editor is challenging and compares approaches like immediate-mode vs retained-mode rendering.",
      "subsections": [
        {
          "id": "terminal-complexity",
          "title": "Terminal I/O Complexity",
          "summary": "Why terminal programming is fundamentally different from GUI programming"
        },
        {
          "id": "existing-approaches",
          "title": "Existing Text Editor Approaches",
          "summary": "Comparison of vim, nano, and modern editors' architectural patterns"
        }
      ]
    },
    {
      "id": "goals-non-goals",
      "title": "Goals and Non-Goals",
      "summary": "Defines the scope of our text editor implementation and explicitly excludes advanced features like plugins or multiple buffers.",
      "subsections": []
    },
    {
      "id": "high-level-architecture",
      "title": "High-Level Architecture",
      "summary": "Overview of the main components: Terminal Manager, Text Buffer, Renderer, and Input Handler, and how they coordinate.",
      "subsections": [
        {
          "id": "component-overview",
          "title": "Component Overview",
          "summary": "Responsibilities of each major component and their interfaces"
        },
        {
          "id": "file-structure",
          "title": "Recommended File Structure",
          "summary": "How to organize the codebase across modules and headers"
        }
      ]
    },
    {
      "id": "data-model",
      "title": "Data Model",
      "summary": "Core data structures including EditorState, TextBuffer, and ViewPort that represent the editor's internal state.",
      "subsections": [
        {
          "id": "buffer-representation",
          "title": "Text Buffer Representation",
          "summary": "How text content is stored in memory using dynamic arrays of strings"
        },
        {
          "id": "cursor-viewport",
          "title": "Cursor and Viewport Management",
          "summary": "Tracking cursor position and visible screen region within the document"
        }
      ]
    },
    {
      "id": "terminal-manager",
      "title": "Terminal Manager Component",
      "summary": "Handles raw mode setup, cleanup, and ANSI escape sequence generation for cursor control and screen clearing.",
      "subsections": [
        {
          "id": "raw-mode-setup",
          "title": "Raw Mode Configuration",
          "summary": "Setting terminal attributes to disable echo and canonical input processing"
        },
        {
          "id": "escape-sequences",
          "title": "ANSI Escape Sequence Management",
          "summary": "Generating VT100 sequences for cursor positioning and screen control"
        },
        {
          "id": "cleanup-handling",
          "title": "Graceful Cleanup",
          "summary": "Restoring terminal state on normal exit and signal handling for crashes"
        }
      ]
    },
    {
      "id": "input-handler",
      "title": "Input Handler Component",
      "summary": "Processes raw keypresses, handles escape sequences for special keys, and dispatches commands to appropriate handlers.",
      "subsections": [
        {
          "id": "keypress-parsing",
          "title": "Keypress Parsing",
          "summary": "Reading individual characters and assembling multi-byte escape sequences"
        },
        {
          "id": "special-key-mapping",
          "title": "Special Key Mapping",
          "summary": "Converting arrow keys, function keys, and control sequences to editor commands"
        },
        {
          "id": "command-dispatch",
          "title": "Command Dispatching",
          "summary": "Routing parsed input to movement, editing, or system commands"
        }
      ]
    },
    {
      "id": "text-buffer",
      "title": "Text Buffer Component",
      "summary": "Manages in-memory text content with operations for insertion, deletion, and navigation while tracking modification state.",
      "subsections": [
        {
          "id": "buffer-operations",
          "title": "Core Buffer Operations",
          "summary": "Insert, delete, and modify text content while maintaining cursor consistency"
        },
        {
          "id": "line-management",
          "title": "Line Management",
          "summary": "Handling line breaks, joins, and splits during editing operations"
        },
        {
          "id": "file-io",
          "title": "File I/O Operations",
          "summary": "Loading files into buffer and saving buffer contents to disk"
        }
      ]
    },
    {
      "id": "renderer",
      "title": "Screen Renderer Component",
      "summary": "Converts buffer content to terminal output, managing viewport scrolling and status bar display without flicker.",
      "subsections": [
        {
          "id": "viewport-calculation",
          "title": "Viewport Calculation",
          "summary": "Determining which lines and columns are visible on screen"
        },
        {
          "id": "screen-composition",
          "title": "Screen Composition",
          "summary": "Building complete screen content including line numbers and status bar"
        },
        {
          "id": "flicker-prevention",
          "title": "Flicker Prevention",
          "summary": "Buffering screen output to write complete frames in single operations"
        }
      ]
    },
    {
      "id": "undo-system",
      "title": "Undo System Component",
      "summary": "Tracks edit operations to enable undo/redo functionality using a command pattern approach.",
      "subsections": [
        {
          "id": "operation-recording",
          "title": "Operation Recording",
          "summary": "Capturing reversible representations of edit commands"
        },
        {
          "id": "undo-stack",
          "title": "Undo Stack Management",
          "summary": "Managing the history of operations and current position for undo/redo"
        }
      ]
    },
    {
      "id": "search-system",
      "title": "Search System Component",
      "summary": "Implements incremental search with highlighting and navigation between matches.",
      "subsections": [
        {
          "id": "incremental-search",
          "title": "Incremental Search Logic",
          "summary": "Updating search results as user types query characters"
        },
        {
          "id": "match-highlighting",
          "title": "Match Highlighting",
          "summary": "Visually marking search matches in the rendered text"
        }
      ]
    },
    {
      "id": "syntax-highlighting",
      "title": "Syntax Highlighting Component",
      "summary": "Applies color codes to text based on programming language syntax rules and file extensions.",
      "subsections": [
        {
          "id": "language-detection",
          "title": "Language Detection",
          "summary": "Mapping file extensions to syntax highlighting rules"
        },
        {
          "id": "tokenization",
          "title": "Simple Tokenization",
          "summary": "Identifying keywords, strings, comments, and other language elements"
        },
        {
          "id": "color-application",
          "title": "Color Code Application",
          "summary": "Applying ANSI color sequences to syntax elements during rendering"
        }
      ]
    },
    {
      "id": "interactions-dataflow",
      "title": "Interactions and Data Flow",
      "summary": "Describes the main event loop and how components communicate during key operations like editing and rendering.",
      "subsections": [
        {
          "id": "main-event-loop",
          "title": "Main Event Loop",
          "summary": "The core read-process-render cycle that drives the editor"
        },
        {
          "id": "editing-workflow",
          "title": "Editing Workflow",
          "summary": "Step-by-step flow from keypress to buffer modification to screen update"
        }
      ]
    },
    {
      "id": "error-handling",
      "title": "Error Handling and Edge Cases",
      "summary": "Covers terminal restoration on errors, file I/O failures, and boundary conditions in text editing.",
      "subsections": [
        {
          "id": "terminal-recovery",
          "title": "Terminal State Recovery",
          "summary": "Ensuring terminal is restored even when editor crashes or exits abnormally"
        },
        {
          "id": "file-errors",
          "title": "File Operation Errors",
          "summary": "Handling read/write failures and permission issues gracefully"
        },
        {
          "id": "boundary-conditions",
          "title": "Text Editing Boundary Conditions",
          "summary": "Edge cases like empty files, cursor at boundaries, and memory limits"
        }
      ]
    },
    {
      "id": "testing-strategy",
      "title": "Testing Strategy",
      "summary": "Approaches for testing terminal applications including automated testing and milestone verification checkpoints.",
      "subsections": [
        {
          "id": "milestone-checkpoints",
          "title": "Milestone Verification Checkpoints",
          "summary": "Expected behavior and verification steps after completing each milestone"
        },
        {
          "id": "automated-testing",
          "title": "Automated Testing Approaches",
          "summary": "Unit testing strategies for terminal-based applications"
        }
      ]
    },
    {
      "id": "debugging-guide",
      "title": "Debugging Guide",
      "summary": "Common issues learners encounter when building the editor with symptoms, causes, and fixes.",
      "subsections": [
        {
          "id": "terminal-issues",
          "title": "Terminal State Issues",
          "summary": "Debugging problems with raw mode, escape sequences, and terminal restoration"
        },
        {
          "id": "rendering-problems",
          "title": "Rendering and Display Problems",
          "summary": "Troubleshooting screen flicker, cursor positioning, and content display"
        },
        {
          "id": "editing-bugs",
          "title": "Text Editing Logic Bugs",
          "summary": "Common issues in buffer manipulation and cursor management"
        }
      ]
    },
    {
      "id": "future-extensions",
      "title": "Future Extensions",
      "summary": "Additional features that could be added like multiple buffers, configuration files, and advanced syntax highlighting.",
      "subsections": []
    },
    {
      "id": "glossary",
      "title": "Glossary",
      "summary": "Definitions of terminal programming terms, ANSI escape sequences, and text editor concepts.",
      "subsections": []
    }
  ],
  "diagrams": [
    {
      "id": "system-components",
      "title": "System Component Architecture",
      "description": "Shows the five main components (Terminal Manager, Input Handler, Text Buffer, Renderer, Search/Syntax) and their relationships. Include data flow arrows showing how keypresses flow through the system to screen updates.",
      "type": "component",
      "relevant_sections": [
        "high-level-architecture",
        "interactions-dataflow"
      ]
    },
    {
      "id": "data-model",
      "title": "Core Data Structures",
      "description": "Class diagram showing EditorState, TextBuffer, ViewPort, Cursor, and UndoStack structures with their key fields and relationships. Show composition relationships and key method signatures.",
      "type": "class",
      "relevant_sections": [
        "data-model",
        "text-buffer",
        "undo-system"
      ]
    },
    {
      "id": "event-loop-flow",
      "title": "Main Event Loop Flow",
      "description": "Flowchart showing the read-input \u2192 parse-command \u2192 update-buffer \u2192 render-screen \u2192 repeat cycle. Include decision points for different types of input and error handling paths.",
      "type": "flowchart",
      "relevant_sections": [
        "interactions-dataflow",
        "input-handler"
      ]
    },
    {
      "id": "editing-sequence",
      "title": "Text Editing Operation Sequence",
      "description": "Sequence diagram showing the interaction between Input Handler, Text Buffer, Undo System, and Renderer when a character is inserted. Show the message flow and state changes.",
      "type": "sequence",
      "relevant_sections": [
        "text-buffer",
        "undo-system",
        "interactions-dataflow"
      ]
    },
    {
      "id": "terminal-state-machine",
      "title": "Terminal State Management",
      "description": "State machine showing terminal modes (cooked, raw, cleanup) and the transitions between them including error states and recovery paths.",
      "type": "state-machine",
      "relevant_sections": [
        "terminal-manager",
        "error-handling"
      ]
    },
    {
      "id": "search-state-machine",
      "title": "Search Mode State Machine",
      "description": "State machine for search functionality showing states like normal-mode, incremental-search, search-forward, search-backward with transitions for different key inputs.",
      "type": "state-machine",
      "relevant_sections": [
        "search-system"
      ]
    },
    {
      "id": "rendering-pipeline",
      "title": "Screen Rendering Pipeline",
      "description": "Flowchart showing how buffer content flows through viewport calculation, line formatting, syntax highlighting, and ANSI sequence generation to produce final screen output.",
      "type": "flowchart",
      "relevant_sections": [
        "renderer",
        "syntax-highlighting"
      ]
    },
    {
      "id": "file-operations",
      "title": "File I/O Operations Flow",
      "description": "Flowchart showing file loading and saving processes including error handling, dirty flag management, and user confirmation steps.",
      "type": "flowchart",
      "relevant_sections": [
        "text-buffer",
        "error-handling"
      ]
    }
  ]
}