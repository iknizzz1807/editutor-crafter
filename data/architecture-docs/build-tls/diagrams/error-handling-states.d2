direction: right

# Initial state
start: {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
}

# Main operational states
normal: Normal Operation {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

detecting: Error Detection {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

# Error classification states
protocol_error: Protocol Violation {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#f85149"
  style.font-color: "#e6edf3"
}

crypto_error: Cryptographic Failure {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#f85149"
  style.font-color: "#e6edf3"
}

cert_error: Certificate Error {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#f85149"
  style.font-color: "#e6edf3"
}

# Alert generation states
fatal_alert: Generate Fatal Alert {
  shape: circle
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

warning_alert: Generate Warning Alert {
  shape: circle
  style.fill: "#0f3460"
  style.stroke: "#f1c40f"
  style.font-color: "#e6edf3"
}

# Terminal states
terminate: Connection Terminated {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.stroke-width: 3
  style.font-color: "#e6edf3"
  style.bold: true
}

recovery: Recovery Attempt {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#f1c40f"
  style.font-color: "#e6edf3"
}

# State transitions
start -> normal: Initialize

normal -> detecting: Error detected

detecting -> protocol_error: Invalid message format\nUnexpected message type\nHandshake sequence violation

detecting -> crypto_error: Decryption failure\nSignature verification failed\nMAC validation error

detecting -> cert_error: Invalid certificate chain\nExpired certificate\nRevoked certificate

protocol_error -> fatal_alert: unexpected_message\nhandshake_failure\nprotocol_version

crypto_error -> fatal_alert: decrypt_error\nbad_record_mac\ndecryption_failed

cert_error -> fatal_alert: certificate_expired\ncertificate_revoked\nbad_certificate

cert_error -> warning_alert: certificate_unknown\nunknown_ca

fatal_alert -> terminate: Send alert &\nclose connection

warning_alert -> recovery: Send alert &\nattempt recovery

warning_alert -> terminate: Recovery failed

recovery -> normal: Recovery successful

recovery -> terminate: Max retries exceeded

terminate -> start: New connection\nattempt