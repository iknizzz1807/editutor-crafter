direction: down

# Dark theme styling
*.style.fill: "#1a1a2e"
*.style.stroke: "#3fb950"
*.style.font-color: "#e6edf3"

# Key derivation process
ecdhe_secret: ECDHE Shared Secret {
  shape: oval
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.bold: true
}

hkdf_extract: HKDF-Extract {
  shape: rectangle
  style.fill: "#0f3460"
}

prk: Pseudo-Random Key (PRK) {
  shape: oval
  style.fill: "#16213e"
}

hkdf_expand: HKDF-Expand {
  shape: rectangle
  style.fill: "#0f3460"
}

# Key material outputs
key_material: Key Material Block {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.bold: true
}

# Separate keys container
derived_keys: Derived Keys {
  client_write_key: Client Write Key {
    shape: cylinder
    style.fill: "#d63031"
    style.font-color: "#ffffff"
  }
  
  server_write_key: Server Write Key {
    shape: cylinder
    style.fill: "#74b9ff"
    style.font-color: "#ffffff"
  }
  
  client_mac_key: Client MAC Key {
    shape: cylinder
    style.fill: "#fd79a8"
    style.font-color: "#ffffff"
  }
  
  server_mac_key: Server MAC Key {
    shape: cylinder
    style.fill: "#fdcb6e"
  }
  
  client_iv: Client IV {
    shape: cylinder
    style.fill: "#6c5ce7"
    style.font-color: "#ffffff"
  }
  
  server_iv: Server IV {
    shape: cylinder
    style.fill: "#a29bfe"
    style.font-color: "#ffffff"
  }
}

# Flow connections
ecdhe_secret -> hkdf_extract: input
hkdf_extract -> prk: extract
prk -> hkdf_expand: expand
hkdf_expand -> key_material: generate

# Split into individual keys
key_material -> derived_keys.client_write_key: split
key_material -> derived_keys.server_write_key
key_material -> derived_keys.client_mac_key
key_material -> derived_keys.server_mac_key
key_material -> derived_keys.client_iv
key_material -> derived_keys.server_iv

# Add salt input
salt: Salt (all zeros) {
  shape: oval
  style.fill: "#636e72"
}

salt -> hkdf_extract: salt input

# Add info input
info: Context Info {
  shape: page
  style.fill: "#636e72"
}

info -> hkdf_expand: context