direction: right

title: TLS System Component Architecture {
  near: top-center
  style.font-size: 24
  style.bold: true
  style.font-color: "#e6edf3"
}

# External interfaces
network: Network Layer {
  shape: cloud
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

application: Application Layer {
  shape: package
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# Main TLS system container
tls_system: TLS 1.3 Implementation {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true

  # Record Layer - core data processing
  record_layer: Record Layer {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    
    encrypt: Symmetric Encryption {
      shape: hexagon
      style.fill: "#0f3460"
      style.stroke: "#8b949e"
      style.font-color: "#e6edf3"
    }
    
    fragment: Data Fragmentation {
      shape: rectangle
      style.fill: "#0f3460"
      style.stroke: "#8b949e"
      style.font-color: "#e6edf3"
    }
    
    mac: Message Authentication {
      shape: hexagon
      style.fill: "#0f3460"
      style.stroke: "#8b949e"
      style.font-color: "#e6edf3"
    }
    
    fragment -> encrypt: plaintext
    encrypt -> mac: ciphertext
  }

  # Handshake Protocol - connection establishment
  handshake: Handshake Protocol {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    
    state_machine: Protocol State Machine {
      shape: circle
      style.fill: "#0f3460"
      style.stroke: "#8b949e"
      style.font-color: "#e6edf3"
    }
    
    message_handler: Message Processing {
      shape: rectangle
      style.fill: "#0f3460"
      style.stroke: "#8b949e"
      style.font-color: "#e6edf3"
    }
    
    state_machine <-> message_handler: state transitions
  }

  # Key Exchange - cryptographic key generation
  key_exchange: Key Exchange {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    
    ecdhe: ECDHE {
      shape: diamond
      style.fill: "#0f3460"
      style.stroke: "#8b949e"
      style.font-color: "#e6edf3"
    }
    
    kdf: Key Derivation {
      shape: hexagon
      style.fill: "#0f3460"
      style.stroke: "#8b949e"
      style.font-color: "#e6edf3"
    }
    
    ecdhe -> kdf: shared secret
  }

  # Certificate Verification - trust establishment
  cert_verify: Certificate Verification {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    
    chain_validate: Chain Validation {
      shape: rectangle
      style.fill: "#0f3460"
      style.stroke: "#8b949e"
      style.font-color: "#e6edf3"
    }
    
    signature_verify: Signature Verification {
      shape: hexagon
      style.fill: "#0f3460"
      style.stroke: "#8b949e"
      style.font-color: "#e6edf3"
    }
    
    chain_validate -> signature_verify: validated cert
  }

  # Internal dependencies
  handshake <-> key_exchange: key material {
    style.stroke: "#3fb950"
    style.animated: true
  }
  
  handshake <-> cert_verify: certificates {
    style.stroke: "#3fb950"
  }
  
  key_exchange -> record_layer: encryption keys {
    style.stroke: "#3fb950"
    style.bold: true
  }
  
  handshake -> record_layer: handshake data {
    style.stroke: "#8b949e"
  }
}

# External connections
application <-> tls_system.record_layer: application data {
  style.stroke: "#3fb950"
  style.bold: true
}

tls_system.record_layer <-> network: encrypted packets {
  style.stroke: "#3fb950"
  style.bold: true
}

tls_system.handshake <-> network: handshake messages {
  style.stroke: "#8b949e"
}