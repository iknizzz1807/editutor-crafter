direction: down

transformer_system: Transformer System {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true

  tokenizer: Tokenizer {
    shape: rectangle
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }

  embedding_layer: Embedding Layer {
    shape: rectangle
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }

  transformer_blocks: Transformer Blocks {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"

    block1: Block 1 {
      attention1: Multi-Head Attention
      ffn1: Feed Forward
      attention1 -> ffn1
    }

    block2: Block 2 {
      attention2: Multi-Head Attention
      ffn2: Feed Forward
      attention2 -> ffn2
    }

    blockn: Block N {
      attentionn: Multi-Head Attention
      ffnn: Feed Forward
      attentionn -> ffnn
    }

    block1 -> block2
    block2 -> blockn: "..."
  }

  generation_head: Generation Head {
    shape: rectangle
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

# Data flow arrows with tensor shapes
tokenizer -> embedding_layer: "[batch, seq_len]" {
  style.stroke: "#8b949e"
}

embedding_layer -> transformer_blocks.block1: "[batch, seq_len, d_model]" {
  style.stroke: "#8b949e"
}

transformer_blocks.blockn -> generation_head: "[batch, seq_len, d_model]" {
  style.stroke: "#8b949e"
}

# Input and output
input_text: "Input Text" {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

output_probs: "Output Probabilities" {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

input_text -> tokenizer: "raw text" {
  style.stroke: "#8b949e"
}

generation_head -> output_probs: "[batch, seq_len, vocab_size]" {
  style.stroke: "#8b949e"
}