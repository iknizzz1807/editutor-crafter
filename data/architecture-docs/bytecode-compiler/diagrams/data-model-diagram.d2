title: "Data Model: Chunk & Related Structures" {
  near: top-center
  style.bold: true
  style.font-size: 32
}

description: "Shows the Chunk containing a list of Instructions and a reference to a ConstantPool. An Instruction has an opcode and optional operand. The SymbolTable contains Scopes, which map names to Slots." {
  shape: text
  style.italic: true
  style.font-size: 16
  style.fill: "#2a2a40"
}

classes: {
  primary_class: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.stroke-width: 2
    style.font-color: "#e6edf3"
    style.bold: true
  }
  secondary_class: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  container: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.stroke-width: 1
    style.font-color: "#e6edf3"
  }
}

chunk: BytecodeChunk {
  shape: class
  class: primary_class
  - instructions: "Instruction[]"
  - constant_pool: ConstantPool
}

instructions_group: {
  shape: rectangle
  class: container
  label: "Instruction Stream"

  instruction: Instruction {
    shape: class
    class: secondary_class
    - opcode: "byte"
    - operand: "int?"
  }

  chunk -> instruction: contains
}

pool_group: {
  shape: rectangle
  class: container
  label: "Constant Pool"

  constant_pool: ConstantPool {
    shape: class
    class: secondary_class
    - constants: "Value[]"
  }

  chunk -> constant_pool: references {
    style.stroke: "#3fb950"
    style.bold: true
  }
}

symbol_table_group: {
  shape: rectangle
  class: container
  label: "Symbol Resolution"

  symbol_table: SymbolTable {
    shape: class
    class: primary_class
    - scopes: "Scope[]"
  }

  scope: Scope {
    shape: class
    class: secondary_class
    - parent: "Scope?"
    - slots: "Map<string, Slot>"
  }

  slot: Slot {
    shape: class
    class: secondary_class
    - index: "int"
    - type: "string"
  }

  symbol_table -> scope: contains
  scope -> slot: maps to
}