title: Flowchart: Forward Jump Target Patching

classes: {
  process_node: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  data_node: {
    shape: circle
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  flow_arrow: {
    style.stroke: "#8b949e"
    style.stroke-width: 2
  }
}

start: Start Compiling `if` Condition {
  class: process_node
  shape: diamond
}

emit_jump: Emit JUMP_IF_FALSE with Placeholder {
  class: process_node
}

placeholder: Placeholder Offset (0x0000) {
  class: data_node
}

compile_then: Compile Then-Block Statements {
  class: process_node
}

calculate: Calculate Jump Offset {
  class: process_node
  shape: parallelogram
  style.fill: "#16213e"
}

jump_target: Jump Target Position {
  class: data_node
}

patch: Patch Placeholder with Calculated Offset {
  class: process_node
}

complete: Continue with Next Statement {
  class: process_node
}

start -> emit_jump: Condition False? {class: flow_arrow}
emit_jump -> placeholder: Contains {class: flow_arrow}
placeholder -> compile_then: Jump Past Then-Block {class: flow_arrow}
compile_then -> calculate: After Then-Block {class: flow_arrow}
calculate -> jump_target: Compute (target - jump_pos) {class: flow_arrow}
jump_target -> patch: Replace 0x0000 {class: flow_arrow}
patch -> complete: Forward Jump Resolved {class: flow_arrow}
start -> compile_then: Condition True (fall through) {class: flow_arrow}