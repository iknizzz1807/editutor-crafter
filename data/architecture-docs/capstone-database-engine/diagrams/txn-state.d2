classes.dark {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: false
}

classes.state {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  style.stroke-width: 2
}

classes.terminal {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  style.stroke-width: 2
}

classes.init_style {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
  style.stroke-width: 0
}

classes.transition {
  style.font-color: "#8b949e"
  style.stroke: "#8b949e"
}

# Initial state
init: {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
  style.stroke-width: 0
  label: ""
}

# States
Active: "Active (Transaction executing)" {
  class: state
}

Partially_Committed: "Partially Committed\n(WAL write complete)" {
  class: state
}

Committed: "Committed (Durable)" {
  class: terminal
}

Aborted: "Aborted (Rolling back)" {
  class: state
}

Failed: "Failed" {
  class: terminal
}

# Transitions
init -> Active: "Begin" {
  class: transition
}

Active -> Active: "Execute Statement" {
  class: transition
}

Active -> Partially_Committed: "Commit Request\nWrite to WAL" {
  class: transition
}

Partially_Committed -> Committed: "WAL Flush Success" {
  class: transition
  style.stroke: "#3fb950"
}

Partially_Committed -> Failed: "WAL Flush Failure" {
  class: transition
  style.stroke: "#f85149"
}

Active -> Aborted: "Abort Request\nor System Error" {
  class: transition
  style.stroke: "#f85149"
}

Aborted -> Failed: "Rollback Complete" {
  class: transition
  style.stroke: "#f85149"
}