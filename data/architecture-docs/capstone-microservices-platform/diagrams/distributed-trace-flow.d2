title: Distributed Trace Propagation

shape: sequence_diagram

Client: Client
API Gateway: API Gateway {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
Order Service: Order Service {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
Inventory Service: Inventory Service {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
Payment Service: Payment Service {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

Client -> API Gateway: POST /orders\ntraceparent: 00-trace-id-span-id-01
API Gateway -> API Gateway: Create root span\nExtract trace context
API Gateway -> Order Service: POST /orders\ntraceparent: 00-trace-id-new-span-id-01
Order Service -> Order Service: Create child span\nSet parent from traceparent
Order Service -> Inventory Service: GET /inventory/check\ntraceparent: 00-trace-id-inv-span-id-01
Inventory Service -> Inventory Service: Create child span\nAdd inventory.check operation
Inventory Service -> Order Service: 200 OK\ntracestate: inventory=processed
Order Service -> Payment Service: POST /payments\ntraceparent: 00-trace-id-pay-span-id-01
Payment Service -> Payment Service: Create child span\nAdd payment.process operation
Payment Service -> Order Service: 200 OK\ntracestate: payment=completed
Order Service -> Order Service: Finish span\nAdd order.created tag
Order Service -> API Gateway: 201 Created\ntracestate: order=created
API Gateway -> API Gateway: Finish root span\nFlush to collector
API Gateway -> Client: 201 Created