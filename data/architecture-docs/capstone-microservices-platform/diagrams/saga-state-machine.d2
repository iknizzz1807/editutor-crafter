title: Order Saga State Machine {
  style.font-color: "#e6edf3"
  style.font-size: 20
  style.bold: true
}

# States
initial: "" {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
  width: 20
  height: 20
}

order_created: Order Created {
  shape: oval
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

inventory_reserved: Inventory Reserved {
  shape: oval
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

payment_processed: Payment Processed {
  shape: oval
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

order_confirmed: Order Confirmed {
  shape: oval
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

# Compensation States
inventory_released: Inventory Released {
  shape: oval
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
}

payment_refunded: Payment Refunded {
  shape: oval
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
}

order_cancelled: Order Cancelled {
  shape: oval
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
  style.bold: true
}

# Happy Path Transitions
initial -> order_created: Create Order {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

order_created -> inventory_reserved: Reserve Inventory {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

inventory_reserved -> payment_processed: Process Payment {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

payment_processed -> order_confirmed: Confirm Order {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

# Compensation Paths
order_created -> order_cancelled: Order Creation Failed {
  style.stroke: "#d63031"
  style.font-color: "#ffffff"
  style.stroke-dash: 5
}

inventory_reserved -> inventory_released: Inventory Unavailable {
  style.stroke: "#d63031"
  style.font-color: "#ffffff"
  style.stroke-dash: 5
}

payment_processed -> payment_refunded: Payment Failed {
  style.stroke: "#d63031"
  style.font-color: "#ffffff"
  style.stroke-dash: 5
}

inventory_released -> order_cancelled: Release Complete {
  style.stroke: "#d63031"
  style.font-color: "#ffffff"
  style.stroke-dash: 5
}

payment_refunded -> inventory_released: Refund Complete {
  style.stroke: "#d63031"
  style.font-color: "#ffffff"
  style.stroke-dash: 5
}

# Timeout Compensation
inventory_reserved -> inventory_released: Payment Timeout {
  style.stroke: "#fd79a8"
  style.font-color: "#ffffff"
  style.stroke-dash: 3
}

payment_processed -> payment_refunded: Confirmation Timeout {
  style.stroke: "#fd79a8"
  style.font-color: "#ffffff"
  style.stroke-dash: 3
}