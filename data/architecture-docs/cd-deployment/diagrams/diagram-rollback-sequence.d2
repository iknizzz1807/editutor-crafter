title: Sequence Diagram: Rollback on Failure
description: When smoke test fails after deployment to inactive environment, traffic switch is aborted. Active environment remains serving traffic.

shape: sequence_diagram

# Actors and components
deployment_orchestrator: Deployment Orchestrator
environment_manager: Environment Manager
load_balancer_controller: Load Balancer Controller
active_env: Active Environment (Live)
inactive_env: Inactive Environment (Staging)
smoke_tester: Smoke Test Runner

# Sequence flow - deployment to inactive environment
deployment_orchestrator -> environment_manager: 1. Deploy to Inactive Environment
environment_manager -> inactive_env: 1.1. Deploy New Version
inactive_env --> environment_manager: 1.2. Deployment Complete
environment_manager --> deployment_orchestrator: 1.3. Deployment Success

# Smoke test execution
deployment_orchestrator -> smoke_tester: 2. Run Smoke Tests
smoke_tester -> inactive_env: 2.1. Execute Test Suite
inactive_env --> smoke_tester: 2.2. Tests Failed
smoke_tester --> deployment_orchestrator: 2.3. Smoke Test Failure

# Rollback decision and action
deployment_orchestrator -> load_balancer_controller: 3. Abort Traffic Switch (Rollback)
deployment_orchestrator -> environment_manager: 4. Mark Inactive Environment as Failed
environment_manager -> inactive_env: 4.1. Cleanup Failed Deployment

# Ongoing traffic (unchanged)
load_balancer_controller -> active_env: 5. Continue Routing Live Traffic
active_env -> load_balancer_controller: 5.1. Serve User Requests