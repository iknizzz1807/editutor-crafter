shape: sequence_diagram

title: Sequence: Cache Miss with Origin Shielding

# Actors
client: Client {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
edge: Edge Cache {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
shield: Origin Shield {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
origin: Origin Server {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# Main flow: Cache miss
client -> edge: "1. GET /resource"
edge -> shield: "2. GET /resource (cache miss)"
shield -> origin: "3. GET /resource (collapsed)"

# Concurrent requests arrive at shield during origin fetch
edge -> shield: "Concurrent Request (waiting)" {
  style.stroke-dash: 3
}
edge -> shield: "Concurrent Request (waiting)" {
  style.stroke-dash: 3
}

# Response flow back
origin -> shield: "4. Response (200 OK)"
shield -> edge: "5. Response (200 OK)"
edge -> client: "6. Response (200 OK)"

# Concurrent requests receive same response
shield -> edge: "Response to waiting requests"
shield -> edge: "Response to waiting requests"