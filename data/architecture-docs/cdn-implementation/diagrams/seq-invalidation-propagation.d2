shape: sequence_diagram
title: Sequence: Purge Propagation via Control Plane

admin: Admin {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

control_plane: Control Plane {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

edge1: "Edge Node 1" {
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

edge2: "Edge Node 2" {
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

edge3: "Edge Node 3" {
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

admin -> control_plane: "1. Purge Command\n(URL pattern)"
control_plane -> edge1: "2. Invalidate Cache\n(URL pattern)"
control_plane -> edge2: "2. Invalidate Cache\n(URL pattern)"
control_plane -> edge3: "2. Invalidate Cache\n(URL pattern)"
edge1 -> edge1: "3. Delete Local\nCache Entries"
edge2 -> edge2: "3. Delete Local\nCache Entries"
edge3 -> edge3: "3. Delete Local\nCache Entries"
edge1 -> control_plane: "4. ACK (optional)"
edge2 -> control_plane: "4. ACK (optional)"
edge3 -> control_plane: "4. ACK (optional)"