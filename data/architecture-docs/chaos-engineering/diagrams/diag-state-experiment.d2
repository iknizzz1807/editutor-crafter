# Experiment Orchestration State Machine

direction: right

title: Experiment Orchestration State Machine

init: {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#ffffff"
  label: ""
}

classes: {
  state_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    style.border-radius: 3
  }
  active_state: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.stroke-width: 3
    style.bold: true
  }
  terminal_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.stroke-width: 2
    style.double-border: true
  }
  error_state: {
    style.fill: "#4a1c1c"
    style.stroke: "#e17055"
    style.stroke-width: 2
    style.double-border: true
  }
}

init -> Draft: Begin

Draft: Draft {
  class: state_style
  style: {
    fill: "#0f3460"
    stroke: "#3fb950"
    stroke-width: 3
  }
}

BaselineValidation: Baseline Validation {
  class: state_style
}

Injecting: Injecting Faults {
  class: state_style
}

Monitoring: Monitoring Impact {
  class: state_style
}

Rollback: Rolling Back {
  class: state_style
}

Analysis: Analysis {
  class: state_style
}

Completed: Completed {
  class: terminal_state
}

Aborted: Aborted {
  class: error_state
}

Draft -> BaselineValidation: start
BaselineValidation -> Injecting: validation_passed
BaselineValidation -> Aborted: validation_failed
Injecting -> Monitoring: injection_complete
Monitoring -> Rollback: safety_breach OR duration_elapsed
Monitoring -> Analysis: monitoring_complete
Rollback -> Analysis: rollback_complete
Analysis -> Completed: analysis_complete
Analysis -> Aborted: analysis_failed

note: |md
  ### Safety Mechanisms
  - **validation_failed**: Baseline metrics don't match hypothesis
  - **safety_breach**: System exceeds safety thresholds
  - **duration_elapsed**: Maximum experiment time reached
| {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  near: top-right
}