title: Fallback Execution Flow {
  style.font-size: 24
  style.bold: true
  style.font-color: "#e6edf3"
  near: top-center
}

classes: {
  start_node: {
    style.fill: "#3fb950"
    style.font-color: "#ffffff"
    style.bold: true
  }
  decision: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  process: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  success: {
    style.fill: "#00b894"
    style.stroke: "#00cec9"
    style.font-color: "#ffffff"
    style.bold: true
  }
  arrow: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

start: Start {
  shape: circle
  class: start_node
}

bulkhead_check: Bulkhead\nCapacity Available? {
  shape: diamond
  class: decision
}

circuit_check: Circuit Breaker\nState Check {
  shape: diamond
  class: decision
}

execute_request: Execute\nOriginal Request {
  class: process
}

fallback_check: Fallback\nAvailable? {
  shape: diamond
  class: decision
}

execute_fallback: Execute\nFallback Logic {
  class: process
}

reject_request: Reject Request\n(Fail Fast) {
  class: error
}

timeout_check: Request\nTimeout? {
  shape: diamond
  class: decision
}

success_response: Return\nSuccess Response {
  class: success
}

error_response: Return\nError Response {
  class: error
}

update_metrics: Update Circuit\nBreaker Metrics {
  class: process
}

end_success: End (Success) {
  shape: circle
  class: success
}

end_error: End (Error) {
  shape: circle
  class: error
}

start -> bulkhead_check: {class: arrow}
bulkhead_check -> circuit_check: Yes {class: arrow}
bulkhead_check -> reject_request: No\n(Bulkhead Full) {class: arrow}

circuit_check -> execute_request: Closed/Half-Open {class: arrow}
circuit_check -> fallback_check: Open {class: arrow}

execute_request -> timeout_check: {class: arrow}
timeout_check -> success_response: No {class: arrow}
timeout_check -> fallback_check: Yes {class: arrow}

fallback_check -> execute_fallback: Yes {class: arrow}
fallback_check -> error_response: No {class: arrow}

execute_fallback -> success_response: Success {class: arrow}
execute_fallback -> error_response: Failure {class: arrow}

success_response -> update_metrics: {class: arrow}
error_response -> update_metrics: {class: arrow}
reject_request -> update_metrics: {class: arrow}

update_metrics -> end_success: Success Path {class: arrow}
update_metrics -> end_error: Error Path {class: arrow}