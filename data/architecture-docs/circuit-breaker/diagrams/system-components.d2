title: Circuit Breaker System Components

classes: {
  container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  core_component: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  support_component: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  data_component: {
    style.fill: "#2d3748"
    style.stroke: "#4a5568"
    style.font-color: "#e6edf3"
  }
}

core: Core Components {
  class: container
  
  circuit_breaker: CircuitBreaker {
    class: core_component
    "- state: CircuitState"
    "- config: CircuitConfig"
    "- metrics: MetricsCollector"
    "+ execute(): Result"
    "+ canExecute(): boolean"
    "+ recordSuccess()"
    "+ recordFailure()"
    "+ transition(state: CircuitState)"
    shape: class
  }
  
  client_integration: ClientIntegration {
    class: core_component
    "- breaker: CircuitBreaker"
    "- fallback: FallbackRegistry"
    "+ makeRequest(): Response"
    "+ handleResponse()"
    "+ applyFallback(): Response"
    shape: class
  }
}

monitoring: Monitoring and Metrics {
  class: container
  
  metrics_collector: MetricsCollector {
    class: support_component
    "- window: SlidingWindow"
    "- counters: Map<string, Counter>"
    "+ recordSuccess(duration: number)"
    "+ recordFailure(error: Error)"
    "+ recordTimeout()"
    "+ getHealthMetrics(): Metrics"
    "+ shouldTripCircuit(): boolean"
    shape: class
  }
  
  sliding_window: SlidingWindow {
    class: data_component
    "- buckets: TimeBucket[]"
    "- windowSize: Duration"
    "- bucketSize: Duration"
    "+ addEvent(event: Event)"
    "+ getEventCount(): number"
    "+ getFailureRate(): number"
    "+ cleanExpiredBuckets()"
    shape: class
  }
}

fallback: Fallback System {
  class: container
  
  fallback_registry: FallbackRegistry {
    class: support_component
    "- strategies: Map<string, Strategy>"
    "- defaultStrategy: Strategy"
    "+ register(key: string, strategy: Strategy)"
    "+ getFallback(key: string): Strategy"
    "+ executeFallback(): Response"
    shape: class
  }
}

external_service: External Service {
  class: support_component
  shape: cloud
}

circuit_breaker -> metrics_collector: collects metrics
circuit_breaker <- client_integration: manages state
client_integration -> fallback_registry: retrieves fallback
metrics_collector -> sliding_window: stores events

circuit_breaker -> circuit_breaker: state transitions {
  style.stroke: "#e17055"
  style.stroke-dash: 3
}

client_integration -> circuit_breaker: request execution
metrics_collector -> circuit_breaker: health status
sliding_window -> metrics_collector: failure rates
fallback_registry -> client_integration: fallback response

client_integration <-> external_service: API calls {
  style.stroke: "#8b949e"
}