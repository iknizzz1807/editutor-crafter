title: Container Lifecycle State Machine

classes: {
  state: {
    shape: circle
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  error_state: {
    shape: circle
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
  }
  final_state: {
    shape: circle
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
  }
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  error_transition: {
    style.stroke: "#e17055"
    style.font-color: "#ff7675"
  }
}

init: {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
  label: ""
}

created: Created {
  class: state
}

initializing: Initializing {
  class: state
}

running: Running {
  class: state
}

stopping: Stopping {
  class: state
}

stopped: Stopped {
  class: final_state
}

creation_failed: Creation Failed {
  class: error_state
}

startup_failed: Startup Failed {
  class: error_state
}

runtime_error: Runtime Error {
  class: error_state
}

cleanup_failed: Cleanup Failed {
  class: error_state
}

init -> created: container_create() {
  class: transition
}

created -> initializing: container_start() {
  class: transition
}

created -> creation_failed: namespace/cgroup\nsetup fails {
  class: error_transition
}

initializing -> running: process exec\nsucceeds {
  class: transition
}

initializing -> startup_failed: exec fails\nmount fails {
  class: error_transition
}

running -> stopping: container_stop()\nSIGTERM sent {
  class: transition
}

running -> runtime_error: process crash\nOOM kill\nresource limit {
  class: error_transition
}

stopping -> stopped: graceful shutdown\ncleanup complete {
  class: transition
}

stopping -> cleanup_failed: cleanup timeout\nresource leak {
  class: error_transition
}

creation_failed -> stopped: cleanup namespaces\nremove cgroups {
  class: error_transition
}

startup_failed -> stopped: unmount filesystems\ncleanup network\nremove cgroups {
  class: error_transition
}

runtime_error -> stopping: attempt graceful\ncleanup {
  class: error_transition
}

runtime_error -> stopped: force cleanup\nSIGKILL process {
  class: error_transition
}

cleanup_failed -> stopped: force cleanup\nlog errors {
  class: error_transition
}

cleanup_note: |md
  ## Cleanup Requirements
  - **Namespaces**: Remove PID, mount, network namespaces
  - **Cgroups**: Remove cgroup directories, release limits  
  - **Network**: Delete veth pairs, cleanup bridge
  - **Mounts**: Unmount overlay, bind mounts
  - **Process**: SIGTERM â†’ SIGKILL escalation
| {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: bottom-right
}