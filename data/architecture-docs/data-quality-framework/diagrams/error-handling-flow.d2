title: Error Handling and Recovery Flow {
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
  near: top-center
}

classes: {
  container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  process: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  decision: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  
  recovery: {
    style.fill: "#00b894"
    style.stroke: "#00a085"
    style.font-color: "#ffffff"
  }
  
  arrow: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

detection: Error Detection {
  class: container
  
  data_input: Data Input {
    class: process
  }
  
  schema_check: Schema Validation {
    class: process
  }
  
  system_check: System Health Check {
    class: process
  }
  
  data_input -> schema_check: validate
  data_input -> system_check: monitor
}

classification: Error Classification {
  class: container
  
  error_type: Determine Error Type {
    shape: diamond
    class: decision
  }
  
  validation_fail: Validation Failure {
    class: error
  }
  
  system_error: System Error {
    class: error
  }
  
  format_issue: Data Format Issue {
    class: error
  }
  
  error_type -> validation_fail: Data Quality Issue
  error_type -> system_error: Infrastructure Failure
  error_type -> format_issue: Structure Problem
}

recovery_strategies: Recovery Strategies {
  class: container
  
  retry_logic: Retry with Backoff {
    class: recovery
  }
  
  fallback_rules: Apply Fallback Rules {
    class: recovery
  }
  
  skip_invalid: Skip Invalid Records {
    class: recovery
  }
  
  alert_ops: Alert Operations {
    class: recovery
  }
}

graceful_degradation: Graceful Degradation {
  class: container
  
  partial_processing: Partial Processing {
    class: process
  }
  
  quality_metrics: Update Quality Metrics {
    class: process
  }
  
  circuit_breaker: Circuit Breaker {
    class: process
  }
  
  reduced_functionality: Reduced Functionality Mode {
    class: process
  }
}

monitoring: Monitoring & Logging {
  class: container
  
  error_log: Error Logging {
    class: process
  }
  
  metrics_update: Metrics Update {
    class: process
  }
  
  notification: Send Notifications {
    class: process
  }
}

# Main flow connections
detection -> classification: errors detected {
  class: arrow
}

classification.validation_fail -> recovery_strategies.skip_invalid: handle {
  class: arrow
}

classification.system_error -> recovery_strategies.retry_logic: handle {
  class: arrow
}

classification.format_issue -> recovery_strategies.fallback_rules: handle {
  class: arrow
}

recovery_strategies -> graceful_degradation: if recovery fails {
  class: arrow
}

recovery_strategies.alert_ops -> monitoring.notification: critical errors {
  class: arrow
}

graceful_degradation -> monitoring: log degradation {
  class: arrow
}

# Feedback loops
monitoring -> detection: adjust thresholds {
  class: arrow
  style.stroke-dash: 5
}

graceful_degradation.circuit_breaker -> detection: pause validation {
  class: arrow
  style.stroke-dash: 5
}

# Recovery success path
recovery_strategies.retry_logic -> detection: retry successful {
  class: arrow
  style.stroke: "#00b894"
}