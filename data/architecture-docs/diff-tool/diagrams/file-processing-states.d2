direction: right

classes: {
  state_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  start_state: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#1a1a2e"
  }
  
  end_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
  }
  
  error_state: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
  }
  
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  error_transition: {
    style.stroke: "#d63031"
    style.font-color: "#d63031"
  }
}

initial: {
  shape: circle
  label: ""
  class: start_state
}

file_discovered: File Discovered {
  shape: circle
  class: state_style
}

encoding_detected: Encoding Detected {
  shape: circle
  class: state_style
}

content_read: Content Read {
  shape: circle
  class: state_style
}

lines_tokenized: Lines Tokenized {
  shape: circle
  class: state_style
}

normalized: Normalized {
  shape: circle
  class: state_style
}

ready: Ready {
  shape: circle
  class: end_state
}

error: Error {
  shape: circle
  class: error_state
}

initial -> file_discovered: file path provided {
  class: transition
}

file_discovered -> encoding_detected: file exists & readable {
  class: transition
}

encoding_detected -> content_read: encoding identified {
  class: transition
}

content_read -> lines_tokenized: content loaded {
  class: transition
}

lines_tokenized -> normalized: lines split {
  class: transition
}

normalized -> ready: whitespace & endings normalized {
  class: transition
}

file_discovered -> error: file not found {
  class: error_transition
}

encoding_detected -> error: unsupported encoding {
  class: error_transition
}

content_read -> error: read failure {
  class: error_transition
}

lines_tokenized -> error: tokenization failure {
  class: error_transition
}

normalized -> error: normalization failure {
  class: error_transition
}

title: File Processing State Machine {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}