classes: {
  entity: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  persistent: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
  }
  volatile: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  composition: {
    style.stroke: "#3fb950"
    style.stroke-width: 2
  }
  reference: {
    style.stroke: "#8b949e"
    style.stroke-dash: 5
  }
}

title: Data Model Relationships {
  near: top-center
  style.font-size: 20
  style.font-color: "#e6edf3"
  style.bold: true
}

node_state: NodeState {
  shape: class
  class: entity
  - "current_term: u64"
  - "voted_for: Option<NodeId>"
  - "log: Vec<LogEntry>"
  - "commit_index: u64"
  - "last_applied: u64"
  - "next_index: Vec<u64>"
  - "match_index: Vec<u64>"
  + "advance_term(term: u64)"
  + "vote_for(candidate: NodeId)"
  + "append_entries(entries: Vec<LogEntry>)"
}

log_entry: LogEntry {
  shape: class
  class: entity
  - "term: u64"
  - "index: u64"
  - "command: Command"
  - "timestamp: Timestamp"
  + "new(term: u64, index: u64, command: Command): LogEntry"
  + "is_committed(commit_index: u64): bool"
}

term: Term {
  shape: class
  class: persistent
  - "value: u64"
  - "voted_for: Option<NodeId>"
  + "increment(): Term"
  + "can_vote_for(candidate: NodeId): bool"
  + "record_vote(candidate: NodeId)"
}

vote: Vote {
  shape: class
  class: volatile
  - "term: u64"
  - "candidate_id: NodeId"
  - "last_log_index: u64"
  - "last_log_term: u64"
  - "granted: bool"
  + "new(term: u64, candidate: NodeId): Vote"
  + "validate(current_term: u64): bool"
}

snapshot: Snapshot {
  shape: class
  class: persistent
  - "last_included_index: u64"
  - "last_included_term: u64"
  - "configuration: ClusterConfig"
  - "data: Vec<u8>"
  + "create(state: ApplicationState): Snapshot"
  + "apply(): ApplicationState"
  + "covers_entry(index: u64): bool"
}

persistent_state: Persistent State {
  shape: rectangle
  class: persistent
  style.font-size: 14
}

volatile_state: Volatile State {
  shape: rectangle
  class: volatile
  style.font-size: 14
}

node_state -> log_entry: contains {
  class: composition
  label: "1..*"
}

node_state -> term: tracks {
  class: reference
  label: "current"
}

node_state -> vote: receives {
  class: reference
  label: "0..*"
}

node_state -> snapshot: manages {
  class: composition
  label: "0..1"
}

log_entry -> term: belongs to {
  class: reference
  label: "1"
}

snapshot -> log_entry: replaces {
  class: reference
  label: "0..*"
  style.stroke-dash: 10
}

term -> persistent_state
vote -> volatile_state
snapshot -> persistent_state

legend: |md
  **Relationships:**
  ‚îÅ‚îÅ‚îÅ Composition (owns)
  ‚îÖ‚îÖ‚îÖ Reference (uses)
  
  **State Types:**
  üü¶ Persistent (survives crashes)
  üü® Volatile (reconstructed)
| {
  shape: page
  near: bottom-right
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}