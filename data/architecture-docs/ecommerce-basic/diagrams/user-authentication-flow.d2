title: User Authentication Sequence
shape: sequence_diagram

client: Client
api: API Gateway
auth: Auth Service
hash: Password Hasher
session: Session Storage
db: User Database

client -> api: POST /register {email, password}
api -> auth: validate registration data
auth -> hash: hash password
hash -> auth: hashed password
auth -> db: store user {email, hash}
db -> auth: user created
auth -> session: create session token
session -> auth: session token
auth -> api: registration success + token
api -> client: 201 Created {token}

client -> api: POST /login {email, password}
api -> auth: authenticate user
auth -> db: find user by email
db -> auth: user data {hash}
auth -> hash: verify password
hash -> auth: password valid
auth -> session: create session token
session -> auth: session token
auth -> api: login success + token
api -> client: 200 OK {token}

client -> api: GET /profile {Authorization: Bearer token}
api -> session: validate token
session -> api: token valid + user_id
api -> db: get user profile
db -> api: user profile data
api -> client: 200 OK {profile}

classes: {
  auth_flow: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  security: {
    style.fill: "#16213e"
    style.stroke: "#e17055"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

client.class: auth_flow
api.class: auth_flow
auth.class: security
hash.class: security
session.class: security
db.class: auth_flow