title: Component Query Execution Flow

classes: {
  process: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  data: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

query_start: Query Specification {
  shape: rectangle
  class: process
}

parse_query: Parse Component Types {
  shape: rectangle
  class: process
}

validate_types: Validate Component Types {
  shape: diamond
  class: decision
}

get_entities: Get Entity List {
  shape: rectangle
  class: process
}

entity_loop: Entity Iterator {
  shape: rectangle
  class: data
}

check_components: Has Required Components? {
  shape: diamond
  class: decision
}

access_components: Access Component Data {
  shape: rectangle
  class: process
}

system_logic: Execute System Logic {
  shape: rectangle
  class: process
}

next_entity: Next Entity {
  shape: rectangle
  class: data
}

more_entities: More Entities? {
  shape: diamond
  class: decision
}

query_complete: Query Complete {
  shape: rectangle
  class: process
}

invalid_type: Invalid Type Error {
  shape: rectangle
  class: data
  style.fill: "#d63031"
  style.font-color: "#ffffff"
}

query_start -> parse_query: Component requirements

parse_query -> validate_types: Parsed types

validate_types -> get_entities: Valid {
  style.stroke: "#3fb950"
}

validate_types -> invalid_type: Invalid {
  style.stroke: "#d63031"
}

get_entities -> entity_loop: Entity collection

entity_loop -> check_components: Current entity

check_components -> access_components: Match {
  style.stroke: "#3fb950"
}

check_components -> next_entity: No match {
  style.stroke: "#8b949e"
}

access_components -> system_logic: Component refs

system_logic -> next_entity: Process complete

next_entity -> more_entities: Advance iterator

more_entities -> entity_loop: Yes {
  style.stroke: "#8b949e"
}

more_entities -> query_complete: No {
  style.stroke: "#3fb950"
}