direction: right

title: ECS Architecture Overview {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  storage: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  optional: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    style.stroke-dash: 3
  }
  arrow: {
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  query_arrow: {
    style.stroke: "#ffa500"
    style.font-color: "#e6edf3"
  }
}

entity_manager: Entity Manager {
  class: container
  id_pool: ID Pool
  entity_registry: Entity Registry
  lifecycle: Entity Lifecycle
}

component_storage: Component Storage {
  class: storage
  type_a: Component Type A
  type_b: Component Type B
  type_c: Component Type C
  sparse_sets: Sparse Sets
}

system_interface: System Interface {
  class: container
  query_engine: Query Engine
  system_runner: System Runner
  event_dispatcher: Event Dispatcher
}

archetypes: Archetypes {
  class: optional
  archetype_graph: Archetype Graph
  chunk_storage: Chunk Storage
  migration_paths: Migration Paths
}

entity_manager -> component_storage: creates/destroys {
  class: arrow
}

entity_manager -> system_interface: entity events {
  class: arrow
}

system_interface -> component_storage: queries components {
  class: query_arrow
}

system_interface -> archetypes: optimized queries {
  class: query_arrow
  style.stroke-dash: 3
}

component_storage -> archetypes: feeds into {
  class: arrow
  style.stroke-dash: 3
}

data_flow: Data Flow Legend {
  near: bottom-right
  class: optional
  creation: "→ Entity/Component Operations"
  queries: "→ System Queries (orange)"
  optional_flow: "⇢ Optional Archetype Path"
}