classes: {
  header_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  table_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  entry_style: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

title: ELF Data Model Relationships {
  near: top-center
  style.font-size: 18
  style.bold: true
  style.font-color: "#e6edf3"
}

elf_header: ELF Header {
  shape: class
  class: header_style
  - "magic: \"[0x7f, E, L, F]\""
  - "class: u8"
  - "data: u8"
  - "version: u8"
  - "type: u16"
  - "machine: u16"
  - "entry: u64"
  - "shoff: u64"
  - "phoff: u64"
  - "shnum: u16"
  - "phnum: u16"
  - "shstrndx: u16"
  + "validate(): bool"
  + "is_64bit(): bool"
  + "is_executable(): bool"
}

section_headers: Section Headers {
  shape: class
  class: table_style
  - "sections: Vec<SectionHeader>"
  + "get_section(index: u16): Option<&SectionHeader>"
  + "find_by_name(name: &str): Option<&SectionHeader>"
  + "get_string_table(): Option<&SectionHeader>"
}

section_header: Section Header {
  shape: class
  class: entry_style
  - "name: u32"
  - "sh_type: u32"
  - "flags: u64"
  - "addr: u64"
  - "offset: u64"
  - "size: u64"
  - "link: u32"
  - "info: u32"
  - "addralign: u64"
  - "entsize: u64"
  + "is_symbol_table(): bool"
  + "is_string_table(): bool"
}

program_headers: Program Headers {
  shape: class
  class: table_style
  - "segments: Vec<ProgramHeader>"
  + "get_segment(index: u16): Option<&ProgramHeader>"
  + "find_loadable(): Vec<&ProgramHeader>"
  + "get_interpreter(): Option<&ProgramHeader>"
}

program_header: Program Header {
  shape: class
  class: entry_style
  - "p_type: u32"
  - "flags: u32"
  - "offset: u64"
  - "vaddr: u64"
  - "paddr: u64"
  - "filesz: u64"
  - "memsz: u64"
  - "align: u64"
  + "is_loadable(): bool"
  + "is_dynamic(): bool"
}

symbol_table: Symbol Table {
  shape: class
  class: table_style
  - "symbols: Vec<SymbolEntry>"
  - "string_table_index: u16"
  + "get_symbol(index: usize): Option<&SymbolEntry>"
  + "find_by_name(name: &str): Option<&SymbolEntry>"
  + "get_globals(): Vec<&SymbolEntry>"
}

symbol_entry: Symbol Entry {
  shape: class
  class: entry_style
  - "name: u32"
  - "info: u8"
  - "other: u8"
  - "shndx: u16"
  - "value: u64"
  - "size: u64"
  + "get_type(): SymbolType"
  + "get_binding(): SymbolBinding"
  + "is_function(): bool"
}

relocation_table: Relocation Table {
  shape: class
  class: table_style
  - "entries: Vec<RelocationEntry>"
  - "symbol_table_index: u32"
  + "get_entry(index: usize): Option<&RelocationEntry>"
  + "apply_relocations(data: &mut [u8]): Result"
}

relocation_entry: Relocation Entry {
  shape: class
  class: entry_style
  - "offset: u64"
  - "info: u64"
  - "addend: i64"
  + "get_symbol_index(): u32"
  + "get_type(): RelocationType"
  + "calculate_value(): u64"
}

string_table: String Table {
  shape: class
  class: table_style
  - "data: Vec<u8>"
  + "get_string(offset: u32): Option<&str>"
  + "add_string(s: &str): u32"
  + "size(): usize"
}

elf_header -> section_headers: "references\n1:1" {
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

elf_header -> program_headers: "references\n1:1" {
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

section_headers -> section_header: "contains\n1:N" {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

program_headers -> program_header: "contains\n1:N" {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

section_header -> symbol_table: "defines\n0:1" {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

section_header -> relocation_table: "defines\n0:N" {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

section_header -> string_table: "defines\n0:N" {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

symbol_table -> symbol_entry: "contains\n1:N" {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

symbol_table -> string_table: "names from\nN:1" {
  style.stroke: "#e17055"
  style.font-color: "#e6edf3"
}

relocation_table -> relocation_entry: "contains\n1:N" {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

relocation_table -> symbol_table: "references\nN:1" {
  style.stroke: "#e17055"
  style.font-color: "#e6edf3"
}

relocation_entry -> symbol_entry: "references\nN:1" {
  style.stroke: "#e17055"
  style.font-color: "#e6edf3"
}

section_header -> string_table: "names from\nN:1" {
  style.stroke: "#e17055"
  style.font-color: "#e6edf3"
}