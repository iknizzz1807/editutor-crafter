title: End-to-End Pipeline Processing {
  style.font-size: 24
  style.font-color: "#e6edf3"
}

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  success: {
    style.fill: "#0d7377"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
  }
}

start: Start Pipeline {
  shape: circle
  class: success
}

parse_dag: Parse DAG Definition {
  class: process
}

validate_dag: Validate DAG Structure {
  class: process
}

dag_valid: DAG Valid? {
  shape: diamond
  class: decision
}

schedule_tasks: Schedule Ready Tasks {
  class: process
}

check_deps: Check Dependencies {
  class: process
}

deps_ready: Dependencies\nReady? {
  shape: diamond
  class: decision
}

allocate_resources: Allocate Resources {
  class: process
}

resources_available: Resources\nAvailable? {
  shape: diamond
  class: decision
}

execute_task: Execute Task {
  class: process
}

task_success: Task\nSuccessful? {
  shape: diamond
  class: decision
}

validate_output: Validate Output Data {
  class: process
}

data_valid: Data\nValid? {
  shape: diamond
  class: decision
}

update_status: Update Task Status {
  class: process
}

check_retry: Retry\nAttempts\nRemaining? {
  shape: diamond
  class: decision
}

increment_retry: Increment Retry Count {
  class: process
}

mark_failed: Mark Task Failed {
  class: error
}

check_complete: All Tasks\nComplete? {
  shape: diamond
  class: decision
}

pipeline_success: Pipeline Success {
  class: success
}

pipeline_failed: Pipeline Failed {
  class: error
}

dag_error: DAG Parse Error {
  class: error
}

wait_deps: Wait for Dependencies {
  class: process
}

wait_resources: Wait for Resources {
  class: process
}

start -> parse_dag
parse_dag -> validate_dag
validate_dag -> dag_valid

dag_valid -> schedule_tasks: Yes
dag_valid -> dag_error: No

schedule_tasks -> check_deps
check_deps -> deps_ready

deps_ready -> allocate_resources: Yes
deps_ready -> wait_deps: No
wait_deps -> deps_ready

allocate_resources -> resources_available

resources_available -> execute_task: Yes
resources_available -> wait_resources: No
wait_resources -> resources_available

execute_task -> task_success

task_success -> validate_output: Yes
task_success -> check_retry: No

validate_output -> data_valid

data_valid -> update_status: Yes
data_valid -> check_retry: No

update_status -> check_complete

check_retry -> increment_retry: Yes
check_retry -> mark_failed: No

increment_retry -> allocate_resources

mark_failed -> check_complete

check_complete -> schedule_tasks: No (More Tasks)
check_complete -> pipeline_success: Yes (All Success)
check_complete -> pipeline_failed: Yes (Has Failures)