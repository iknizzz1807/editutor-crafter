title: Aggregate State Machine

classes: {
  state_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  final_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
    style.double-border: true
  }
  command_style: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

init: {
  shape: circle
  style.fill: "#3fb950"
  label: ""
}

draft: Draft {
  shape: circle
  class: state_style
}

pending: Pending Review {
  shape: circle
  class: state_style
}

approved: Approved {
  shape: circle
  class: state_style
}

published: Published {
  shape: circle
  class: state_style
}

rejected: Rejected {
  shape: circle
  class: final_state
}

archived: Archived {
  shape: circle
  class: final_state
}

init -> draft: CreateAggregate

draft -> draft: UpdateContent {
  class: command_style
}

draft -> pending: SubmitForReview {
  class: command_style
}

draft -> archived: Archive {
  class: command_style
}

pending -> approved: Approve {
  class: command_style
}

pending -> rejected: Reject {
  class: command_style
}

pending -> draft: RequestChanges {
  class: command_style
}

approved -> published: Publish {
  class: command_style
}

approved -> draft: Revise {
  class: command_style
}

published -> archived: Archive {
  class: command_style
}

published -> draft: CreateNewVersion {
  class: command_style
}

events_note: |md
  **Domain Events Generated:**
  • AggregateCreated
  • ContentUpdated
  • ReviewSubmitted
  • ApprovalGranted
  • PublicationCompleted
  • AggregateArchived
| {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  near: bottom-right
}