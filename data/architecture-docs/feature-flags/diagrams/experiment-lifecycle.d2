direction: right

# Define style classes
classes: {
  phase: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  process: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  data: {
    style.fill: "#2d1b69"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

# Experiment Creation Phase
creation: Experiment Creation {
  class: phase
  define_hypothesis: Define Hypothesis {
    class: process
  }
  configure_variants: Configure Variants {
    class: process
  }
  set_metrics: Set Success Metrics {
    class: process
  }
  create_flag: Create Feature Flag {
    class: process
  }
  
  define_hypothesis -> configure_variants
  configure_variants -> set_metrics
  set_metrics -> create_flag
}

# User Assignment Phase
assignment: User Assignment {
  class: phase
  user_request: User Request {
    class: process
  }
  check_targeting: Check Targeting Rules {
    class: decision
    shape: diamond
  }
  hash_assignment: Hash-Based Assignment {
    class: process
  }
  cache_assignment: Cache Assignment {
    class: process
  }
  
  user_request -> check_targeting
  check_targeting -> hash_assignment: eligible
  check_targeting -> user_request: not eligible
  hash_assignment -> cache_assignment
}

# Exposure Tracking Phase
exposure: Exposure Tracking {
  class: phase
  feature_accessed: Feature Accessed {
    class: process
  }
  log_exposure: Log Exposure Event {
    class: process
  }
  batch_events: Batch Events {
    class: process
  }
  
  feature_accessed -> log_exposure
  log_exposure -> batch_events
}

# Metric Collection Phase
metrics: Metric Collection {
  class: phase
  user_actions: User Actions {
    class: process
  }
  track_conversions: Track Conversions {
    class: process
  }
  aggregate_metrics: Aggregate Metrics {
    class: process
  }
  
  user_actions -> track_conversions
  track_conversions -> aggregate_metrics
}

# Statistical Analysis Phase
analysis: Statistical Analysis {
  class: phase
  collect_data: Collect Experiment Data {
    class: process
  }
  statistical_test: Run Statistical Tests {
    class: process
  }
  significance_check: Check Significance {
    class: decision
    shape: diamond
  }
  generate_report: Generate Report {
    class: process
  }
  make_decision: Make Launch Decision {
    class: decision
    shape: diamond
  }
  
  collect_data -> statistical_test
  statistical_test -> significance_check
  significance_check -> generate_report: significant
  significance_check -> collect_data: more data needed
  generate_report -> make_decision
}

# Data Storage
experiment_db: Experiment Database {
  shape: cylinder
  class: data
}

events_db: Events Database {
  shape: cylinder
  class: data
}

# Phase connections
creation -> assignment: experiment active
assignment -> exposure: user assigned
exposure -> metrics: events logged
metrics -> analysis: data collected
analysis -> experiment_db: results stored

# Data flow
assignment -> events_db: assignments
exposure -> events_db: exposures
metrics -> events_db: conversions
events_db -> analysis: raw data

title: A/B Test Experiment Lifecycle {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}