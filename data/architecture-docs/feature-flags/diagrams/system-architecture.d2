direction: right

classes: {
  container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  service: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  datastore: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  client: {
    style.fill: "#2d3748"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

title: Feature Flag System Architecture {
  near: top-center
  style.font-size: 18
  style.bold: true
  style.font-color: "#e6edf3"
}

core_services: Core Services {
  class: container
  
  flag_api: Flag Management API {
    class: service
  }
  
  evaluation_engine: Evaluation Engine {
    class: service
  }
  
  update_service: Real-time Update Service {
    class: service
  }
}

data_layer: Data Layer {
  class: container
  
  flag_db: Flag Config Store {
    shape: cylinder
    class: datastore
  }
  
  cache: Evaluation Cache {
    shape: cylinder
    class: datastore
  }
  
  events: Event Stream {
    shape: queue
    class: datastore
  }
}

client_layer: Client Layer {
  class: container
  
  web_sdk: Web SDK {
    class: client
  }
  
  mobile_sdk: Mobile SDK {
    class: client
  }
  
  server_sdk: Server SDK {
    class: client
  }
}

flag_api -> flag_db: store/retrieve configs {
  style.stroke: "#8b949e"
}

flag_api -> events: publish updates {
  style.stroke: "#8b949e"
}

evaluation_engine -> flag_db: read flag rules {
  style.stroke: "#8b949e"
}

evaluation_engine -> cache: cache evaluations {
  style.stroke: "#8b949e"
}

update_service -> events: consume updates {
  style.stroke: "#8b949e"
}

update_service -> web_sdk: WebSocket updates {
  style.stroke: "#3fb950"
  style.bold: true
}

update_service -> mobile_sdk: push notifications {
  style.stroke: "#3fb950"
  style.bold: true
}

update_service -> server_sdk: streaming updates {
  style.stroke: "#3fb950"
  style.bold: true
}

web_sdk -> evaluation_engine: evaluate flags {
  style.stroke: "#8b949e"
}

mobile_sdk -> evaluation_engine: evaluate flags {
  style.stroke: "#8b949e"
}

server_sdk -> evaluation_engine: evaluate flags {
  style.stroke: "#8b949e"
}

web_sdk -> cache: local cache {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

mobile_sdk -> cache: local cache {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

server_sdk -> cache: local cache {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}