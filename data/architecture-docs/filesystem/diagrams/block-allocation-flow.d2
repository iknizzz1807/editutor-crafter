direction: down

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
  }
  success: {
    style.fill: "#00b894"
    style.stroke: "#00a085"
    style.font-color: "#ffffff"
  }
  arrow: {
    style.stroke: "#8b949e"
  }
}

start: Start {
  shape: circle
  class: success
}

request: Request Block Allocation {
  class: process
}

read_bitmap: Read Bitmap from Disk {
  class: process
}

bitmap_error: Bitmap Read Error? {
  shape: diamond
  class: decision
}

handle_io_error: Handle I/O Error {
  class: error
}

scan_bitmap: Scan Bitmap for Free Block {
  class: process
}

free_found: Free Block Found? {
  shape: diamond
  class: decision
}

out_of_space: Handle Out-of-Space {
  class: error
}

mark_allocated: Mark Block as Allocated {
  class: process
}

write_bitmap: Write Updated Bitmap {
  class: process
}

write_error: Bitmap Write Error? {
  shape: diamond
  class: decision
}

handle_write_error: Handle Write Error {
  class: error
}

return_block: Return Block Number {
  class: success
}

end: End {
  shape: circle
  class: success
}

start -> request: {class: arrow}
request -> read_bitmap: {class: arrow}
read_bitmap -> bitmap_error: {class: arrow}
bitmap_error -> handle_io_error: Yes {class: arrow}
bitmap_error -> scan_bitmap: No {class: arrow}
scan_bitmap -> free_found: {class: arrow}
free_found -> out_of_space: No {class: arrow}
free_found -> mark_allocated: Yes {class: arrow}
mark_allocated -> write_bitmap: {class: arrow}
write_bitmap -> write_error: {class: arrow}
write_error -> handle_write_error: Yes {class: arrow}
write_error -> return_block: No {class: arrow}
return_block -> end: {class: arrow}
handle_io_error -> end: {class: arrow}
out_of_space -> end: {class: arrow}
handle_write_error -> end: {class: arrow}