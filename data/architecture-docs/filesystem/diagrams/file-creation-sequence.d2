shape: sequence_diagram

app: Application
vfs: VFS Layer
fuse: FUSE Layer
fs: Filesystem
dir: Directory Manager
inode: Inode Manager
block: Block Manager
journal: Journal

app -> vfs: create("/path/file", mode)
vfs -> fuse: fuse_create()
fuse -> fs: fs_create("/path/file", mode)
fs -> dir: lookup_parent("/path")
dir -> fs: parent_inode
fs -> inode: allocate_inode()
inode -> journal: log_inode_alloc(ino)
journal -> inode: success
inode -> block: allocate_block()
block -> journal: log_block_alloc(block_no)
journal -> block: success
block -> inode: block_no
inode -> fs: new_inode
fs -> dir: add_entry(parent, "file", ino)
dir -> journal: log_dir_update(parent, entry)
journal -> dir: success
dir -> fs: success
fs -> inode: write_inode(new_inode)
inode -> journal: log_inode_write(ino)
journal -> inode: success
inode -> fs: success
fs -> fuse: file_handle
fuse -> vfs: fd
vfs -> app: fd

app.style.fill: "#1a1a2e"
app.style.stroke: "#3fb950"
app.style.font-color: "#e6edf3"

vfs.style.fill: "#16213e"
vfs.style.stroke: "#3fb950"
vfs.style.font-color: "#e6edf3"

fuse.style.fill: "#0f3460"
fuse.style.stroke: "#3fb950"
fuse.style.font-color: "#e6edf3"
fuse.style.bold: true

fs.style.fill: "#1a1a2e"
fs.style.stroke: "#3fb950"
fs.style.font-color: "#e6edf3"
fs.style.bold: true

dir.style.fill: "#16213e"
dir.style.stroke: "#8b949e"
dir.style.font-color: "#e6edf3"

inode.style.fill: "#16213e"
inode.style.stroke: "#8b949e"
inode.style.font-color: "#e6edf3"

block.style.fill: "#16213e"
block.style.stroke: "#8b949e"
block.style.font-color: "#e6edf3"

journal.style.fill: "#0f3460"
journal.style.stroke: "#3fb950"
journal.style.font-color: "#e6edf3"