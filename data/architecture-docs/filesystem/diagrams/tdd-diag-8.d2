direction: right
vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 0
  }
}

inode_t: "struct inode_t (sizeof=128 bytes)" {
  shape: sql_table
  style: {
    stroke: "#333333"
    stroke-width: 2
    border-radius: 0
  }

  "0x00": "mode" {
    constraint: "uint16_t (2B)"
    style.fill: "#9b59b6"
    style.font-color: white
  }
  "0x02": "uid" {
    constraint: "uint16_t (2B)"
    style.fill: "#3498db"
    style.font-color: white
  }
  "0x04": "gid" {
    constraint: "uint16_t (2B)"
    style.fill: "#3498db"
    style.font-color: white
  }
  "0x06": "nlinks" {
    constraint: "uint16_t (2B)"
    style.fill: "#3498db"
    style.font-color: white
  }
  "0x08": "size" {
    constraint: "uint32_t (4B)"
    style.fill: "#3498db"
    style.font-color: white
  }
  "0x0C": "atime" {
    constraint: "uint32_t (4B)"
    style.fill: "#3498db"
    style.font-color: white
  }
  "0x10": "mtime" {
    constraint: "uint32_t (4B)"
    style.fill: "#3498db"
    style.font-color: white
  }
  "0x14": "ctime" {
    constraint: "uint32_t (4B)"
    style.fill: "#3498db"
    style.font-color: white
  }
  "0x18": "i_blocks[0..9]" {
    constraint: "uint32_t[10] (40B)"
    style.fill: "#e67e22"
    style.font-color: white
  }

  # --- 64B CACHE LINE BOUNDARY ---
  "0x40": "i_blocks[10..11]" {
    constraint: "uint32_t[2] (8B)"
    style.fill: "#e67e22"
    style.font-color: white
  }
  "0x48": "single_indirect" {
    constraint: "uint32_t (4B)"
    style.fill: "#e67e22"
    style.font-color: white
  }
  "0x4C": "double_indirect" {
    constraint: "uint32_t (4B)"
    style.fill: "#e67e22"
    style.font-color: white
  }
  "0x50": "reserved" {
    constraint: "uint8_t[48] (48B)"
    style.fill: "#95a5a6"
    style.font-color: white
  }
}

boundary: "------------------------ 64B CACHE LINE BOUNDARY ------------------------" {
  shape: text
  near: top-right
  style: {
    font-size: 11
    font-color: "#7f8c8d"
    stroke-dash: 5
  }
}

annotations: {
  near: bottom-center
  
  mode_bits: ||md
    ### i_mode (16-bit) Bit Breakdown
    - **Bits 15-12**: File Type (`S_IFMT`)
      - `1000`: Regular File | `0100`: Directory | `1010`: Symlink
    - **Bits 11-0**: Permissions (`rwxrwxrwx`)
  ||

  assertions: ||md
    ### Alignment & Layout
    - **Size**: 128 Bytes (Fixed Width)
    - **Page Layout**: 32 Inodes per 4KB Block
    - **Cache Efficiency**: Fields 0x00 to 0x3F fit in single L1 cache line.
  ||
}

legend: {
  near: bottom-right
  grid-columns: 1
  h: "Header (Purple)" { style.fill: "#9b59b6"; style.font-color: white }
  d: "Data (Blue)" { style.fill: "#3498db"; style.font-color: white }
  p: "Pointers (Orange)" { style.fill: "#e67e22"; style.font-color: white }
  f: "Padding (Gray)" { style.fill: "#95a5a6"; style.font-color: white }
}