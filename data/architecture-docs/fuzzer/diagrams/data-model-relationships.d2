# Core Data Type Relationships
direction: down

classes: {
  core_type: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  relationship: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

TestCase: {
  shape: class
  class: core_type
  - "data: bytes"
  - "size: u32"
  - "checksum: u64"
  - "discovered_at: Instant"
  - "parent_id: Option<TestCaseId>"
  - "generation: u32"
  + "new(data: Vec<u8>): Self"
  + "is_empty(): bool"
  + "compute_checksum(): u64"
  + "clone_data(): Vec<u8>"
}

CoverageMap: {
  shape: class
  class: core_type
  - "edges: \"Vec<u64>\""
  - "hit_counts: \"HashMap<EdgeId, u32>\""
  - "virgin_bits: \"BitSet\""
  - "total_edges: u32"
  + "new(size: usize): Self"
  + "record_hit(edge: EdgeId): bool"
  + "merge(other: &CoverageMap): bool"
  + "has_new_coverage(other: &CoverageMap): bool"
  + "reset(): ()"
}

ExecutionResult: {
  shape: class
  class: core_type
  - "status: ExitStatus"
  - "execution_time: Duration"
  - "peak_memory: u64"
  - "coverage: CoverageMap"
  - "signal: Option<i32>"
  - "stdout_size: u32"
  - "stderr_size: u32"
  + "new(): Self"
  + "is_crash(): bool"
  + "is_timeout(): bool"
  + "is_hang(): bool"
  + "classify(): ExecutionClass"
}

CorpusEntry: {
  shape: class
  class: core_type
  - "test_case: TestCase"
  - "execution_result: ExecutionResult"
  - "energy: f64"
  - "fuzz_count: u32"
  - "last_fuzzed: Instant"
  - "favored: bool"
  - "handicap: u8"
  + "new(test: TestCase, result: ExecutionResult): Self"
  + "calculate_energy(): f64"
  + "should_skip(): bool"
  + "update_energy(total_execs: u64): ()"
}

MutationStrategy: {
  shape: class
  class: core_type
  - "bit_flip_stages: \"Vec<BitFlipConfig>\""
  - "byte_flip_stages: \"Vec<ByteFlipConfig>\""
  - "arithmetic_stages: \"Vec<ArithConfig>\""
  - "interest_stages: \"Vec<InterestConfig>\""
  - "dictionary: \"Vec<Vec<u8>>\""
  - "havoc_cycles: u32"
  + "new(): Self"
  + "mutate(input: &TestCase): \"Vec<TestCase>\""
  + "add_dictionary_entry(entry: \"Vec<u8>\"): ()"
  + "get_mutation_count(size: usize): usize"
}

# Relationships
TestCase -> ExecutionResult: "executed to produce" {
  class: relationship
}

ExecutionResult -> CoverageMap: "contains" {
  class: relationship
}

CorpusEntry -> TestCase: "wraps" {
  class: relationship
}

CorpusEntry -> ExecutionResult: "stores" {
  class: relationship
}

MutationStrategy -> TestCase: "generates from" {
  class: relationship
}

TestCase -> TestCase: "parent_id references" {
  class: relationship
  style.stroke-dash: 3
}

CoverageMap -> CoverageMap: "compared with" {
  class: relationship
  style.stroke-dash: 3
}