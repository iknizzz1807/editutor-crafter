direction: down

classes: {
  entity: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  association: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

title: Core Data Model {
  near: top-center
  style.font-size: 24
  style.font-color: "#e6edf3"
  style.bold: true
}

Application: {
  shape: class
  class: entity
  - "id: string"
  - "name: string"
  - "namespace: string"
  - "repo_url: string"
  - "target_revision: string"
  - "path: string"
  - "destination_server: string"
  - "destination_namespace: string"
  - "sync_policy: SyncPolicy"
  - "created_at: timestamp"
  - "updated_at: timestamp"
  + "sync(): SyncOperation"
  + "get_current_revision(): Revision"
  + "get_health_status(): HealthStatus"
}

Repository: {
  shape: class
  class: entity
  - "url: string"
  - "branch: string"
  - "credentials: AuthConfig"
  - "last_fetched: timestamp"
  - "connection_state: string"
  + "fetch(): boolean"
  + "get_manifest_files(path: string): string[]"
  + "get_commit_info(revision: string): CommitInfo"
}

SyncOperation: {
  shape: class
  class: entity
  - "id: string"
  - "application_id: string"
  - "revision_id: string"
  - "status: SyncStatus"
  - "phase: SyncPhase"
  - "started_at: timestamp"
  - "finished_at: timestamp"
  - "message: string"
  - "resources_synced: int"
  - "resources_failed: int"
  + "execute(): boolean"
  + "rollback(): boolean"
  + "get_details(): SyncDetails"
}

Revision: {
  shape: class
  class: entity
  - "id: string"
  - "application_id: string"
  - "commit_sha: string"
  - "author: string"
  - "commit_message: string"
  - "timestamp: timestamp"
  - "manifests: Manifest[]"
  - "is_deployed: boolean"
  + "get_manifest_diff(other: Revision): ManifestDiff"
  + "deploy(): SyncOperation"
}

HealthStatus: {
  shape: class
  class: entity
  - "id: string"
  - "application_id: string"
  - "status: HealthCode"
  - "message: string"
  - "last_checked: timestamp"
  - "resource_statuses: ResourceHealth[]"
  - "degraded_since: timestamp"
  + "check_health(): boolean"
  + "get_unhealthy_resources(): Resource[]"
}

Configuration: {
  shape: class
  class: entity
  - "id: string"
  - "application_id: string"
  - "auto_sync_enabled: boolean"
  - "prune_enabled: boolean"
  - "self_heal_enabled: boolean"
  - "sync_timeout: duration"
  - "retry_limit: int"
  - "notification_config: NotificationSettings"
  + "validate(): boolean"
  + "apply_defaults(): void"
}

Application -> Repository: {
  class: association
  label: "pulls from"
}

Application -> SyncOperation: {
  class: association
  label: "1..*"
}

Application -> Revision: {
  class: association  
  label: "1..*"
}

Application -> HealthStatus: {
  class: association
  label: "1..1"
}

Application -> Configuration: {
  class: association
  label: "1..1"
}

SyncOperation -> Revision: {
  class: association
  label: "1..1"
}

Revision -> Repository: {
  class: association
  label: "*..*"
}