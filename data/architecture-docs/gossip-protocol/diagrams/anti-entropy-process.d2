shape: sequence_diagram

classes: {
  peer_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  message_style: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

peer_a: Peer A {
  class: peer_style
}

peer_b: Peer B {
  class: peer_style
}

peer_a -> peer_b: digest_request() {
  class: message_style
}

peer_b -> peer_b: compute_digest() {
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

peer_b -> peer_a: digest_response(merkle_tree_root, version_vector) {
  class: message_style
}

peer_a -> peer_a: compare_digests() {
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

peer_a -> peer_a: identify_differences() {
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

peer_a -> peer_b: sync_request(missing_keys, outdated_keys) {
  class: message_style
}

peer_b -> peer_b: prepare_delta() {
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

peer_b -> peer_a: sync_response(data_delta, tombstones) {
  class: message_style
}

peer_a -> peer_a: apply_changes() {
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

peer_a -> peer_a: update_local_state() {
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

peer_a -> peer_b: ack_sync_complete() {
  class: message_style
}

peer_b -> peer_b: mark_peer_synchronized() {
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}