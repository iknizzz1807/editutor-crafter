classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  initial: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  final: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
    style.bold: true
  }
  
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  error_transition: {
    style.stroke: "#d63031"
    style.font-color: "#d63031"
    style.stroke-dash: 3
  }
}

init: {
  shape: circle
  class: initial
  label: ""
}

idle: Idle {
  shape: circle
  class: state
}

connecting: Connecting {
  shape: circle
  class: state
}

active: Active Streaming {
  shape: circle
  class: state
}

client_closing: Client Closing {
  shape: circle
  class: state
}

server_closing: Server Closing {
  shape: circle
  class: state
}

closed: Closed {
  shape: circle
  class: final
}

error: Error {
  shape: circle
  class: error
}

init -> idle: Create Stream {
  class: transition
}

idle -> connecting: Open Connection {
  class: transition
}

connecting -> active: Handshake Complete {
  class: transition
}

active -> active: Send/Receive Messages {
  class: transition
}

active -> client_closing: Client Sends Close {
  class: transition
}

active -> server_closing: Server Initiates Close {
  class: transition
}

client_closing -> closed: Server Acknowledges {
  class: transition
}

server_closing -> closed: Client Acknowledges {
  class: transition
}

connecting -> error: Connection Failed {
  class: error_transition
}

active -> error: Stream Error {
  class: error_transition
}

client_closing -> error: Close Timeout {
  class: error_transition
}

server_closing -> error: Close Timeout {
  class: error_transition
}

error -> closed: Cleanup Complete {
  class: transition
}

note: |md
  ## Bidirectional Stream States
  
  **Active**: Both client and server can send messages
  **Graceful Close**: Either party initiates close sequence
  **Error Handling**: Network failures or protocol violations
| {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: top-right
}