direction: right
vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 4
  }
}

# L0: Trace of Empty Input Padding (SHA-256)
# Reference: FIPS 180-4 Section 5.1.1

input_layer: {
  direction: down
  label: "INPUT STATE"
  
  message: {
    shape: rectangle
    label: "Empty Message (L=0 bits)"
    style: {
      stroke-dash: 5
      fill: "#f4f4f4"
    }
  }
  
  meta_data: {
    shape: sql_table
    label: "Metadata (sha256.c)"
    row1: "L | uint64_t | 0"
    row2: "k | uint32_t | 447"
    label_bottom: "k = (447 - L) mod 512"
  }
}

logic_layer: {
  direction: down
  label: "PADDING TRANSFORMATION"
  
  step1: {
    label: "Append '1' bit (0x80)"
    style.fill: "#E4DBFE"
  }
  step2: {
    label: "Append k zero bits (447 bits)"
    style.fill: "#DEE1EB"
  }
  step3: {
    label: "Append L (64-bit BE)"
    style.fill: "#C7F1FF"
  }
  
  step1 -> step2 -> step3
}

output_layer: {
  direction: down
  label: "RESULT: PADDED BLOCK 0"
  
  block_structure: {
    shape: sql_table
    label: "struct SHA256_Block (512 bits)"
    
    # Byte 0
    row_0: "0x00 | 0x80 | [1000 0000] '1' bit marker"
    
    # Bytes 1-55
    row_padding: "0x01-0x37 | 0x00 | Zero-fill (55 bytes)"
    
    # Bytes 56-63 (Length Field)
    row_len_msb: "0x38 | 0x00 | bit_length[63:56]"
    row_len_mid: "0x39-0x3E | 0x00 | bit_length[55:08]"
    row_len_lsb: "0x3F | 0x00 | bit_length[07:00]"
    
    row_0.style.fill: "#E4DBFE"
    row_padding.style.fill: "#DEE1EB"
    row_len_msb.style.fill: "#C7F1FF"
    row_len_mid.style.fill: "#C7F1FF"
    row_len_lsb.style.fill: "#C7F1FF"
    
    label_bottom: "Total: 64 bytes (512 bits)"
  }
}

# Connections with Type and Size
input_layer -> logic_layer: "L=0 bits | void* | NULL"
logic_layer -> output_layer: "uint8_t[64] | 512 bits | Block 0"

# Annotations
output_layer.block_structure.row_0 -> logic_layer.step1: "Rule 1" {
  style.stroke-dash: 3
}
output_layer.block_structure.row_padding -> logic_layer.step2: "Rule 2" {
  style.stroke-dash: 3
}
output_layer.block_structure.row_len_lsb -> logic_layer.step3: "Rule 3 (BE)" {
  style.stroke-dash: 3
}