direction: right
vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 4
  }
}

# L1: MAJORITY FUNCTION SPECIFICATION
maj_logic: {
  shape: class
  label: "Majority Function (sha256.c)"
  
  fields: |md
    c
    // Input Word Structure (32-bit word parallel)
    uint32_t x;  // 0x00 | Input A
    uint32_t y;  // 0x04 | Input B
    uint32_t z;  // 0x08 | Input C
    
  |
  
  methods: |md
    c
    /**
     * Standard: Maj(x, y, z) = (x & y) ^ (x & z) ^ (y & z)
     * Ops: 3 AND, 2 XOR
     */
    static uint32_t Maj(uint32_t x, uint32_t y, uint32_t z);

    /**
     * Optimized: Maj(x, y, z) = (x & y) | (z & (x | y))
     * Ops: 2 AND, 2 OR, 1 XOR-equiv
     */
    static uint32_t Maj_Alt(uint32_t x, uint32_t y, uint32_t z);
    
  |
  
  complexity: {
    label: "Logic Complexity: 5 Bitwise Operations"
    shape: text
    style: {
      font-size: 12
      italic: true
    }
  }
}

# L1: DATA EVALUATION (TRUTH TABLE)
truth_table: {
  shape: sql_table
  label: "Bitwise Truth Table (Per Bit i)"
  
  "Inputs [x, y, z]": "Output [Maj] | State"
  "0, 0, 0": "0 | All Zero"
  "0, 0, 1": "0 | Minority"
  "0, 1, 0": "0 | Minority"
  "0, 1, 1": "1 | Majority"
  "1, 0, 0": "0 | Minority"
  "1, 0, 1": "1 | Majority"
  "1, 1, 0": "1 | Majority"
  "1, 1, 1": "1 | All One"
  
  label_bottom: "Sum Threshold: bit_sum >= 2 | Total: 4 bytes"
}

# L1: HARDWARE ABSTRACTION
hardware_mapping: {
  direction: down
  label: "Hardware Implementation (L2 Micro-arch)"
  
  gate_logic: {
    direction: right
    label: "Gate Realization (Bit-Parallel)"
    
    input_bus: {
      x_i: "x[i]"
      y_i: "y[i]"
      z_i: "z[i]"
    }
    
    logic_unit: {
      shape: circle
      label: "Î£ >= 2"
      style: {
        fill: "#C7F1FF"
      }
    }
    
    output_bus: {
      res_i: "result[i]"
    }
    
    input_bus -> logic_unit: "3x 1-bit"
    logic_unit -> output_bus: "1-bit"
  }
  
  simd_view: {
    label: "Parallel Word Processing (32-bit)"
    instruction: |md
      text
      Word X: 11110000 11110000 11110000 11110000
      Word Y: 10101010 10101010 10101010 10101010
      Word Z: 11001100 11001100 11001100 11001100
      ------------------------------------------
      Result: 11101000 11101000 11101000 11101000
      
    |
  }
}

# CONNECTIONS & DATA FLOW
maj_logic -> truth_table: "uint32_t | 4 bytes | Defines Logic"
truth_table -> hardware_mapping: "Gate mapping | 1 clock cycle"

# STYLING & ANNOTATIONS
(maj_logic -> truth_table)[0].style: {
  stroke: "#88DCF7"
  stroke-width: 2
}

(truth_table -> hardware_mapping)[0].style: {
  stroke: "#88DCF7"
  stroke-width: 2
}

maj_logic.style.font-size: 14

truth_table.style: {
  stroke: "#4baae5"
}

# Legend for SHA-2 Rounds
legend: {
  near: bottom-right
  shape: text
  label: "SHA-2 Confusion Function: Maj(x,y,z) non-linearly combines bits to prevent differential cryptanalysis."
  style: {
    font-size: 11
  }
}