direction: right
vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 4
  }
}

title: |md
  # SHA-256 Initial Hash Values (IV)
  ## Derivation from Prime Square Roots (FIPS 180-4)
| {near: top-center}

# SECTION: Derivation Logic
derivation_process: {
  label: "Derivation Logic: H[0] Example (sha256.c)"
  direction: down
  style: {
    stroke-width: 2
  }

  step1: {
    label: "Step 1: Square Root of First Prime"
    content: |md
      c
      // Prime[0] = 2
      double val = sqrt(2.0); 
      // Result: 1.41421356237309504880...
      
    |
  }

  step2: {
    label: "Step 2: Isolate Fractional Part"
    content: |md
      c
      // f(x) = x - floor(x)
      double frac = val - (uint64_t)val;
      // Result: 0.41421356237309504880...
      
    |
  }

  step3: {
    label: "Step 3: Map to 32-bit Integer Space"
    content: |md
      c
      // Scale by 2^32
      uint64_t scaled = (uint64_t)(frac * 4294967296.0);
      // Result: 1779033703 (0x6A09E667)
      
    |
  }

  step4: {
    label: "Step 4: Final Hexadecimal Constant"
    content: |md
      c
      // SHA-256 IV Constant
      const uint32_t H0 = 0x6A09E667;
      
    |
  }

  step1 -> step2: "Isolate fraction"
  step2 -> step3: "Scale by 2^32"
  step3 -> step4: "Truncate to uint32"
}

# SECTION: State Representation
initial_values_table: {
  shape: sql_table
  label: "struct SHA256_CTX { uint32_t h[8]; } (sha256.h)"
  
  h0: "0x00 | uint32_t | h[0] = 0x6A09E667 (Prime: 2)"
  h1: "0x04 | uint32_t | h[1] = 0xBB67AE85 (Prime: 3)"
  h2: "0x08 | uint32_t | h[2] = 0x3C6EF372 (Prime: 5)"
  h3: "0x0C | uint32_t | h[3] = 0xA54FF53A (Prime: 7)"
  h4: "0x10 | uint32_t | h[4] = 0x510E527F (Prime: 11)"
  h5: "0x14 | uint32_t | h[5] = 0x9B05688C (Prime: 13)"
  h6: "0x18 | uint32_t | h[6] = 0x1F83D9AB (Prime: 17)"
  h7: "0x1C | uint32_t | h[7] = 0x5BE0CD19 (Prime: 19)"

  label_bottom: "Total State Size: 32 bytes (256 bits)"
}

# SECTION: Family Comparison
parameterization_context: {
  label: "SHA-2 Family Parameterization"
  direction: down

  sha256_spec: {
    label: "SHA-256 (Standard)"
    style.fill: "#C7F1FF"
    content: |md
      - **Primes**: 1..8
      - **Word Size**: 32-bit
      - **IV Source**: sqrt(primes)
      - **K[t] Source**: cbrt(primes)
    |
  }

  sha224_spec: {
    label: "SHA-224 (Modified IV)"
    style.fill: "#E4DBFE"
    content: |md
      - **Primes**: 9..16
      - **Word Size**: 32-bit
      - **Initial H**: 0xc1059ed8, 0x367cd507...
      - **Logic**: SHA-256 compression
    |
  }

  sha512_spec: {
    label: "SHA-512 (Extended)"
    style.fill: "#DEE1EB"
    content: |md
      - **Primes**: 1..8
      - **Word Size**: 64-bit
      - **IV Source**: sqrt(primes)
      - **Output**: 512-bit state
    |
  }

  sha256_spec -> sha224_spec: "Shared K[t] Constants"
  sha256_spec -> sha512_spec: "64-bit word upgrade"
}

# Data Flow Connections
derivation_process.step4 -> initial_values_table: "H[0..7] Initialization"
initial_values_table -> parameterization_context: "Baseline Implementation"

# Explanatory Notes
nothing_up_my_sleeve: |md
  ### "Nothing-Up-My-Sleeve" Numbers
  Verifiable derivation prevents the 
  insertion of cryptographic backdoors 
  in the algorithm's initial state.
| {
  # Fix: Changed near to constant for ELK compatibility
  near: top-left
  style: {
    stroke-dash: 3
    fill: "#FFF9C9"
  }
}