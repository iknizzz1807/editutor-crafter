direction: right
vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 4
  }
  colors: {
    header: "#D1C4E9" # Purple (Separator)
    data: "#BBDEFB"   # Blue (Message)
    padding: "#E0E0E0" # Gray (Zero Padding)
    length: "#FFE0B2" # Orange (Length field)
    border: "#424242"
  }
}

sha256_padding: {
  shape: package
  label: "SHA-256 PADDING STRATEGIES (FIPS 180-4 ยง5.1.1)"

  empty_msg: {
    label: "Example 1: Empty Input (N=0)"
    
    layout: {
      grid-columns: 1
      grid-gap: 0
      
      h: "Offset | Content | Size" {
        style: {
          fill: white
          bold: true
        }
      }
      
      row0: "0x00 | 0x80 (Separator) | 1 byte" {
        style.fill: ${colors.header}
      }
      
      row1: "0x01..0x37 | 0x00 (Zero Padding) | 55 bytes" {
        style.fill: ${colors.padding}
      }
      
      row2: "0x38..0x3F | 0x0000000000000000 (Length) | 8 bytes" {
        style.fill: ${colors.length}
      }
    }
    
    footer: "Total Size: 64 Bytes (512 bits)" {
      shape: text
      style.italic: true
    }
    
    style.stroke-dash: 3 # 64B Cache Line Boundary
  }

  abc_msg: {
    label: "Example 2: 'abc' Input (N=3)"
    
    layout: {
      grid-columns: 1
      grid-gap: 0
      
      h: "Offset | Content | Size" {
        style: {
          fill: white
          bold: true
        }
      }
      
      row0: "0x00..0x02 | 0x61 62 63 (Message) | 3 bytes" {
        style.fill: ${colors.data}
      }
      
      row1: "0x03 | 0x80 (Separator) | 1 byte" {
        style.fill: ${colors.header}
      }
      
      row2: "0x04..0x37 | 0x00 (Zero Padding) | 52 bytes" {
        style.fill: ${colors.padding}
      }
      
      row3: "0x38..0x3F | 0x0000000000000018 (Length: 24b) | 8 bytes" {
        style.fill: ${colors.length}
      }
    }
    
    footer: "Total Size: 64 Bytes (512 bits)" {
      shape: text
      style.italic: true
    }
    
    style.stroke-dash: 3 # 64B Cache Line Boundary
  }

  boundary_msg: {
    label: "Example 3: 55-Byte Boundary (N=55)"
    
    layout: {
      grid-columns: 1
      grid-gap: 0
      
      h: "Offset | Content | Size" {
        style: {
          fill: white
          bold: true
        }
      }
      
      row0: "0x00..0x36 | Message Data [0..54] | 55 bytes" {
        style.fill: ${colors.data}
      }
      
      row1: "0x37 | 0x80 (Separator) | 1 byte" {
        style.fill: ${colors.header}
      }
      
      row2: "0x38..0x3F | 0x00000000000001B8 (Length: 440b) | 8 bytes" {
        style.fill: ${colors.length}
      }
    }
    
    footer: "Padding absent; Msg + Sep + Len = 64B" {
      shape: text
      style.italic: true
    }
    
    style.stroke-dash: 3 # 64B Cache Line Boundary
  }
}

# Annotations for Engineers
legend: {
  near: bottom-right
  
  msg: "Message Data" { style.fill: ${colors.data} }
  sep: "Separator (0x80)" { style.fill: ${colors.header} }
  pad: "Zero Padding" { style.fill: ${colors.padding} }
  len: "Bit Length (BE)" { style.fill: ${colors.length} }
}

annotation: |md
  ### SHA256_Block Invariants
  - **Type**: `struct { uint8_t bytes[64]; }`
  - **Alignment**: 512-bit (64-byte) aligned for AVX/SHA-NI
  - **Endianness**: Big-Endian Length Field
  - **Constraint**: If `N > 55`, padding overflows into next block.
| {
  near: bottom-center
}