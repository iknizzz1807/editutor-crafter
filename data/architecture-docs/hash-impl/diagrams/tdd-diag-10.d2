direction: down
vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 4
  }
}

title: {
  shape: text
  near: top-center
  style: {
    font-color: "#663399"
    bold: true
  }
  label: ||md
    ### SHA-256 Message Schedule Expansion (W[0..19])
    **Test Vector:** "abc" | **Size:** 256 Bytes (64 words × 4B)
    *Recurrence: W[t] = σ1(W[t-2]) + W[t-7] + σ0(W[t-15]) + W[t-16]*
  ||
}

# -----------------------------------------------------------------------------
# INPUT WORDS (W[0..15]) - Blue Data Group
# -----------------------------------------------------------------------------
InputWords: {
  grid-columns: 8
  style: {
    stroke: "#336699"
    fill: "#f0f7ff"
    stroke-width: 2
  }

  W0: "W[0]\n0x61626380" { shape: circle; style.fill: "#CCE5FF" }
  W1: "W[1]\n0x00000000" { shape: circle }
  W2: "W[2]\n0x00000000" { shape: circle }
  W3: "W[3]\n0x00000000" { shape: circle }
  W4: "W[4]\n0x00000000" { shape: circle }
  W5: "W[5]\n0x00000000" { shape: circle }
  W6: "W[6]\n0x00000000" { shape: circle }
  W7: "W[7]\n0x00000000" { shape: circle }
  W8: "W[8]\n0x00000000" { shape: circle }
  W9: "W[9]\n0x00000000" { shape: circle }
  W10: "W[10]\n0x00000000" { shape: circle }
  W11: "W[11]\n0x00000000" { shape: circle }
  W12: "W[12]\n0x00000000" { shape: circle }
  W13: "W[13]\n0x00000000" { shape: circle }
  W14: "W[14]\n0x00000000" { shape: circle }
  W15: "W[15]\n0x00000018" { shape: circle; style.fill: "#CCE5FF" }
}

# -----------------------------------------------------------------------------
# EXPANDED WORDS (W[16..19]) - Red Changed Group
# -----------------------------------------------------------------------------
W16: "**W[16]**\n**0x61626380**" {
  shape: circle
  style: {
    fill: "#FFCCCC"
    stroke: "#CC0000"
    stroke-width: 3
  }
}

W17: "**W[17]**\n**0x000F0000**" {
  shape: circle
  style: {
    fill: "#FFCCCC"
    stroke: "#CC0000"
    stroke-width: 3
  }
}

W18: "**W[18]**\n**0x61706380**" {
  shape: circle
  style: {
    fill: "#FFCCCC"
    stroke: "#CC0000"
    stroke-width: 3
  }
}

W19: "**W[19]**\n**0x610E0000**" {
  shape: circle
  style: {
    fill: "#FFCCCC"
    stroke: "#CC0000"
    stroke-width: 3
  }
}

# -----------------------------------------------------------------------------
# DEPENDENCY EDGES
# -----------------------------------------------------------------------------

# W[16] Dependencies
InputWords.W14 -> W16: "σ1(W[t-2])" { style.stroke: orange }
InputWords.W9 -> W16: "W[t-7]"
InputWords.W1 -> W16: "σ0(W[t-15])" { style.stroke: orange }
InputWords.W0 -> W16: "W[t-16]"

# W[17] Dependencies
InputWords.W15 -> W17: "σ1(W[t-2])" { style.stroke: orange }
InputWords.W10 -> W17: "W[t-7]"
InputWords.W2 -> W17: "σ0(W[t-15])" { style.stroke: orange }
InputWords.W1 -> W17: "W[t-16]"

# W[18] Dependencies
W16 -> W18: "σ1(W[t-2])" { style.stroke: orange }
InputWords.W11 -> W18: "W[t-7]"
InputWords.W3 -> W18: "σ0(W[t-15])" { style.stroke: orange }
InputWords.W2 -> W18: "W[t-16]"

# W[19] Dependencies
W17 -> W19: "σ1(W[t-2])" { style.stroke: orange }
InputWords.W12 -> W19: "W[t-7]"
InputWords.W4 -> W19: "σ0(W[t-15])" { style.stroke: orange }
InputWords.W3 -> W19: "W[t-16]"

# -----------------------------------------------------------------------------
# ANNOTATIONS
# -----------------------------------------------------------------------------
Legend: {
  near: bottom-right
  "σ0": {
    shape: text
    label: "σ0(x) = ROTR(x, 7) ^ ROTR(x, 18) ^ SHR(x, 3)"
  }
  "σ1": {
    shape: text
    label: "σ1(x) = ROTR(x, 17) ^ ROTR(x, 19) ^ SHR(x, 10)"
  }
}

diffusion_note: {
  shape: text
  near: bottom-left
  style: {
    stroke: "#808080"
    stroke-dash: 3
  }
  label: ||md
    **The Diffusion Wave:** 
    A single-bit change in W[0] propagates to W[16], then ripples into 
    W[18] and beyond. By W[48], the avalanche effect typically saturates 
    all 32 bits of the schedule words.
  ||
}