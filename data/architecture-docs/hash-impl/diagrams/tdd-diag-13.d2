direction: right
vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 4
  }
}

title: |'md
  # SHA-256 COMPRESSION PRIMITIVE: Maj(a,b,c)
  **Definition:** `Maj(x, y, z) = (x & y) ^ (x & z) ^ (y & z)`
  *The Majority function returns 1 if two or more bits are 1.*
'| {near: top-center}

"1. TRUTH TABLE (8-BIT BITWISE EVALUATION)": {
  grid-columns: 8
  grid-gap: 0

  # HEADERS
  h1: "a" { style.fill: "#E1BEE7"; style.bold: true }
  h2: "b" { style.fill: "#E1BEE7"; style.bold: true }
  h3: "c" { style.fill: "#E1BEE7"; style.bold: true }
  h4: "a & b" { style.fill: "#D1C4E9"; style.italic: true }
  h5: "a & c" { style.fill: "#D1C4E9"; style.italic: true }
  h6: "b & c" { style.fill: "#D1C4E9"; style.italic: true }
  h7: "Maj" { style.fill: "#CE93D8"; style.bold: true }
  h8: "Count" { style.fill: "#F3E5F5" }

  # ROW 0
  r0_1: "0"; r0_2: "0"; r0_3: "0"; r0_4: "0"; r0_5: "0"; r0_6: "0"; r0_7: "0"; r0_8: "0"
  # ROW 1
  r1_1: "0"; r1_2: "0"; r1_3: "1"; r1_4: "0"; r1_5: "0"; r1_6: "0"; r1_7: "0"; r1_8: "1"
  # ROW 2
  r2_1: "0"; r2_2: "1"; r2_3: "0"; r2_4: "0"; r2_5: "0"; r2_6: "0"; r2_7: "0"; r2_8: "1"
  # ROW 3 (MAJORITY)
  r3_1: "**0**"; r3_2: "**1**"; r3_3: "**1**"; r3_4: "0"; r3_5: "0"; r3_6: "1"; r3_7: "**1**" {style: {font-color: red; fill: "#FFEBEE"}} ; r3_8: "2"
  # ROW 4
  r4_1: "1"; r4_2: "0"; r4_3: "0"; r4_4: "0"; r4_5: "0"; r4_6: "0"; r4_7: "0"; r4_8: "1"
  # ROW 5 (MAJORITY)
  r5_1: "**1**"; r5_2: "**0**"; r5_3: "**1**"; r5_4: "0"; r5_5: "1"; r5_6: "0"; r5_7: "**1**" {style: {font-color: red; fill: "#FFEBEE"}} ; r5_8: "2"
  # ROW 6 (MAJORITY)
  r6_1: "**1**"; r6_2: "**1**"; r6_3: "**0**"; r6_4: "1"; r6_5: "0"; r6_6: "0"; r6_7: "**1**" {style: {font-color: red; fill: "#FFEBEE"}} ; r6_8: "2"
  # ROW 7 (MAJORITY)
  r7_1: "**1**"; r7_2: "**1**"; r7_3: "**1**"; r7_4: "1"; r7_5: "1"; r7_6: "1"; r7_7: "**1**" {style: {font-color: red; fill: "#FFEBEE"}} ; r7_8: "3"
}

"2. CIRCUIT LOGIC (BIT-PARALLEL)": {
  Inputs: {
    a: "Word A (32-bit)" {shape: cylinder; style.fill: "#BBDEFB"}
    b: "Word B (32-bit)" {shape: cylinder; style.fill: "#BBDEFB"}
    c: "Word C (32-bit)" {shape: cylinder; style.fill: "#BBDEFB"}
  }

  Gates: {
    AND_AB: "AND" {shape: parallelogram; style.fill: "#C8E6C9"}
    AND_AC: "AND" {shape: parallelogram; style.fill: "#C8E6C9"}
    AND_BC: "AND" {shape: parallelogram; style.fill: "#C8E6C9"}
    
    XOR_1: "XOR" {shape: diamond; style.fill: "#FFF9C4"}
    XOR_2: "XOR" {shape: diamond; style.fill: "#FFF9C4"}
  }

  Inputs.a -> Gates.AND_AB
  Inputs.b -> Gates.AND_AB
  
  Inputs.a -> Gates.AND_AC
  Inputs.c -> Gates.AND_AC
  
  Inputs.b -> Gates.AND_BC
  Inputs.c -> Gates.AND_BC

  Gates.AND_AB -> Gates.XOR_1: "W_tmp1"
  Gates.AND_AC -> Gates.XOR_1: "W_tmp2"
  
  Gates.XOR_1 -> Gates.XOR_2: "W_partial"
  Gates.AND_BC -> Gates.XOR_2: "W_tmp3"

  Result: "Maj(a,b,c)" {
    shape: rectangle
    style: {
      fill: "#F44336"
      font-color: white
      bold: true
      stroke-width: 2
    }
  }

  Gates.XOR_2 -> Result
}

"3. ALTERNATIVE OPTIMIZED LOGIC": {
  Label: |'md
    **Alternative Formula:**
    `(a & (b | c)) | (b & c)`
    *Reduces XOR/AND operations from 5 to 4 total.*
  '|
  style.fill: "#F5F5F5"
  style.stroke-dash: 3
}

"1. TRUTH TABLE (8-BIT BITWISE EVALUATION)" -> "2. CIRCUIT LOGIC (BIT-PARALLEL)": "Implements" {
  style.stroke-dash: 5
}