direction: right
vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 4
  }
}

title: "Σ0 vs σ0 Constant Comparison — Visual Diff" {
  shape: text
  style: {
    font-size: 24
    bold: true
  }
}

comparison: {
  sigma0: "Step 1: σ0 (Message Schedule - Lower Case)" {
    style: {
      fill: "#f8f9fa"
      stroke: "#6f42c1"
      stroke-width: 2
    }

    op1: "ROTR(x, **7**)" {
      shape: rectangle
      style: {
        fill: "#e7f3ff"
        stroke: "red"
        bold: true
      }
    }
    op2: "ROTR(x, **18**)" {
      shape: rectangle
      style: {
        fill: "#e7f3ff"
        stroke: "red"
        bold: true
      }
    }
    op3: "SHR(x, **3**)" {
      shape: rectangle
      style: {
        fill: "#ffe7e7"
        stroke: "red"
        bold: true
      }
      bits_lost: "BITS DESTROYED" {
        shape: square
        style: {
          fill: "#6c757d"
          font-color: white
          font-size: 10
        }
      }
    }

    logic: "Non-Linear/Irreversible" {
      shape: text
      style: {
        font-color: red
        italic: true
      }
    }

    op1 -> logic
    op2 -> logic
    op3 -> logic
  }

  Sigma0: "Step 2: Σ0 (Compression - Upper Case)" {
    style: {
      fill: "#f8f9fa"
      stroke: "#007bff"
      stroke-width: 2
    }

    op1: "ROTR(x, **2**)" {
      shape: rectangle
      style: {
        fill: "#e7f3ff"
        stroke: "red"
        bold: true
      }
    }
    op2: "ROTR(x, **13**)" {
      shape: rectangle
      style: {
        fill: "#e7f3ff"
        stroke: "red"
        bold: true
      }
    }
    op3: "ROTR(x, **22**)" {
      shape: rectangle
      style: {
        fill: "#e7f3ff"
        stroke: "red"
        bold: true
      }
    }

    logic: "Linear/Invertible" {
      shape: text
      style: {
        font-color: green
        italic: true
      }
    }

    op1 -> logic
    op2 -> logic
    op3 -> logic
  }
}

annotation: |md
  ### Analysis
  - **σ (Lower)** uses **SHR** (Right-Shift): Bits shifted off the end are permanently destroyed. This introduces non-linearity and prevents the message schedule from being easily reversed.
  - **Σ (Upper)** uses only **ROTR** (Right-Rotate): All 32 bits of information are preserved, just moved to new positions for maximum diffusion.

  **CRITICAL BUG WARNING:**
  Naming your compression function `sigma0()` instead of `Sigma0()` is the **#1 source of silent hash failures**. If your hash is wrong, check these constants first!
| {
  near: bottom-center
}

comparison.sigma0.op3.bits_lost -> comparison.sigma0.logic: "Info Loss" {
  style: {
    stroke: red
    stroke-dash: 3
  }
}