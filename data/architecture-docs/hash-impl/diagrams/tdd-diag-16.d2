direction: right
vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 6
  }
}

# SHA-256 Round Transformation - Technical Specification
title: |md
  ### SHA-256 Working Variable Rotation (Round t)
  *Intel-grade Register State Transition Diagram*
  **sizeof = 256 bits (8 x 32-bit registers)**
| {near: top-center}

# 1. State Container: Before Transition
BEFORE_STATE: {
  label: "STEP N: REGISTER STATE (T)"
  style.fill: "#f3f0ff"
  style.stroke: "#6e4ba3"
  style.stroke-width: 2

  grid: {
    grid-columns: 1
    grid-gap: 0

    a: "a (H0)" { shape: rectangle; style.fill: "#D0E1F9"; style.stroke: "#4D648D" }
    b: "b (H1)" { shape: rectangle; style.fill: "#D0E1F9"; style.stroke: "#4D648D" }
    c: "c (H2)" { shape: rectangle; style.fill: "#D0E1F9"; style.stroke: "#4D648D" }
    d: "d (H3)" { shape: rectangle; style.fill: "#D0E1F9"; style.stroke: "#4D648D" }
    e: "e (H4)" { shape: rectangle; style.fill: "#D0E1F9"; style.stroke: "#4D648D" }
    f: "f (H5)" { shape: rectangle; style.fill: "#D0E1F9"; style.stroke: "#4D648D" }
    g: "g (H6)" { shape: rectangle; style.fill: "#D0E1F9"; style.stroke: "#4D648D" }
    h: "h (H7)" { shape: rectangle; style.fill: "#D0E1F9"; style.stroke: "#4D648D" }

    *.width: 200
    *.height: 40
  }
}

# 2. State Container: After Transition
AFTER_STATE: {
  label: "STEP N+1: REGISTER STATE (T+1)"
  style.fill: "#f3f0ff"
  style.stroke: "#6e4ba3"
  style.stroke-width: 2

  grid: {
    grid-columns: 1
    grid-gap: 0

    a_new: "**a' = T1 + T2**" { 
      shape: rectangle
      style.fill: "#FFDADA"
      style.stroke: "#B22222"
      style.stroke-width: 4
      style.bold: true
    }
    b_new: "b' = a" { shape: rectangle; style.fill: "#D0E1F9"; style.stroke: "#4D648D" }
    c_new: "c' = b" { shape: rectangle; style.fill: "#D0E1F9"; style.stroke: "#4D648D" }
    d_new: "d' = c" { shape: rectangle; style.fill: "#D0E1F9"; style.stroke: "#4D648D" }
    e_new: "**e' = d + T1**" { 
      shape: rectangle
      style.fill: "#FFDADA"
      style.stroke: "#B22222"
      style.stroke-width: 4
      style.bold: true
    }
    f_new: "f' = e" { shape: rectangle; style.fill: "#D0E1F9"; style.stroke: "#4D648D" }
    g_new: "g' = f" { shape: rectangle; style.fill: "#D0E1F9"; style.stroke: "#4D648D" }
    h_new: "h' = g" { shape: rectangle; style.fill: "#D0E1F9"; style.stroke: "#4D648D" }

    *.width: 200
    *.height: 40
  }
}

# 3. Positional Logic Annotations
round_logic: "Round Function Components" {
  T1: "T1 = h + Σ1(e) + Ch(e,f,g) + Kt + Wt"
  T2: "T2 = Σ0(a) + Maj(a,b,c)"
  style.fill: "#E4DBFE"
  style.stroke: "#6e4ba3"
}
round_logic.near: top-left

data_specs: |md
  ### Register Invariants
  - **Word Size**: 32-bit Unsigned Integer
  - **Arithmetic**: Addition modulo $2^{32}$
  - **Shift/Rotate**: Standard logical shifts
| {near: bottom-right}

# 4. Connections & Data Flow
BEFORE_STATE.grid.a -> AFTER_STATE.grid.b_new: { style.stroke: "#FFA500" }
BEFORE_STATE.grid.b -> AFTER_STATE.grid.c_new: { style.stroke: "#FFA500" }
BEFORE_STATE.grid.c -> AFTER_STATE.grid.d_new: { style.stroke: "#FFA500" }
BEFORE_STATE.grid.e -> AFTER_STATE.grid.f_new: { style.stroke: "#FFA500" }
BEFORE_STATE.grid.f -> AFTER_STATE.grid.g_new: { style.stroke: "#FFA500" }
BEFORE_STATE.grid.g -> AFTER_STATE.grid.h_new: { style.stroke: "#FFA500" }

# Injection Flows (T1/T2)
BEFORE_STATE.grid.d -> AFTER_STATE.grid.e_new: "MODULAR SUM (d + T1)" {
  style.stroke: "#B22222"
  style.stroke-width: 3
  style.animated: true
}

BEFORE_STATE.grid.h -> AFTER_STATE.grid.a_new: "MODULAR SUM (T1 + T2)" {
  style.stroke: "#B22222"
  style.stroke-width: 3
  style.animated: true
}

# Metadata Annotations
bit_marker: "Offset: 0..31" {
  near: top-left
  shape: text
  style.font-size: 12
}

total_size: "Total Size: 32 Bytes" {
  near: bottom-right
  shape: text
  style.font-size: 14
  style.bold: true
}