layout-engine: elk
vars: {
  d2-config: {
    theme-id: 0
  }
}

padded_block: "SHA-256 Padded Block for 'abc'" {
  style: {
    stroke-width: 4
    stroke-dash: 5
  }

  memory_grid: {
    grid-columns: 3
    grid-gap: 0

    # Header Row
    "OFFSET": {shape: text; style: {bold: true; font-size: 14}}
    "MEMORY CONTENT": {shape: text; style: {bold: true; font-size: 14}}
    "SIZE": {shape: text; style: {bold: true; font-size: 14}}

    # Message Data (Blue)
    off0: "0x00" {shape: text}
    msg: "Message Data: 'abc' (0x61 62 63)" {
      style: {
        fill: "#3498db"
        font-color: white
        stroke: black
      }
    }
    sz0: "3 Bytes" {shape: text}

    # '1' bit Marker (Purple)
    off1: "0x03" {shape: text}
    marker: "Marker Byte (0x80)" {
      style: {
        fill: "#9b59b6"
        font-color: white
        stroke: black
      }
    }
    sz1: "1 Byte" {shape: text}

    # Zero Fill (Gray)
    off2: "0x04" {shape: text}
    padding: "Zero Padding (0x00...0x00)" {
      style: {
        fill: "#bdc3c7"
        stroke: black
      }
    }
    sz2: "52 Bytes" {shape: text}

    # Length Field (Purple)
    off3: "0x38" {shape: text}
    len: "64-bit Bit Length (0x0000000000000018)" {
      style: {
        fill: "#9b59b6"
        font-color: white
        stroke: black
      }
    }
    sz3: "8 Bytes" {shape: text}
    
    # Final Offset Reference
    off4: "0x3F" {shape: text}
    boundary: "Block End (512-bit boundary)" {
      style: {
        fill: transparent
        stroke-dash: 2
      }
    }
    sz4: "0 Bytes" {shape: text}
  }
}

# Footer must be at root level to use global 'near' positioning
footer: |md
  **Total Size**: 64 Bytes (512 bits / 1 Cache Line)
  **Alignment**: 64-byte aligned
  **Endianness**: Big-Endian (FIPS 180-4)
| {
  shape: text
  near: bottom-center
}

# Legend for clarity
legend: {
  near: bottom-right
  label: "Legend"
  data: "Data" { style.fill: "#3498db" }
  header: "Header/Meta" { style.fill: "#9b59b6" }
  padding: "Padding" { style.fill: "#bdc3c7" }
}