vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 4
  }
}

layout-engine: elk
theme-id: 4

title: |md
  # Algorithm Steps: Padding Length & Zero-Fill Calculation
  **Spec:** Ceiling Division Idiom: `total = ((L + 9 + 63) / 64) * 64`
| {near: top-center}

classes: {
  state_box: {
    style: {
      fill: "#f8f9fa"
      stroke: "#343a40"
      stroke-width: 2
      font-size: 14
      font: mono
    }
  }
  changed: {
    style: {
      stroke: "#d00000"
      font-color: "#d00000"
      bold: true
      stroke-width: 3
    }
  }
  header_purple: {
    style: {
      fill: "#6f42c1"
      font-color: white
      bold: true
    }
  }
}

step_1: "1. Calculate Total Padded Size (T)" {
  direction: right
  before: "BEFORE: Input L" {
    class: header_purple
    grid-columns: 5
    L0: "L=0"; L3: "L=3"; L55: "L=55"; L56: "L=56"; L64: "L=64"
    L0.class: state_box; L3.class: state_box; L55.class: state_box; L56.class: state_box; L64.class: state_box
  }
  after: "AFTER: Result T" {
    class: header_purple
    grid-columns: 5
    T0: "T=64"; T3: "T=64"; T55: "T=64"; T56: "T=128"; T64: "T=128"
    T0.class: [state_box; changed]
    T3.class: [state_box; changed]
    T55.class: [state_box; changed]
    T56.class: [state_box; changed]
    T64.class: [state_box; changed]
  }
  before -> after: "total = ((L+72)/64)*64" {
    style: {
      font-size: 14
      bold: true
    }
  }
}

step_2: "2. Locate Zero-Fill Start" {
  direction: right
  before: "BEFORE: L-Bound" {
    class: header_purple
    grid-columns: 5
    L0_2: "L=0"; L3_2: "L=3"; L55_2: "L=55"; L56_2: "L=56"; L64_2: "L=64"
    L0_2.class: state_box; L3_2.class: state_box; L55_2.class: state_box; L56_2.class: state_box; L64_2.class: state_box
  }
  after: "AFTER: zero_start" {
    class: header_purple
    grid-columns: 5
    S0: "idx=1"; S3: "idx=4"; S55: "idx=56"; S56: "idx=57"; S64: "idx=65"
    S0.class: [state_box; changed]
    S3.class: [state_box; changed]
    S55.class: [state_box; changed]
    S56.class: [state_box; changed]
    S64.class: [state_box; changed]
  }
  before -> after: "offset past 0x80"
}

step_3: "3. Locate Zero-Fill End" {
  direction: right
  before: "BEFORE: Total T" {
    class: header_purple
    grid-columns: 5
    T0_3: "64"; T3_3: "64"; T55_3: "64"; T56_3: "128"; T64_3: "128"
    T0_3.class: state_box; T3_3.class: state_box; T55_3.class: state_box; T56_3.class: state_box; T64_3.class: state_box
  }
  after: "AFTER: zero_end" {
    class: header_purple
    grid-columns: 5
    E0: "idx=56"; E3: "idx=56"; E55: "idx=56"; E56: "idx=120"; E64: "idx=120"
    E0.class: [state_box; changed]
    E3.class: [state_box; changed]
    E55.class: [state_box; changed]
    E56.class: [state_box; changed]
    E64.class: [state_box; changed]
  }
  before -> after: "reserve 8B tail"
}

step_4: "4. Compute Final Zero Count" {
  direction: right
  before: "BEFORE: [Start..End]" {
    class: header_purple
    grid-columns: 5
    SE0: "1..56"; SE3: "4..56"; SE55: "56..56"; SE56: "57..120"; SE64: "65..120"
    SE0.class: state_box; SE3.class: state_box; SE55.class: state_box; SE56.class: state_box; SE64.class: state_box
  }
  after: "AFTER: count" {
    class: header_purple
    grid-columns: 5
    C0: "55"; C3: "52"; C55: "0"; C56: "63"; C64: "55"
    C0.class: [state_box; changed]
    C3.class: [state_box; changed]
    C55.class: [state_box; changed]
    C56.class: [state_box; changed]
    C64.class: [state_box; changed]
  }
  before -> after: "End - Start"
}

step_1 -> step_2 -> step_3 -> step_4

***.style.font: mono

step_1.style.stroke: "#495057"
step_2.style.stroke: "#495057"
step_3.style.stroke: "#495057"
step_4.style.stroke: "#495057"