layout-engine: elk
theme-id: 4

"Algorithm Steps â€” ROTR vs SHR on a 32-bit Value": {
  near: top-center
  shape: text
  style.font-size: 24
  style.bold: true
}

comparison: {
  grid-columns: 2
  grid-gap: 50

  logical_shift: {
    label: "SHR(x, 7): Logical Right Shift"
    
    step1: {
      label: "Step 1: Initial State (0x61626380)"
      reg: {
        grid-columns: 32
        grid-gap: 0
        b31: "0"; b30: "1"; b29: "1"; b28: "0"; b27: "0"; b26: "0"; b25: "0"; b24: "1"
        b23: "0"; b22: "1"; b21: "1"; b20: "0"; b19: "0"; b18: "0"; b17: "1"; b16: "0"
        b15: "0"; b14: "1"; b13: "1"; b12: "0"; b11: "0"; b10: "0"; b09: "1"; b08: "1"
        b07: "1"; b06: "0"; b05: "0"; b04: "0"; b03: "0"; b02: "0"; b01: "0"; b00: "0"
      }
      indices: {
        label: "Bits 31 .. 0"
        shape: text
      }
    }

    step2: {
      label: "Step 2: Shift 7 Positions Right"
      reg: {
        grid-columns: 32
        grid-gap: 0
        # New Zeros in Red/Bold
        n31: "0" { style: { font-color: red; bold: true } }
        n30: "0" { style: { font-color: red; bold: true } }
        n29: "0" { style: { font-color: red; bold: true } }
        n28: "0" { style: { font-color: red; bold: true } }
        n27: "0" { style: { font-color: red; bold: true } }
        n26: "0" { style: { font-color: red; bold: true } }
        n25: "0" { style: { font-color: red; bold: true } }
        # Shifted bits
        n24: "0"; n23: "1"; n22: "1"; n21: "0"; n20: "0"; n19: "0"; n18: "0"; n17: "1"
        n16: "0"; n15: "1"; n14: "1"; n13: "0"; n12: "0"; n11: "0"; n10: "1"; n09: "0"
        n08: "0"; n07: "1"; n06: "1"; n05: "0"; n04: "0"; n03: "0"; n02: "1"; n01: "1"
        n00: "1" 
      }
      annotation: {
        label: |md
          **Discarded Bits [6..0]:**
          `0000000`
        |
        shape: text
        style.font-color: gray
      }
    }
    
    step1.reg -> step2.reg: "x >> 7" {
      style.stroke-dash: 3
    }
  }

  circular_rotation: {
    label: "ROTR(x, 7): Circular Rotation"
    
    step1: {
      label: "Step 1: Isolate Parts"
      parts: {
        grid-columns: 2
        high: "Bits [31..7]" { style.fill: "#DEE1EB" }
        low: "Bits [6..0]" { style.fill: "#B5AFF6" }
      }
    }

    step2: {
      label: "Step 2: Rotate and Recombine"
      reg: {
        grid-columns: 32
        grid-gap: 0
        # Wrapped Bits (from 0-6 to 31-25) in Red/Bold
        w31: "0" { style: { font-color: red; bold: true; fill: "#B5AFF6" } }
        w30: "0" { style: { font-color: red; bold: true; fill: "#B5AFF6" } }
        w29: "0" { style: { font-color: red; bold: true; fill: "#B5AFF6" } }
        w28: "0" { style: { font-color: red; bold: true; fill: "#B5AFF6" } }
        w27: "0" { style: { font-color: red; bold: true; fill: "#B5AFF6" } }
        w26: "0" { style: { font-color: red; bold: true; fill: "#B5AFF6" } }
        w25: "0" { style: { font-color: red; bold: true; fill: "#B5AFF6" } }
        # Shifted High bits
        s24: "0"; s23: "1"; s22: "1"; s21: "0"; s20: "0"; s19: "0"; s18: "0"; s17: "1"
        s16: "0"; s15: "1"; s14: "1"; s13: "0"; s12: "0"; s11: "0"; s10: "1"; s09: "0"
        s08: "0"; s07: "1"; s06: "1"; s05: "0"; s04: "0"; s03: "0"; s02: "1"; s01: "1"
        s00: "1"
      }
      formula: {
        label: |md
          `(x >> 7) | (x << 25)`
        |
        shape: text
        style.bold: true
      }
    }

    step1.parts.low -> step2.reg: "Wrap to MSB" {
      style.stroke: blue
      style.animated: true
    }
    step1.parts.high -> step2.reg: "Shift to LSB" {
      style.stroke: gray
    }
  }
}

explanation: {
  label: |md
    ### Bitwise Comparison
    1. **SHR (Shift Right)**:
       - Positions [31..25] are filled with **0**.
       - Bits [6..0] are lost forever.
       - Result: `0x00C2C4C7` (for 0x61626380)
    
    2. **ROTR (Rotate Right)**:
       - Positions [31..25] are filled with the **original [6..0]**.
       - No information is lost (reversable).
       - Result: `0x00C2C4C7` (coincidentally same here as trailing bits were 0)
  |
  near: comparison
  width: 400
}

# Style overrides for the bit cells
comparison.**.reg.*: {
  width: 25
  height: 25
  style.font-size: 12
}