classes: {
  primary_component: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  secondary_component: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  data_flow: {
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  control_flow: {
    style.stroke: "#ffa502"
    style.font-color: "#e6edf3"
  }
}

title: HTTP/2 Server Component Architecture {
  near: top-center
  style.font-size: 18
  style.font-color: "#e6edf3"
  style.bold: true
}

tcp_layer: TCP Layer {
  class: secondary_component
  
  connection_handler: Connection Handler {
    class: primary_component
  }
  
  tcp_socket: TCP Socket {
    class: secondary_component
  }
  
  tcp_socket -> connection_handler: raw bytes {
    class: data_flow
  }
}

protocol_layer: Protocol Layer {
  class: secondary_component
  
  frame_parser: Frame Parser {
    class: primary_component
  }
  
  hpack_engine: HPACK Engine {
    class: primary_component
  }
  
  frame_parser -> hpack_engine: header blocks {
    class: data_flow
  }
  
  hpack_engine -> frame_parser: compressed headers {
    class: data_flow
  }
}

stream_layer: Stream Management {
  class: secondary_component
  
  stream_manager: Stream Manager {
    class: primary_component
  }
  
  flow_controller: Flow Controller {
    class: primary_component
  }
  
  stream_manager -> flow_controller: flow control events {
    class: control_flow
  }
  
  flow_controller -> stream_manager: window updates {
    class: control_flow
  }
}

application_layer: Application Layer {
  class: secondary_component
  
  request_handler: Request Handler {
    class: secondary_component
  }
  
  response_builder: Response Builder {
    class: secondary_component
  }
  
  request_handler -> response_builder: response data {
    class: data_flow
  }
}

tcp_layer.connection_handler -> protocol_layer.frame_parser: binary frames {
  class: data_flow
}

protocol_layer.frame_parser -> stream_layer.stream_manager: parsed frames {
  class: data_flow
}

stream_layer.stream_manager -> application_layer.request_handler: HTTP requests {
  class: data_flow
}

application_layer.response_builder -> stream_layer.stream_manager: HTTP responses {
  class: data_flow
}

stream_layer.stream_manager -> protocol_layer.frame_parser: response frames {
  class: data_flow
}

protocol_layer.frame_parser -> tcp_layer.connection_handler: encoded frames {
  class: data_flow
}

tcp_layer.connection_handler -> tcp_layer.tcp_socket: response bytes {
  class: data_flow
}

legend: |md
  **Data Flow Legend**
  → Binary data processing
  → Frame parsing & encoding
  → Stream multiplexing
  → Flow control management
| {
  near: bottom-right
  class: secondary_component
  shape: page
}