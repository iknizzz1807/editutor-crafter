title: Flow Control Window Management

classes: {
  connection_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  stream_style: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  frame_style: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  window_style: {
    style.fill: "#2d3748"
    style.stroke: "#e53e3e"
    style.font-color: "#e6edf3"
  }
}

connection: HTTP/2 Connection {
  class: connection_style
  
  connection_window: Connection Flow Window {
    class: window_style
    initial_size: 65535 bytes
    current_available: variable
  }
  
  streams: Stream Multiplexer {
    class: connection_style
    
    stream_1: Stream 1 {
      class: stream_style
      
      stream_1_window: Stream Flow Window {
        class: window_style
        initial_size: 65535 bytes
        current_available: variable
      }
      
      data_frames_1: DATA Frames {
        class: frame_style
      }
    }
    
    stream_3: Stream 3 {
      class: stream_style
      
      stream_3_window: Stream Flow Window {
        class: window_style
        initial_size: 65535 bytes
        current_available: variable
      }
      
      data_frames_3: DATA Frames {
        class: frame_style
      }
    }
    
    stream_5: Stream 5 {
      class: stream_style
      
      stream_5_window: Stream Flow Window {
        class: window_style
        initial_size: 65535 bytes
        current_available: variable
      }
      
      data_frames_5: DATA Frames {
        class: frame_style
      }
    }
  }
  
  window_update_handler: WINDOW_UPDATE Handler {
    class: frame_style
  }
}

receiver: Receiver {
  class: connection_style
  
  buffer_manager: Buffer Manager {
    class: stream_style
  }
  
  window_update_sender: WINDOW_UPDATE Sender {
    class: frame_style
  }
}

# Data flow and window updates
stream_1.data_frames_1 -> connection.connection_window: consumes bytes
stream_3.data_frames_3 -> connection.connection_window: consumes bytes
stream_5.data_frames_5 -> connection.connection_window: consumes bytes

stream_1.data_frames_1 -> stream_1.stream_1_window: consumes bytes
stream_3.data_frames_3 -> stream_3.stream_3_window: consumes bytes
stream_5.data_frames_5 -> stream_5.stream_5_window: consumes bytes

connection.connection_window -> receiver: enforces connection limit
stream_1.stream_1_window -> receiver: enforces stream limit
stream_3.stream_3_window -> receiver: enforces stream limit
stream_5.stream_5_window -> receiver: enforces stream limit

receiver.buffer_manager -> receiver.window_update_sender: triggers updates
receiver.window_update_sender -> connection.window_update_handler: WINDOW_UPDATE(stream_id=0)
receiver.window_update_sender -> connection.window_update_handler: WINDOW_UPDATE(stream_id=N)

connection.window_update_handler -> connection.connection_window: replenishes connection window
connection.window_update_handler -> stream_1.stream_1_window: replenishes stream window
connection.window_update_handler -> stream_3.stream_3_window: replenishes stream window
connection.window_update_handler -> stream_5.stream_5_window: replenishes stream window

note: |md
  **Flow Control Layers**
  
  Connection-level: Aggregate limit across all streams
  Stream-level: Individual stream limits prevent starvation
  
  **Credit-Based System**
  Receivers grant transmission permission via WINDOW_UPDATE frames
| {
  shape: page
  near: top-right
  class: frame_style
}