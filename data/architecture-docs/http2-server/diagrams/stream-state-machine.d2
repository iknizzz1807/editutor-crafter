title: HTTP/2 Stream State Machine

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  initial_state: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#1a1a2e"
    style.bold: true
  }
  final_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
    style.double-border: true
  }
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

init: {
  shape: circle
  class: initial_state
  label: ""
}

idle: IDLE {
  shape: circle
  class: state
}

reserved_local: "RESERVED\n(local)" {
  shape: circle
  class: state
}

reserved_remote: "RESERVED\n(remote)" {
  shape: circle
  class: state
}

open: OPEN {
  shape: circle
  class: state
}

half_closed_local: "HALF-CLOSED\n(local)" {
  shape: circle
  class: state
}

half_closed_remote: "HALF-CLOSED\n(remote)" {
  shape: circle
  class: state
}

closed: CLOSED {
  shape: circle
  class: final_state
}

init -> idle: {
  class: transition
}

idle -> reserved_local: PUSH_PROMISE {
  class: transition
}

idle -> reserved_remote: "recv PUSH_PROMISE" {
  class: transition
}

idle -> open: "HEADERS (start)" {
  class: transition
}

reserved_local -> half_closed_remote: HEADERS {
  class: transition
}

reserved_remote -> closed: RST_STREAM {
  class: transition
}

reserved_remote -> half_closed_local: "recv HEADERS" {
  class: transition
}

open -> half_closed_local: "END_STREAM\n(send)" {
  class: transition
}

open -> half_closed_remote: "recv END_STREAM" {
  class: transition
}

open -> closed: RST_STREAM {
  class: transition
}

half_closed_local -> closed: "recv END_STREAM" {
  class: transition
}

half_closed_remote -> closed: "END_STREAM\n(send)" {
  class: transition
}

half_closed_local -> closed: RST_STREAM {
  class: transition
}

half_closed_remote -> closed: RST_STREAM {
  class: transition
}

idle -> closed: RST_STREAM {
  class: transition
}

note: |md
  **Stream States:**
  • **IDLE**: Stream exists but no frames sent
  • **RESERVED**: Stream reserved via PUSH_PROMISE
  • **OPEN**: Bidirectional frame exchange allowed
  • **HALF-CLOSED**: One direction closed, other open
  • **CLOSED**: Stream completely terminated
| {
  shape: page
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: bottom-center
}