classes: {
  container_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  class_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  inheritance_style: {
    style.stroke: "#3fb950"
    style.stroke-width: 2
    style.font-color: "#3fb950"
  }
  
  composition_style: {
    style.stroke: "#8b949e"
    style.stroke-dash: 3
  }
}

direction: down

title: TLS Data Structure Relationships {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

tls_record: TLSRecord {
  shape: class
  class: class_style
  - "content_type: u8"
  - "version: TLSVersion"
  - "length: u16"
  - "payload: Vec<u8>"
  + "parse(data: &[u8]): Result<TLSRecord>"
  + "serialize(): Vec<u8>"
  + "validate(): bool"
}

handshake_message: HandshakeMessage {
  shape: class
  class: class_style
  - "msg_type: HandshakeType"
  - "length: u32"
  - "body: Vec<u8>"
  + "parse(data: &[u8]): Result<HandshakeMessage>"
  + "serialize(): Vec<u8>"
  + "get_type(): HandshakeType"
}

client_hello: ClientHello {
  shape: class
  class: class_style
  - "version: TLSVersion"
  - "random: [u8; 32]"
  - "session_id: Vec<u8>"
  - "cipher_suites: Vec<CipherSuite>"
  - "extensions: Vec<Extension>"
  + "new(version: TLSVersion): ClientHello"
  + "add_extension(ext: Extension)"
  + "serialize(): Vec<u8>"
}

server_hello: ServerHello {
  shape: class
  class: class_style
  - "version: TLSVersion"
  - "random: [u8; 32]"
  - "session_id: Vec<u8>"
  - "cipher_suite: CipherSuite"
  - "extensions: Vec<Extension>"
  + "parse(data: &[u8]): Result<ServerHello>"
  + "get_cipher_suite(): CipherSuite"
  + "validate(): bool"
}

certificate: Certificate {
  shape: class
  class: class_style
  - "certificates: Vec<X509Certificate>"
  - "certificate_type: CertificateType"
  + "parse(data: &[u8]): Result<Certificate>"
  + "verify_chain(): Result<()>"
  + "get_public_key(): PublicKey"
  + "validate_hostname(hostname: &str): bool"
}

crypto_state: CryptoState {
  shape: class
  class: class_style
  - "cipher_suite: CipherSuite"
  - "client_random: [u8; 32]"
  - "server_random: [u8; 32]"
  - "master_secret: [u8; 48]"
  - "client_write_key: Vec<u8>"
  - "server_write_key: Vec<u8>"
  - "sequence_number: u64"
  + "derive_keys(pre_master: &[u8])"
  + "encrypt(data: &[u8]): Vec<u8>"
  + "decrypt(data: &[u8]): Result<Vec<u8>>"
}

handshake_message -> client_hello: inherits {
  class: inheritance_style
}

handshake_message -> server_hello: inherits {
  class: inheritance_style
}

handshake_message -> certificate: inherits {
  class: inheritance_style
}

tls_record -> handshake_message: contains {
  class: composition_style
}

tls_record -> crypto_state: uses {
  class: composition_style
}

legend: Legend {
  shape: rectangle
  class: container_style
  near: bottom-right
  
  legend.inheritance_line: "Inherits" {
    style.stroke: "#3fb950"
    style.font-color: "#3fb950"
  }
  
  legend.composition_line: "Contains/Uses" {
    style.stroke: "#8b949e"
    style.font-color: "#8b949e"
  }
}