title: TLS 1.3 Key Derivation Process

classes: {
  secret: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
    shape: oval
  }
  function: {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    shape: rectangle
  }
  output: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    shape: rectangle
  }
}

ecdhe_shared: ECDHE\nShared Secret {
  class: secret
}

early_secret: Early Secret {
  class: secret
}

derive_handshake_secret: HKDF-Extract\n(Early Secret, ECDHE Secret) {
  class: function
}

handshake_secret: Handshake Secret {
  class: secret
}

derive_handshake_keys: HKDF-Expand-Label\n(Handshake Secret) {
  class: function
}

client_handshake_keys: Client Handshake\nTraffic Key + IV {
  class: output
}

server_handshake_keys: Server Handshake\nTraffic Key + IV {
  class: output
}

derive_master_secret: HKDF-Extract\n(Handshake Secret, 0) {
  class: function
}

master_secret: Master Secret {
  class: secret
}

derive_application_keys: HKDF-Expand-Label\n(Master Secret) {
  class: function
}

client_app_keys: Client Application\nTraffic Key + IV {
  class: output
}

server_app_keys: Server Application\nTraffic Key + IV {
  class: output
}

resumption_master_secret: Resumption\nMaster Secret {
  class: output
}

salt_input: Salt: 0x00... {
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  shape: parallelogram
}

zero_input: Input: 0x00... {
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  shape: parallelogram
}

salt_input -> early_secret: HKDF-Extract
early_secret -> derive_handshake_secret
ecdhe_shared -> derive_handshake_secret
derive_handshake_secret -> handshake_secret

handshake_secret -> derive_handshake_keys
derive_handshake_keys -> client_handshake_keys: client_handshake_traffic_secret
derive_handshake_keys -> server_handshake_keys: server_handshake_traffic_secret

handshake_secret -> derive_master_secret
zero_input -> derive_master_secret
derive_master_secret -> master_secret

master_secret -> derive_application_keys
derive_application_keys -> client_app_keys: client_application_traffic_secret
derive_application_keys -> server_app_keys: server_application_traffic_secret
derive_application_keys -> resumption_master_secret: resumption_master_secret