title: Flowchart: Configuration Parsing and Resolution

direction: right

# Start and End
start: Start {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.bold: true
}
end: "End: Final Resource Collection" {
  shape: oval
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.bold: true
}

# Main Process Steps
load_config: "Load Root Configuration (e.g., main.hcl)" {
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}
parse_ast: "Parse Configuration into AST" {
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}
init_traversal: "Initialize AST Traversal" {
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}
traverse_node: "Traverse to Next AST Node" {
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}
resolve_var: "Resolve Variable Reference" {
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}
substitute_var: "Substitute Variable Value" {
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}
handle_default: "Handle Error/Use Default" {
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}
load_module: "Load Module Configuration" {
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}
parse_module: "Parse Module AST" {
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}
merge_resources: "Merge Resources into Collection" {
  style.fill: "#1a1a2e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

# Decision Diamonds
var_ref_decision: "Variable Reference?" {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
var_found_decision: "Variable Found?" {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
module_block_decision: "Module Block?" {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
nodes_remaining: "More Nodes in AST?" {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}
modules_remaining: "More Module Blocks?" {
  shape: diamond
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# Flow Connections
start -> load_config
load_config -> parse_ast
parse_ast -> init_traversal
init_traversal -> traverse_node

traverse_node -> var_ref_decision

var_ref_decision -> resolve_var: Yes
resolve_var -> var_found_decision
var_found_decision -> substitute_var: Yes
var_found_decision -> handle_default: No
substitute_var -> nodes_remaining
handle_default -> nodes_remaining

var_ref_decision -> module_block_decision: No

module_block_decision -> load_module: Yes
load_module -> parse_module
parse_module -> init_traversal: "Recursive Traversal"
module_block_decision -> nodes_remaining: No

nodes_remaining -> traverse_node: Yes
nodes_remaining -> modules_remaining: No

modules_remaining -> load_module: Yes
modules_remaining -> merge_resources: No

merge_resources -> end

# Styling for the entire diagram
style {
  stroke: "#3fb950"
  font-color: "#e6edf3"
}