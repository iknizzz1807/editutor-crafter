title: Worker State Machine

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  initial: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  final: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
  }
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  error_transition: {
    style.stroke: "#d63031"
    style.font-color: "#d63031"
  }
}

init: {
  shape: circle
  class: initial
  label: ""
}

registered: Registered {
  shape: circle
  class: state
}

available: Available {
  shape: circle
  class: state
}

claimed: "Claimed Job" {
  shape: circle
  class: state
}

executing: Executing {
  shape: circle
  class: state
}

reporting: Reporting {
  shape: circle
  class: state
}

failed: Failed {
  shape: circle
  class: final
}

# Main flow transitions
init -> registered: Worker starts {
  class: transition
}

registered -> available: Registration complete {
  class: transition
}

available -> claimed: Job assigned {
  class: transition
}

claimed -> executing: Begin execution {
  class: transition
}

executing -> reporting: Job complete {
  class: transition
}

reporting -> available: Report sent {
  class: transition
}

# Failure transitions
registered -> failed: Registration failed {
  class: error_transition
}

claimed -> failed: Claim timeout {
  class: error_transition
}

executing -> failed: Execution error {
  class: error_transition
}

executing -> failed: Worker timeout {
  class: error_transition
}

reporting -> failed: Report failed {
  class: error_transition
}

# Recovery transitions
failed -> available: Recovery/Restart {
  class: transition
  style.stroke-dash: 3
}