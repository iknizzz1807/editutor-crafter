direction: right

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  error_state: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  final_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
    style.double-border: true
  }
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  trigger: {
    style.stroke: "#3fb950"
    style.font-color: "#3fb950"
  }
}

init: {
  shape: circle
  style.fill: "#3fb950"
  label: ""
  width: 20
  height: 20
}

pending: Pending {
  shape: circle
  class: state
}

reconciling: Reconciling {
  shape: circle
  class: state
}

ready: Ready {
  shape: circle
  class: state
}

error: Error {
  shape: circle
  class: error_state
}

deleting: Deleting {
  shape: circle
  class: state
}

deleted: {
  shape: circle
  class: final_state
  label: ""
  width: 20
  height: 20
}

init -> pending: Resource Created {
  class: trigger
}

pending -> reconciling: Controller Picks Up Resource {
  class: transition
}

reconciling -> ready: Reconciliation Success {
  class: transition
}

reconciling -> error: Reconciliation Failure {
  class: transition
}

error -> reconciling: Retry / Manual Fix {
  class: transition
}

ready -> reconciling: Spec Changed {
  class: trigger
}

ready -> deleting: Deletion Requested {
  class: trigger
}

pending -> deleting: Deletion Requested {
  class: trigger
}

error -> deleting: Deletion Requested {
  class: trigger
}

reconciling -> deleting: Deletion Requested {
  class: trigger
}

deleting -> deleted: Finalizers Completed {
  class: transition
}

deleting -> error: Deletion Failure {
  class: transition
}

actions: Actions & Triggers {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  create: "• kubectl apply" {
    style.font-color: "#e6edf3"
  }
  
  watch: "• Controller watches" {
    style.font-color: "#e6edf3"
  }
  
  reconcile: "• Deploy resources" {
    style.font-color: "#e6edf3"
  }
  
  validate: "• Validate config" {
    style.font-color: "#e6edf3"
  }
  
  cleanup: "• Remove finalizers" {
    style.font-color: "#e6edf3"
  }
}

actions.near: bottom-center