title: Expression Evaluation Flow

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  data: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

start: Start Evaluation {
  shape: circle
  class: process
}

input: Expression Input {
  class: data
}

type_check: What type of expression? {
  shape: diamond
  class: decision
}

atom_check: Is it a symbol? {
  shape: diamond
  class: decision
}

env_lookup: Environment Lookup {
  class: process
}

literal_return: Return Literal Value {
  class: process
}

list_check: Empty list? {
  shape: diamond
  class: decision
}

nil_return: Return NIL {
  class: process
}

first_elem: Get First Element {
  class: process
}

special_check: Special form? {
  shape: diamond
  class: decision
}

special_eval: Evaluate Special Form {
  class: process
}

eval_args: Evaluate Arguments {
  class: process
}

func_lookup: Function Lookup {
  class: process
}

apply_func: Apply Function {
  class: process
}

bind_params: Bind Parameters {
  class: process
}

eval_body: Evaluate Function Body {
  class: process
}

result: Return Result {
  shape: circle
  class: process
}

start -> input
input -> type_check

type_check -> atom_check: Atom
type_check -> list_check: List

atom_check -> env_lookup: Symbol
atom_check -> literal_return: Literal

env_lookup -> result
literal_return -> result

list_check -> nil_return: Yes
list_check -> first_elem: No

nil_return -> result
first_elem -> special_check

special_check -> special_eval: Yes (define, lambda, if, etc.)
special_check -> eval_args: No (function call)

special_eval -> result

eval_args -> func_lookup
func_lookup -> apply_func
apply_func -> bind_params
bind_params -> eval_body
eval_body -> result

environment: Environment {
  variables: Variable Bindings {
    class: data
  }
  functions: Function Definitions {
    class: data
  }
}

env_lookup -> environment: lookup
func_lookup -> environment: lookup
bind_params -> environment: extend

start.style.fill: "#3fb950"
result.style.fill: "#d63031"