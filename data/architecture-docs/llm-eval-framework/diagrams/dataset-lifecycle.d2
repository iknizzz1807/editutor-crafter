title: Dataset Lifecycle State Machine

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  error_state: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  final_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
    style.double-border: true
  }
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  error_transition: {
    style.stroke: "#d63031"
    style.font-color: "#ff7675"
  }
  recovery_transition: {
    style.stroke: "#00b894"
    style.font-color: "#00cec9"
  }
}

init: {
  shape: circle
  style.fill: "#3fb950"
  label: ""
}

created: Created {
  shape: circle
  class: state
}

validated: Validated {
  shape: circle
  class: state
}

split: Split {
  shape: circle
  class: state
}

versioned: Versioned {
  shape: circle
  class: final_state
}

validation_error: Validation Error {
  shape: circle
  class: error_state
}

split_error: Split Error {
  shape: circle
  class: error_state
}

version_error: Version Error {
  shape: circle
  class: error_state
}

init -> created: dataset_import {
  class: transition
}

created -> validated: validate_schema {
  class: transition
}

created -> validation_error: validation_failed {
  class: error_transition
}

validated -> split: create_splits {
  class: transition
}

validated -> split_error: split_failed {
  class: error_transition
}

split -> versioned: create_version {
  class: transition
}

split -> version_error: versioning_failed {
  class: error_transition
}

validation_error -> created: fix_data {
  class: recovery_transition
}

split_error -> validated: reconfigure_splits {
  class: recovery_transition
}

version_error -> split: retry_versioning {
  class: recovery_transition
}

versioned -> split: update_splits {
  class: transition
}

versioned -> validated: schema_migration {
  class: transition
}