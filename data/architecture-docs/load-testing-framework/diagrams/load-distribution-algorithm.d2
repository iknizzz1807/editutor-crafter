start: Check Worker Capacity {
  shape: diamond
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

capacity_check: Capacity Available? {
  shape: diamond
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

check_load: Check Current Load {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

load_threshold: Load < Threshold? {
  shape: diamond
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

assign_users: Assign Virtual Users {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

find_alternative: Find Alternative Worker {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

redistribute: Redistribute from Overloaded {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

worker_failure: Worker Failure Detected? {
  shape: diamond
  style.fill: "#1a1a2e"
  style.stroke: "#d63031"
  style.font-color: "#e6edf3"
}

failover: Failover to Backup Workers {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#d63031"
  style.font-color: "#e6edf3"
  style.bold: true
}

scale_check: Can Scale Out? {
  shape: diamond
  style.fill: "#1a1a2e"
  style.stroke: "#fdcb6e"
  style.font-color: "#e6edf3"
}

spawn_worker: Spawn New Worker {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#fdcb6e"
  style.font-color: "#e6edf3"
}

queue_users: Queue Users for Later {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

complete: Assignment Complete {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
  style.font-color: "#ffffff"
  style.bold: true
}

start -> capacity_check: Begin Distribution

capacity_check -> check_load: Yes
capacity_check -> find_alternative: No

check_load -> load_threshold: Analyze Load

load_threshold -> assign_users: Yes
load_threshold -> redistribute: No

assign_users -> worker_failure: Monitor Health

find_alternative -> capacity_check: Worker Found
find_alternative -> scale_check: None Available

redistribute -> check_load: Rebalanced

worker_failure -> failover: Yes
worker_failure -> complete: No

failover -> capacity_check: Recovery Complete

scale_check -> spawn_worker: Yes
scale_check -> queue_users: No

spawn_worker -> capacity_check: Worker Ready

queue_users -> complete: Queued

complete -> start: Next Batch

notes: Load Distribution Notes {
  shape: page
  near: top-right
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

notes: |md
  ## Algorithm Considerations
  
  **Capacity Factors:**
  - CPU cores & memory
  - Network bandwidth
  - Current connections
  
  **Load Metrics:**
  - Active virtual users
  - Response times
  - Error rates
  
  **Failure Handling:**
  - Health checks
  - Graceful degradation
  - Load redistribution
|