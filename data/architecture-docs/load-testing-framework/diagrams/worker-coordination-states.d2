# Worker Coordination State Machine

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  initial_state: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#ffffff"
  }
  
  final_state: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.double-border: true
  }
  
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

# Initial state
init: {
  shape: circle
  class: initial_state
  label: ""
}

# Worker states
disconnected: Disconnected {
  shape: circle
  class: state
}

connecting: Connecting {
  shape: circle
  class: state
}

ready: Ready {
  shape: circle
  class: state
}

executing_test: ExecutingTest {
  shape: circle
  class: state
}

reporting_results: ReportingResults {
  shape: circle
  class: state
}

failed: Failed {
  shape: circle
  class: final_state
}

# State transitions
init -> disconnected: {
  class: transition
}

disconnected -> connecting: coordinator.connect() {
  class: transition
}

connecting -> ready: connection.established {
  class: transition
}

connecting -> failed: connection.timeout {
  class: transition
}

ready -> executing_test: coordinator.start_test() {
  class: transition
}

ready -> disconnected: coordinator.disconnect() {
  class: transition
}

ready -> failed: health_check.failed {
  class: transition
}

executing_test -> reporting_results: test.completed {
  class: transition
}

executing_test -> failed: execution.error {
  class: transition
}

executing_test -> ready: coordinator.abort_test() {
  class: transition
}

reporting_results -> ready: results.sent {
  class: transition
}

reporting_results -> failed: report.timeout {
  class: transition
}

failed -> connecting: coordinator.retry() {
  class: transition
}