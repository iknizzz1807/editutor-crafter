# System Architecture Overview
classes: {
  component: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  interface: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  storage: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  external: {
    style.fill: "#2d3748"
    style.stroke: "#ffd700"
    style.font-color: "#e6edf3"
  }
}

# External Interfaces
http_endpoint: HTTP API {
  shape: hexagon
  class: external
}

tcp_endpoint: TCP Logs {
  shape: hexagon
  class: external
}

udp_endpoint: UDP Logs {
  shape: hexagon
  class: external
}

file_system: File System {
  shape: cylinder
  class: external
}

clients: Query Clients {
  shape: cloud
  class: external
}

# Main System Components
ingestion: Log Ingestion {
  class: component
  api_server: HTTP API Server
  tcp_receiver: TCP Receiver
  udp_receiver: UDP Receiver
  buffer: Input Buffer {
    shape: queue
  }
}

parser: Log Parser {
  class: component
  normalizer: Message Normalizer
  extractor: Label Extractor
  validator: Schema Validator
}

index: Indexing Engine {
  class: component
  inverted_index: Inverted Index Builder
  bloom_filters: Bloom Filter Generator
  time_partitioner: Time Partitioner
}

storage: Storage Layer {
  class: storage
  chunk_store: Log Chunks {
    shape: cylinder
  }
  index_store: Index Store {
    shape: cylinder
  }
  metadata: Metadata Store {
    shape: cylinder
  }
}

query_engine: Query Engine {
  class: component
  logql_parser: LogQL Parser
  query_planner: Query Planner
  result_aggregator: Result Aggregator
}

# External to System Data Flow
http_endpoint -> ingestion.api_server: HTTP logs
tcp_endpoint -> ingestion.tcp_receiver: TCP stream
udp_endpoint -> ingestion.udp_receiver: UDP packets
file_system -> ingestion.buffer: file reads

# Internal Data Flow
ingestion.buffer -> parser.normalizer: raw logs
parser.validator -> index.inverted_index: structured logs
index.time_partitioner -> storage.chunk_store: log chunks
index.bloom_filters -> storage.index_store: bloom filters
index.inverted_index -> storage.index_store: inverted indexes

# Query Flow
clients -> query_engine.logql_parser: LogQL queries
query_engine.query_planner -> storage.index_store: index lookups
storage.chunk_store -> query_engine.result_aggregator: log data
query_engine.result_aggregator -> clients: query results

# Metadata Flow
storage.chunk_store <-> storage.metadata: chunk locations
storage.index_store <-> storage.metadata: index metadata