shape: sequence_diagram

classes: {
  api_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  queue_style: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  worker_style: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  ffmpeg_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

API: API Server {
  class: api_style
}
Queue: Processing Queue {
  class: queue_style
}
Worker: Background Worker {
  class: worker_style
}
FFmpeg: FFmpeg Process {
  class: ffmpeg_style
}

API -> Queue: 1. Enqueue video job
Queue -> API: 2. Return job ID
API -> Queue: 3. Job queued
Queue -> Worker: 4. Poll for jobs
Worker -> Queue: 5. Claim job
Worker -> Queue: 6. Update status: "Processing Started"
Queue -> API: 7. Webhook: job started
Worker -> FFmpeg: 8. Start transcoding
FFmpeg -> Worker: 9. Progress update (25%)
Worker -> Queue: 10. Update progress: 25%
Queue -> API: 11. Webhook: progress update
FFmpeg -> Worker: 12. Progress update (50%)
Worker -> Queue: 13. Update progress: 50%
FFmpeg -> Worker: 14. Progress update (75%)
Worker -> Queue: 15. Update progress: 75%
FFmpeg -> Worker: 16. Transcoding complete
Worker -> Queue: 17. Update status: "Complete"
Queue -> API: 18. Webhook: job completed
API -> Queue: 19. Poll job status
Queue -> API: 20. Return final result