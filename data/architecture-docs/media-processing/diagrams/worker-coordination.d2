title: Worker Process Coordination

classes: {
  container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  worker: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  queue_system: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  critical: {
    style.stroke: "#d63031"
    style.bold: true
  }
  success: {
    style.stroke: "#00b894"
  }
  warning: {
    style.stroke: "#fdcb6e"
  }
}

job_distributor: Job Distributor {
  class: container
  scheduler: Priority Scheduler {
    class: queue_system
    shape: queue
  }
  load_balancer: Load Balancer {
    class: queue_system
  }
  job_queue: Active Jobs Queue {
    class: queue_system
    shape: queue
  }
}

worker_pool: Worker Pool {
  class: container
  
  worker_1: Image Worker #1 {
    class: worker
    worker_status: "Processing: resize_job_123"
  }
  
  worker_2: Image Worker #2 {
    class: worker
    worker_status: "Idle"
  }
  
  worker_3: Video Worker #1 {
    class: worker
    worker_status: "Processing: transcode_job_456"
  }
  
  worker_4: Video Worker #2 {
    class: worker
    worker_status: "Failed - Restarting"
  }
}

coordination: Coordination Services {
  class: container
  
  heartbeat: Heartbeat Monitor {
    class: queue_system
  }
  
  progress_tracker: Progress Tracker {
    class: queue_system
  }
  
  failure_handler: Failure Handler {
    class: queue_system
  }
}

notification: Notification System {
  class: container
  
  webhook_queue: Webhook Queue {
    shape: queue
    class: queue_system
  }
  
  retry_handler: Retry Handler {
    class: queue_system
  }
}

job_distributor.scheduler -> job_distributor.load_balancer: 1. Prioritize jobs
job_distributor.load_balancer -> job_distributor.job_queue: 2. Queue assignment
job_distributor.job_queue -> worker_pool.worker_1: 3. Assign job
job_distributor.job_queue -> worker_pool.worker_3: 3. Assign job

worker_pool.worker_1 -> coordination.heartbeat: Heartbeat every 30s
worker_pool.worker_2 -> coordination.heartbeat: Available for work
worker_pool.worker_3 -> coordination.heartbeat: Heartbeat every 30s
worker_pool.worker_4 -> coordination.heartbeat: Worker crashed {
  class: critical
}

worker_pool.worker_1 -> coordination.progress_tracker: 65% complete
worker_pool.worker_3 -> coordination.progress_tracker: 20% complete
coordination.progress_tracker -> notification.webhook_queue: Progress updates

coordination.heartbeat -> coordination.failure_handler: Detect worker failure {
  class: critical
}
coordination.failure_handler -> job_distributor.job_queue: Requeue failed job {
  class: warning
}
coordination.failure_handler -> worker_pool.worker_4: Restart worker {
  class: warning
}

worker_pool.worker_1 -> coordination.progress_tracker: Job complete {
  class: success
}
coordination.progress_tracker -> notification.webhook_queue: Completion notification {
  class: success
}

notification.webhook_queue -> notification.retry_handler: Failed delivery {
  class: warning
}
notification.retry_handler -> notification.webhook_queue: Retry with backoff {
  class: warning
}

coordination.heartbeat -> job_distributor.load_balancer: Worker capacity info
coordination.progress_tracker -> job_distributor.scheduler: Queue metrics

legend: |md
  **Flow Types:**
  - **Black arrows**: Job distribution and assignment
  - **Green arrows**: Successful operations  
  - **Red arrows**: Failure scenarios
  - **Yellow arrows**: Retry and recovery
| {
  shape: page
  near: bottom-right
  class: container
}