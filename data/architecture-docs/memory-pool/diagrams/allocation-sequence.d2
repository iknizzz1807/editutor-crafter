shape: sequence_diagram

classes: {
  dark_theme: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  important: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

client: Client {
  class: dark_theme
}

allocator: Pool Allocator {
  class: important
}

free_list: Free List Manager {
  class: dark_theme
}

chunk_manager: Chunk Manager {
  class: dark_theme
}

client -> allocator: "1: alloc_request(size)"
allocator -> free_list: "2: check_free_blocks()"
free_list -> allocator: "3: free_list_status"
allocator -> allocator: "4: decision: blocks_available?"
allocator -> free_list: "5a: pop_free_block()" {
  style.stroke: "#3fb950"
}
free_list -> allocator: "5b: return_block"
allocator -> client: "6a: return_block_ptr"
allocator -> chunk_manager: "7: needs_growth()" {
  style.stroke: "#d63031"
}
chunk_manager -> chunk_manager: "8: allocate_new_chunk()"
chunk_manager -> chunk_manager: "9: carve_into_blocks()"
chunk_manager -> free_list: "10: add_blocks_to_list()"
free_list -> chunk_manager: "11: list_updated"
chunk_manager -> allocator: "12: growth_complete"
allocator -> free_list: "13: retry_pop_block()"
free_list -> allocator: "14: return_new_block"
allocator -> client: "15: return_block_ptr"

title: Block Allocation Sequence

note_growth: |md
  **Growth Decision:**
  - Check free list status
  - Evaluate pool policy
  - Allocate if necessary
| {
  shape: page
  class: decision
  near: center-right
}