title: Pool State Machine

classes: {
  state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  initial: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#1a1a2e"
  }
  
  final: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.double-border: true
  }
  
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  action: {
    style.fill: "#16213e"
    style.stroke: "#6c757d"
    style.font-color: "#e6edf3"
    shape: page
  }
}

init: {
  shape: circle
  class: initial
  label: ""
}

uninitialized: Uninitialized {
  shape: circle
  class: state
}

initialized: Initialized {
  shape: circle
  class: state
}

active: Active {
  shape: circle
  class: state
}

growing: Growing {
  shape: circle
  class: state
}

destroyed: Destroyed {
  shape: circle
  class: final
}

init_action: |md
  **Actions:**
  - Allocate memory chunk
  - Set block size & count
  - Initialize free list
  - Set pool state
| {
  class: action
}

activate_action: |md
  **Actions:**
  - Mark pool as ready
  - Enable allocation
  - Reset error flags
| {
  class: action
}

grow_action: |md
  **Actions:**
  - Allocate new chunk
  - Carve into blocks
  - Link to free list
  - Update statistics
| {
  class: action
}

shrink_action: |md
  **Actions:**
  - Return to active state
  - Update block count
  - Log growth completion
| {
  class: action
}

destroy_action: |md
  **Actions:**
  - Free all chunks
  - Clear free list
  - Reset counters
  - Mark as destroyed
| {
  class: action
}

init -> uninitialized: start {
  class: transition
}

uninitialized -> initialized: pool_init() {
  class: transition
}

uninitialized -> init_action {
  class: transition
  style.stroke-dash: 3
}

init_action -> initialized {
  class: transition
  style.stroke-dash: 3
}

initialized -> active: first allocation {
  class: transition
}

initialized -> activate_action {
  class: transition
  style.stroke-dash: 3
}

activate_action -> active {
  class: transition
  style.stroke-dash: 3
}

active -> growing: free_list empty\n& growth enabled {
  class: transition
}

active -> grow_action {
  class: transition
  style.stroke-dash: 3
}

grow_action -> growing {
  class: transition
  style.stroke-dash: 3
}

growing -> active: chunk allocated {
  class: transition
}

growing -> shrink_action {
  class: transition
  style.stroke-dash: 3
}

shrink_action -> active {
  class: transition
  style.stroke-dash: 3
}

active -> destroyed: pool_destroy() {
  class: transition
}

initialized -> destroyed: pool_destroy() {
  class: transition
}

uninitialized -> destroyed: pool_destroy() {
  class: transition
}

active -> destroy_action {
  class: transition
  style.stroke-dash: 3
}

initialized -> destroy_action {
  class: transition
  style.stroke-dash: 3
}

uninitialized -> destroy_action {
  class: transition
  style.stroke-dash: 3
}

destroy_action -> destroyed {
  class: transition
  style.stroke-dash: 3
}