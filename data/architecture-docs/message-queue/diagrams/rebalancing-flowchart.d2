title: Consumer Group Rebalancing Process

classes: {
  start_event: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#1a1a2e"
    style.bold: true
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  notification: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

start: Consumer Join/Leave Event {
  shape: circle
  class: start_event
}

detect_change: Detect Group\nMembership Change {
  class: process
}

determine_type: What type of change? {
  shape: diamond
  class: decision
}

pause_processing: Pause Message\nProcessing {
  class: process
}

consumer_join: Consumer\nJoined Group {
  class: process
}

consumer_left: Consumer\nLeft Group {
  class: process
}

check_unacked: Check for\nUnacknowledged Messages {
  shape: diamond
  class: decision
}

reassign_messages: Reassign Unacked\nMessages to Active\nConsumers {
  class: process
}

calculate_assignment: Calculate New\nWork Assignment\n(Round-Robin) {
  class: process
}

update_coordinator: Update Group\nCoordinator State {
  class: process
}

notify_consumers: Notify All Group\nMembers of New\nAssignments {
  class: notification
}

resume_processing: Resume Message\nProcessing {
  class: process
}

complete: Rebalancing\nComplete {
  shape: circle
  class: start_event
}

start -> detect_change
detect_change -> determine_type
determine_type -> pause_processing
pause_processing -> consumer_join: Consumer Joined
pause_processing -> consumer_left: Consumer Left

consumer_join -> calculate_assignment
consumer_left -> check_unacked

check_unacked -> reassign_messages: Has Unacked\nMessages
check_unacked -> calculate_assignment: No Unacked\nMessages

reassign_messages -> calculate_assignment

calculate_assignment -> update_coordinator
update_coordinator -> notify_consumers
notify_consumers -> resume_processing
resume_processing -> complete