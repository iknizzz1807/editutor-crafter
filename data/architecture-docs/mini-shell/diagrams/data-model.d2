title: Core Data Structures

classes: {
  primary: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  secondary: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  arrow: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

Command: {
  shape: class
  class: primary
  - "program: string"
  - "args: string[]"
  - "input_file: string?"
  - "output_file: string?"
  - "append_mode: bool"
  - "background: bool"
  + "parse(input: string): Command"
  + "validate(): bool"
}

Job: {
  shape: class
  class: primary
  - "id: int"
  - "pgid: pid_t"
  - "command_line: string"
  - "processes: Process[]"
  - "state: JobState"
  - "foreground: bool"
  + "add_process(proc: Process): void"
  + "update_state(): void"
  + "send_signal(sig: int): void"
}

Process: {
  shape: class
  class: primary
  - "pid: pid_t"
  - "command: Command"
  - "state: ProcessState"
  - "exit_status: int?"
  - "stopped: bool"
  + "start(): pid_t"
  + "wait(): int"
  + "kill(signal: int): void"
}

ShellState: {
  shape: class
  class: primary
  - "jobs: Job[]"
  - "foreground_job: Job?"
  - "terminal_fd: int"
  - "shell_pgid: pid_t"
  - "interactive: bool"
  - "exit_requested: bool"
  + "add_job(job: Job): void"
  + "find_job(id: int): Job?"
  + "cleanup_finished(): void"
  + "set_foreground(job: Job): void"
}

JobState: {
  shape: class
  class: secondary
  - "RUNNING"
  - "STOPPED" 
  - "COMPLETED"
  - "TERMINATED"
}

ProcessState: {
  shape: class
  class: secondary
  - "CREATED"
  - "RUNNING"
  - "STOPPED"
  - "EXITED"
  - "SIGNALED"
}

Command -> Process: {
  class: arrow
  label: "executed by"
}

Process -> Job: {
  class: arrow
  label: "belongs to"
}

Job -> ShellState: {
  class: arrow
  label: "managed by"
}

Job -> JobState: {
  class: arrow
  label: "has state"
  style.stroke-dash: 3
}

Process -> ProcessState: {
  class: arrow
  label: "has state"
  style.stroke-dash: 3
}

ShellState -> Job: {
  class: arrow
  label: "tracks active"
  style.stroke-dash: 3
}