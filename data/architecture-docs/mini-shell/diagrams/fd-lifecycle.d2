shape: sequence_diagram

shell: Shell
process: Process
kernel: Kernel
"fd_table": "FD Table"

shell -> kernel: "open(\"/path/to/file\", flags)"
kernel -> "fd_table": allocate new fd entry
"fd_table" -> kernel: fd = 3
kernel -> shell: return fd 3

shell -> shell: setup pipeline
shell -> kernel: "pipe()"
kernel -> "fd_table": allocate pipe fds
"fd_table" -> kernel: "pipe_fds[0,1] = [4,5]"
kernel -> shell: return pipe fds

shell -> kernel: "fork()"
kernel -> shell: child pid

shell -> kernel: "dup2(fd, STDOUT_FILENO)"
kernel -> "fd_table": duplicate fd 3 -> fd 1
"fd_table" -> kernel: success
kernel -> shell: success

shell -> process: "exec(\"/bin/command\")"
process -> kernel: write to fd 1
kernel -> "fd_table": lookup fd 1 -> original fd 3
"fd_table" -> kernel: file descriptor
kernel -> process: write success

process -> kernel: "exit()"
kernel -> "fd_table": close all process fds
"fd_table" -> kernel: cleanup complete

shell -> kernel: "waitpid()"
kernel -> shell: child exit status

shell -> kernel: "close(fd)"
kernel -> "fd_table": decrement ref count
"fd_table" -> kernel: fd freed
kernel -> shell: close success