direction: down

classes: {
  terminal_style: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  session_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  process_group_style: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  process_style: {
    style.fill: "#2d3748"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  foreground_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  background_style: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#8b949e"
  }
}

terminal: Terminal (TTY) {
  class: terminal_style
  shape: rectangle
}

shell_session: Shell Session {
  class: session_style
  
  job_table: Job Table {
    class: session_style
    shape: cylinder
  }
  
  fg_group: Process Group 1 (Foreground) {
    class: foreground_style
    
    fg_proc1: bash {
      class: process_style
      shape: rectangle
    }
    fg_proc2: grep {
      class: process_style
      shape: rectangle
    }
    fg_proc3: sort {
      class: process_style
      shape: rectangle
    }
    
    fg_proc1 -> fg_proc2: pipe
    fg_proc2 -> fg_proc3: pipe
  }
  
  bg_group1: Process Group 2 (Background) {
    class: background_style
    
    bg_proc1: find {
      class: process_style
      shape: rectangle
    }
    bg_proc2: xargs {
      class: process_style
      shape: rectangle
    }
    
    bg_proc1 -> bg_proc2: pipe
  }
  
  bg_group2: Process Group 3 (Suspended) {
    class: background_style
    
    suspended_proc: vim {
      class: process_style
      shape: rectangle
    }
  }
}

signal_flow: Signal Flow {
  class: session_style
  shape: page
  
  ctrl_c: "Ctrl+C (SIGINT)" {
    class: terminal_style
    shape: oval
  }
  
  ctrl_z: "Ctrl+Z (SIGTSTP)" {
    class: terminal_style
    shape: oval
  }
  
  sigchld: "SIGCHLD" {
    class: process_style
    shape: oval
  }
}

ownership_note: |md
  ## Terminal Ownership
  - Only **foreground** process group owns terminal
  - Receives keyboard input and signals
  - Background jobs run independently
  - Shell manages process group switching
| {
  class: session_style
  shape: page
  near: top-right
}

terminal -> shell_session.fg_group: "terminal control\n(STDIN/STDOUT)"
terminal -> shell_session.job_table: manages

shell_session.job_table -> shell_session.fg_group: tracks
shell_session.job_table -> shell_session.bg_group1: tracks
shell_session.job_table -> shell_session.bg_group2: tracks

signal_flow.ctrl_c -> shell_session.fg_group: "routes to\nforeground only"
signal_flow.ctrl_z -> shell_session.fg_group: "suspend\nforeground job"
shell_session.bg_group1 -> signal_flow.sigchld: "job completion\nnotification"
signal_flow.sigchld -> shell_session.job_table: "update job\nstatus"