title: Core Data Model {
  near: top-center
  style.font-size: 24
  style.bold: true
  style.font-color: "#e6edf3"
}

# Entity class
Entity: |md
  **Entity**

  Fields:
  - id: EntityID
  - components: ComponentMask
  - is_active: bool

  Methods:
  + add_component<T>(): void
  + get_component<T>(): T*
  + remove_component<T>(): void
  + has_component<T>(): bool
| {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# Component class
Component: |md
  **Component**

  Fields:
  - type_id: ComponentTypeID
  - version: uint32

  Methods:
  + serialize(): bytes
  + deserialize(): void
  + clone(): Component
| {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

# PositionComponent
PositionComponent: |md
  **PositionComponent**

  Fields:
  - position: Vec3
  - rotation: Quaternion
  - velocity: Vec3

  Methods:
  + update(): void
  + interpolate(): Vec3
| {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

# NetworkComponent
NetworkComponent: |md
  **NetworkComponent**

  Fields:
  - owner_client_id: ClientID
  - replication_flags: ReplicationMask
  - last_update_tick: uint64

  Methods:
  + should_replicate(): bool
  + get_dirty_fields(): FieldMask
| {
  shape: rectangle
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# SpatialNode
SpatialNode: |md
  **SpatialNode**

  Fields:
  - bounds: AABB
  - entities: Set<EntityID>
  - children: SpatialNode[]
  - parent: SpatialNode
  - level: uint8

  Methods:
  + insert(): void
  + remove(): void
  + query_range(): Set<EntityID>
  + subdivide(): void
| {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# NetworkMessage
NetworkMessage: |md
  **NetworkMessage**

  Fields:
  - message_type: MessageType
  - sequence_number: uint32
  - timestamp: uint64
  - payload_size: uint16
  - payload: byte[]

  Methods:
  + serialize(): bytes
  + deserialize(): bool
  + validate_checksum(): bool
| {
  shape: rectangle
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# EntityUpdateMessage
EntityUpdateMessage: |md
  **EntityUpdateMessage**

  Fields:
  - entity_id: EntityID
  - component_mask: ComponentMask
  - field_updates: Map<ComponentType, bytes>

  Methods:
  + pack_delta(): void
  + apply_delta(): void
| {
  shape: rectangle
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# GameState
GameState: |md
  **GameState**

  Fields:
  - tick: uint64
  - timestamp: uint64
  - entity_states: Map<EntityID, EntityState>
  - spatial_hash: SpatialHash
  - checksum: uint64

  Methods:
  + apply_update(): void
  + create_snapshot(): GameStateSnapshot
  + rollback_to_tick(): void
  + calculate_checksum(): uint64
| {
  shape: rectangle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

# Relationships
Component -> Entity: implements
PositionComponent -> Component: extends
NetworkComponent -> Component: extends

Entity -> SpatialNode: tracked by
Entity -> NetworkMessage: serialized in
Entity -> GameState: managed by

SpatialNode -> SpatialNode: subdivides into

NetworkMessage -> EntityUpdateMessage: specialized as
EntityUpdateMessage -> GameState: updates

GameState -> SpatialNode: contains

note: |md
  ## Key Relationships

  - **Entity-Component**: Composition-based architecture
  - **Spatial Integration**: Entities tracked in spatial partitions
  - **Network Serialization**: Components packed into messages
  - **State Management**: GameState coordinates all systems
| {
  shape: page
  near: bottom-right
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}
