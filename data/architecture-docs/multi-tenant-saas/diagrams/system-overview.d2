title: Multi-Tenant System Architecture

classes: {
  tenant_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  service_style: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  external_style: {
    style.fill: "#0f3460"
    style.stroke: "#ffd700"
    style.font-color: "#e6edf3"
  }
}

client: Client App {
  class: service_style
}

gateway: API Gateway {
  class: tenant_style
  shape: rectangle
}

tenant_resolver: Tenant Resolver {
  class: tenant_style
  shape: rectangle
}

app_services: Application Services {
  class: service_style
  shape: rectangle
  
  auth: Authentication Service {
    class: service_style
  }
  
  business: Business Logic {
    class: service_style
  }
  
  config: Configuration Service {
    class: service_style
  }
}

database: Multi-Tenant Database {
  class: tenant_style
  shape: rectangle
  
  rls: Row-Level Security {
    class: tenant_style
    shape: cylinder
  }
  
  tenant_data: Tenant Data {
    class: service_style
    shape: cylinder
  }
}

external: External Integrations {
  class: external_style
  shape: rectangle
  
  billing: Billing Provider {
    class: external_style
  }
  
  notifications: Email/SMS Service {
    class: external_style
  }
  
  analytics: Analytics Provider {
    class: external_style
  }
}

client -> gateway: 1. API Request\n(with tenant info)

gateway -> tenant_resolver: 2. Extract tenant ID\nfrom header/subdomain

tenant_resolver -> app_services: 3. Inject tenant\ncontext

app_services.auth -> database.rls: 4. Query with\ntenant context

database.rls -> database.tenant_data: 5. Filter data\nby tenant ID

app_services.business -> external.billing: Tenant-specific\nbilling operations

app_services.config -> external.notifications: Per-tenant\nnotification settings

app_services -> external.analytics: Tenant metrics\nand usage data

gateway <- tenant_resolver: Tenant context\nestablished

client <- gateway: 6. Filtered response\n(tenant-specific data)

note: |md
  **Request Flow:**
  1. Client sends request with tenant identifier
  2. API Gateway extracts tenant information
  3. Tenant Resolver validates and injects context
  4. Application Services process with tenant scope
  5. Database enforces row-level security
  6. External integrations use tenant-specific configs
| {
  shape: page
  class: service_style
  near: top-right
}