direction: right

classes: {
  table_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  tenant_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  index_style: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    style.stroke-dash: 3
  }
}

title: Tenant Data Model Relationships {
  style.font-size: 18
  style.font-color: "#e6edf3"
  style.bold: true
  near: top-center
}

tenant: Tenant {
  shape: sql_table
  class: tenant_style
  id: "bigserial PRIMARY KEY"
  name: "varchar(255) NOT NULL"
  slug: "varchar(100) UNIQUE"
  status: "tenant_status_enum"
  plan: "varchar(50)"
  settings: "jsonb"
  created_at: "timestamptz"
  updated_at: "timestamptz"
  deleted_at: "timestamptz"
}

users: Users {
  shape: sql_table
  class: table_style
  id: "bigserial PRIMARY KEY"
  tenant_id: "bigint NOT NULL"
  email: "varchar(255)"
  name: "varchar(255)"
  created_at: "timestamptz"
  deleted_at: "timestamptz"
}

projects: Projects {
  shape: sql_table
  class: table_style
  id: "bigserial PRIMARY KEY"
  tenant_id: "bigint NOT NULL"
  name: "varchar(255)"
  description: "text"
  owner_id: "bigint"
  created_at: "timestamptz"
  deleted_at: "timestamptz"
}

tasks: Tasks {
  shape: sql_table
  class: table_style
  id: "bigserial PRIMARY KEY"
  tenant_id: "bigint NOT NULL"
  project_id: "bigint"
  assignee_id: "bigint"
  title: "varchar(500)"
  status: "task_status_enum"
  created_at: "timestamptz"
  deleted_at: "timestamptz"
}

audit_logs: Audit Logs {
  shape: sql_table
  class: table_style
  id: "bigserial PRIMARY KEY"
  tenant_id: "bigint NOT NULL"
  entity_type: "varchar(100)"
  entity_id: "bigint"
  action: "varchar(50)"
  user_id: "bigint"
  created_at: "timestamptz"
}

indexes: Composite Indexes {
  shape: rectangle
  class: index_style
  
  idx_users: "idx_users_tenant_email" {
    style.font-color: "#e6edf3"
    shape: rectangle
    label: "CREATE INDEX ON users (tenant_id, email)"
  }
  
  idx_projects: "idx_projects_tenant_owner" {
    style.font-color: "#e6edf3"
    shape: rectangle
    label: "CREATE INDEX ON projects (tenant_id, owner_id)"
  }
  
  idx_tasks: "idx_tasks_tenant_project" {
    style.font-color: "#e6edf3"
    shape: rectangle
    label: "CREATE INDEX ON tasks (tenant_id, project_id)"
  }
  
  idx_audit: "idx_audit_tenant_created" {
    style.font-color: "#e6edf3"
    shape: rectangle
    label: "CREATE INDEX ON audit_logs (tenant_id, created_at DESC)"
  }
}

soft_deletion: Soft Deletion Pattern {
  shape: rectangle
  class: index_style
  
  pattern: "WHERE deleted_at IS NULL" {
    style.font-color: "#e6edf3"
    shape: rectangle
    label: "All queries filter by deleted_at IS NULL"
  }
  
  partial_idx: "Partial Indexes" {
    style.font-color: "#e6edf3"
    shape: rectangle
    label: "CREATE INDEX ON table_name (tenant_id, col) WHERE deleted_at IS NULL"
  }
}

tenant -> users: "1:N" {
  style.stroke: "#3fb950"
  style.stroke-width: 2
}

tenant -> projects: "1:N" {
  style.stroke: "#3fb950"
  style.stroke-width: 2
}

tenant -> tasks: "1:N" {
  style.stroke: "#3fb950"
  style.stroke-width: 2
}

tenant -> audit_logs: "1:N" {
  style.stroke: "#3fb950"
  style.stroke-width: 2
}

users -> projects: "owner_id FK" {
  style.stroke: "#8b949e"
}

projects -> tasks: "project_id FK" {
  style.stroke: "#8b949e"
}

users -> tasks: "assignee_id FK" {
  style.stroke: "#8b949e"
}

indexes.idx_users -> users: "performance" {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

indexes.idx_projects -> projects: "performance" {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

indexes.idx_tasks -> tasks: "performance" {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

indexes.idx_audit -> audit_logs: "performance" {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

soft_deletion.pattern -> users: "applies to" {
  style.stroke: "#8b949e"
  style.stroke-dash: 5
}

soft_deletion.pattern -> projects: "applies to" {
  style.stroke: "#8b949e"
  style.stroke-dash: 5
}

soft_deletion.pattern -> tasks: "applies to" {
  style.stroke: "#8b949e"
  style.stroke-dash: 5
}