shape: sequence_diagram

client: Client {
  style.fill: "#1a1a2e"
  style.font-color: "#e6edf3"
  style.stroke: "#3fb950"
}

server: Server {
  style.fill: "#16213e"
  style.font-color: "#e6edf3"
  style.stroke: "#3fb950"
  style.bold: true
}

# Reliable command with acknowledgment
client -> server: Move Command (reliable) {
  style.stroke: "#3fb950"
  style.bold: true
}
server -> client: ACK + State Update {
  style.stroke: "#3fb950"
}

# Heartbeat exchange
client -> server: Heartbeat {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}
server -> client: Heartbeat Response {
  style.stroke: "#8b949e"
  style.stroke-dash: 3
}

# Unreliable state updates
server -> client: Position Update (unreliable) {
  style.stroke: "#ffa502"
}
server -> client: Animation State (unreliable) {
  style.stroke: "#ffa502"
}

# Reliable command timeout and retry
client -> server: Attack Command (reliable) {
  style.stroke: "#3fb950"
  style.bold: true
}

timeout_note: |md
  **Timeout - No ACK received**
  Client initiates retry logic
| {
  shape: page
  style.fill: "#d63031"
  style.font-color: "#ffffff"
  near: top-center
}

client -> server: Attack Command (retry) {
  style.stroke: "#ff6348"
  style.bold: true
}
server -> client: ACK + Damage Result {
  style.stroke: "#3fb950"
}

# Delta state synchronization
server -> client: Delta State (entities changed) {
  style.stroke: "#74b9ff"
}

# Connection loss scenario
connection_lost: |md
  **Connection Issues**
  Heartbeat timeout detected
| {
  shape: page
  style.fill: "#fdcb6e"
  style.font-color: "#2d3436"
  near: top-right
}

server -> client: Reconnection Required {
  style.stroke: "#e17055"
  style.stroke-dash: 5
}

client -> server: Full State Request {
  style.stroke: "#a29bfe"
}
server -> client: Complete World State {
  style.stroke: "#a29bfe"
  style.bold: true
}