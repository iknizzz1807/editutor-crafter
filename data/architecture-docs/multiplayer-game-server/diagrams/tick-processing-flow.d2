direction: down

tick_start: Tick Start {
  shape: circle
  style.fill: "#3fb950"
  style.font-color: "#000000"
}

input_collection: Input Collection {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

validation: Input Validation {
  shape: diamond
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

error_handler: Error Handler {
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
}

state_updates: State Updates {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

timing_check: Within Tick Budget? {
  shape: diamond
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

snapshot_creation: Snapshot Creation {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

client_broadcast: Client Broadcasting {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

tick_end: Tick Complete {
  shape: circle
  style.fill: "#3fb950"
  style.font-color: "#000000"
}

defer_updates: Defer to Next Tick {
  style.fill: "#fd79a8"
  style.stroke: "#e84393"
  style.font-color: "#ffffff"
}

tick_start -> input_collection: "Collect player inputs"
input_collection -> validation: "Validate inputs"
validation -> state_updates: "Valid"
validation -> error_handler: "Invalid"
error_handler -> input_collection: "Log & continue"
state_updates -> timing_check: "Apply physics & game logic"
timing_check -> snapshot_creation: "Yes"
timing_check -> defer_updates: "No - overrun"
defer_updates -> snapshot_creation: "Priority updates only"
snapshot_creation -> client_broadcast: "Create world snapshot"
client_broadcast -> tick_end: "Send to clients"

timing_note: |md
  **Tick Budget: 16.67ms (60 FPS)**
  
  Overrun handling prevents
  server slowdown
| {
  shape: page
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

timing_check -- timing_note