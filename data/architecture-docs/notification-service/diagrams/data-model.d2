title: Data Model Relationships

classes: {
  entity: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  relationship: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

notification: NotificationMessage {
  shape: class
  class: entity
  - "id: string"
  - "user_id: string"
  - "template_id: string"
  - "channel: Channel"
  - "priority: Priority"
  - "status: Status"
  - "created_at: timestamp"
  - "scheduled_at: timestamp"
  + "send(): void"
  + "get_status(): Status"
}

user: User {
  shape: class
  class: entity
  - "id: string"
  - "email: string"
  - "phone: string"
  - "timezone: string"
  - "locale: string"
  - "created_at: timestamp"
  + "get_preferences(): UserPreference[]"
  + "update_profile(data: UserData): void"
}

template: Template {
  shape: class
  class: entity
  - "id: string"
  - "name: string"
  - "category: string"
  - "subject: string"
  - "body_template: string"
  - "supported_channels: Channel[]"
  - "variables: string[]"
  - "created_at: timestamp"
  + "render(variables: Map<string, any>): string"
  + "validate(): boolean"
}

preference: UserPreference {
  shape: class
  class: entity
  - "id: string"
  - "user_id: string"
  - "channel: Channel"
  - "category: string"
  - "enabled: boolean"
  - "quiet_hours_start: time"
  - "quiet_hours_end: time"
  - "updated_at: timestamp"
  + "is_allowed(category: string, time: timestamp): boolean"
}

delivery: DeliveryRecord {
  shape: class
  class: entity
  - "id: string"
  - "notification_id: string"
  - "user_id: string"
  - "channel: Channel"
  - "status: DeliveryStatus"
  - "provider: string"
  - "external_id: string"
  - "attempts: int"
  - "delivered_at: timestamp"
  - "error_message: string"
  + "update_status(status: DeliveryStatus): void"
  + "retry(): void"
}

notification -> user: "belongs to" {
  class: relationship
}

notification -> template: "uses" {
  class: relationship
}

user -> preference: "has many" {
  class: relationship
}

notification -> delivery: "creates" {
  class: relationship
}

delivery -> user: "delivered to" {
  class: relationship
}

template -> notification: "instantiated as" {
  class: relationship
}