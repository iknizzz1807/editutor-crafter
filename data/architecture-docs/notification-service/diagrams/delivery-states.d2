title: Delivery Status State Machine

init: {
  shape: circle
  style.fill: "#3fb950"
  label: ""
}

queued: Queued {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

sent: Sent {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

delivered: Delivered {
  shape: circle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.double-border: true
}

failed: Failed {
  shape: circle
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
  style.double-border: true
}

bounced: Bounced {
  shape: circle
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
  style.double-border: true
}

opened: Opened {
  shape: circle
  style.fill: "#0984e3"
  style.stroke: "#74b9ff"
  style.font-color: "#ffffff"
}

clicked: Clicked {
  shape: circle
  style.fill: "#00b894"
  style.stroke: "#55efc4"
  style.font-color: "#ffffff"
  style.double-border: true
}

init -> queued: Submit notification

queued -> sent: Provider accepts {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

sent -> delivered: Delivery webhook {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

sent -> failed: Failure webhook {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

sent -> bounced: Bounce webhook {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

sent -> failed: Timeout (24h) {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  style.stroke-dash: 3
}

delivered -> opened: Open tracking pixel {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

opened -> clicked: Click tracking link {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

delivered -> clicked: Direct click (no open) {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  style.stroke-dash: 3
}

webhooks: Webhook Sources {
  shape: rectangle
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  sendgrid: SendGrid
  twilio: Twilio
  fcm: Firebase FCM
  apns: Apple APNS
}

timeout: Timeout Monitor {
  shape: rectangle
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

webhooks -> sent: Status updates {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

timeout -> sent: Check expired {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  style.stroke-dash: 3
}

legend: |md
  **State Types:**
  • **Green border**: Active states
  • **Red fill**: Terminal failure states
  • **Blue fill**: Engagement states
  • **Double border**: Final states
  • **Dashed arrows**: Timeout/fallback transitions
| {
  shape: page
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  near: bottom-right
}