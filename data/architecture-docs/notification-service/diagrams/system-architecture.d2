title: System Architecture Overview

classes: {
  container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  service: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  datastore: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  external: {
    style.fill: "#2d3748"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  important: {
    style.stroke: "#3fb950"
    style.bold: true
  }
}

core_system: Core System {
  class: container
  
  api_gateway: API Gateway {
    class: service
  }
  
  notification_service: Notification Service {
    class: service
  }
  
  channel_handlers: Channel Handlers {
    class: container
    
    email_handler: Email Handler {
      class: service
    }
    
    sms_handler: SMS Handler {
      class: service
    }
    
    push_handler: Push Handler {
      class: service
    }
    
    inapp_handler: In-App Handler {
      class: service
    }
  }
  
  template_engine: Template Engine {
    class: service
  }
  
  preference_manager: User Preference Manager {
    class: service
  }
  
  message_queue: Message Queue {
    shape: queue
    class: service
  }
}

data_stores: Data Stores {
  class: container
  
  templates_db: Templates {
    shape: cylinder
    class: datastore
  }
  
  preferences_db: User Preferences {
    shape: cylinder
    class: datastore
  }
  
  tracking_db: Delivery Tracking {
    shape: cylinder
    class: datastore
  }
}

external_providers: External Providers {
  class: container
  
  sendgrid: SendGrid {
    shape: cloud
    class: external
  }
  
  twilio: Twilio {
    shape: cloud
    class: external
  }
  
  fcm: FCM {
    shape: cloud
    class: external
  }
}

# Main flow
api_gateway -> notification_service: Route Request {
  class: important
}

notification_service -> template_engine: Get Template
notification_service -> preference_manager: Check Preferences
notification_service -> message_queue: Queue Message

message_queue -> channel_handlers.email_handler: Email Message
message_queue -> channel_handlers.sms_handler: SMS Message  
message_queue -> channel_handlers.push_handler: Push Message
message_queue -> channel_handlers.inapp_handler: In-App Message

# Data access
template_engine <-> data_stores.templates_db: Read Templates
preference_manager <-> data_stores.preferences_db: Manage Preferences
channel_handlers <-> data_stores.tracking_db: Update Status

# External integrations
channel_handlers.email_handler -> external_providers.sendgrid: Send Email
channel_handlers.sms_handler -> external_providers.twilio: Send SMS
channel_handlers.push_handler -> external_providers.fcm: Send Push