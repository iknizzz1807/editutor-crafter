title: OAuth2 Provider System Components

classes: {
  endpoint: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  store: {
    style.fill: "#1a1a2e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  service: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

oauth_provider: OAuth2 Provider System {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  
  endpoints: API Endpoints {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    
    auth_endpoint: Authorization Endpoint {
      class: endpoint
    }
    
    token_endpoint: Token Endpoint {
      class: endpoint
    }
    
    userinfo_endpoint: UserInfo Endpoint {
      class: endpoint
    }
    
    jwks_endpoint: JWKS Endpoint {
      class: endpoint
    }
  }
  
  services: Core Services {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    
    client_registry: Client Registration {
      class: service
    }
    
    token_service: Token Service {
      class: service
    }
    
    auth_service: Authorization Service {
      class: service
    }
    
    jwt_service: JWT Service {
      class: service
    }
  }
  
  storage: Data Storage {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    
    user_store: User Store {
      shape: cylinder
      class: store
    }
    
    client_store: Client Store {
      shape: cylinder
      class: store
    }
    
    token_store: Token Store {
      shape: cylinder
      class: store
    }
    
    session_store: Session Store {
      shape: cylinder
      class: store
    }
  }
}

external_client: Client Application {
  class: endpoint
}

external_user: Resource Owner {
  shape: circle
  class: endpoint
}

# Client interactions
external_client -> oauth_provider.endpoints.auth_endpoint: Authorization Request
oauth_provider.endpoints.auth_endpoint -> external_user: Login/Consent
external_user -> oauth_provider.endpoints.auth_endpoint: Authorization Grant
oauth_provider.endpoints.auth_endpoint -> external_client: Authorization Code

external_client -> oauth_provider.endpoints.token_endpoint: Token Request
oauth_provider.endpoints.token_endpoint -> external_client: Access Token + ID Token

external_client -> oauth_provider.endpoints.userinfo_endpoint: User Info Request
oauth_provider.endpoints.userinfo_endpoint -> external_client: User Claims

external_client -> oauth_provider.endpoints.jwks_endpoint: Public Keys
oauth_provider.endpoints.jwks_endpoint -> external_client: JWT Keys

# Internal service relationships
oauth_provider.endpoints.auth_endpoint -> oauth_provider.services.auth_service: Validate Request
oauth_provider.endpoints.token_endpoint -> oauth_provider.services.token_service: Issue Tokens
oauth_provider.endpoints.userinfo_endpoint -> oauth_provider.services.auth_service: Validate Token
oauth_provider.endpoints.jwks_endpoint -> oauth_provider.services.jwt_service: Get Public Keys

oauth_provider.services.auth_service -> oauth_provider.services.client_registry: Validate Client
oauth_provider.services.token_service -> oauth_provider.services.jwt_service: Sign Tokens
oauth_provider.services.client_registry -> oauth_provider.storage.client_store: Client Data
oauth_provider.services.auth_service -> oauth_provider.storage.user_store: User Authentication
oauth_provider.services.token_service -> oauth_provider.storage.token_store: Store Tokens
oauth_provider.services.auth_service -> oauth_provider.storage.session_store: Session Management