title: Order Book Data Structure {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  tree_node: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  queue_node: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  order_node: {
    style.fill: "#2d3748"
    style.stroke: "#4a5568"
    style.font-color: "#e6edf3"
  }
  hash_map: {
    style.fill: "#1a202c"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

order_book: Order Book {
  class: container
  
  bid_tree: Bid Tree (Max Heap) {
    class: container
    
    bid_100_50: "Price: {100.50}" {
      class: tree_node
      
      bid_queue_100_50: FIFO Queue {
        shape: rectangle
        class: queue_node
        
        bid_order_1: "Order ID: B001\nQty: 500\nTime: 09:30:01" {
          class: order_node
        }
        
        bid_order_2: "Order ID: B002\nQty: 300\nTime: 09:30:05" {
          class: order_node
        }
      }
      
      bid_queue_100_50 -> bid_order_1
      bid_order_1 -> bid_order_2
    }
    
    bid_100_25: "Price: {100.25}" {
      class: tree_node
      
      bid_queue_100_25: FIFO Queue {
        shape: rectangle
        class: queue_node
        
        bid_order_3: "Order ID: B003\nQty: 1000\nTime: 09:29:45" {
          class: order_node
        }
      }
      
      bid_queue_100_25 -> bid_order_3
    }
    
    bid_100_00: "Price: {100.00}" {
      class: tree_node
      
      bid_queue_100_00: FIFO Queue {
        shape: rectangle
        class: queue_node
        
        bid_order_4: "Order ID: B004\nQty: 750\nTime: 09:28:30" {
          class: order_node
        }
      }
      
      bid_queue_100_00 -> bid_order_4
    }
    
    bid_100_50 -> bid_100_25
    bid_100_25 -> bid_100_00
  }
  
  ask_tree: Ask Tree (Min Heap) {
    class: container
    
    ask_101_00: "Price: {101.00}" {
      class: tree_node
      
      ask_queue_101_00: FIFO Queue {
        shape: rectangle
        class: queue_node
        
        ask_order_1: "Order ID: A001\nQty: 400\nTime: 09:30:02" {
          class: order_node
        }
        
        ask_order_2: "Order ID: A002\nQty: 600\nTime: 09:30:08" {
          class: order_node
        }
      }
      
      ask_queue_101_00 -> ask_order_1
      ask_order_1 -> ask_order_2
    }
    
    ask_101_25: "Price: {101.25}" {
      class: tree_node
      
      ask_queue_101_25: FIFO Queue {
        shape: rectangle
        class: queue_node
        
        ask_order_3: "Order ID: A003\nQty: 200\nTime: 09:29:50" {
          class: order_node
        }
      }
      
      ask_queue_101_25 -> ask_order_3
    }
    
    ask_101_50: "Price: {101.50}" {
      class: tree_node
      
      ask_queue_101_50: FIFO Queue {
        shape: rectangle
        class: queue_node
        
        ask_order_4: "Order ID: A004\nQty: 900\nTime: 09:28:15" {
          class: order_node
        }
      }
      
      ask_queue_101_50 -> ask_order_4
    }
    
    ask_101_00 -> ask_101_25
    ask_101_25 -> ask_101_50
  }
}

hash_lookup: Order ID Hash Map {
  class: hash_map
  
  hash_entries: |md
    **Fast O(1) Lookup**
    
    B001 → Bid {100.50} Queue
    B002 → Bid {100.50} Queue  
    B003 → Bid {100.25} Queue
    B004 → Bid {100.00} Queue
    A001 → Ask {101.00} Queue
    A002 → Ask {101.00} Queue
    A003 → Ask {101.25} Queue
    A004 → Ask {101.50} Queue
  | {
    shape: page
    style.fill: "#1a202c"
    style.font-color: "#e6edf3"
  }
}

spread_info: "Best Bid: {100.50}\nBest Ask: {101.00}\nSpread: {0.50}" {
  shape: page
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
  near: bottom-center
}

hash_lookup -> order_book.bid_tree.bid_100_50.bid_queue_100_50: O(1) lookup
hash_lookup -> order_book.ask_tree.ask_101_00.ask_queue_101_00: O(1) lookup