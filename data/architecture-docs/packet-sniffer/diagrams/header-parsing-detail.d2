classes: {
  parser: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  utility: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  field: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

title: Protocol Header Parsing Detail {
  near: top-center
  style.font-size: 18
  style.font-color: "#e6edf3"
  style.bold: true
}

ethernet_parser: Ethernet Parser {
  class: parser
  
  eth_header: Ethernet Header {
    class: field
    dst_mac: "6 bytes"
    src_mac: "6 bytes"
    ethertype: "2 bytes"
  }
  
  eth_validator: Header Validator {
    class: utility
  }
  
  eth_extractor: Field Extractor {
    class: utility
  }
}

ipv4_parser: IPv4 Parser {
  class: parser
  
  ipv4_header: IPv4 Header {
    class: field
    version_ihl: "1 byte"
    tos: "1 byte"
    total_length: "2 bytes"
    identification: "2 bytes"
    flags_fragment: "2 bytes"
    ttl: "1 byte"
    protocol: "1 byte"
    checksum: "2 bytes"
    src_ip: "4 bytes"
    dst_ip: "4 bytes"
    options: "variable"
  }
  
  ipv4_validator: Header Validator {
    class: utility
  }
  
  ipv4_extractor: Field Extractor {
    class: utility
  }
  
  ipv4_checksum: Checksum Validator {
    class: utility
  }
}

ipv6_parser: IPv6 Parser {
  class: parser
  
  ipv6_header: IPv6 Header {
    class: field
    version_class_label: "4 bytes"
    payload_length: "2 bytes"
    next_header: "1 byte"
    hop_limit: "1 byte"
    src_ip: "16 bytes"
    dst_ip: "16 bytes"
  }
  
  ipv6_validator: Header Validator {
    class: utility
  }
  
  ipv6_extractor: Field Extractor {
    class: utility
  }
  
  extension_parser: Extension Header Parser {
    class: utility
  }
}

tcp_parser: TCP Parser {
  class: parser
  
  tcp_header: TCP Header {
    class: field
    src_port: "2 bytes"
    dst_port: "2 bytes"
    seq_number: "4 bytes"
    ack_number: "4 bytes"
    flags: "2 bytes"
    window: "2 bytes"
    checksum: "2 bytes"
    urgent: "2 bytes"
    options: "variable"
  }
  
  tcp_validator: Header Validator {
    class: utility
  }
  
  tcp_extractor: Field Extractor {
    class: utility
  }
  
  tcp_checksum: Checksum Validator {
    class: utility
  }
  
  tcp_options: Options Parser {
    class: utility
  }
}

udp_parser: UDP Parser {
  class: parser
  
  udp_header: UDP Header {
    class: field
    src_port: "2 bytes"
    dst_port: "2 bytes"
    length: "2 bytes"
    checksum: "2 bytes"
  }
  
  udp_validator: Header Validator {
    class: utility
  }
  
  udp_extractor: Field Extractor {
    class: utility
  }
  
  udp_checksum: Checksum Validator {
    class: utility
  }
}

shared_utilities: Shared Parsing Utilities {
  class: utility
  
  byte_order: Byte Order Conversion {
    class: utility
    ntoh16: "Network to Host 16-bit"
    ntoh32: "Network to Host 32-bit"
    hton16: "Host to Network 16-bit"
    hton32: "Host to Network 32-bit"
  }
  
  bit_operations: Bit Operations {
    class: utility
    extract_bits: "Extract bit fields"
    mask_apply: "Apply bit masks"
    shift_ops: "Bit shift operations"
  }
  
  buffer_ops: Buffer Operations {
    class: utility
    safe_read: "Safe buffer reading"
    bounds_check: "Boundary validation"
    offset_calc: "Offset calculation"
  }
}

ethernet_parser.eth_extractor -> shared_utilities.byte_order: uses
ethernet_parser.eth_extractor -> shared_utilities.buffer_ops: uses

ipv4_parser.ipv4_extractor -> shared_utilities.byte_order: uses
ipv4_parser.ipv4_extractor -> shared_utilities.bit_operations: uses
ipv4_parser.ipv4_extractor -> shared_utilities.buffer_ops: uses

ipv6_parser.ipv6_extractor -> shared_utilities.byte_order: uses
ipv6_parser.ipv6_extractor -> shared_utilities.bit_operations: uses
ipv6_parser.ipv6_extractor -> shared_utilities.buffer_ops: uses

tcp_parser.tcp_extractor -> shared_utilities.byte_order: uses
tcp_parser.tcp_extractor -> shared_utilities.bit_operations: uses
tcp_parser.tcp_extractor -> shared_utilities.buffer_ops: uses

udp_parser.udp_extractor -> shared_utilities.byte_order: uses
udp_parser.udp_extractor -> shared_utilities.buffer_ops: uses

ethernet_parser.eth_validator -> ethernet_parser.eth_header: validates
ipv4_parser.ipv4_validator -> ipv4_parser.ipv4_header: validates
ipv6_parser.ipv6_validator -> ipv6_parser.ipv6_header: validates
tcp_parser.tcp_validator -> tcp_parser.tcp_header: validates
udp_parser.udp_validator -> udp_parser.udp_header: validates