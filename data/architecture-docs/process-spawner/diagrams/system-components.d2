title: System Component Architecture {
  style.font-size: 24
  style.font-color: "#e6edf3"
  style.bold: true
}

classes: {
  container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.stroke-width: 2
  }
  component: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  worker: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  data_flow: {
    style.stroke: "#58a6ff"
    style.stroke-width: 2
  }
  control_flow: {
    style.stroke: "#f85149"
    style.stroke-width: 2
  }
  ipc_flow: {
    style.stroke: "#a5a5a5"
    style.stroke-width: 2
    style.stroke-dash: 5
  }
}

system: System Architecture {
  class: container
  
  process_manager: Process Manager {
    class: component
    lifecycle: Lifecycle Manager {
      class: worker
    }
    monitor: Process Monitor {
      class: worker
    }
    cleanup: Resource Cleanup {
      class: worker
    }
  }
  
  worker_pool: Worker Pool {
    class: component
    worker1: Child Process 1 {
      class: worker
    }
    worker2: Child Process 2 {
      class: worker
    }
    worker3: Child Process N {
      class: worker
    }
  }
  
  ipc_handler: IPC Handler {
    class: component
    pipe_mgr: Pipe Manager {
      class: worker
    }
    signal_mgr: Signal Handler {
      class: worker
    }
    msg_queue: Message Queue {
      class: worker
      shape: queue
    }
  }
}

external: External Interface {
  class: container
  client: Client Requests {
    class: component
  }
  os: Operating System {
    class: component
  }
}

# Control dependencies
external.client -> system.process_manager: spawn requests {
  class: control_flow
}
system.process_manager.lifecycle -> system.worker_pool: fork/exec {
  class: control_flow
}
system.process_manager.monitor -> system.worker_pool: status check {
  class: control_flow
}
system.process_manager.cleanup -> system.worker_pool: terminate {
  class: control_flow
}

# Data flow
system.worker_pool -> system.ipc_handler.pipe_mgr: stdout/stderr {
  class: data_flow
}
system.ipc_handler.pipe_mgr -> system.process_manager: process output {
  class: data_flow
}
system.process_manager -> external.client: results {
  class: data_flow
}

# IPC communication
system.ipc_handler.signal_mgr <-> system.worker_pool: signals {
  class: ipc_flow
}
system.ipc_handler.msg_queue <-> system.worker_pool: messages {
  class: ipc_flow
}

# OS interactions
system.worker_pool <-> external.os: system calls {
  class: ipc_flow
}
system.process_manager <-> external.os: process creation {
  class: ipc_flow
}

legend: Legend {
  class: container
  near: bottom-right
  
  control_line: Control Flow {
    style.stroke: "#f85149"
    style.stroke-width: 2
  }
  data_line: Data Flow {
    style.stroke: "#58a6ff"
    style.stroke-width: 2
  }
  ipc_line: IPC Communication {
    style.stroke: "#a5a5a5"
    style.stroke-width: 2
    style.stroke-dash: 5
  }
}