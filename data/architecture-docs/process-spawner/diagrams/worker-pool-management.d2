title: Worker Pool Management Flow

classes: {
  process_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  decision_style: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  action_style: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  failure_style: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
}

init: {
  shape: circle
  style.fill: "#3fb950"
  label: ""
}

spawn_pool: Initialize Worker Pool {
  shape: rectangle
  class: process_style
}

spawn_worker: Spawn Worker Process {
  shape: rectangle
  class: action_style
}

spawn_success: Fork/Exec Success? {
  shape: diamond
  class: decision_style
}

add_to_pool: Add to Available Workers {
  shape: rectangle
  class: action_style
}

spawn_retry: Retry Spawn {
  shape: rectangle
  class: failure_style
}

wait_task: Wait for Incoming Task {
  shape: rectangle
  class: process_style
}

worker_available: Available Worker? {
  shape: diamond
  class: decision_style
}

assign_task: Assign Task to Worker {
  shape: rectangle
  class: action_style
}

queue_task: Queue Task {
  shape: rectangle
  class: action_style
}

monitor_workers: Monitor Worker Status {
  shape: rectangle
  class: process_style
}

worker_done: Task Complete? {
  shape: diamond
  class: decision_style
}

collect_result: Collect Result {
  shape: rectangle
  class: action_style
}

worker_failed: Worker Crashed? {
  shape: diamond
  class: decision_style
}

respawn_worker: Respawn Failed Worker {
  shape: rectangle
  class: failure_style
}

return_to_pool: Return Worker to Pool {
  shape: rectangle
  class: action_style
}

init -> spawn_pool

spawn_pool -> spawn_worker

spawn_worker -> spawn_success

spawn_success -> add_to_pool: Yes
spawn_success -> spawn_retry: No

spawn_retry -> spawn_worker

add_to_pool -> wait_task

wait_task -> worker_available

worker_available -> assign_task: Yes
worker_available -> queue_task: No

assign_task -> monitor_workers
queue_task -> worker_available

monitor_workers -> worker_done

worker_done -> collect_result: Yes
worker_done -> worker_failed: No

collect_result -> return_to_pool

worker_failed -> respawn_worker: Yes
worker_failed -> wait_task: No

respawn_worker -> spawn_worker

return_to_pool -> wait_task