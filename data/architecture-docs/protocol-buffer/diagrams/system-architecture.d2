title: System Architecture Overview {
  near: top-center
  style.font-size: 20
  style.bold: true
  style.font-color: "#e6edf3"
}

classes: {
  layer: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.stroke-width: 2
  }
  component: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  dataflow: {
    style.stroke: "#3fb950"
    style.stroke-width: 2
    style.font-color: "#e6edf3"
  }
  important: {
    style.stroke: "#3fb950"
    style.bold: true
    style.stroke-width: 3
  }
}

varint_layer: Varint Encoding Layer {
  class: layer
  
  varint_encoder: Varint Encoder {
    class: component
  }
  
  varint_decoder: Varint Decoder {
    class: component
  }
  
  zigzag: ZigZag Encoding {
    class: component
  }
  
  varint_encoder <-> varint_decoder: encode/decode
  zigzag -> varint_encoder: signed integers
}

wire_types_layer: Wire Types Layer {
  class: layer
  
  varint_type: VARINT (0) {
    class: component
  }
  
  fixed64_type: FIXED64 (1) {
    class: component
  }
  
  length_delimited: LENGTH_DELIMITED (2) {
    class: component
    class: important
  }
  
  fixed32_type: FIXED32 (5) {
    class: component
  }
  
  type_detector: Wire Type Detector {
    class: component
  }
  
  type_detector -> varint_type
  type_detector -> fixed64_type
  type_detector -> length_delimited
  type_detector -> fixed32_type
}

schema_layer: Schema Parser Layer {
  class: layer
  
  proto_parser: Proto File Parser {
    class: component
  }
  
  field_descriptor: Field Descriptors {
    class: component
  }
  
  message_descriptor: Message Descriptors {
    class: component
    class: important
  }
  
  proto_parser -> field_descriptor: generates
  proto_parser -> message_descriptor: generates
  field_descriptor -> message_descriptor: contains
}

serialization_layer: Message Serialization Layer {
  class: layer
  
  serializer: Message Serializer {
    class: component
    class: important
  }
  
  deserializer: Message Deserializer {
    class: component
    class: important
  }
  
  field_writer: Field Writer {
    class: component
  }
  
  field_reader: Field Reader {
    class: component
  }
  
  serializer -> field_writer: uses
  deserializer -> field_reader: uses
  serializer <-> deserializer: binary data
}

varint_layer -> wire_types_layer: provides encoding {
  class: dataflow
}

wire_types_layer -> serialization_layer: type information {
  class: dataflow
}

schema_layer -> serialization_layer: field metadata {
  class: dataflow
}

data_flow: Raw Data {
  near: center-left
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

binary_output: Binary Stream {
  near: center-right
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

data_flow -> serialization_layer: input {
  style.stroke: "#3fb950"
  style.stroke-width: 2
  style.font-color: "#e6edf3"
}

serialization_layer -> binary_output: output {
  style.stroke: "#3fb950"
  style.stroke-width: 2
  style.font-color: "#e6edf3"
}