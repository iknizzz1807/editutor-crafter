title: Embedding Generation State Machine

classes: {
  state: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  initial: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#1a1a2e"
  }
  final: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
  }
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  transition: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

init: {
  shape: circle
  class: initial
  label: ""
}

pending: Pending {
  shape: circle
  class: state
}

cache_lookup: Cache Lookup {
  shape: circle
  class: state
}

cached: Cached {
  shape: circle
  class: final
}

processing: Processing {
  shape: circle
  class: state
}

rate_limited: Rate Limited {
  shape: circle
  class: error
}

failed: Failed {
  shape: circle
  class: error
}

completed: Completed {
  shape: circle
  class: final
}

init -> pending: New chunk received {
  class: transition
}

pending -> cache_lookup: Check cache {
  class: transition
}

cache_lookup -> cached: Cache hit {
  class: transition
}

cache_lookup -> processing: Cache miss {
  class: transition
}

processing -> rate_limited: Rate limit exceeded {
  class: transition
}

processing -> failed: API error {
  class: transition
}

processing -> completed: Embedding generated {
  class: transition
}

rate_limited -> processing: Retry after delay {
  class: transition
}

failed -> processing: Retry {
  class: transition
}

failed -> failed: Max retries exceeded {
  class: transition
}