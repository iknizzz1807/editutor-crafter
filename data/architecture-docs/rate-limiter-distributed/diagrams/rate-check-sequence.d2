shape: sequence_diagram

classes: {
  highlight: {
    style.stroke: "#3fb950"
    style.bold: true
  }
  service: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  storage: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

client: Client {
  class: highlight
}
api: API Gateway {
  class: service
}
limiter: Rate Limiter {
  class: service
}
redis: Redis {
  class: storage
}

client -> api: HTTP Request
api -> limiter: Check Rate Limit
limiter -> redis: EVAL Lua Script\n(atomic check & increment)
redis -> limiter: {allowed: true, count: 42, ttl: 58}
limiter -> redis: GET remaining window time
redis -> limiter: TTL: 58 seconds
limiter -> api: Rate Limit Result\n{allowed: true, remaining: 8}
api -> client: HTTP 200 OK\nX-RateLimit-Limit: 50\nX-RateLimit-Remaining: 8\nX-RateLimit-Reset: 58