title: Client Bucket Lifecycle

classes: {
  state_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.stroke-width: 2
  }
  
  initial_style: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#1a1a2e"
    style.stroke-width: 3
  }
  
  final_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
    style.stroke-width: 2
  }
  
  transition_style: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

init: {
  shape: circle
  label: ""
  class: initial_style
}

nonexistent: Non-Existent {
  shape: circle
  class: state_style
}

creating: Creating {
  shape: circle
  class: state_style
}

active: Active {
  shape: circle
  class: state_style
}

stale: Stale {
  shape: circle
  class: state_style
}

cleanup: Cleanup {
  shape: circle
  class: state_style
}

destroyed: Destroyed {
  shape: circle
  class: final_style
}

init -> nonexistent: {
  label: "System Start"
  class: transition_style
}

nonexistent -> creating: {
  label: "First Request\nfor Client"
  class: transition_style
}

creating -> active: {
  label: "Bucket\nInitialized"
  class: transition_style
}

active -> active: {
  label: "Token Requests\n(Reset TTL)"
  class: transition_style
}

active -> stale: {
  label: "TTL Expires\n(No Activity)"
  class: transition_style
}

stale -> active: {
  label: "New Request\n(Resurrect)"
  class: transition_style
}

stale -> cleanup: {
  label: "Cleanup Task\nDetects Stale"
  class: transition_style
}

cleanup -> destroyed: {
  label: "Memory\nFreed"
  class: transition_style
}

creating -> cleanup: {
  label: "Creation\nFails"
  class: transition_style
}