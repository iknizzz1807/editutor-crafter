classes: {
  entity: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  relationship: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  inheritance: {
    style.stroke: "#3fb950"
    style.stroke-width: 2
    style.font-color: "#e6edf3"
  }
  many_to_many: {
    style.stroke: "#ffa726"
    style.stroke-dash: 3
    style.font-color: "#e6edf3"
  }
}

User: {
  shape: class
  class: entity
  - "id: UUID"
  - "username: string"
  - "email: string"
  - "attributes: Map<string, any>"
  - "tenant_id: UUID"
  - "created_at: DateTime"
  + "hasAttribute(key: string): boolean"
  + "getAttribute(key: string): any"
}

Role: {
  shape: class
  class: entity
  - "id: UUID"
  - "name: string"
  - "description: string"
  - "parent_role_id: UUID"
  - "tenant_id: UUID"
  - "is_system: boolean"
  + "getAncestors(): Role[]"
  + "getDescendants(): Role[]"
}

Permission: {
  shape: class
  class: entity
  - "id: UUID"
  - "action: string"
  - "resource_type: string"
  - "scope: string"
  - "tenant_id: UUID"
  + "matches(action: string, resource: string): boolean"
}

Policy: {
  shape: class
  class: entity
  - "id: UUID"
  - "name: string"
  - "rules: PolicyRule[]"
  - "effect: PolicyEffect"
  - "tenant_id: UUID"
  - "is_active: boolean"
  + "evaluate(context: Context): PolicyResult"
  + "addRule(rule: PolicyRule): void"
}

Resource: {
  shape: class
  class: entity
  - "id: UUID"
  - "resource_type: string"
  - "identifier: string"
  - "owner_id: UUID"
  - "tenant_id: UUID"
  - "attributes: Map<string, any>"
  + "isOwnedBy(user_id: UUID): boolean"
  + "hasAttribute(key: string): boolean"
}

Tenant: {
  shape: class
  class: entity
  - "id: UUID"
  - "name: string"
  - "domain: string"
  - "settings: Map<string, any>"
  - "is_active: boolean"
  + "getUsers(): User[]"
  + "getRoles(): Role[]"
}

UserRoles: {
  shape: class
  class: entity
  - "user_id: UUID"
  - "role_id: UUID"
  - "assigned_at: DateTime"
  - "assigned_by: UUID"
}

RolePermissions: {
  shape: class
  class: entity
  - "role_id: UUID"
  - "permission_id: UUID"
  - "granted_at: DateTime"
  - "granted_by: UUID"
}

PolicyAssignments: {
  shape: class
  class: entity
  - "policy_id: UUID"
  - "subject_id: UUID"
  - "subject_type: SubjectType"
  - "assigned_at: DateTime"
}

User -> Tenant: "belongs to" {class: relationship}
Role -> Tenant: "scoped to" {class: relationship}
Permission -> Tenant: "scoped to" {class: relationship}
Policy -> Tenant: "scoped to" {class: relationship}
Resource -> Tenant: "owned by" {class: relationship}
Resource -> User: "owned by" {class: relationship}

Role -> Role: "parent_role_id" {class: inheritance}

User -> UserRoles: "many-to-many" {class: many_to_many}
UserRoles -> Role: "many-to-many" {class: many_to_many}

Role -> RolePermissions: "many-to-many" {class: many_to_many}
RolePermissions -> Permission: "many-to-many" {class: many_to_many}

Policy -> PolicyAssignments: "many-to-many" {class: many_to_many}
PolicyAssignments -> User: "applies to" {class: many_to_many}
PolicyAssignments -> Role: "applies to" {class: many_to_many}