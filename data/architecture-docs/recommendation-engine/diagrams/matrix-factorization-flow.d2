classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  data: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  model: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

start: Start {
  shape: circle
  class: process
}

input_data: Rating Matrix R {
  class: data
}

init: Initialize Matrices {
  class: process
}

user_matrix: User Matrix U {
  class: data
}

item_matrix: Item Matrix V {
  class: data
}

iteration: Training Iteration {
  class: process
}

svd_step: SVD Decomposition {
  class: process
}

als_step: ALS Factor Update {
  class: process
}

regularization: Apply Regularization {
  class: process
}

compute_loss: Compute Loss Function {
  class: process
}

convergence: Converged? {
  shape: diamond
  class: decision
}

update_factors: Update Factor Matrices {
  class: process
}

final_model: Trained Model {
  class: model
}

output: Model Output {
  shape: circle
  class: model
}

start -> input_data

input_data -> init: "Sparse ratings"

init -> user_matrix
init -> item_matrix

user_matrix -> iteration
item_matrix -> iteration

iteration -> svd_step: "SVD Algorithm"
iteration -> als_step: "ALS Algorithm"

svd_step -> regularization
als_step -> regularization

regularization -> compute_loss: "L1/L2 penalty"

compute_loss -> convergence: "Loss + regularization"

convergence -> update_factors: "No"
convergence -> final_model: "Yes"

update_factors -> user_matrix: "Update U"
update_factors -> item_matrix: "Update V"

final_model -> output

note: |md
  ## Matrix Factorization Training
  
  **Key Components:**
  - **R**: User-item rating matrix (sparse)
  - **U**: User latent factor matrix (users × k)
  - **V**: Item latent factor matrix (items × k)
  - **k**: Number of latent factors (typically 50-200)
  
  **Algorithms:**
  - **SVD**: Singular Value Decomposition
  - **ALS**: Alternating Least Squares
| {
  shape: page
  near: top-right
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}