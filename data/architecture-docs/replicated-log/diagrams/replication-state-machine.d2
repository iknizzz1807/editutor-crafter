title: Node State Machine

# State nodes
follower: Follower {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

candidate: Candidate {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

leader: Leader {
  shape: circle
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.double-border: true
  style.bold: true
}

# Initial state
init: {
  shape: circle
  style.fill: "#3fb950"
  style.stroke: "#3fb950"
  label: ""
  width: 20
  height: 20
}

# State transitions
init -> follower: Start

follower -> candidate: Election timeout\nNo heartbeat received {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

candidate -> leader: Majority votes\nreceived {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

candidate -> follower: Higher term\ndiscovered {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

candidate -> candidate: Election timeout\nSplit vote {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

leader -> follower: Higher term\ndiscovered {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

follower -> follower: Heartbeat\nreceived {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}

leader -> leader: Send heartbeats\nto followers {
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
}