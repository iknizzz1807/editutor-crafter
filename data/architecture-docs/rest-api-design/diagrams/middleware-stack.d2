shape: sequence_diagram

client: Client
rate_limiter: Rate Limiter
auth: Authentication
validator: Validator
handler: CRUD Handler
error_handler: Error Handler

client -> rate_limiter: HTTP Request
rate_limiter -> rate_limiter: Check rate limits
rate_limiter -> error_handler: Rate limit exceeded {
  style.stroke: "#d63031"
}
error_handler -> client: 429 Too Many Requests {
  style.stroke: "#d63031"
}

rate_limiter -> auth: Forward request
auth -> auth: Verify credentials
auth -> error_handler: Invalid auth {
  style.stroke: "#d63031"
}
error_handler -> client: 401 Unauthorized {
  style.stroke: "#d63031"
}

auth -> validator: Authenticated request
validator -> validator: Validate input
validator -> error_handler: Validation failed {
  style.stroke: "#d63031"
}
error_handler -> client: 400 Bad Request {
  style.stroke: "#d63031"
}

validator -> handler: Valid request
handler -> handler: Execute CRUD operation
handler -> error_handler: Business logic error {
  style.stroke: "#d63031"
}
error_handler -> client: 500 Internal Error {
  style.stroke: "#d63031"
}

handler -> validator: Success response
validator -> auth: Pass through
auth -> rate_limiter: Pass through
rate_limiter -> client: 200 OK Response {
  style.stroke: "#3fb950"
}

classes: {
  middleware: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
}

rate_limiter: {
  class: middleware
}
auth: {
  class: middleware
}
validator: {
  class: middleware
}
handler: {
  class: middleware
}
error_handler: {
  style.fill: "#2d1b69"
  style.stroke: "#d63031"
  style.font-color: "#e6edf3"
  style.bold: true
}