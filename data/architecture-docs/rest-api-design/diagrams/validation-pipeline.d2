title: Input Validation Pipeline

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  success: {
    style.fill: "#00b894"
    style.stroke: "#00cec9"
    style.font-color: "#ffffff"
    style.bold: true
  }
}

start: {
  shape: circle
  label: "Start"
  style.fill: "#3fb950"
  style.font-color: "#ffffff"
}

input: Incoming Request {
  class: process
}

json_parse: JSON Parsing {
  class: process
}

json_valid: {
  shape: diamond
  label: "Valid JSON?"
  class: decision
}

json_error: JSON Parse Error {
  class: error
}

schema_validate: Schema Validation {
  class: process
}

schema_valid: {
  shape: diamond
  label: "Schema Valid?"
  class: decision
}

schema_error: Schema Validation Error {
  class: error
}

business_validate: Business Rule Validation {
  class: process
}

business_valid: {
  shape: diamond
  label: "Business Rules OK?"
  class: decision
}

business_error: Business Rule Error {
  class: error
}

sanitize: Data Sanitization {
  class: process
}

sanitize_complete: {
  shape: diamond
  label: "Sanitization Complete?"
  class: decision
}

sanitize_error: Sanitization Error {
  class: error
}

validated: Validated Input {
  class: success
}

start -> input
input -> json_parse
json_parse -> json_valid
json_valid -> json_error: "No"
json_valid -> schema_validate: "Yes"
schema_validate -> schema_valid
schema_valid -> schema_error: "No"
schema_valid -> business_validate: "Yes"
business_validate -> business_valid
business_valid -> business_error: "No"
business_valid -> sanitize: "Yes"
sanitize -> sanitize_complete
sanitize_complete -> sanitize_error: "No"
sanitize_complete -> validated: "Yes"