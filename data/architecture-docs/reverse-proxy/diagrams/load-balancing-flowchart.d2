# Load Balancing Decision Flow
direction: down

classes: {
  start_node: {
    style.fill: "#3fb950"
    style.font-color: "#ffffff"
    style.stroke: "#2d8a3e"
    style.bold: true
  }
  decision: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  process: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  error: {
    style.fill: "#d63031"
    style.font-color: "#ffffff"
    style.stroke: "#e17055"
    style.bold: true
  }
  success: {
    style.fill: "#00b894"
    style.font-color: "#ffffff"
    style.stroke: "#00a085"
  }
}

start: Incoming Request {
  shape: circle
  class: start_node
}

health_check: Health Check\nValidation {
  shape: diamond
  class: decision
}

servers_available: Available\nHealthy Servers? {
  shape: diamond
  class: decision
}

algorithm_selection: Select Load Balancing\nAlgorithm {
  class: process
}

round_robin: Round Robin\nNext in sequence {
  class: process
}

least_connections: Least Connections\nFind minimum active {
  class: process
}

weighted: Weighted Round Robin\nConsider server capacity {
  class: process
}

validate_selection: Selected Server\nStill Healthy? {
  shape: diamond
  class: decision
}

forward_request: Forward Request\nto Selected Server {
  class: process
}

fallback_check: Fallback Servers\nAvailable? {
  shape: diamond
  class: decision
}

emergency_response: Emergency Response\nStatic error page {
  class: process
}

circuit_breaker: Circuit Breaker\nTriggered {
  class: error
}

success_response: Request Successfully\nRouted {
  shape: circle
  class: success
}

error_response: Service\nUnavailable {
  shape: circle
  class: error
}

start -> health_check
health_check -> servers_available: Perform checks
servers_available -> algorithm_selection: Yes
servers_available -> fallback_check: No

algorithm_selection -> round_robin: Round Robin
algorithm_selection -> least_connections: Least Connections
algorithm_selection -> weighted: Weighted

round_robin -> validate_selection
least_connections -> validate_selection
weighted -> validate_selection

validate_selection -> forward_request: Yes
validate_selection -> algorithm_selection: No - Retry

forward_request -> success_response

fallback_check -> emergency_response: Yes
fallback_check -> circuit_breaker: No

emergency_response -> error_response
circuit_breaker -> error_response