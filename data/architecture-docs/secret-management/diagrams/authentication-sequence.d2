shape: sequence_diagram

client: Client
auth_engine: Authentication Engine
policy_engine: Policy Engine
secret_engine: Secret Engine
audit_logger: Audit Logger
crypto_engine: Crypto Engine

client -> auth_engine: Login request (credentials)
auth_engine -> auth_engine: Validate credentials
auth_engine -> client: Authentication token

client -> secret_engine: Request secret (token, path)
secret_engine -> auth_engine: Validate token
auth_engine -> secret_engine: Token valid + identity

secret_engine -> policy_engine: Check permissions (identity, path)
policy_engine -> policy_engine: Evaluate path-based policies
policy_engine -> secret_engine: Access granted

secret_engine -> audit_logger: Log access attempt
secret_engine -> crypto_engine: Decrypt secret
crypto_engine -> secret_engine: Decrypted secret

secret_engine -> client: Return secret
secret_engine -> audit_logger: Log successful retrieval

client.style.fill: "#0f3460"
client.style.stroke: "#3fb950"
client.style.font-color: "#e6edf3"

auth_engine.style.fill: "#1a1a2e"
auth_engine.style.stroke: "#3fb950"
auth_engine.style.font-color: "#e6edf3"

policy_engine.style.fill: "#1a1a2e"
policy_engine.style.stroke: "#3fb950"
policy_engine.style.font-color: "#e6edf3"

secret_engine.style.fill: "#16213e"
secret_engine.style.stroke: "#3fb950"
secret_engine.style.font-color: "#e6edf3"
secret_engine.style.bold: true

audit_logger.style.fill: "#1a1a2e"
audit_logger.style.stroke: "#8b949e"
audit_logger.style.font-color: "#e6edf3"

crypto_engine.style.fill: "#1a1a2e"
crypto_engine.style.stroke: "#3fb950"
crypto_engine.style.font-color: "#e6edf3"