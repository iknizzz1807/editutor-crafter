direction: down

title: Data Model Relationships

classes: {
  entity: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  abstract: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
    style.italic: true
  }
  policy_rule: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

secret_base: Secret {
  shape: class
  class: abstract
  - "id: string"
  - "path: string"
  - "encrypted_data: bytes"
  - "data_key_id: string"
  - "version: int"
  - "created_at: timestamp"
  - "updated_at: timestamp"
  - "metadata: Map<string, string>"
  + "encrypt_data(plaintext: bytes): void"
  + "decrypt_data(): bytes"
  + "create_version(): Secret"
}

static_secret: StaticSecret {
  shape: class
  class: entity
  - "value: string"
  - "content_type: string"
  + "get_value(): string"
  + "set_value(value: string): void"
}

dynamic_secret: DynamicSecret {
  shape: class
  class: entity
  - "template_id: string"
  - "ttl: duration"
  - "renewable: bool"
  - "generator_config: Map<string, string>"
  + "generate(): Lease"
  + "revoke(lease_id: string): void"
}

certificate_secret: CertificateSecret {
  shape: class
  class: entity
  - "certificate: string"
  - "private_key: string"
  - "ca_chain: string"
  - "expires_at: timestamp"
  + "is_expired(): bool"
  + "renew(): CertificateSecret"
}

policy: Policy {
  shape: class
  class: entity
  - "id: string"
  - "name: string"
  - "description: string"
  - "created_at: timestamp"
  - "updated_at: timestamp"
  + "evaluate(token: Token, path: string, action: string): bool"
  + "add_rule(rule: PolicyRule): void"
  + "remove_rule(rule_id: string): void"
}

policy_rule: PolicyRule {
  shape: class
  class: policy_rule
  - "id: string"
  - "path_pattern: string"
  - "actions: List<string>"
  - "conditions: Map<string, string>"
  - "effect: enum[Allow, Deny]"
  + "matches(path: string, action: string): bool"
  + "evaluate_conditions(context: Map<string, string>): bool"
}

token: Token {
  shape: class
  class: entity
  - "id: string"
  - "accessor: string"
  - "policies: List<string>"
  - "ttl: duration"
  - "created_at: timestamp"
  - "expires_at: timestamp"
  - "renewable: bool"
  - "parent_token: string"
  + "is_expired(): bool"
  + "renew(increment: duration): void"
  + "has_policy(policy_name: string): bool"
}

lease: Lease {
  shape: class
  class: entity
  - "id: string"
  - "secret_id: string"
  - "token_id: string"
  - "ttl: duration"
  - "created_at: timestamp"
  - "expires_at: timestamp"
  - "renewable: bool"
  - "revoked: bool"
  + "is_expired(): bool"
  + "renew(increment: duration): void"
  + "revoke(): void"
}

secret_base -> static_secret: inherits {
  style.stroke: "#3fb950"
  style.stroke-dash: 3
}

secret_base -> dynamic_secret: inherits {
  style.stroke: "#3fb950"
  style.stroke-dash: 3
}

secret_base -> certificate_secret: inherits {
  style.stroke: "#3fb950"
  style.stroke-dash: 3
}

policy -> policy_rule: "composed of *" {
  style.stroke: "#8b949e"
}

token -> policy: "references *" {
  style.stroke: "#8b949e"
}

dynamic_secret -> lease: generates {
  style.stroke: "#8b949e"
}

lease -> secret_base: references {
  style.stroke: "#8b949e"
}

lease -> token: "belongs to" {
  style.stroke: "#8b949e"
}

token -> token: parent {
  style.stroke: "#8b949e"
}