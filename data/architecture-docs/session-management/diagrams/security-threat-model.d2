title: Security Threat Model and Countermeasures {
  style.font-size: 24
  style.bold: true
  style.font-color: "#e6edf3"
  near: top-center
}

classes: {
  threat: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  control: {
    style.fill: "#00b894"
    style.stroke: "#00cec9"
    style.font-color: "#ffffff"
    style.bold: true
  }
  component: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#fdcb6e"
    style.stroke: "#e17055"
    style.font-color: "#2d3436"
    style.bold: true
  }
}

threats: Attack Vectors {
  class: component
  
  session_fixation: Session Fixation {
    class: threat
    label: |md
      **Session Fixation**
      Attacker sets known session ID
      before user authentication
    |
  }
  
  session_hijacking: Session Hijacking {
    class: threat
    label: |md
      **Session Hijacking**
      Attacker steals valid
      session token via XSS/MITM
    |
  }
  
  csrf: CSRF Attack {
    class: threat
    label: |md
      **CSRF Attack**
      Malicious site executes
      unauthorized requests
    |
  }
}

security_controls: Security Controls {
  class: component
  
  id_regeneration: Session ID Regeneration {
    class: control
    label: |md
      **ID Regeneration**
      New session ID on
      authentication/privilege change
    |
  }
  
  encryption: Cookie Encryption {
    class: control
    label: |md
      **Cookie Encryption**
      AES-256 encryption prevents
      client-side tampering
    |
  }
  
  samesite: SameSite Attribute {
    class: control
    label: |md
      **SameSite=Strict**
      Blocks cross-site
      cookie transmission
    |
  }
  
  httponly: HttpOnly Flag {
    class: control
    label: |md
      **HttpOnly Flag**
      Prevents JavaScript
      access to cookies
    |
  }
  
  secure: Secure Flag {
    class: control
    label: |md
      **Secure Flag**
      HTTPS-only cookie
      transmission
    |
  }
  
  csrf_token: CSRF Token {
    class: control
    label: |md
      **CSRF Tokens**
      Unique per-request
      validation tokens
    |
  }
}

components: Session Components {
  class: component
  
  session_manager: Session Manager {
    class: component
    label: |md
      **Session Manager**
      Central orchestrator for
      session operations
    |
  }
  
  cookie_security: Cookie Security {
    class: component
    label: |md
      **Cookie Security**
      Secure cookie handling
      and transport protection
    |
  }
  
  session_store: Session Store {
    class: component
    shape: cylinder
    label: |md
      **Distributed Storage**
      Redis/Database backend
      for session persistence
    |
  }
}

validation: Request Validation {
  shape: diamond
  class: decision
  label: Validate Session?
}

threats.session_fixation -> security_controls.id_regeneration: mitigated by
threats.session_hijacking -> security_controls.encryption: protected by
threats.session_hijacking -> security_controls.httponly: blocked by
threats.session_hijacking -> security_controls.secure: secured by
threats.csrf -> security_controls.samesite: prevented by
threats.csrf -> security_controls.csrf_token: validated by

security_controls.id_regeneration -> components.session_manager: implemented in
security_controls.encryption -> components.cookie_security: handled by
security_controls.samesite -> components.cookie_security: configured in
security_controls.httponly -> components.cookie_security: set by
security_controls.secure -> components.cookie_security: enforced by
security_controls.csrf_token -> components.session_manager: generated by

components.session_manager -> validation: processes request
validation -> components.session_store: Valid Session
validation -> threats: Invalid/Missing: "Potential Attack"

components.session_manager <-> components.session_store: store/retrieve
components.session_manager -> components.cookie_security: secure transport

legend: Security Legend {
  class: component
  near: bottom-right
  
  threat_ex: Threat {
    class: threat
    shape: circle
  }
  
  control_ex: Control {
    class: control
    shape: circle
  }
  
  component_ex: Component {
    class: component
    shape: rectangle
  }
}