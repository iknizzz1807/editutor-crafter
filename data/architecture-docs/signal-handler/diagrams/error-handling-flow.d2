classes: {
  error: {
    style.fill: "#d63031"
    style.font-color: "#ffffff"
    style.stroke: "#e17055"
    style.bold: true
  }
  recovery: {
    style.fill: "#00b894"
    style.font-color: "#ffffff"
    style.stroke: "#00a085"
  }
  decision: {
    style.fill: "#fdcb6e"
    style.font-color: "#2d3436"
    style.stroke: "#f39c12"
    style.bold: true
  }
  fallback: {
    style.fill: "#6c5ce7"
    style.font-color: "#ffffff"
    style.stroke: "#5f3dc4"
  }
}

start: Start Signal Handler {
  shape: circle
  style.fill: "#3fb950"
  style.font-color: "#ffffff"
}

register: Register Signal Handler {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

reg_check: Registration Success? {
  shape: diamond
  class: decision
}

reg_error: Handler Registration Failed {
  class: error
}

reg_retry: Retry Registration {
  class: recovery
}

reg_fallback: Use Default Handler {
  class: fallback
}

mask_op: Set Signal Mask {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

mask_check: Mask Operation Success? {
  shape: diamond
  class: decision
}

mask_error: Signal Mask Failed {
  class: error
}

mask_retry: Restore Previous Mask {
  class: recovery
}

mask_fallback: Continue Without Mask {
  class: fallback
}

pipe_write: Write to Self-Pipe {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

pipe_check: Pipe Write Success? {
  shape: diamond
  class: decision
}

pipe_error: Pipe Write Failed {
  class: error
}

pipe_retry: Retry Pipe Write {
  class: recovery
}

pipe_fallback: Set Flag Only {
  class: fallback
}

cleanup: Cleanup Resources {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
}

success: Signal Handled Successfully {
  shape: circle
  style.fill: "#00b894"
  style.font-color: "#ffffff"
  style.double-border: true
}

start -> register

register -> reg_check

reg_check -> mask_op: Yes
reg_check -> reg_error: No

reg_error -> reg_retry: EAGAIN/EINTR
reg_error -> reg_fallback: EINVAL/ENOSYS

reg_retry -> register: Attempt < 3
reg_retry -> reg_fallback: Max Attempts

reg_fallback -> mask_op

mask_op -> mask_check

mask_check -> pipe_write: Yes
mask_check -> mask_error: No

mask_error -> mask_retry: EINTR
mask_error -> mask_fallback: EINVAL/EPERM

mask_retry -> mask_op
mask_fallback -> pipe_write

pipe_write -> pipe_check

pipe_check -> cleanup: Yes
pipe_check -> pipe_error: No

pipe_error -> pipe_retry: EAGAIN/EINTR
pipe_error -> pipe_fallback: EPIPE/EBADF

pipe_retry -> pipe_write: Attempt < 3
pipe_retry -> pipe_fallback: Max Attempts

pipe_fallback -> cleanup

cleanup -> success