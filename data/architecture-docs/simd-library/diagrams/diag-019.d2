vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}
direction: right

Title: |md
  # Test Matrix Coverage
  Comprehensive Permutation Strategy
| {
  shape: text
  near: top-center
  link: "#anchor-testing"
}

Dimensions: {
  link: "#anchor-testing"
  style: {
    fill: "transparent"
    stroke-width: 0
  }

  # Dimension 1: CPU Architecture
  Hardware: "CPU Targets" {
    link: "#anchor-testing"
    shape: class
    style: {
      stroke: "#F56565"
      fill: "#FFF5F5"
    }
    
    "AVX-512F": "Skylake+"
    "AVX2": "Haswell+"
    "SSE 4.2": "Legacy"
    "Scalar": "Fallback"
  }

  # Dimension 2: Data Topology
  Data: "Buffer Scenarios" {
    link: "#anchor-testing"
    shape: class
    style: {
      stroke: "#4299E1"
      fill: "#EBF8FF"
    }

    "Micro": "< 16 Bytes"
    "Small": "L1 Cache"
    "Medium": "L3 Cache"
    "Huge": "Main RAM"
  }

  # Dimension 3: Memory Alignment
  Memory: "Alignment Offsets" {
    link: "#anchor-testing"
    shape: class
    style: {
      stroke: "#48BB78"
      fill: "#F0FFF4"
    }

    "Aligned": "0x00"
    "Offset +1": "0x01 (Worst Case)"
    "Offset +7": "0x07 (Odd)"
    "Split": "Page Boundary"
  }
}

# The Test Execution Logic
Runner: "Torture Chamber\n(Test Runner)" {
  link: "#anchor-testing"
  shape: package
  style: {
    fill: "#2D3748"
    stroke: "#1A202C"
    font-color: "#FFFFFF"
    shadow: true
  }
}

# Validation Logic
Validation: {
  link: "#anchor-testing"
  style: {
    fill: "transparent"
    stroke-width: 0
  }

  Oracle: "Scalar Oracle\n(std::accumulate)" {
    link: "#anchor-testing"
    shape: person
    style.fill: "#ECC94B"
  }

  Comparator: "Result Verification" {
    link: "#anchor-testing"
    shape: diamond
    style.fill: "#ED64A6"
    style.font-color: "white"
  }

  Output: "Crash / Success" {
    link: "#anchor-testing"
    shape: parallelogram
    style.fill: "#E2E8F0"
  }
}

# Wiring the Diagram
Dimensions.Hardware -> Runner: "Select Dispatcher"
Dimensions.Data -> Runner: "Generate Vector<T>"
Dimensions.Memory -> Runner: "Pointer Arithmetic"

Runner -> Validation.Comparator: "Optimized Output"
Validation.Oracle -> Validation.Comparator: "Baseline Output"
Validation.Comparator -> Validation.Output: "memcmp() == 0"

# Styling specific edges
(Dimensions.Hardware -> Runner).style: {
  stroke: "#F56565"
  stroke-width: 2
}
(Dimensions.Data -> Runner).style: {
  stroke: "#4299E1"
  stroke-width: 2
}
(Dimensions.Memory -> Runner).style: {
  stroke: "#48BB78"
  stroke-width: 2
}