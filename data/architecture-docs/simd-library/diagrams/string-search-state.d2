direction: right

# Define named styles
classes: {
  state_style: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  initial_state: {
    style.fill: "#3fb950"
    style.stroke: "#3fb950"
    style.font-color: "#1a1a2e"
  }
  final_state: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.double-border: true
  }
  transition_style: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

# Initial state
init: {
  shape: circle
  class: initial_state
  label: ""
}

# Main processing states
idle: Idle {
  shape: circle
  class: state_style
}

loading: Loading Chunk {
  shape: circle
  class: state_style
}

comparing: SIMD Compare {
  shape: circle
  class: state_style
}

extracting: Extract Mask {
  shape: circle
  class: state_style
}

checking_boundary: Check Boundary {
  shape: circle
  class: state_style
}

match_found: Match Found {
  shape: circle
  class: final_state
}

no_match: No Match {
  shape: circle
  class: final_state
}

# State transitions
init -> idle: Initialize {
  class: transition_style
}

idle -> loading: Start Search {
  class: transition_style
}

loading -> comparing: 16-byte chunk loaded {
  class: transition_style
}

comparing -> extracting: Comparison complete {
  class: transition_style
}

extracting -> match_found: Non-zero mask {
  class: transition_style
}

extracting -> checking_boundary: Zero mask {
  class: transition_style
}

checking_boundary -> loading: Within string bounds {
  class: transition_style
}

checking_boundary -> no_match: End of string {
  class: transition_style
}

match_found -> idle: Reset for next search {
  class: transition_style
}

no_match -> idle: Reset for next search {
  class: transition_style
}

# Self-loops for error conditions
loading -> loading: Alignment adjustment {
  class: transition_style
}