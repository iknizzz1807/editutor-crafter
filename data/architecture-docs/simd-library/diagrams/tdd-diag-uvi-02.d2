vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}

classes: {
  api_obj: {
    style: {
      fill: "#E1F5FE"
      stroke: "#01579B"
      stroke-width: 2
    }
  }
  logic_obj: {
    style: {
      fill: "#F3E5F5"
      stroke: "#4A148C"
      stroke-dash: 3
    }
  }
  hw_obj: {
    style: {
      fill: "#E8F5E9"
      stroke: "#1B5E20"
      bold: true
    }
  }
}

uvi: Unified Vector Interface {
  style: {
    stroke: "#455A64"
    fill: "#ECEFF1"
  }

  user_layer: User-Facing API {
    vector_class: Vector<T, N> {
      shape: class
      class: api_obj
      +data: InternalType
      +operator+(rhs: Vector): Vector
      +operator*(rhs: Vector): Vector
      +LoadAligned(ptr: T*): static Vector
      +Store(ptr: T*): void
    }
  }

  trait_resolver: Meta-Programming Layer {
    simd_traits: SimdTraits<T, N> {
      shape: class
      class: logic_obj
      +NativeType: typename
      +Alignment: size_t
      +ISA_Tag: string
    }
    
    specializations: {
      x86_avx: SimdTraits<float, 8> {
        NativeType: __m256
        ISA_Tag: "AVX2"
      }
      arm_neon: SimdTraits<float, 4> {
        NativeType: float32x4_t
        ISA_Tag: "NEON"
      }
    }
  }

  intrinsic_abstraction: Hardware Abstraction Layer (HAL) {
    wrappers: SIMD Wrappers {
      shape: class
      class: logic_obj
      +simd_add(a, b): inline
      +simd_mul(a, b): inline
      +simd_load(ptr): inline
    }
  }
}

hardware: CPU Execution Units {
  x86_unit: Intel/AMD AVX {
    class: hw_obj
    _mm256_add_ps: intrinsic
    _mm256_mul_ps: intrinsic
  }
  arm_unit: ARM NEON/SVE {
    class: hw_obj
    vaddq_f32: intrinsic
    vmulq_f32: intrinsic
  }
}

# Relationship & Call Flow
uvi.user_layer.vector_class.operator+ -> uvi.trait_resolver.simd_traits: 1. Fetch NativeType
uvi.user_layer.vector_class.operator+ -> uvi.intrinsic_abstraction.wrappers: 2. Call Unified Wrapper
uvi.intrinsic_abstraction.wrappers.simd_add -> hardware.x86_unit._mm256_add_ps: 3a. Compile-time Dispatch (x86)
uvi.intrinsic_abstraction.wrappers.simd_add -> hardware.arm_unit.vaddq_f32: 3b. Compile-time Dispatch (ARM)

# External Module Links
uvi.user_layer.vector_class -> hdde_module: "Resolves optimal N via" {
  link: "mod-hardware-dispatch"
  style.stroke: "#0288D1"
}

uvi.user_layer.vector_class -> ambm_module: "Uses for Aligned Load/Store" {
  link: "mod-memory-management"
  style.stroke: "#7B1FA2"
}

hdde_module: Hardware Dispatch Engine {
  shape: package
  style.opacity: 0.6
}

ambm_module: Aligned Memory Manager {
  shape: package
  style.opacity: 0.6
}