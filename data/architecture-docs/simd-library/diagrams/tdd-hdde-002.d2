shape: sequence_diagram

# IFUNC Resolution Sequence (GNU/Linux Load-time)
# This diagram visualizes the zero-overhead dispatch mechanism used by the HDDE.

ld_so: Dynamic Linker (ld.so)
hdde_resolver: HDDE Resolver {
  tooltip: "__attribute__((ifunc)) target"
}
cpu: CPU Hardware
plt_got: GOT/PLT Entry
app: Application
kernels: Optimized Kernels {
  avx512: AVX-512 Implementation
  avx2: AVX2 Implementation
  scalar: Scalar Fallback
}

Load-time Resolution: {
  ld_so -> hdde_resolver: Invoke IFUNC resolver for 'simd_op'
  
  hdde_resolver -> cpu: Execute 'cpuid' (x86) / 'mrs' (ARM)
  cpu -> hdde_resolver: Return ISA Feature Bits
  
  hdde_resolver."Logic: Identify Best-Fit ISA"
  
  hdde_resolver -> ld_so: Return address of 'avx512_impl'
  ld_so -> plt_got: Patch Global Offset Table (GOT) with address
}

Runtime Execution: {
  app -> plt_got: Call 'simd_op()'
  
  plt_got -> kernels.avx512: Direct Jump (No Branching) {
    style: {
      stroke: green
      stroke-width: 2
      animated: true
    }
  }
  
  kernels.avx512 -> app: Return result
}

# Documentation note
plt_got."Note: IFUNC eliminates runtime 'if' checks by binding the optimal kernel at load-time." {
  near: plt_got
}

# Styling
ld_so.style.fill: "#DEE1EB"
hdde_resolver.style.fill: "#C7F1FF"
cpu.style.fill: "#B5AFF6"
plt_got.style.fill: "#FFE7CB"
app.style.fill: "#E4DBFE"
kernels.style.fill: "#F6F9FC"
kernels.avx512.style.fill: "#ACE1AF"