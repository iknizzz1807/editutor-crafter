vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}

direction: down

title: "Object Graph Traversal - Mark Phase" {
  near: top-center
  shape: text
  style: {
    font-size: 24
    bold: true
    underline: true
  }
}

# Root set (stack + globals)
roots: "Root Set\n(Stack + Globals)" {
  shape: rectangle
  style: {
    fill: "#4CAF50"
    stroke: "#2E7D32"
    font-color: white
    bold: true
    stroke-width: 3
  }
  link: "#anchor-object-graph"
}

# Reachable objects (marked)
obj_a: "Object A\n[MARKED]\n128 bytes" {
  shape: rectangle
  style: {
    fill: "#81C784"
    stroke: "#4CAF50"
    stroke-width: 2
    bold: true
  }
  link: "#anchor-object-graph"
}

obj_b: "Object B\n[MARKED]\n256 bytes" {
  shape: rectangle
  style: {
    fill: "#81C784"
    stroke: "#4CAF50"
    stroke-width: 2
    bold: true
  }
  link: "#anchor-object-graph"
}

obj_c: "Object C\n[MARKED]\n64 bytes" {
  shape: rectangle
  style: {
    fill: "#81C784"
    stroke: "#4CAF50"
    stroke-width: 2
    bold: true
  }
  link: "#anchor-object-graph"
}

obj_d: "Object D\n[MARKED]\n512 bytes" {
  shape: rectangle
  style: {
    fill: "#81C784"
    stroke: "#4CAF50"
    stroke-width: 2
    bold: true
  }
  link: "#anchor-object-graph"
}

# Unreachable objects (garbage)
obj_x: "Object X\n[UNMARKED]\n128 bytes\n‚ö† GARBAGE" {
  shape: rectangle
  style: {
    fill: "#EF5350"
    stroke: "#C62828"
    stroke-width: 2
    stroke-dash: 3
    font-color: white
  }
  link: "#anchor-object-graph"
}

obj_y: "Object Y\n[UNMARKED]\n256 bytes\n‚ö† GARBAGE" {
  shape: rectangle
  style: {
    fill: "#EF5350"
    stroke: "#C62828"
    stroke-width: 2
    stroke-dash: 3
    font-color: white
  }
  link: "#anchor-object-graph"
}

obj_z: "Object Z\n[UNMARKED]\n64 bytes\n‚ö† GARBAGE" {
  shape: rectangle
  style: {
    fill: "#EF5350"
    stroke: "#C62828"
    stroke-width: 2
    stroke-dash: 3
    font-color: white
  }
  link: "#anchor-object-graph"
}

# Connections from roots
roots -> obj_a: "root ptr" {
  style: {
    stroke: "#4CAF50"
    stroke-width: 3
    animated: true
  }
}

roots -> obj_b: "root ptr" {
  style: {
    stroke: "#4CAF50"
    stroke-width: 3
    animated: true
  }
}

# Reachable object graph
obj_a -> obj_c: "field ptr" {
  style: {
    stroke: "#66BB6A"
    stroke-width: 2
  }
}

obj_b -> obj_d: "field ptr" {
  style: {
    stroke: "#66BB6A"
    stroke-width: 2
  }
}

obj_c -> obj_d: "field ptr" {
  style: {
    stroke: "#66BB6A"
    stroke-width: 2
  }
}

# Unreachable subgraph (isolated)
obj_x -> obj_y: "dangling ptr" {
  style: {
    stroke: "#E57373"
    stroke-width: 2
    stroke-dash: 3
  }
}

obj_y -> obj_z: "dangling ptr" {
  style: {
    stroke: "#E57373"
    stroke-width: 2
    stroke-dash: 3
  }
}

obj_z -> obj_x: "circular ref" {
  style: {
    stroke: "#E57373"
    stroke-width: 2
    stroke-dash: 3
  }
}

# Legend
legend: "Legend" {
  shape: rectangle
  style: {
    fill: "#ECEFF1"
    stroke: "#90A4AE"
    stroke-width: 2
  }
  
  marked: "üü¢ Marked = Reachable" {
    shape: text
    style: {
      font-size: 14
    }
  }
  
  unmarked: "üî¥ Unmarked = Garbage" {
    shape: text
    style: {
      font-size: 14
    }
  }
  
  solid: "‚îÅ‚îÅ Solid line = Live reference" {
    shape: text
    style: {
      font-size: 14
    }
  }
  
  dashed: "‚ïå‚ïå Dashed line = Dangling reference" {
    shape: text
    style: {
      font-size: 14
    }
  }
}

legend.near: bottom-right

# Annotations
mark_phase: "Mark Phase:\n1. Start from roots\n2. Follow pointers\n3. Mark reachable objects\n4. Stop at marked objects" {
  shape: rectangle
  style: {
    fill: "#E3F2FD"
    stroke: "#1976D2"
    stroke-width: 2
    font-size: 12
  }
  near: top-left
}

sweep_phase: "Sweep Phase:\n1. Scan entire heap\n2. Free unmarked objects\n3. Clear mark bits\n4. Reclaim memory" {
  shape: rectangle
  style: {
    fill: "#FFF3E0"
    stroke: "#F57C00"
    stroke-width: 2
    font-size: 12
  }
  near: bottom-left
}

stats: "Heap Statistics:\n‚Ä¢ Total: 1408 bytes\n‚Ä¢ Live: 960 bytes (68%)\n‚Ä¢ Garbage: 448 bytes (32%)\n‚Ä¢ Objects: 7 (4 live, 3 garbage)" {
  shape: rectangle
  style: {
    fill: "#F3E5F5"
    stroke: "#7B1FA2"
    stroke-width: 2
    font-size: 12
    font: mono
  }
  near: top-right
}