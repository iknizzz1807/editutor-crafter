direction: down

classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  buffer: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  arrow: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

title: "Z-Buffer Depth Testing Flow" {
  near: top-center
  style.font-size: 18
  style.bold: true
  style.font-color: "#e6edf3"
}

start: "Incoming Fragment\n(x, y, z)" {
  shape: oval
  class: process
}

zbuffer: "Z-Buffer\n[x][y]" {
  shape: cylinder
  class: buffer
}

read_depth: "Read Current\nDepth Value" {
  shape: rectangle
  class: process
}

depth_test: "Fragment Z\n< Buffer Z ?" {
  shape: diamond
  class: decision
}

write_pixel: "Write Pixel\nColor & Depth" {
  shape: rectangle
  class: process
}

discard: "Discard\nFragment" {
  shape: rectangle
  style.fill: "#d63031"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
}

next: "Next Fragment" {
  shape: oval
  class: process
}

start -> read_depth {
  class: arrow
}

read_depth -> zbuffer: lookup {
  class: arrow
}

read_depth -> depth_test {
  class: arrow
}

depth_test -> write_pixel: "YES\n(closer)" {
  class: arrow
  style.stroke: "#3fb950"
  style.bold: true
}

depth_test -> discard: "NO\n(farther)" {
  class: arrow
  style.stroke: "#d63031"
  style.bold: true
}

write_pixel -> zbuffer: update {
  class: arrow
}

write_pixel -> next {
  class: arrow
}

discard -> next {
  class: arrow
}