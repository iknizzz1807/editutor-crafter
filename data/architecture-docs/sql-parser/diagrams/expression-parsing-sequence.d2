shape: sequence_diagram

classes: {
  parser_func: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  ast_node: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

client: Client {
  class: parser_func
}
where_parser: WHERE Parser {
  class: parser_func
}
expr_parser: Expression Parser {
  class: parser_func
}
precedence: Precedence Handler {
  class: parser_func
}
tokenizer: Tokenizer {
  class: parser_func
}
ast_builder: AST Builder {
  class: ast_node
}

client -> where_parser: "parse_where_clause('age > 18 AND status = active')"
where_parser -> tokenizer: get_next_token()
tokenizer -> where_parser: IDENTIFIER(age)

where_parser -> expr_parser: parse_expression()
expr_parser -> precedence: parse_with_precedence(0)
precedence -> tokenizer: peek_token()
tokenizer -> precedence: IDENTIFIER(age)

precedence -> ast_builder: create_identifier_node('age')
ast_builder -> precedence: IdentifierNode

precedence -> tokenizer: get_next_token()
tokenizer -> precedence: GREATER_THAN(>)

precedence -> precedence: check_operator_precedence(>, current=0)
precedence -> tokenizer: get_next_token()
tokenizer -> precedence: NUMBER(18)

precedence -> ast_builder: create_literal_node(18)
ast_builder -> precedence: LiteralNode

precedence -> ast_builder: create_binary_op(>, left=age, right=18)
ast_builder -> precedence: BinaryOpNode

precedence -> tokenizer: peek_token()
tokenizer -> precedence: AND

precedence -> precedence: check_operator_precedence(AND, current=0)
precedence -> tokenizer: get_next_token()
tokenizer -> precedence: AND

precedence -> precedence: parse_with_precedence(AND_PRECEDENCE + 1)
precedence -> tokenizer: get_next_token()
tokenizer -> precedence: IDENTIFIER(status)

precedence -> ast_builder: create_identifier_node('status')
ast_builder -> precedence: IdentifierNode

precedence -> tokenizer: get_next_token()
tokenizer -> precedence: EQUALS(=)

precedence -> tokenizer: get_next_token()
tokenizer -> precedence: IDENTIFIER(active)

precedence -> ast_builder: create_identifier_node('active')
ast_builder -> precedence: IdentifierNode

precedence -> ast_builder: create_binary_op(=, left=status, right=active)
ast_builder -> precedence: BinaryOpNode

precedence -> ast_builder: create_binary_op(AND, left=age>18, right=status=active)
ast_builder -> precedence: BinaryOpNode

precedence -> expr_parser: ComplexBinaryOpNode
expr_parser -> where_parser: WhereExpressionNode
where_parser -> client: WHERE AST with proper precedence