title: Core Entity Relationship Diagram

classes: {
  entity: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  primary_key: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  relationship: {
    style.stroke: "#8b949e"
    style.font-color: "#8b949e"
  }
}

Customer: {
  shape: sql_table
  class: entity
  id: uuid {constraint: primary_key}
  email: varchar
  name: varchar
  created_at: timestamp
  updated_at: timestamp
  status: varchar
}

Plan: {
  shape: sql_table
  class: entity
  id: uuid {constraint: primary_key}
  name: varchar
  description: text
  billing_interval: varchar
  price: decimal
  currency: varchar
  trial_period_days: integer
  usage_type: varchar
  created_at: timestamp
  updated_at: timestamp
  status: varchar
}

Subscription: {
  shape: sql_table
  class: entity
  id: uuid {constraint: primary_key}
  customer_id: uuid {constraint: foreign_key}
  plan_id: uuid {constraint: foreign_key}
  status: varchar
  current_period_start: timestamp
  current_period_end: timestamp
  trial_end: timestamp
  cancel_at_period_end: boolean
  canceled_at: timestamp
  created_at: timestamp
  updated_at: timestamp
}

Invoice: {
  shape: sql_table
  class: entity
  id: uuid {constraint: primary_key}
  customer_id: uuid {constraint: foreign_key}
  subscription_id: uuid {constraint: foreign_key}
  amount_due: decimal
  amount_paid: decimal
  currency: varchar
  status: varchar
  period_start: timestamp
  period_end: timestamp
  due_date: timestamp
  created_at: timestamp
  updated_at: timestamp
}

Payment: {
  shape: sql_table
  class: entity
  id: uuid {constraint: primary_key}
  invoice_id: uuid {constraint: foreign_key}
  customer_id: uuid {constraint: foreign_key}
  amount: decimal
  currency: varchar
  status: varchar
  payment_method: varchar
  processed_at: timestamp
  created_at: timestamp
  updated_at: timestamp
}

UsageEvent: {
  shape: sql_table
  class: entity
  id: uuid {constraint: primary_key}
  subscription_id: uuid {constraint: foreign_key}
  customer_id: uuid {constraint: foreign_key}
  metric_name: varchar
  quantity: decimal
  unit_price: decimal
  timestamp: timestamp
  created_at: timestamp
  metadata: jsonb
}

Customer.id -> Subscription.customer_id: has {
  class: relationship
}

Plan.id -> Subscription.plan_id: defines {
  class: relationship
}

Customer.id -> Invoice.customer_id: billed to {
  class: relationship
}

Subscription.id -> Invoice.subscription_id: generates {
  class: relationship
}

Invoice.id -> Payment.invoice_id: paid by {
  class: relationship
}

Customer.id -> Payment.customer_id: made by {
  class: relationship
}

Subscription.id -> UsageEvent.subscription_id: tracks usage {
  class: relationship
}

Customer.id -> UsageEvent.customer_id: consumed by {
  class: relationship
}