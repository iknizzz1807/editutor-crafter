title: System Architecture Overview {
  style.font-size: 24
  style.bold: true
  style.font-color: "#e6edf3"
  near: top-center
}

classes: {
  container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.stroke-width: 2
  }
  component: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  critical: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
    style.stroke-width: 2
  }
  flow: {
    style.stroke: "#8b949e"
    style.font-color: "#8b949e"
  }
  data_flow: {
    style.stroke: "#3fb950"
    style.font-color: "#3fb950"
    style.stroke-width: 2
  }
}

core_systems: Core Game Systems {
  class: container

  board: Game Board {
    class: critical
    shape: rectangle
  }

  tetromino: Tetromino System {
    class: critical
    shape: rectangle
  }

  collision: Collision Detection {
    class: component
    shape: rectangle
  }

  board <-> collision: "Grid State"
  tetromino <-> collision: "Piece Position"
}

input_systems: Input & Control {
  class: container

  controls: Controls {
    class: component
    shape: rectangle
  }

  rotation: Rotation Engine {
    class: component
    shape: rectangle
  }

  controls -> rotation: "Rotate Command" {
    class: flow
  }
}

game_logic: Game Logic {
  class: container

  line_clearing: Line Clearing {
    class: component
    shape: rectangle
  }

  scoring: Scoring System {
    class: component
    shape: rectangle
  }

  game_state: Game State Manager {
    class: critical
    shape: rectangle
  }

  line_clearing -> scoring: "Lines Cleared" {
    class: data_flow
  }
  scoring -> game_state: "Score Update" {
    class: flow
  }
}

controls -> tetromino: "Movement Input" {
  class: data_flow
}

rotation -> tetromino: "Rotated Piece" {
  class: data_flow
}

tetromino -> board: "Place Piece" {
  class: data_flow
}

board -> line_clearing: "Full Lines" {
  class: data_flow
}

line_clearing -> board: "Clear Lines" {
  class: data_flow
}

core_systems.collision -> game_logic.game_state: "Collision Events" {
  class: data_flow
}

game_logic.game_state -> core_systems.tetromino: "Next Piece" {
  class: data_flow
}

game_logic.game_state -> input_systems.controls: "Input Enable/Disable" {
  class: flow
}

data_flow_legend: Data Flow Legend {
  class: container
  near: bottom-right

  primary: Primary Flow {
    class: data_flow
    shape: rectangle
  }
  
  secondary: Control Flow {
    class: flow
    shape: rectangle
  }

  primary -> secondary: "" {
    class: data_flow
  }
  secondary -> primary: "" {
    class: flow
  }
}