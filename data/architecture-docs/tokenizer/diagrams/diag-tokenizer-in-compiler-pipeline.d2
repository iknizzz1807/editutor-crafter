direction: right
vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 3
  }
}

# Global Styles
classes: {
  project_scope: {
    style: {
      stroke: "#2ecc71"
      stroke-width: 4
      fill: "#eafaf1"
      shadow: true
    }
  }
  data_structure: {
    shape: sql_table
    style: {
      fill: "#fdfefe"
      stroke: "#34495e"
    }
  }
  logic_component: {
    shape: class
    style: {
      fill: "#ebf5fb"
      stroke: "#2980b9"
    }
  }
  future_scope: {
    style: {
      stroke-dash: 5
      opacity: 0.6
    }
  }
}

# LAYERS
front_end: {
  label: "FRONT-END (Lexical & Syntactic Analysis)"
  direction: down

  source: {
    shape: page
    label: "Source Code\n(program.c)"
    tooltip: "Raw UTF-8 Character Stream"
  }

  tokenizer_group: {
    class: project_scope
    label: "LEXICAL ANALYZER (This Project)"
    
    scanner: {
      class: logic_component
      label: "Scanner (scanner.py)"
      definition: |md
        python
        class Scanner:
            source: str
            tokens: list[Token]
            def scan_tokens() -> list[Token]: ...
        
      |
    }

    token_def: {
      class: data_structure
      label: "dataclass Token (scanner.py)"
      row1: "type    | TokenType"
      row2: "lexeme  | str"
      row3: "line    | int"
      row4: "column  | int"
      label_bottom: "Size: ~64 bytes per instance"
    }
  }

  parser_group: {
    class: future_scope
    label: "SYNTACTIC ANALYZER"
    
    parser: {
      class: logic_component
      label: "Parser (parser.py)"
      definition: |md
        python
        class Parser:
            tokens: list[Token]
            def parse() -> Expr: ...
        
      |
    }
    
    ast_def: {
      class: data_structure
      label: "AST Node (ast.py)"
      row1: "left  | Expr"
      row2: "op    | Token"
      row3: "right | Expr"
    }
  }
}

back_end: {
  class: future_scope
  label: "BACK-END (IR & Code Gen)"
  direction: down

  semantic_analysis: {
    label: "Semantic Analysis\n(Symbol Tables & Types)"
    shape: rectangle
  }

  ir_generator: {
    label: "IR Generator\n(Three-Address Code)"
    shape: rectangle
  }

  code_gen: {
    label: "Code Generator\n(X86/LLVM/Bytecode)"
    shape: cylinder
  }
}

# DATA FLOWS
front_end.source -> front_end.tokenizer_group.scanner: "str | 'if (x >= 42)...'" {
  style: {
    stroke: "#3498db"
    animated: true
  }
}

front_end.tokenizer_group.scanner -> front_end.parser_group.parser: "list[Token] | [Token(IF, 'if', 1, 1), ...]" {
  style: {
    stroke: "#3498db"
    stroke-width: 2
  }
}

front_end.parser_group.parser -> back_end.semantic_analysis: "Tree | BinaryExpr(lhs, GTE, rhs)"

back_end.semantic_analysis -> back_end.ir_generator: "Decorated AST"
back_end.ir_generator -> back_end.code_gen: "Intermediate Rep"

# Annotation
legend: {
  near: bottom-right
  
  scope: "Current Milestone Scope" {
    class: project_scope
  }
  future: "Downstream Pipeline" {
    class: future_scope
  }
}