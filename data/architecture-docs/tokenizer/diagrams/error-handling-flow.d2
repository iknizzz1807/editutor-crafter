title: Error Detection and Recovery Flow

classes: {
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  recovery: {
    style.fill: "#00b894"
    style.stroke: "#00a085"
    style.font-color: "#ffffff"
  }
}

start: Start Scanning {
  shape: circle
  class: process
}

read_char: Read Next Character {
  class: process
}

valid_check: Valid Character? {
  shape: diamond
  class: decision
}

token_match: Match Token Pattern {
  class: process
}

pattern_check: Valid Token Pattern? {
  shape: diamond
  class: decision
}

emit_token: Emit Token {
  class: process
}

detect_error: Detect Error {
  class: error
}

error_type: Determine Error Type {
  shape: diamond
  class: decision
}

invalid_char: Invalid Character Error {
  class: error
}

malformed_token: Malformed Token Error {
  class: error
}

unterminated: Unterminated String/Comment {
  class: error
}

report_error: Report Error with Location {
  class: error
}

recovery_strategy: Choose Recovery Strategy {
  shape: diamond
  class: decision
}

skip_char: Skip Invalid Character {
  class: recovery
}

skip_to_delimiter: Skip to Next Delimiter {
  class: recovery
}

insert_terminator: Insert Missing Terminator {
  class: recovery
}

continue_scan: Continue Scanning {
  class: recovery
}

end_check: End of Input? {
  shape: diamond
  class: decision
}

finish: Finish with Error List {
  shape: circle
  class: process
}

start -> read_char
read_char -> valid_check
valid_check -> token_match: Yes
valid_check -> detect_error: No

token_match -> pattern_check
pattern_check -> emit_token: Valid
pattern_check -> detect_error: Invalid

emit_token -> end_check

detect_error -> error_type
error_type -> invalid_char: Invalid Char
error_type -> malformed_token: Bad Pattern
error_type -> unterminated: Unclosed

invalid_char -> report_error
malformed_token -> report_error
unterminated -> report_error

report_error -> recovery_strategy
recovery_strategy -> skip_char: Single Char
recovery_strategy -> skip_to_delimiter: Malformed Token
recovery_strategy -> insert_terminator: Unterminated

skip_char -> continue_scan
skip_to_delimiter -> continue_scan
insert_terminator -> continue_scan

continue_scan -> end_check
end_check -> read_char: No
end_check -> finish: Yes