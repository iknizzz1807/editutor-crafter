vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 4
  }
}

title: "Two-Character Operator Decision Tree (Maximal Munch)" {
  shape: text
  near: top-center
  style: {
    font-size: 18
    bold: true
  }
}

dispatch: "char = advance()" {
  shape: diamond
  style.fill: "#E1D5E7"
}

dispatch -> eq_check: "char == '='"
eq_check: "Scanner._match('=')" {
  shape: diamond
  style.fill: "#D5E8D4"
}
eq_check -> t_equals: "True"
eq_check -> t_assign: "False"

t_equals: "TokenType.EQUALS\nlexeme: '=='" {
  style.fill: "#DAE8FC"
  style.stroke: "#6C8EBF"
}
t_assign: "TokenType.ASSIGN\nlexeme: '='" {
  style.fill: "#DAE8FC"
  style.stroke: "#6C8EBF"
}

dispatch -> bang_check: "char == '!'"
bang_check: "Scanner._match('=')" {
  shape: diamond
  style.fill: "#D5E8D4"
}
bang_check -> t_not_equal: "True"
bang_check -> t_err_bang: "False"

t_not_equal: "TokenType.NOT_EQUAL\nlexeme: '!='" {
  style.fill: "#DAE8FC"
  style.stroke: "#6C8EBF"
}
t_err_bang: "TokenType.ERROR\nlexeme: '!'" {
  style.fill: "#F8CECC"
  style.stroke: "#B85450"
}

dispatch -> lt_check: "char == '<'"
lt_check: "Scanner._match('=')" {
  shape: diamond
  style.fill: "#D5E8D4"
}
lt_check -> t_less_equal: "True"
lt_check -> t_less_than: "False"

t_less_equal: "TokenType.LESS_EQUAL\nlexeme: '<='" {
  style.fill: "#DAE8FC"
  style.stroke: "#6C8EBF"
}
t_less_than: "TokenType.LESS_THAN\nlexeme: '<'" {
  style.fill: "#DAE8FC"
  style.stroke: "#6C8EBF"
}

dispatch -> gt_check: "char == '>'"
gt_check: "Scanner._match('=')" {
  shape: diamond
  style.fill: "#D5E8D4"
}
gt_check -> t_greater_equal: "True"
gt_check -> t_greater_than: "False"

t_greater_equal: "TokenType.GREATER_EQUAL\nlexeme: '>='" {
  style.fill: "#DAE8FC"
  style.stroke: "#6C8EBF"
}
t_greater_than: "TokenType.GREATER_THAN\nlexeme: '>'" {
  style.fill: "#DAE8FC"
  style.stroke: "#6C8EBF"
}

legend: {
  shape: rectangle
  style.stroke-dash: 3
  near: bottom-right
  
  h: "Color Legend" { shape: text; style.bold: true }
  logic: "Logic/Match" { style.fill: "#D5E8D4" }
  data: "Valid Token" { style.fill: "#DAE8FC" }
  fail: "Invalid Lexeme" { style.fill: "#F8CECC" }
}

annotation: |md
  **Maximal Munch Principle**
  The scanner greedy-matches the 
  longest possible sequence. 
  `_match()` performs lookahead 
  and conditional consumption.
| {
  near: top-left
}