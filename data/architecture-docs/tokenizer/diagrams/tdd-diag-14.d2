direction: right
vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 6
  }
}

# State Definitions
START: "â—" {
  shape: circle
  width: 20
  height: 20
  style.fill: black
}

ENTRY: "ENTRY" {
  tooltip: "First digit consumed by next_token dispatch"
  style.italic: true
  |md
    **Invariant:** 
    lexeme = [0-9]
  |
}

INTEGER: "INTEGER STATE" {
  |md
    **Invariant:** 
    lexeme contains only [0-9]
  |
}

FLOAT: "FLOAT STATE" {
  |md
    **Invariant:** 
    lexeme contains [0-9].[0-9]
  |
}

ACCEPT_INT: "ACCEPT (INTEGER)" {
  style: {
    fill: "#ACE1AF"
    double-border: true
  }
  |md
    **Action:** 
    emit TokenType.NUMBER
  |
}

ACCEPT_FLOAT: "ACCEPT (FLOAT)" {
  style: {
    fill: "#ACE1AF"
    double-border: true
  }
  |md
    **Action:** 
    emit TokenType.NUMBER
  |
}

# Transitions: trigger + [guard] + action
START -> ENTRY: "char.isdigit()"

ENTRY -> INTEGER: "Always / [advance first digit]"

INTEGER -> INTEGER: "peek().isdigit() / advance()" {
  style.stroke-width: 2
}

INTEGER -> FLOAT: "peek() == '.' [ _peek_next().isdigit() ] / advance() dot" {
  style: {
    stroke: orange
    bold: true
  }
}

INTEGER -> ACCEPT_INT: "peek() != [0-9] [ NOT ('.' + [0-9]) ]" {
  style.stroke-dash: 3
}

FLOAT -> FLOAT: "peek().isdigit() / advance()" {
  style.stroke-width: 2
}

FLOAT -> ACCEPT_FLOAT: "peek() != [0-9]" {
  style.stroke-dash: 3
}

# Annotations
Lookahead_Note: |md
  ### Two-Character Lookahead
  The transition to **FLOAT** requires `_peek_next()` to avoid 
  consuming a dot that belongs to a method call (e.g., `3.toString()`) 
  or a range operator (e.g., `1..10`).
| {
  near: bottom-right
  style.font-size: 10
}