vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}

title: |md
  # Positional Encoding: Sinusoidal Wavelength Patterns
| {near: top-center}

direction: right

legend: Wavelength Legend {
  near: center-right
  
  legend_title: {
    shape: text
    label: Wavelength Legend
    style.font-size: 14
  }
  
  dim_0: {
    label: "Dimension 0 (λ=2π)"
    style.fill: "#4A90D9"
    shape: rectangle
    width: 100
    height: 30
  }
  
  dim_512: {
    label: "Dimension 512 (λ=2π×10000)"
    style.fill: "#2D5A87"
    shape: rectangle
    width: 100
    height: 30
  }
  
  positive: {
    label: "+1.0 (peak)"
    style.fill: "#FF6B6B"
    shape: rectangle
    width: 80
    height: 25
  }
  
  zero: {
    label: "0.0"
    style.fill: "#F5F5F5"
    shape: rectangle
    width: 80
    height: 25
  }
  
  negative: {
    label: "-1.0 (trough)"
    style.fill: "#4ECDC4"
    shape: rectangle
    width: 80
    height: 25
  }
}

heatmap: Positional Encoding Heatmap {
  near: center-left
  grid-columns: 9
  grid-rows: 6
  grid-gap: 2
  
  style.fill: white
  style.stroke: "#333333"
  style.stroke-width: 2
  
  header_pos: |md
    **Position**
  | {shape: text}
  
  header_d0: |md
    **d=0**
    sin
  | {shape: text}
  
  header_d1: |md
    **d=1**
    cos
  | {shape: text}
  
  header_d2: |md
    **d=2**
    sin
  | {shape: text}
  
  header_d3: |md
    **d=3**
    cos
  | {shape: text}
  
  header_d4: |md
    **d=4**
    sin
  | {shape: text}
  
  header_d5: |md
    **d=5**
    cos
  | {shape: text}
  
  header_d6: |md
    **d=6**
    sin
  | {shape: text}
  
  header_d7: |md
    **d=7**
    cos
  | {shape: text}
  
  pos0_label: "pos=0" {shape: text}
  pos0_d0: "0.00" {style.fill: "#F5F5F5"; shape: rectangle}
  pos0_d1: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  pos0_d2: "0.00" {style.fill: "#F5F5F5"; shape: rectangle}
  pos0_d3: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  pos0_d4: "0.00" {style.fill: "#F5F5F5"; shape: rectangle}
  pos0_d5: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  pos0_d6: "0.00" {style.fill: "#F5F5F5"; shape: rectangle}
  pos0_d7: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  
  pos1_label: "pos=1" {shape: text}
  pos1_d0: "0.84" {style.fill: "#E8A0A0"; shape: rectangle}
  pos1_d1: "0.54" {style.fill: "#C0D9E8"; shape: rectangle}
  pos1_d2: "0.01" {style.fill: "#F3F3F3"; shape: rectangle}
  pos1_d3: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  pos1_d4: "0.00" {style.fill: "#F5F5F5"; shape: rectangle}
  pos1_d5: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  pos1_d6: "0.00" {style.fill: "#F5F5F5"; shape: rectangle}
  pos1_d7: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  
  pos2_label: "pos=2" {shape: text}
  pos2_d0: "0.91" {style.fill: "#F0B0B0"; shape: rectangle}
  pos2_d1: "-0.42" {style.fill: "#9AD0D0"; shape: rectangle}
  pos2_d2: "0.02" {style.fill: "#F0F0F0"; shape: rectangle}
  pos2_d3: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  pos2_d4: "0.00" {style.fill: "#F5F5F5"; shape: rectangle}
  pos2_d5: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  pos2_d6: "0.00" {style.fill: "#F5F5F5"; shape: rectangle}
  pos2_d7: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  
  pos3_label: "pos=3" {shape: text}
  pos3_d0: "0.14" {style.fill: "#D8D8D8"; shape: rectangle}
  pos3_d1: "-0.99" {style.fill: "#4ECDC4"; shape: rectangle}
  pos3_d2: "0.03" {style.fill: "#EFEFEF"; shape: rectangle}
  pos3_d3: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  pos3_d4: "0.00" {style.fill: "#F5F5F5"; shape: rectangle}
  pos3_d5: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  pos3_d6: "0.00" {style.fill: "#F5F5F5"; shape: rectangle}
  pos3_d7: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  
  pos4_label: "pos=4" {shape: text}
  pos4_d0: "-0.76" {style.fill: "#8CC8C8"; shape: rectangle}
  pos4_d1: "-0.65" {style.fill: "#88C8C8"; shape: rectangle}
  pos4_d2: "0.04" {style.fill: "#EEEEEE"; shape: rectangle}
  pos4_d3: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  pos4_d4: "0.00" {style.fill: "#F5F5F5"; shape: rectangle}
  pos4_d5: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  pos4_d6: "0.00" {style.fill: "#F5F5F5"; shape: rectangle}
  pos4_d7: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  
  pos5_label: "pos=5" {shape: text}
  pos5_d0: "-0.96" {style.fill: "#60D0D0"; shape: rectangle}
  pos5_d1: "0.28" {style.fill: "#D5E5EA"; shape: rectangle}
  pos5_d2: "0.05" {style.fill: "#EDEDED"; shape: rectangle}
  pos5_d3: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  pos5_d4: "0.00" {style.fill: "#F5F5F5"; shape: rectangle}
  pos5_d5: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
  pos5_d6: "0.00" {style.fill: "#F5F5F5"; shape: rectangle}
  pos5_d7: "1.00" {style.fill: "#FF6B6B"; shape: rectangle}
}

wavelength_pattern: Wavelength Expansion Pattern {
  shape: rectangle
  style.fill: "#FAFAFA"
  style.stroke: "#666666"
  width: 600
}

formula: |md
  ## Sinusoidal Positional Encoding Formula
  
  
  PE(pos, 2i)   = sin(pos / 10000^(2i/d_model))
  PE(pos, 2i+1) = cos(pos / 10000^(2i/d_model))
  
  
  **Wavelength at dimension i:** λ_i = 2π × 10000^(2i/d_model)
  
  - Dimension 0: λ = 2π ≈ 6.28 (fast oscillation)
  - Dimension 256: λ = 2π × 100 ≈ 628
  - Dimension 512: λ = 2π × 10000 ≈ 62,832 (slow oscillation)
| {near: top-center}

dim_0_wave: Dimension 0 (λ≈6) {
  shape: rectangle
  width: 550
  height: 50
  style.fill: "linear-gradient(90deg, #F5F5F5, #FF6B6B, #F5F5F5, #4ECDC4, #F5F5F5, #FF6B6B, #F5F5F5, #4ECDC4, #F5F5F5)"
}

dim_256_wave: Dimension 256 (λ≈628) {
  shape: rectangle
  width: 550
  height: 50
  style.fill: "linear-gradient(90deg, #F5F5F5, #FFB6B6, #F5F5F5)"
}

dim_511_wave: Dimension 511 (λ≈62832) {
  shape: rectangle
  width: 550
  height: 50
  style.fill: "linear-gradient(90deg, #F5F5F5, #F8F8F8)"
}

key_insight: |md
  ### Key Insight: Unique Binary-Like Encoding
  
  Each position gets a **unique code** because:
  - Low dimensions differentiate nearby positions (fast waves)
  - High dimensions differentiate distant positions (slow waves)
  - Combined, they form a "multi-resolution" position signature
  
  This allows the model to **attend by relative position** since:
  `PE(pos+k)` can be derived from `PE(pos)` via linear transformations.
| {near: bottom-center}