vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}

title: |md
  # Synthetic Task: Copy & Reversal
  Training objectives for transformer validation
| {near: top-center}

direction: right

Task_Definition: Task Definition {
  style.fill: "#E8E4F0"
  style.stroke: "#6B5B95"
  
  Copy_Task: Copy Task {
    style.fill: "#D4C4E8"
    desc: |md
      **Objective**: Model learns identity mapping
      
      Input sequence: $x_1, x_2, ..., x_n$
      Target output: $x_1, x_2, ..., x_n$
      
      Tests: Basic attention, positional encoding
    |
  }
  
  Reversal_Task: Reversal Task {
    style.fill: "#D4C4E8"
    desc: |md
      **Objective**: Model learns position manipulation
      
      Input sequence: $x_1, x_2, ..., x_n$
      Target output: $x_n, x_{n-1}, ..., x_1$
      
      Tests: Cross-position attention, non-local dependencies
    |
  }
}

Input_Output_Examples: Input/Output Examples {
  style.fill: "#E3F2FD"
  style.stroke: "#1565C0"
  
  grid-columns: 3
  grid-gap: 0
  
  header_in: Input {
    style.fill: "#BBDEFB"
    style.bold: true
  }
  header_copy: Copy Output {
    style.fill: "#BBDEFB"
    style.bold: true
  }
  header_rev: Reversal Output {
    style.fill: "#BBDEFB"
    style.bold: true
  }
  
  ex1_in: |md
    `[3, 7, 2, 9]`
  |
  ex1_copy: |md
    `[3, 7, 2, 9]`
  |
  ex1_rev: |md
    `[9, 2, 7, 3]`
  |
  
  ex2_in: |md
    `[1, 4, 6, 8, 2]`
  |
  ex2_copy: |md
    `[1, 4, 6, 8, 2]`
  |
  ex2_rev: |md
    `[2, 8, 6, 4, 1]`
  |
  
  ex3_in: |md
    `[5, 5, 5]`
  |
  ex3_copy: |md
    `[5, 5, 5]`
  |
  ex3_rev: |md
    `[5, 5, 5]`
  |
}

Loss_Curve: Expected Loss Curves {
  style.fill: "#FFF3E0"
  style.stroke: "#E65100"
  
  Copy_Loss: Copy Task Loss {
    style.fill: "#FFE0B2"
    desc: |md
      **Expected behavior**:
      - Rapid initial descent (easy identity)
      - Plateau near 0 after ~2k steps
      - Final loss: < 0.01
      
      **Why easy**: Direct attention to same position
    |
  }
  
  Reversal_Loss: Reversal Task Loss {
    style.fill: "#FFCC80"
    desc: |md
      **Expected behavior**:
      - Slower initial descent
      - Plateau near 0 after ~5k steps
      - Final loss: < 0.01
      
      **Why harder**: Must attend to distant positions
    |
  }
  
  Loss_Comparison: Loss Comparison {
    style.fill: "#FFE0B2"
    x_axis: Training Steps {
      style.fill: transparent
    }
    y_axis: Cross-Entropy Loss {
      style.fill: transparent
    }
    curves: |md
      Loss
       │
      3│╲
       │ ╲ Copy ────────
      2│  ╲
       │   ╲ Reversal ────────
      1│    ╲____________
       │         ╲____________
      0│________________________
       └──────┬──────┬─────────→ Steps
              2k     5k
    |
  }
}

Training_Config: Training Configuration {
  style.fill: "#E8F5E9"
  style.stroke: "#2E7D32"
  
  Hyperparams: Hyperparameters {
    style.fill: "#C8E6C9"
    params: ||md
      | Parameter | Value |
      |-----------|-------|
      | Vocab size | 10 (digits 0-9) |
      | Sequence length | 4-8 |
      | Batch size | 32 |
      | Learning rate | 1e-4 |
      | Warmup steps | 400 |
      | Total steps | 10,000 |
    ||
  }
  
  Success_Criteria: Success Criteria {
    style.fill: "#C8E6C9"
    criteria: |md
      ✓ Copy task: 100% accuracy @ 2k steps
      ✓ Reversal task: 100% accuracy @ 5k steps
      ✓ Loss convergence: < 0.01 final loss
      ✓ No overfitting signs (synthetic data)
    |
  }
}

Task_Definition -> Input_Output_Examples: Generate samples
Input_Output_Examples -> Training_Config: Configure training
Training_Config -> Loss_Curve: Observe convergence