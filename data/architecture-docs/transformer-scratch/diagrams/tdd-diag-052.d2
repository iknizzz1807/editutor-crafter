vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
  }
}

title: |md
  # Training Metrics Dashboard
| {near: top-center}

direction: right

# Three metric panels side by side
Loss: {
  style.fill: "#1a1a2e"
  style.stroke: "#4a4a6a"
  style.border-radius: 8
  
  header: "Loss over Steps" {
    style.fill: "#4a4a6a"
    style.font-color: white
    style.bold: true
  }
  
  y_axis: "Loss Value" {
    shape: text
    style.font-color: "#888"
  }
  
  x_axis: "Training Steps" {
    shape: text
    style.font-color: "#888"
  }
  
  # Loss curve visualization
  curve: {
    shape: text
    label: |md
      
           ╭────╮
          ╱      ╲
         ╱        ╲___
        ╱             ╲____
       ╱                    ╲___
      ╱                          ╲_____
      ╱                                ╲____
      ──────────────────────────────────────────▶
      0    1k    2k    3k    4k    5k    6k    7k
      
    |
    style.font: mono
    style.font-color: "#ff6b6b"
  }
  
  start_point: "2.5" {
    shape: circle
    style.fill: "#ff6b6b"
  }
  
  end_point: "0.8" {
    shape: circle
    style.fill: "#4ecdc4"
  }
  
  annotation: "↓ 68% reduction" {
    shape: text
    style.font-color: "#4ecdc4"
    style.bold: true
  }
}

Learning_Rate: {
  style.fill: "#1a1a2e"
  style.stroke: "#4a4a6a"
  style.border-radius: 8
  
  header: "Learning Rate over Steps" {
    style.fill: "#4a4a6a"
    style.font-color: white
    style.bold: true
  }
  
  y_axis: "LR (×1e-4)" {
    shape: text
    style.font-color: "#888"
  }
  
  x_axis: "Training Steps" {
    shape: text
    style.font-color: "#888"
  }
  
  # Warmup + decay curve
  curve: {
    shape: text
    label: |md
      
                      ╭─╮
                     ╱   ╲
                    ╱     ╲
                   ╱       ╲
          ╱╲     ╱         ╲
         ╱  ╲___╱           ╲
        ╱                      ╲
       ╱                        ╲___________
      ──────────────────────────────────────────▶
      0    1k    2k    3k    4k    5k    6k    7k
      
    |
    style.font: mono
    style.font-color: "#ffd93d"
  }
  
  warmup: "warmup" {
    shape: text
    style.font-color: "#ffd93d"
    style.italic: true
  }
  
  peak_lr: "peak: 1e-4" {
    shape: circle
    style.fill: "#ffd93d"
  }
  
  decay_phase: "decay" {
    shape: text
    style.font-color: "#888"
    style.italic: true
  }
}

Gradient_Norm: {
  style.fill: "#1a1a2e"
  style.stroke: "#4a4a6a"
  style.border-radius: 8
  
  header: "Gradient Norm over Steps" {
    style.fill: "#4a4a6a"
    style.font-color: white
    style.bold: true
  }
  
  y_axis: "‖∇‖" {
    shape: text
    style.font-color: "#888"
  }
  
  x_axis: "Training Steps" {
    shape: text
    style.font-color: "#888"
  }
  
  # Gradient norm with spikes
  curve: {
    shape: text
    label: |md
      
            ╱╲      ╱
           ╱  ╲    ╱ ╲
      ╱╲  ╱    ╲  ╱   ╲
     ╱  ╲╱      ╲╱     ╲  ╱╲
    ╱                   ╲╱  ╲
      ──────────────────────────────────────────▶
      0    1k    2k    3k    4k    5k    6k    7k
      
    |
    style.font: mono
    style.font-color: "#a855f7"
  }
  
  clip_threshold: {
    shape: text
    label: "clip=1.0 ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─"
    style.font-color: "#ff6b6b"
    style.font: mono
  }
  
  spike_warning: "⚠ spike" {
    shape: text
    style.font-color: "#ff6b6b"
  }
  
  stable_region: "stable" {
    shape: text
    style.font-color: "#4ecdc4"
  }
}

# Data flow annotations
Data_Flow: {
  style.fill: transparent
  style.stroke: transparent
  
  step_counter: "Step: 7,234 / 10,000" {
    shape: text
    style.font-color: white
    style.bold: true
  }
  
  eta: "ETA: 2h 14m" {
    shape: text
    style.font-color: "#888"
  }
}

# Legend
Legend: {
  style.fill: "#2a2a3e"
  style.border-radius: 4
  
  item1: "● Training Loss" {
    style.font-color: "#ff6b6b"
  }
  item2: "● Learning Rate" {
    style.font-color: "#ffd93d"
  }
  item3: "● Gradient Norm" {
    style.font-color: "#a855f7"
  }
  item4: "─ Clip Threshold" {
    style.font-color: "#ff6b6b"
  }
}