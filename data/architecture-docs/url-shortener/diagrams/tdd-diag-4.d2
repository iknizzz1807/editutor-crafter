vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 4
  }
}

title: |'md
# Domain Event Struct Memory Layout (amd64 Go)
**String header = 16 bytes** (ptr 8B + len 8B) Â· **time.Time = 24 bytes** (wall 8B + ext 8B + loc ptr 8B)
**[16]byte = 16 bytes** Â· Cache line = 64 B (dashed) Â· Page boundary = 4096 B (bold)
'| {near: top-center}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# URLCreatedEvent  total = 136 bytes
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
uce: URLCreatedEvent â€” sizeof = 136 bytes {
  style.fill: "#f0eaff"
  style.stroke: "#7c3aed"
  style.stroke-width: 2
  style.border-radius: 6

  uce_f0: "0x00  â”‚ EventType      string    â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  uce_f1: "0x10  â”‚ CorrelationID  string    â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  uce_cl1: "â”€â”€ cache line 0 boundary (0x00â€“0x3F) â”€â”€" {
    style.fill: "#f3f4f6"
    style.stroke: "#9ca3af"
    style.stroke-dash: 5
    style.font: mono
    style.italic: true
  }
  uce_f2: "0x20  â”‚ OccurredAt   time.Time   â”‚ +24 B  (wall 8 + ext 8 + loc* 8)" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  uce_cl2: "â”€â”€ cache line 1 boundary (0x40â€“0x7F) â”€â”€" {
    style.fill: "#f3f4f6"
    style.stroke: "#9ca3af"
    style.stroke-dash: 5
    style.font: mono
    style.italic: true
  }
  uce_f3: "0x38  â”‚ ShortCode     string     â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  uce_f4: "0x48  â”‚ OriginalURL   string     â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  uce_f5: "0x58  â”‚ UserID        string     â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  uce_cl3: "â”€â”€ cache line 2 boundary (0x80â€“0xBF) â”€â”€" {
    style.fill: "#f3f4f6"
    style.stroke: "#9ca3af"
    style.stroke-dash: 5
    style.font: mono
    style.italic: true
  }
  uce_f6: "0x68  â”‚ UserEmail     string     â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  uce_f7: "0x78  â”‚ ExpiresAt     *time.Time â”‚ +8 B   (pointer; nil = no expiry)" {
    style.fill: "#fed7aa"
    style.stroke: "#c2410c"
    style.font: mono
    style.border-radius: 3
  }
  uce_pad: "0x80  â”‚ â”€â”€ padding    (align)   â”‚ +0 B   (already aligned)" {
    style.fill: "#e5e7eb"
    style.stroke: "#6b7280"
    style.font: mono
    style.italic: true
    style.border-radius: 3
  }
  uce_ann: |'md
**Total: 136 bytes = 0x88**
Spans **3 cache lines** (0â€“63, 64â€“127, 128â€“135+)
Largest alignment: 8 bytes (pointer) â†’ struct align = 8
No internal padding required (all fields naturally aligned)
'| {
    style.fill: "#faf5ff"
    style.stroke: "#7c3aed"
    style.border-radius: 4
  }
  uce_f0 -> uce_f1 -> uce_cl1 -> uce_f2 -> uce_cl2 -> uce_f3 -> uce_f4 -> uce_f5 -> uce_cl3 -> uce_f6 -> uce_f7 -> uce_pad -> uce_ann: {style.opacity: 0}
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# URLClickedEvent  total = 160 bytes
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ucke: URLClickedEvent â€” sizeof = 160 bytes {
  style.fill: "#ecfdf5"
  style.stroke: "#059669"
  style.stroke-width: 2
  style.border-radius: 6

  ucke_f0: "0x00  â”‚ EventType      string    â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  ucke_f1: "0x10  â”‚ CorrelationID  string    â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  ucke_cl1: "â”€â”€ cache line 0 boundary (0x00â€“0x3F) â”€â”€" {
    style.fill: "#f3f4f6"
    style.stroke: "#9ca3af"
    style.stroke-dash: 5
    style.font: mono
    style.italic: true
  }
  ucke_f2: "0x20  â”‚ OccurredAt   time.Time   â”‚ +24 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  ucke_f3: "0x38  â”‚ EventID      string      â”‚ +16 B  (UUID v4 dedup key)" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  ucke_cl2: "â”€â”€ cache line 1 boundary (0x40â€“0x7F) â”€â”€" {
    style.fill: "#f3f4f6"
    style.stroke: "#9ca3af"
    style.stroke-dash: 5
    style.font: mono
    style.italic: true
  }
  ucke_f4: "0x48  â”‚ ShortCode    string      â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  ucke_f5: "0x58  â”‚ UserID       string      â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  ucke_f6: "0x68  â”‚ IPHash       string      â”‚ +16 B  (SHA-256 hex; never raw IP)" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  ucke_cl3: "â”€â”€ cache line 2 boundary (0x80â€“0xBF) â”€â”€" {
    style.fill: "#f3f4f6"
    style.stroke: "#9ca3af"
    style.stroke-dash: 5
    style.font: mono
    style.italic: true
  }
  ucke_f7: "0x78  â”‚ UserAgent    string      â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  ucke_f8: "0x88  â”‚ Referer      string      â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  ucke_cl4: "â”€â”€ cache line 3 boundary (0xC0â€“) â”€â”€" {
    style.fill: "#f3f4f6"
    style.stroke: "#9ca3af"
    style.stroke-dash: 5
    style.font: mono
    style.italic: true
  }
  ucke_ann: |'md
**Total: 160 bytes = 0xA0**
Spans **3 full cache lines** (0â€“63, 64â€“127, 128â€“159)
No padding: all fields are 8-byte aligned
`Referer omitempty` â†’ JSON omitted when len==0; struct field always present
'| {
    style.fill: "#f0fdf4"
    style.stroke: "#059669"
    style.border-radius: 4
  }
  ucke_f0 -> ucke_f1 -> ucke_cl1 -> ucke_f2 -> ucke_f3 -> ucke_cl2 -> ucke_f4 -> ucke_f5 -> ucke_f6 -> ucke_cl3 -> ucke_f7 -> ucke_f8 -> ucke_cl4 -> ucke_ann: {style.opacity: 0}
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# URLDeletedEvent  total = 96 bytes
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ude: URLDeletedEvent â€” sizeof = 96 bytes {
  style.fill: "#fff7ed"
  style.stroke: "#ea580c"
  style.stroke-width: 2
  style.border-radius: 6

  ude_f0: "0x00  â”‚ EventType      string    â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  ude_f1: "0x10  â”‚ CorrelationID  string    â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  ude_cl1: "â”€â”€ cache line 0 boundary (0x00â€“0x3F) â”€â”€" {
    style.fill: "#f3f4f6"
    style.stroke: "#9ca3af"
    style.stroke-dash: 5
    style.font: mono
    style.italic: true
  }
  ude_f2: "0x20  â”‚ OccurredAt   time.Time   â”‚ +24 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  ude_f3: "0x38  â”‚ ShortCode    string      â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  ude_cl2: "â”€â”€ cache line 1 boundary (0x40â€“0x7F) â”€â”€" {
    style.fill: "#f3f4f6"
    style.stroke: "#9ca3af"
    style.stroke-dash: 5
    style.font: mono
    style.italic: true
  }
  ude_f4: "0x48  â”‚ UserID       string      â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  ude_f5: "0x58  â”‚ UserEmail    string      â”‚ +16 B  (avoids cross-svc lookup)" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  ude_ann: |'md
**Total: 96 bytes = 0x60**
Spans **2 cache lines** (0â€“63, 64â€“95)
Smallest of the four event types
No padding; all fields naturally 8-byte aligned
'| {
    style.fill: "#fff7ed"
    style.stroke: "#ea580c"
    style.border-radius: 4
  }
  ude_f0 -> ude_f1 -> ude_cl1 -> ude_f2 -> ude_f3 -> ude_cl2 -> ude_f4 -> ude_f5 -> ude_ann: {style.opacity: 0}
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# MilestoneReachedEvent  total = 128 bytes
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
mre: MilestoneReachedEvent â€” sizeof = 128 bytes {
  style.fill: "#fdf4ff"
  style.stroke: "#9333ea"
  style.stroke-width: 2
  style.border-radius: 6

  mre_f0: "0x00  â”‚ EventType      string    â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  mre_f1: "0x10  â”‚ CorrelationID  string    â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  mre_cl1: "â”€â”€ cache line 0 boundary (0x00â€“0x3F) â”€â”€" {
    style.fill: "#f3f4f6"
    style.stroke: "#9ca3af"
    style.stroke-dash: 5
    style.font: mono
    style.italic: true
  }
  mre_f2: "0x20  â”‚ OccurredAt   time.Time   â”‚ +24 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  mre_f3: "0x38  â”‚ ShortCode    string      â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  mre_cl2: "â”€â”€ cache line 1 boundary (0x40â€“0x7F) â”€â”€" {
    style.fill: "#f3f4f6"
    style.stroke: "#9ca3af"
    style.stroke-dash: 5
    style.font: mono
    style.italic: true
  }
  mre_f4: "0x48  â”‚ UserID       string      â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  mre_f5: "0x58  â”‚ UserEmail    string      â”‚ +16 B" {
    style.fill: "#dbeafe"
    style.stroke: "#2563eb"
    style.font: mono
    style.border-radius: 3
  }
  mre_f6: "0x68  â”‚ Milestone    int         â”‚ +8 B   (int64 on amd64)" {
    style.fill: "#dcfce7"
    style.stroke: "#16a34a"
    style.font: mono
    style.border-radius: 3
  }
  mre_cl3: "â”€â”€ cache line 2 boundary (0x80â€“0xBF) â”€â”€" {
    style.fill: "#f3f4f6"
    style.stroke: "#9ca3af"
    style.stroke-dash: 5
    style.font: mono
    style.italic: true
  }
  mre_f7: "0x70  â”‚ TotalClicks  int64       â”‚ +8 B   (current count)" {
    style.fill: "#dcfce7"
    style.stroke: "#16a34a"
    style.font: mono
    style.border-radius: 3
  }
  mre_pad: "0x78  â”‚ â”€â”€ padding               â”‚ +0 B   (aligned)" {
    style.fill: "#e5e7eb"
    style.stroke: "#6b7280"
    style.font: mono
    style.italic: true
    style.border-radius: 3
  }
  mre_ann: |'md
**Total: 128 bytes = 0x80**
Spans **exactly 2 cache lines** (0â€“63, 64â€“127) âœ“
`int` on amd64 = 8 bytes; `int64` = 8 bytes
No padding anywhere; perfect 8-byte alignment throughout
'| {
    style.fill: "#fdf4ff"
    style.stroke: "#9333ea"
    style.border-radius: 4
  }
  mre_f0 -> mre_f1 -> mre_cl1 -> mre_f2 -> mre_f3 -> mre_cl2 -> mre_f4 -> mre_f5 -> mre_f6 -> mre_cl3 -> mre_f7 -> mre_pad -> mre_ann: {style.opacity: 0}
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Field-type legend
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
legend: |'md
## Field Type Legend
| Color | Type | Size (amd64) | Layout |
|---|---|---|---|
| ðŸ”µ Blue | `string` header | **16 B** | ptr(8) + len(8) |
| ðŸ”µ Blue | `time.Time` | **24 B** | wall(8) + ext(8) + loc*(8) |
| ðŸŸ  Orange | `*time.Time` | **8 B** | pointer only; nil = no expiry |
| ðŸŸ¢ Green | `int` / `int64` | **8 B** | two's-complement integer |
| â¬œ Gray | padding | **0â€“7 B** | compiler-inserted alignment filler |
| â€” dashed | cache line | **64 B** | hardware fetch granularity |

**String payload** (actual character bytes) lives **on the heap**, not in the struct.
These layouts show **header bytes only** â€” stack/inline allocation of the struct value.
`ExpiresAt *time.Time` in URLCreatedEvent: 8 bytes (pointer), pointed-to value on heap.
'| {
  near: bottom-center
  style.fill: "#f8fafc"
  style.stroke: "#64748b"
  style.border-radius: 6
}