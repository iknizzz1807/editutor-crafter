classes: {
  container: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  clock_class: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  value_class: {
    style.fill: "#0f3460"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  metadata_class: {
    style.fill: "#2d3748"
    style.stroke: "#4a5568"
    style.font-color: "#e6edf3"
  }
  arrow: {
    style.stroke: "#8b949e"
  }
}

vector_clock: VectorClock {
  shape: class
  class: clock_class
  - "node_id: string"
  - "counters: Map<string, int>"
  + "increment(): void"
  + "merge(other: VectorClock): void"
  + "compare(other: VectorClock): Ordering"
  + "copy(): VectorClock"
}

versioned_value: VersionedValue {
  shape: class
  class: value_class
  - "value: T"
  - "version: VectorClock"
  - "metadata: VersionMetadata"
  + "is_concurrent_with(other: VersionedValue): bool"
  + "get_value(): T"
  + "get_version(): VectorClock"
}

version_metadata: VersionMetadata {
  shape: class
  class: metadata_class
  - "timestamp: i64"
  - "node_id: string"
  - "operation_id: string"
  - "prunable: bool"
  + "mark_prunable(): void"
  + "get_age(): Duration"
}

node_counter: NodeCounter {
  shape: class
  class: value_class
  - "node_id: string"
  - "counter: int"
  + "increment(): void"
  + "get_counter(): int"
}

clock_ordering: ClockOrdering {
  shape: class
  class: metadata_class
  - "BEFORE: int = -1"
  - "CONCURRENT: int = 0"  
  - "AFTER: int = 1"
  + "from_comparison(a: VectorClock, b: VectorClock): ClockOrdering"
}

conflict_detector: ConflictDetector {
  shape: class
  class: clock_class
  - "conflicts: List<Conflict>"
  + "detect_conflicts(values: List<VersionedValue>): List<Conflict>"
  + "resolve_conflict(conflict: Conflict): VersionedValue"
}

version_store: VersionStore {
  shape: class
  class: container
  - "versions: Map<string, List<VersionedValue>>"
  - "pruning_policy: PruningPolicy"
  + "put(key: string, value: VersionedValue): void"
  + "get_all_versions(key: string): List<VersionedValue>"
  + "prune_old_versions(): void"
}

vector_clock -> node_counter: contains {
  class: arrow
}

versioned_value -> vector_clock: has version {
  class: arrow
}

versioned_value -> version_metadata: contains {
  class: arrow
}

version_store -> versioned_value: stores {
  class: arrow
}

conflict_detector -> versioned_value: analyzes {
  class: arrow
}

vector_clock -> clock_ordering: produces {
  class: arrow
}