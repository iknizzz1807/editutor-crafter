classes: {
  start_end: {
    style.fill: "#3fb950"
    style.stroke: "#2d8a3e"
    style.font-color: "#ffffff"
    style.bold: true
  }
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  layer: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

start: Start Search {
  shape: circle
  class: start_end
}

init_layer: Initialize at Top Layer {
  class: process
}

get_entry: Get Entry Point {
  class: process
}

search_layer: Search Current Layer {
  class: layer
}

explore_neighbors: Explore Neighbors\nof Current Best {
  class: process
}

calc_distance: Calculate Distance\nto Query Vector {
  class: process
}

update_candidates: Update Candidate Set\nwith Closer Vectors {
  class: process
}

local_minimum: Found Local\nMinimum? {
  shape: diamond
  class: decision
}

bottom_layer: At Bottom\nLayer? {
  shape: diamond
  class: decision
}

descend_layer: Descend to\nNext Layer {
  class: process
}

expand_search: Expand Search\nwith ef Parameter {
  class: process
}

more_candidates: More Candidates\nto Explore? {
  shape: diamond
  class: decision
}

return_results: Return K Nearest\nNeighbors {
  class: process
}

end: End {
  shape: circle
  class: start_end
}

start -> init_layer: Begin
init_layer -> get_entry: Start at highest layer
get_entry -> search_layer: Enter layer
search_layer -> explore_neighbors: Begin greedy search
explore_neighbors -> calc_distance: For each neighbor
calc_distance -> update_candidates: Compare distances
update_candidates -> local_minimum: Check convergence

local_minimum -> bottom_layer: Yes - no closer neighbors
local_minimum -> more_candidates: No - continue exploring

more_candidates -> explore_neighbors: Yes - explore next
more_candidates -> bottom_layer: No - layer complete

bottom_layer -> descend_layer: No - go deeper
bottom_layer -> expand_search: Yes - final search

descend_layer -> search_layer: Use best candidates as entry points

expand_search -> more_candidates: Explore ef candidates at layer 0

return_results -> end: Complete search