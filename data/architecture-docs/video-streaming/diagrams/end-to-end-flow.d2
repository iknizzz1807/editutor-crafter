classes: {
  process: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  decision: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  storage: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  
  error: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
}

start: Upload Request {
  shape: circle
  class: process
}

upload_service: Upload Service {
  class: process
}

validate_file: Validate File {
  shape: diamond
  class: decision
}

reject: Reject Upload {
  class: error
}

chunk_upload: Chunk Upload {
  class: process
}

upload_complete: Upload Complete? {
  shape: diamond
  class: decision
}

store_original: Store Original Video {
  shape: cylinder
  class: storage
}

queue_transcode: Queue Transcoding Job {
  shape: queue
  class: process
}

transcoding_service: Transcoding Service {
  class: process
}

create_segments: Create Segments {
  class: process
}

generate_qualities: Generate Multiple Qualities {
  class: process
}

store_segments: Store HLS Segments {
  shape: cylinder
  class: storage
}

update_metadata: Update Video Metadata {
  class: process
}

transcode_complete: Transcoding Complete {
  class: process
}

ready_for_playback: Video Ready {
  shape: circle
  class: process
  style.double-border: true
}

playback_request: Playback Request {
  class: process
}

check_availability: Check Video Available? {
  shape: diamond
  class: decision
}

serve_manifest: Serve HLS Manifest {
  class: process
}

serve_segments: Serve Video Segments {
  class: process
}

not_found: Video Not Found {
  class: error
}

start -> upload_service
upload_service -> validate_file

validate_file -> reject: Invalid
validate_file -> chunk_upload: Valid

chunk_upload -> upload_complete
upload_complete -> chunk_upload: No
upload_complete -> store_original: Yes

store_original -> queue_transcode
queue_transcode -> transcoding_service

transcoding_service -> create_segments
create_segments -> generate_qualities
generate_qualities -> store_segments

store_segments -> update_metadata
update_metadata -> transcode_complete
transcode_complete -> ready_for_playback

playback_request -> check_availability
check_availability -> not_found: No
check_availability -> serve_manifest: Yes

serve_manifest -> serve_segments

directions: {
  right
}