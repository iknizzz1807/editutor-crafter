direction: down
vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 4
  }
}

title: {
  shape: rectangle
  label: "Two-Level Address Decomposition (32-bit)"
  style: {
    font-size: 24
    bold: true
    fill: "#f0f0f0"
  }
}
title.near: top-center

address_space: {
  shape: sql_table
  label: "32-bit Virtual Address (vaddr.h)"
  row1: "bits [31:22] | 10 bits | Directory Index (PDI)"
  row2: "bits [21:12] | 10 bits | Table Index (PTI)"
  row3: "bits [11:00] | 12 bits | Page Offset (OFF)"
  total: "Total: 32-bit word"
  
  style: {
    stroke-width: 2
  }
}

decomposition_logic: {
  shape: class
  label: "C Extraction Logic (mmu.c)"
  
  fields: |'c
    #define PD_SHIFT 22
    #define PT_SHIFT 12
    #define INDEX_MASK 0x3FF
    #define OFF_MASK   0xFFF
  '|
  
  methods: |'c
    uint32_t pd_index(uint32_t v) { return (v >> 22) & 0x3FF; }
    uint32_t pt_index(uint32_t v) { return (v >> 12) & 0x3FF; }
    uint32_t page_offset(uint32_t v) { return v & 0xFFF; }
  '|
}

math_validation: {
  shape: sql_table
  label: "Virtual Memory Capacity Calculation"
  
  dir: "Level 1 (Directory) | 2^10 entries | 1024 regions"
  tab: "Level 2 (Table)     | 2^10 entries | 1024 pages/region"
  off: "Page Size          | 2^12 bytes   | 4096 bytes/page"
  total: "Total Coverage     | 2^32 bytes   | 4.00 GB addressable"
  
  style: {
    fill: "#e1f5fe"
  }
}

address_space -> decomposition_logic: "uint32_t | 4 bytes | 0x004056A8"
decomposition_logic -> math_validation: "Maps to 1,048,576 unique pages"

math_validation.near: bottom-center