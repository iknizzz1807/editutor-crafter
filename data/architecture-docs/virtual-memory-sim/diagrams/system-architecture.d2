direction: right

classes: {
  component: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  cache: {
    style.fill: "#16213e"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  
  storage: {
    style.fill: "#0f3460"
    style.stroke: "#74b9ff"
    style.font-color: "#e6edf3"
  }
  
  flow: {
    style.stroke: "#8b949e"
    style.font-color: "#8b949e"
  }
  
  fast_path: {
    style.stroke: "#00b894"
    style.font-color: "#00b894"
    style.bold: true
  }
  
  slow_path: {
    style.stroke: "#e17055"
    style.font-color: "#e17055"
  }
}

cpu: CPU {
  class: component
}

mmu: Memory Management Unit (MMU) {
  class: component
}

tlb_cache: Translation Lookaside Buffer {
  shape: package
  class: cache
  
  tlb_entries: Recent Translations {
    class: storage
  }
}

page_table_system: Page Table System {
  class: component
  
  page_directory: Page Directory {
    class: storage
  }
  
  page_tables: Page Tables {
    class: storage
  }
}

physical_memory: Physical Memory {
  shape: cylinder
  class: storage
  
  frames: Memory Frames {
    class: storage
  }
}

virtual_addr: Virtual Address\n0x12345678 {
  shape: oval
  class: component
}

physical_addr: Physical Address\n0x87654321 {
  shape: oval
  class: component
}

# Main address translation pipeline
cpu -> mmu: virtual address {
  class: flow
}

mmu -> tlb_cache: check TLB {
  class: fast_path
}

tlb_cache -> mmu: TLB HIT\n(fast path) {
  class: fast_path
}

mmu -> page_table_system: TLB MISS\n(slow path) {
  class: slow_path
}

page_table_system -> physical_memory: lookup page {
  class: slow_path
}

physical_memory -> page_table_system: page frame {
  class: slow_path
}

page_table_system -> tlb_cache: update TLB {
  class: slow_path
}

page_table_system -> mmu: translation result {
  class: slow_path
}

mmu -> physical_memory: physical address {
  class: flow
}

physical_memory -> cpu: data {
  class: flow
}

# Address flow examples
virtual_addr -> mmu {
  class: flow
}

mmu -> physical_addr {
  class: flow
}

# Notes
tlb_note: |md
  **TLB Cache**
  - Stores recent VAâ†’PA mappings
  - 64-256 entries typical
  - Hardware-managed
  - Sub-nanosecond lookup
| {
  shape: page
  near: top-left
  style.fill: "#16213e"
  style.stroke: "#e17055"
  style.font-color: "#ffffff"
}

page_table_note: |md
  **Page Tables**
  - Hierarchical structure
  - 4KB pages typical
  - OS-managed
  - Memory-resident lookup
| {
  shape: page
  near: bottom-center
  style.fill: "#0f3460"
  style.stroke: "#74b9ff"
  style.font-color: "#e6edf3"
}