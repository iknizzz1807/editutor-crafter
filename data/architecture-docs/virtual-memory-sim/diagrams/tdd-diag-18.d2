layout-engine: elk

vars: {
  d2-config: {
    theme-id: 0
  }
}

# --- Comparison Container ---
comparison: "Structural Comparison: PDE vs PTE" {
  style: {
    stroke-width: 0
    fill: transparent
  }

  # --- LEFT COLUMN: PAGE DIRECTORY ENTRY ---
  pde_column: {
    style.stroke-width: 0

    pde_entry: "Page Directory Entry (pde_t)" {
      shape: sql_table
      style: {
        stroke: "#000000"
        stroke-width: 2
      }
      
      "0": "PT_PHYS_BASE [31:12]" {
        width: 20
        style.fill: "#ff9800" # Orange: Pointer
      }
      "2": "Reserved [11:1]" {
        width: 11
        style.fill: "#9e9e9e" # Gray: Padding
      }
      "3": "P [0]" {
        width: 1
        style.fill: "#673ab7" # Purple: Control
      }
      
      |'md
      **Size:** 4 Bytes
      **Role:** Metadata-to-Metadata
      '|
    }

    pt_target: "Page Table (target)" {
      shape: sql_table
      style: {
        stroke: "#000000"
        stroke-dash: 3
      }
      "0x000": "pte_t [0]" { style.fill: "#673ab7" }
      "0x004": "pte_t [1]" { style.fill: "#673ab7" }
      "...": "..."
      "0xFFC": "pte_t [1023]" { style.fill: "#673ab7" }

      |'md
      **Total Size:** 4096B
      Contains 1024 PTEs
      '|
    }

    pde_entry."0" -> pt_target: "points to root of next level" {
      style: {
        stroke: "#ff9800"
        stroke-width: 2
      }
    }
  }

  # --- RIGHT COLUMN: PAGE TABLE ENTRY ---
  pte_column: {
    style.stroke-width: 0

    pte_entry: "Page Table Entry (pte_t)" {
      shape: sql_table
      style: {
        stroke: "#000000"
        stroke-width: 2
      }
      
      "0": "PFN [31:12]" {
        width: 20
        style.fill: "#ff9800" # Orange: Pointer
      }
      "2": "FLAGS [11:0]" {
        width: 12
        style.fill: "#673ab7" # Purple: Control
      }

      |'md
      **Size:** 4 Bytes
      **Role:** Metadata-to-Data
      '|
    }

    frame_target: "Physical Data Frame (target)" {
      shape: sql_table
      style: {
        stroke: "#000000"
        stroke-dash: 0
      }
      "0x000": "Data Chunk" { style.fill: "#2196f3" }
      "...": "User Data Bytes" { style.fill: "#2196f3" }
      "0xFFF": "Data Chunk" { style.fill: "#2196f3" }

      |'md
      **Total Size:** 4096B
      Contains raw program data
      '|
    }

    pte_entry."0" -> frame_target: "points to physical RAM" {
      style: {
        stroke: "#ff9800"
        stroke-width: 2
      }
    }
  }
}

legend: {
  near: bottom-center
  
  ptr: "Pointer (Physical Address)" {
    style.fill: "#ff9800"
  }
  ctrl: "Control/Flags" {
    style.fill: "#673ab7"
  }
  pad: "Padding/Reserved" {
    style.fill: "#9e9e9e"
  }
  data: "User Memory Content" {
    style.fill: "#2196f3"
  }
}