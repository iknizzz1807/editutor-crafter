layout-engine: elk
vars: {
  d2-config: {
    theme-id: 4
    layout-engine: elk
  }
}

# -----------------------------------------------------------------------------
# FIFO REPLACEMENT ALGORITHM TRACE
# Reference String: 7, 0, 1, 2, 0, 3, 0, 4, 2, 3, 0, 3, 2
# -----------------------------------------------------------------------------

Legend: {
  shape: package
  near: top-left
  label: "Notation Guide"
  fault: "FAULT" {
    style: {
      fill: "#ffcccc"
      stroke: red
      bold: true
    }
  }
  hit: "HIT" {
    style: {
      fill: "#ccffcc"
      stroke: green
      bold: true
    }
  }
  change: "Red + Bold = Modified State" {
    style.font-color: red
    style.bold: true
  }
}

Algorithm_Trace: {
  grid-columns: 1
  grid-gap: 20

  Step_01: {
    label: "Step 01: Access VPN 7"
    vpn: "VPN: 7"
    state: "| **7** | - | - |" {
      style.font-color: red
      style.bold: true
    }
    queue: "Oldest [ **7** ] Newest" {
      style.font-color: red
      style.bold: true
    }
    status: "FAULT"
    status.style.fill: "#ffcccc"
    status.style.stroke: red
  }

  Step_02: {
    label: "Step 02: Access VPN 0"
    vpn: "VPN: 0"
    state: "| 7 | **0** | - |" {
      style.font-color: red
      style.bold: true
    }
    queue: "Oldest [ 7 | **0** ] Newest" {
      style.font-color: red
      style.bold: true
    }
    status: "FAULT"
    status.style.fill: "#ffcccc"
    status.style.stroke: red
  }

  Step_03: {
    label: "Step 03: Access VPN 1"
    vpn: "VPN: 1"
    state: "| 7 | 0 | **1** |" {
      style.font-color: red
      style.bold: true
    }
    queue: "Oldest [ 7 | 0 | **1** ] Newest" {
      style.font-color: red
      style.bold: true
    }
    status: "FAULT"
    status.style.fill: "#ffcccc"
    status.style.stroke: red
  }

  Step_04: {
    label: "Step 04: Access VPN 2 (Evict 7)"
    vpn: "VPN: 2"
    state: "| **2** | 0 | 1 |" {
      style.font-color: red
      style.bold: true
    }
    queue: "Oldest [ 0 | 1 | **2** ] Newest" {
      style.font-color: red
      style.bold: true
    }
    status: "FAULT"
    status.style.fill: "#ffcccc"
    status.style.stroke: red
  }

  Step_05: {
    label: "Step 05: Access VPN 0"
    vpn: "VPN: 0"
    state: "| 2 | 0 | 1 |"
    queue: "Oldest [ 0 | 1 | 2 ] Newest"
    status: "HIT"
    status.style.fill: "#ccffcc"
    status.style.stroke: green
  }

  Step_06: {
    label: "Step 06: Access VPN 3 (Evict 0)"
    vpn: "VPN: 3"
    state: "| 2 | **3** | 1 |" {
      style.font-color: red
      style.bold: true
    }
    queue: "Oldest [ 1 | 2 | **3** ] Newest" {
      style.font-color: red
      style.bold: true
    }
    status: "FAULT"
    status.style.fill: "#ffcccc"
    status.style.stroke: red
  }

  Step_07: {
    label: "Step 07: Access VPN 0 (Evict 1)"
    vpn: "VPN: 0"
    state: "| 2 | 3 | **0** |" {
      style.font-color: red
      style.bold: true
    }
    queue: "Oldest [ 2 | 3 | **0** ] Newest" {
      style.font-color: red
      style.bold: true
    }
    status: "FAULT"
    status.style.fill: "#ffcccc"
    status.style.stroke: red
  }

  Step_08: {
    label: "Step 08: Access VPN 4 (Evict 2)"
    vpn: "VPN: 4"
    state: "| **4** | 3 | 0 |" {
      style.font-color: red
      style.bold: true
    }
    queue: "Oldest [ 3 | 0 | **4** ] Newest" {
      style.font-color: red
      style.bold: true
    }
    status: "FAULT"
    status.style.fill: "#ffcccc"
    status.style.stroke: red
  }

  Step_09: {
    label: "Step 09: Access VPN 2 (Evict 3)"
    vpn: "VPN: 2"
    state: "| 4 | **2** | 0 |" {
      style.font-color: red
      style.bold: true
    }
    queue: "Oldest [ 0 | 4 | **2** ] Newest" {
      style.font-color: red
      style.bold: true
    }
    status: "FAULT"
    status.style.fill: "#ffcccc"
    status.style.stroke: red
  }

  Step_10: {
    label: "Step 10: Access VPN 3 (Evict 0)"
    vpn: "VPN: 3"
    state: "| 4 | 2 | **3** |" {
      style.font-color: red
      style.bold: true
    }
    queue: "Oldest [ 4 | 2 | **3** ] Newest" {
      style.font-color: red
      style.bold: true
    }
    status: "FAULT"
    status.style.fill: "#ffcccc"
    status.style.stroke: red
  }

  Step_11: {
    label: "Step 11: Access VPN 0 (Evict 4)"
    vpn: "VPN: 0"
    state: "| **0** | 2 | 3 |" {
      style.font-color: red
      style.bold: true
    }
    queue: "Oldest [ 2 | 3 | **0** ] Newest" {
      style.font-color: red
      style.bold: true
    }
    status: "FAULT"
    status.style.fill: "#ffcccc"
    status.style.stroke: red
  }

  Step_12: {
    label: "Step 12: Access VPN 3"
    vpn: "VPN: 3"
    state: "| 0 | 2 | 3 |"
    queue: "Oldest [ 2 | 3 | 0 ] Newest"
    status: "HIT"
    status.style.fill: "#ccffcc"
    status.style.stroke: green
  }

  Step_13: {
    label: "Step 13: Access VPN 2"
    vpn: "VPN: 2"
    state: "| 0 | 2 | 3 |"
    queue: "Oldest [ 2 | 3 | 0 ] Newest"
    status: "HIT"
    status.style.fill: "#ccffcc"
    status.style.stroke: green
  }

  Step_01 -> Step_02 -> Step_03 -> Step_04 -> Step_05 -> Step_06 -> Step_07 -> Step_08 -> Step_09 -> Step_10 -> Step_11 -> Step_12 -> Step_13
}

Annotation: |md
  ### TECHNICAL INSIGHT: FIFO PITFALL
  FIFO select victims based solely on `load_time`.
  In **Step 05**, VPN 0 is accessed (a Hit). In a smart cache (LRU), this would move VPN 0 to the back of the queue.
  However, in **FIFO**, the queue position remains unchanged. 
  Result: Even though VPN 0 was used at Step 05, it remains the "Oldest" and is evicted in **Step 06** to make room for VPN 3.
| {
  near: bottom-left
}

Summary: {
  shape: sql_table
  near: bottom-right
  Total_Accesses: 13
  Total_Faults: 10
  Fault_Rate: 76.9%
}