direction: down
vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 4
  }
}

title: ||md
  # LRU Replacement Trace
  **Reference String:** 7, 0, 1, 2, 0, 3, 0, 4, 2, 3, 0, 3, 2 | **Frames:** 3
|| {
  near: top-center
}

Legend: {
  near: top-right
  f: "Fault" {style.fill: "#ffcfcf"}
  h: "Hit" {style.fill: "#cfedff"}
  chg: "**Changed**" {style.font-color: red}
}

Trace: {
  grid-columns: 2
  
  S1: "Step 1: R 7" {
    shape: sql_table
    style.fill: "#ffcfcf"
    Access: "7 (T=1)"
    F0: "**7 (LA:1)**" {style.font-color: red}
    F1: "-"
    F2: "-"
    Result: "FAULT"
  }

  S2: "Step 2: R 0" {
    shape: sql_table
    style.fill: "#ffcfcf"
    Access: "0 (T=2)"
    F0: "7 (LA:1)"
    F1: "**0 (LA:2)**" {style.font-color: red}
    F2: "-"
    Result: "FAULT"
  }

  S3: "Step 3: R 1" {
    shape: sql_table
    style.fill: "#ffcfcf"
    Access: "1 (T=3)"
    F0: "7 (LA:1)"
    F1: "0 (LA:2)"
    F2: "**1 (LA:3)**" {style.font-color: red}
    Result: "FAULT"
  }

  S4: "Step 4: R 2" {
    shape: sql_table
    style.fill: "#ffcfcf"
    Access: "2 (T=4)"
    F0: "**2 (LA:4)**" {
      style.font-color: red
      tooltip: "Evicted 7 (min LA=1)"
    }
    F1: "0 (LA:2)"
    F2: "1 (LA:3)"
    Result: "FAULT"
  }

  S5: "Step 5: R 0" {
    shape: sql_table
    style.fill: "#cfedff"
    Access: "0 (T=5)"
    F0: "2 (LA:4)"
    F1: "**0 (LA:5)**" {
      style.font-color: red
      tooltip: "Hit! LA updated"
    }
    F2: "1 (LA:3)"
    Result: "HIT"
  }

  S6: "Step 6: R 3" {
    shape: sql_table
    style.fill: "#ffcfcf"
    Access: "3 (T=6)"
    F0: "2 (LA:4)"
    F1: "0 (LA:5)"
    F2: "**3 (LA:6)**" {
      style.font-color: red
      tooltip: "Evicted 1 (min LA=3)"
    }
    Result: "FAULT"
  }

  S7: "Step 7: R 0" {
    shape: sql_table
    style.fill: "#cfedff"
    Access: "0 (T=7)"
    F0: "2 (LA:4)"
    F1: "**0 (LA:7)**" {
      style.font-color: red
      tooltip: "Hit! LA updated"
    }
    F2: "3 (LA:6)"
    Result: "HIT"
  }

  S8: "Step 8: R 4" {
    shape: sql_table
    style.fill: "#ffcfcf"
    Access: "4 (T=8)"
    F0: "**4 (LA:8)**" {
      style.font-color: red
      tooltip: "Evicted 2 (min LA=4)"
    }
    F1: "0 (LA:7)"
    F2: "3 (LA:6)"
    Result: "FAULT"
  }

  S9: "Step 9: R 2" {
    shape: sql_table
    style.fill: "#ffcfcf"
    Access: "2 (T=9)"
    F0: "4 (LA:8)"
    F1: "0 (LA:7)"
    F2: "**2 (LA:9)**" {
      style.font-color: red
      tooltip: "Evicted 3 (min LA=6)"
    }
    Result: "FAULT"
  }

  S10: "Step 10: R 3" {
    shape: sql_table
    style.fill: "#ffcfcf"
    Access: "3 (T=10)"
    F0: "4 (LA:8)"
    F1: "**3 (LA:10)**" {
      style.font-color: red
      tooltip: "Evicted 0 (min LA=7)"
    }
    F2: "2 (LA:9)"
    Result: "FAULT"
  }

  S11: "Step 11: R 0" {
    shape: sql_table
    style.fill: "#ffcfcf"
    Access: "0 (T=11)"
    F0: "**0 (LA:11)**" {
      style.font-color: red
      tooltip: "Evicted 4 (min LA=8)"
    }
    F1: "3 (LA:10)"
    F2: "2 (LA:9)"
    Result: "FAULT"
  }

  S12: "Step 12: R 3" {
    shape: sql_table
    style.fill: "#cfedff"
    Access: "3 (T=12)"
    F0: "0 (LA:11)"
    F1: "**3 (LA:12)**" {style.font-color: red}
    F2: "2 (LA:9)"
    Result: "HIT"
  }

  S13: "Step 13: R 2" {
    shape: sql_table
    style.fill: "#cfedff"
    Access: "2 (T=13)"
    F0: "0 (LA:11)"
    F1: "3 (LA:12)"
    F2: "**2 (LA:13)**" {style.font-color: red}
    Result: "HIT"
  }
}

Analysis: {
  near: bottom-center
  style.stroke-dash: 5
  label: ||md
    ### Comparative Analysis
    - **Total Faults:** 8 (LRU) vs 9 (FIFO).
    - **Divergence:** At Step 10, LRU keeps VPN 2 and 4 while FIFO would have evicted differently.
    - **Hardware Constraint:** Note that LRU requires updating `last_access` on **EVERY** access. 
    In a 3GHz CPU, this means billions of metadata writes/sec. 
    This O(N) bookkeeping is why real hardware uses **Clock (Second Chance)** approximation instead.
  ||
}

Trace.S1 -> Trace.S2 -> Trace.S3 -> Trace.S4 -> Trace.S5 -> Trace.S6 -> Trace.S7 -> Trace.S8 -> Trace.S9 -> Trace.S10 -> Trace.S11 -> Trace.S12 -> Trace.S13