vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 0
  }
}

direction: right

# PHYSICAL MEMORY LAYOUT: physical_frame_t Array
# Total size: 64 Frames * 4104 Bytes = 262,656 Bytes
# Page Boundary: Bold (4096B intervals)
# Cache Alignment: Dashed (interleaved metadata)

Memory_Space: {
  grid-columns: 1
  grid-gap: 20

  Frame_0: "physical_frame_t [0]" {
    style: {
      stroke: "#662D91"
      stroke-width: 4
      fill: "#E1D5E7"
    }
    
    Layout: {
      grid-columns: 3
      grid-gap: 0
      
      # Offset | Field | Size
      o1: "0x0000" {shape: text; style.font-color: "#666666"}
      f1: "data [4096 Bytes]" {
        style.fill: "#DAE8FC"
        width: 400
      }
      s1: "4096B" {shape: text; style.font-color: "#666666"}

      o2: "0x1000" {shape: text; style.font-color: "#666666"}
      f2: "in_use" {
        style.fill: "#D5E8D4"
        width: 400
      }
      s2: "1B" {shape: text; style.font-color: "#666666"}

      o3: "0x1001" {shape: text; style.font-color: "#666666"}
      f3: "padding" {
        style.fill: "#F5F5F5"
        width: 400
      }
      s3: "7B" {shape: text; style.font-color: "#666666"}
    }
  }

  Cache_Line: "--- Cache Line Boundary (64B) ---" {
    shape: text
    style: {
      stroke-dash: 5
      font-color: "#FF8000"
    }
  }

  Frame_1: "physical_frame_t [1]" {
    style: {
      stroke: "#662D91"
      stroke-width: 4
      fill: "#E1D5E7"
    }
    
    Layout: {
      grid-columns: 3
      grid-gap: 0
      
      o1: "0x1008" {shape: text; style.font-color: "#666666"}
      f1: "data [4096 Bytes]" {style.fill: "#DAE8FC"; width: 400}
      s1: "4096B" {shape: text; style.font-color: "#666666"}

      o2: "0x2008" {shape: text; style.font-color: "#666666"}
      f2: "in_use" {style.fill: "#D5E8D4"; width: 400}
      s2: "1B" {shape: text; style.font-color: "#666666"}

      o3: "0x2009" {shape: text; style.font-color: "#666666"}
      f3: "padding" {style.fill: "#F5F5F5"; width: 400}
      s3: "7B" {shape: text; style.font-color: "#666666"}
    }
  }

  Gap: "... [Frames 2 to 62 omitted] ..." {
    shape: text
    style.italic: true
  }

  Frame_63: "physical_frame_t [63]" {
    style: {
      stroke: "#662D91"
      stroke-width: 4
      fill: "#E1D5E7"
    }
    Layout: {
      grid-columns: 3
      grid-gap: 0
      o1: "0x3F9C0" {shape: text; style.font-color: "#666666"}
      f1: "data [4096 Bytes]" {style.fill: "#DAE8FC"; width: 400}
      s1: "4096B" {shape: text; style.font-color: "#666666"}
      o2: "0x409C0" {shape: text; style.font-color: "#666666"}
      f2: "in_use" {style.fill: "#D5E8D4"; width: 400}
      s2: "1B" {shape: text; style.font-color: "#666666"}
      o3: "0x409C1" {shape: text; style.font-color: "#666666"}
      f3: "padding" {style.fill: "#F5F5F5"; width: 400}
      s3: "7B" {shape: text; style.font-color: "#666666"}
    }
  }
}

Technical_Analysis: |md
  ### Architectural Constraints
  - **Memory Alignment:** Struct is padded to 8-byte alignment (4104B total).
  - **Total Allocation:** 262,656 Bytes (64 frames).
  - **Search Efficiency:** `alloc_free_frame()` uses a linear scan $O(N)$. 
    - Metadata (`in_use`) is interleaved with 4KB data blocks.
    - Each flag resides in a different cache line due to the 4096B offset.
    - **Optimization:** In production, separate metadata into contiguous `struct page` arrays to maximize cache locality and allow $O(1)$ allocation via free-lists.
| {
  style.font-size: 14
}