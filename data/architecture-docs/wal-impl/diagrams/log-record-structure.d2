classes: {
  base_record: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  derived_record: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

LogRecord: "Base Log Record" {
  shape: class
  class: base_record
  - "lsn: u64"
  - "transaction_id: u64"
  - "crc: u32"
  - "magic: u32"
  - "record_type: u8"
  - "payload_length: u32"
  + "validate_crc(): bool"
  + "serialize(): Vec<u8>"
  + "deserialize(data: &[u8]): Result<Self>"
}

RedoRecord: "Redo Record" {
  shape: class
  class: derived_record
  - "table_id: u32"
  - "page_id: u64"
  - "slot_id: u16"
  - "after_image: Vec<u8>"
  + "apply_redo(): Result<()>"
  + "get_affected_page(): PageId"
}

UndoRecord: "Undo Record" {
  shape: class
  class: derived_record
  - "table_id: u32"
  - "page_id: u64"
  - "slot_id: u16"
  - "before_image: Vec<u8>"
  - "undo_next_lsn: u64"
  + "apply_undo(): Result<()>"
  + "get_prev_undo(): LSN"
}

CheckpointRecord: "Checkpoint Record" {
  shape: class
  class: derived_record
  - "active_transactions: Vec<u64>"
  - "dirty_pages: Vec<PageId>"
  - "min_dirty_lsn: u64"
  - "checkpoint_lsn: u64"
  + "get_active_txns(): &Vec<u64>"
  + "is_dirty_page(page_id: PageId): bool"
}

CommitRecord: "Commit Record" {
  shape: class
  class: derived_record
  - "commit_timestamp: u64"
  - "first_lsn: u64"
  - "last_lsn: u64"
  + "finalize_transaction(): Result<()>"
  + "get_commit_time(): Timestamp"
}

AbortRecord: "Abort Record" {
  shape: class
  class: derived_record
  - "abort_timestamp: u64"
  - "first_lsn: u64"
  - "last_undo_lsn: u64"
  + "rollback_transaction(): Result<()>"
  + "get_undo_chain(): LSN"
}

LogRecord -> RedoRecord: inherits {
  style.stroke: "#3fb950"
  style.stroke-dash: 3
}

LogRecord -> UndoRecord: inherits {
  style.stroke: "#3fb950"
  style.stroke-dash: 3
}

LogRecord -> CheckpointRecord: inherits {
  style.stroke: "#3fb950"
  style.stroke-dash: 3
}

LogRecord -> CommitRecord: inherits {
  style.stroke: "#3fb950"
  style.stroke-dash: 3
}

LogRecord -> AbortRecord: inherits {
  style.stroke: "#3fb950"
  style.stroke-dash: 3
}

documentation: |md
  ## Log Record Data Model
  
  **LSN (Log Sequence Number)**: Monotonically increasing 64-bit counter
  
  **Common Header**: All records share magic, type, CRC validation
  
  **Record Types**: Redo (1), Undo (2), Commit (3), Abort (4), Checkpoint (5)
| {
  shape: text
  style.fill: "#0f3460"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  near: top-right
}