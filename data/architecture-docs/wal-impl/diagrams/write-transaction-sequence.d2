shape: sequence_diagram

Client: Client
TransactionManager: Transaction Manager
LogWriter: Log Writer
Database: Database {
  shape: cylinder
}

Client -> TransactionManager: BEGIN TRANSACTION
TransactionManager -> Client: transaction_id

Client -> TransactionManager: WRITE(key, value)
TransactionManager -> LogWriter: append_log_record(txn_id, WRITE, key, value, lsn)
LogWriter -> LogWriter: buffer_record()
LogWriter -> TransactionManager: log_sequence_number

Client -> TransactionManager: WRITE(key2, value2)
TransactionManager -> LogWriter: append_log_record(txn_id, WRITE, key2, value2, lsn)
LogWriter -> LogWriter: buffer_record()
LogWriter -> TransactionManager: log_sequence_number

Client -> TransactionManager: COMMIT
TransactionManager -> LogWriter: append_log_record(txn_id, COMMIT, lsn)
LogWriter -> LogWriter: buffer_record()
TransactionManager -> LogWriter: force_sync()
LogWriter -> LogWriter: fsync()
LogWriter -> TransactionManager: sync_complete

TransactionManager -> Database: apply_changes(key, value)
Database -> TransactionManager: ack
TransactionManager -> Database: apply_changes(key2, value2)
Database -> TransactionManager: ack

TransactionManager -> Client: COMMIT_SUCCESS

Client.style.fill: "#1a1a2e"
Client.style.stroke: "#3fb950"
Client.style.font-color: "#e6edf3"

TransactionManager.style.fill: "#1a1a2e"
TransactionManager.style.stroke: "#3fb950"
TransactionManager.style.font-color: "#e6edf3"

LogWriter.style.fill: "#1a1a2e"
LogWriter.style.stroke: "#3fb950"
LogWriter.style.font-color: "#e6edf3"

Database.style.fill: "#16213e"
Database.style.stroke: "#3fb950"
Database.style.font-color: "#e6edf3"