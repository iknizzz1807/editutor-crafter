title: Error Detection and Recovery Flow

classes: {
  error_node: {
    style.fill: "#d63031"
    style.stroke: "#e17055"
    style.font-color: "#ffffff"
    style.bold: true
  }
  recovery_node: {
    style.fill: "#fdcb6e"
    style.stroke: "#e17055"
    style.font-color: "#2d3436"
  }
  process_node: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  decision_node: {
    style.fill: "#16213e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
  success_node: {
    style.fill: "#00b894"
    style.stroke: "#3fb950"
    style.font-color: "#ffffff"
  }
}

start: Start Compilation {
  shape: circle
  style.fill: "#3fb950"
  style.font-color: "#ffffff"
}

ast_analysis: AST Analysis {
  class: process_node
}

expr_compile: Expression\nCompilation {
  class: process_node
}

binary_emit: Binary Emission {
  class: process_node
}

module_assembly: Module Assembly {
  class: process_node
}

error_detect: Error\nDetected? {
  shape: diamond
  class: decision_node
}

categorize: Categorize Error {
  class: process_node
}

error_categories: Error Categories {
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  syntax_err: Syntax Errors {
    class: error_node
  }
  
  type_err: Type Errors {
    class: error_node
  }
  
  stack_err: Stack Validation\nErrors {
    class: error_node
  }
  
  encoding_err: Encoding Errors {
    class: error_node
  }
}

severity_check: Check Error\nSeverity {
  shape: diamond
  class: decision_node
}

recovery_attempt: Attempt\nRecovery {
  class: recovery_node
}

recovery_success: Recovery\nSuccessful? {
  shape: diamond
  class: decision_node
}

continue_compile: Continue\nCompilation {
  class: process_node
}

accumulate_diag: Accumulate\nDiagnostics {
  class: process_node
}

generate_report: Generate\nDiagnostic Report {
  class: process_node
}

propagate_error: Propagate Error\nto User {
  class: error_node
}

compilation_success: Compilation\nComplete {
  shape: circle
  class: success_node
}

start -> ast_analysis
ast_analysis -> expr_compile
expr_compile -> binary_emit
binary_emit -> module_assembly
module_assembly -> error_detect

ast_analysis -> error_detect: Error found
expr_compile -> error_detect: Error found
binary_emit -> error_detect: Error found

error_detect -> categorize: Yes
error_detect -> compilation_success: No

categorize -> error_categories
error_categories -> severity_check

severity_check -> recovery_attempt: Recoverable
severity_check -> accumulate_diag: Fatal

recovery_attempt -> recovery_success
recovery_success -> continue_compile: Yes
recovery_success -> accumulate_diag: No

continue_compile -> ast_analysis: Resume pipeline
accumulate_diag -> generate_report
generate_report -> propagate_error
propagate_error -> compilation_success: End

error_categories.syntax_err -> severity_check
error_categories.type_err -> severity_check
error_categories.stack_err -> severity_check
error_categories.encoding_err -> severity_check