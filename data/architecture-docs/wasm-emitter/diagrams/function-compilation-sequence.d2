shape: sequence_diagram

classes: {
  phase: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  
  process: {
    style.fill: "#16213e"
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
  
  data: {
    style.fill: "#0f3460"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
  }
}

Compiler: Compiler Frontend {
  class: phase
}

SignatureAnalyzer: Signature Analyzer {
  class: process
}

LocalAllocator: Local Allocator {
  class: process
}

BodyCompiler: Body Compiler {
  class: process
}

BinaryEmitter: Binary Emitter {
  class: process
}

Compiler -> SignatureAnalyzer: analyze function signature
SignatureAnalyzer -> SignatureAnalyzer: extract parameter types
SignatureAnalyzer -> SignatureAnalyzer: determine return type
SignatureAnalyzer -> Compiler: function signature metadata

Compiler -> LocalAllocator: allocate local variables
LocalAllocator -> LocalAllocator: map variables to local indices
LocalAllocator -> LocalAllocator: calculate local counts by type
LocalAllocator -> Compiler: local allocation table

Compiler -> BodyCompiler: compile function body
BodyCompiler -> BodyCompiler: traverse expression tree
BodyCompiler -> BodyCompiler: emit WASM instructions
BodyCompiler -> BodyCompiler: manage stack depth
BodyCompiler -> Compiler: instruction sequence

Compiler -> BinaryEmitter: emit binary code
BinaryEmitter -> BinaryEmitter: encode function header
BinaryEmitter -> BinaryEmitter: encode local declarations
BinaryEmitter -> BinaryEmitter: encode instruction bytes
BinaryEmitter -> BinaryEmitter: calculate function size
BinaryEmitter -> Compiler: binary function data