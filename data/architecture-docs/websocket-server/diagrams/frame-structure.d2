websocket_frame: WebSocket Frame Binary Structure {
  style.fill: "#1a1a2e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  style.bold: true
}

bit_0_15: Bits 0-15 {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  fin_bit: "FIN (1 bit)" {
    style.fill: "#d63031"
    style.font-color: "#ffffff"
    style.stroke: "#e17055"
  }
  
  rsv_bits: "RSV1-3 (3 bits)" {
    style.fill: "#6c5ce7"
    style.font-color: "#ffffff"
    style.stroke: "#a29bfe"
  }
  
  opcode: "Opcode (4 bits)" {
    style.fill: "#00b894"
    style.font-color: "#ffffff"
    style.stroke: "#00cec9"
  }
  
  mask_bit: "MASK (1 bit)" {
    style.fill: "#fdcb6e"
    style.font-color: "#2d3436"
    style.stroke: "#e17055"
  }
  
  payload_len: "Payload Length (7 bits)" {
    style.fill: "#74b9ff"
    style.font-color: "#ffffff"
    style.stroke: "#0984e3"
  }
}

extended_length: Extended Length {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  
  len_16: "16-bit Length\n(if payload = 126)" {
    style.fill: "#74b9ff"
    style.font-color: "#ffffff"
  }
  
  len_64: "64-bit Length\n(if payload = 127)" {
    style.fill: "#74b9ff"
    style.font-color: "#ffffff"
  }
}

masking_key: Masking Key {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#8b949e"
  style.font-color: "#e6edf3"
  
  key_32: "32-bit Key\n(if MASK = 1)" {
    style.fill: "#fdcb6e"
    style.font-color: "#2d3436"
  }
}

payload_data: Payload Data {
  shape: rectangle
  style.fill: "#16213e"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  data: "Application Data\n(masked if client)" {
    style.fill: "#00b894"
    style.font-color: "#ffffff"
  }
}

bit_layout: Bit Layout Details {
  shape: page
  style.fill: "#0f3460"
  style.stroke: "#3fb950"
  style.font-color: "#e6edf3"
  
  label: |md
    ## Frame Structure Details
    
    **FIN**: Final fragment flag (1=complete message)
    **RSV1-3**: Reserved bits (must be 0)
    **Opcode**: Frame type (0x1=text, 0x2=binary, 0x8=close, 0x9=ping, 0xA=pong)
    **MASK**: Payload masking flag (1=masked, required for client frames)
    **Payload Length**: 
    - 0-125: Actual length
    - 126: Next 2 bytes contain 16-bit length
    - 127: Next 8 bytes contain 64-bit length
  |
}

websocket_frame -> bit_0_15: "First 2 bytes"
bit_0_15 -> extended_length: "Optional (based on length)"
extended_length -> masking_key: "If MASK=1"
masking_key -> payload_data: "Application data follows"

bit_0_15.fin_bit -> bit_layout: "Details" {
  style.stroke-dash: 3
  style.stroke: "#8b949e"
}