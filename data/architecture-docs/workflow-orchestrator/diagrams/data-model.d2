direction: right

classes: {
  entity: {
    style.fill: "#1a1a2e"
    style.stroke: "#3fb950"
    style.font-color: "#e6edf3"
    style.bold: true
  }
  relationship: {
    style.stroke: "#8b949e"
    style.font-color: "#e6edf3"
  }
}

dag: DAG {
  shape: sql_table
  class: entity
  id: string {constraint: primary_key}
  name: string
  description: text
  schedule_interval: string
  start_date: datetime
  end_date: datetime
  is_active: boolean
  created_at: datetime
  updated_at: datetime
  owner_id: string {constraint: foreign_key}
}

task: Task {
  shape: sql_table
  class: entity
  id: string {constraint: primary_key}
  dag_id: string {constraint: foreign_key}
  task_id: string
  task_type: string
  command: text
  dependencies: "string[]"
  retry_count: integer
  timeout_seconds: integer
  created_at: datetime
  updated_at: datetime
}

dag_run: DAGRun {
  shape: sql_table
  class: entity
  id: string {constraint: primary_key}
  dag_id: string {constraint: foreign_key}
  run_id: string
  state: string
  execution_date: datetime
  start_date: datetime
  end_date: datetime
  created_by: string
  created_at: datetime
  updated_at: datetime
}

task_instance: TaskInstance {
  shape: sql_table
  class: entity
  id: string {constraint: primary_key}
  dag_run_id: string {constraint: foreign_key}
  task_id: string {constraint: foreign_key}
  state: string
  start_date: datetime
  end_date: datetime
  duration: float
  try_number: integer
  max_tries: integer
  executor: string
  worker_id: string
  log_url: string
  created_at: datetime
  updated_at: datetime
}

user: User {
  shape: sql_table
  class: entity
  id: string {constraint: primary_key}
  username: string
  email: string
  first_name: string
  last_name: string
  is_active: boolean
  role: string
  created_at: datetime
  last_login: datetime
}

dag.owner_id -> user.id: {
  class: relationship
  label: "owned by"
}

task.dag_id -> dag.id: {
  class: relationship
  label: "belongs to"
}

dag_run.dag_id -> dag.id: {
  class: relationship
  label: "instance of"
}

task_instance.dag_run_id -> dag_run.id: {
  class: relationship
  label: "part of"
}

task_instance.task_id -> task.id: {
  class: relationship
  label: "executes"
}

title: Data Model Relationships {
  near: top-center
  style.font-size: 24
  style.font-color: "#e6edf3"
  style.bold: true
}