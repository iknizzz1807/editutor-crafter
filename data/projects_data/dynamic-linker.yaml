id: dynamic-linker
name: Dynamic Linker
description: >
  Build a dynamic linker that loads shared libraries at runtime, resolves
  symbols through GOT/PLT, and implements dlopen/dlsym functionality.

difficulty: advanced
estimated_hours: 50-70
domain: compilers

essence: >
  ELF shared library loading, symbol resolution via Global Offset Table
  (GOT) and Procedure Linkage Table (PLT), relocation processing, runtime
  symbol lookup, and dynamic loading API implementation.

why_important: >
  Understanding dynamic linking is crucial for language runtimes, debuggers,
  and security tools. These skills are valued at $180K-350K+ for systems
  engineers and compiler developers.

learning_outcomes:
  - Parse ELF shared library format
  - Implement relocation processing
  - Build GOT/PLT for symbol resolution
  - Implement dlopen/dlsym API
  - Handle symbol interposition
  - Implement lazy vs immediate binding
  - Handle library dependencies
  - Debug linking issues

skills:
  - ELF Parsing
  - Relocation Processing
  - GOT/PLT Implementation
  - Symbol Resolution
  - Dynamic Loading
  - Dependency Handling
  - Memory Mapping
  - Debugging

tags:
  - advanced
  - compilers
  - dlopen
  - dynamic-linking
  - elf
  - got
  - plt
  - systems

languages:
  recommended:
    - C
    - Rust
  also_possible:
    - C++

resources:
  - name: "How to Write a Shared Library (Ulrich Drepper)"
    url: https://akkadia.org/drepper/dsohowto.pdf
    type: paper
  - name: "ELF Format Specification"
    url: https://refspecs.linuxfoundation.org/elf/elf.pdf
    type: specification
  - name: "Linkers and Loaders (Book)"
    url: https://linker.iecc.com/
    type: book
  - name: "Computer Systems: A Programmer's Perspective"
    url: https://csapp.cs.cmu.edu/
    type: book

prerequisites:
  - type: project
    id: build-linker
    name: Static Linker
  - type: skill
    name: ELF format understanding
  - type: skill
    name: Memory mapping (mmap)
  - type: skill
    name: Function pointers and callbacks

milestones:
  - id: dl-m1
    name: ELF Shared Object Parsing
    description: >
      Parse ELF shared library files and extract symbol and relocation
      information.
    acceptance_criteria:
      - Parse ELF header and program headers
      - Extract dynamic section (dependencies, symbols)
      - Parse symbol table (.dynsym, .symtab)
      - Parse relocation sections (.rela.dyn, .rela.plt)
      - Extract string tables for symbol names
      - Handle both 32-bit and 64-bit ELF
      - Display library dependencies
    pitfalls:
      - 32-bit vs 64-bit structure differences
      - Endianness handling
      - Alignment requirements
      - String table indexing
      - Section vs segment view
    concepts:
      - ELF format
      - Dynamic section
      - Symbol tables
      - Relocations
    skills:
      - ELF parsing
      - Binary format
      - Data extraction
      - Debugging
    deliverables:
      - ELF parser
      - Symbol extractor
      - Relocation reader
      - Dependency lister
    estimated_hours: "10-12"

  - id: dl-m2
    name: Library Loading & Relocation
    description: >
      Load shared libraries into memory and process relocations for
      correct symbol resolution.
    acceptance_criteria:
      - mmap library into executable memory
      - Process RELATIVE relocations
      - Process GLOB_DAT relocations
      - Process JUMP_SLOT relocations
      - Handle copy relocations (COPY)
      - Apply relocations correctly
      - Verify with simple test library
    pitfalls:
      - Memory protection (mprotect)
      - Relocation addend handling
      - Symbol visibility rules
      - Copy relocation edge cases
      - Alignment for SIMD types
    concepts:
      - Memory mapping
      - Relocation types
      - Symbol binding
      - Memory protection
    skills:
      - mmap usage
      - Relocation processing
      - Memory management
      - Verification
    deliverables:
      - Library loader
      - Relocation processor
      - Memory setup
      - Test library
    estimated_hours: "12-14"

  - id: dl-m3
    name: GOT/PLT Implementation
    description: >
      Implement Global Offset Table and Procedure Linkage Table for
      lazy symbol resolution.
    acceptance_criteria:
      - Allocate and populate GOT
      - Set up PLT entries
      - Implement lazy binding resolver
      - Initial PLT entries point to resolver
      - Resolver patches GOT after first call
      - Subsequent calls use resolved address
      - Support both lazy and immediate binding
    pitfalls:
      - GOT/PLT alignment
      - Resolver must preserve registers
      - Thread safety for resolution
      - PLT entry size (16 bytes typically)
      - x86 vs x86-64 PLT differences
    concepts:
      - GOT layout
      - PLT structure
      - Lazy binding
      - Trampolines
    skills:
      - GOT/PLT setup
      - Resolver implementation
      - Assembly integration
      - Thread safety
    deliverables:
      - GOT allocator
      - PLT generator
      - Lazy resolver
      - Binding modes
    estimated_hours: "12-14"

  - id: dl-m4
    name: dlopen/dlsym API
    description: >
      Implement the standard dynamic loading API (dlopen, dlsym, dlclose,
      dlerror) compatible with existing code.
    acceptance_criteria:
      - dlopen loads library by path
      - RTLD_LAZY and RTLD_NOW modes
      - RTLD_LOCAL and RTLD_GLOBAL flags
      - dlsym finds symbol by name
      - dlclose unloads library (refcount)
      - dlerror returns error message
      - Works with existing dlopen code
    pitfalls:
      - Reference counting for handles
      - Symbol lookup order (dependencies)
      - Error handling across API
      - Thread safety
      - Memory leaks on error paths
    concepts:
      - Handle management
      - Symbol lookup
      - Flag handling
      - Error reporting
    skills:
      - API implementation
      - Handle design
      - Lookup algorithm
      - Error handling
    deliverables:
      - dlopen
      - dlsym
      - dlclose
      - dlerror
    estimated_hours: "10-12"

  - id: dl-m5
    name: Dependency Resolution & Production
    description: >
      Implement dependency resolution and add production features for
      a complete dynamic linker.
    acceptance_criteria:
      - Load transitive dependencies
      - Dependency ordering (topological sort)
      - Handle circular dependencies
      - Symbol interposition support
      - rpath/runpath handling
      - Library search path configuration
      - Performance optimization
      - Documentation
    pitfalls:
      - Circular dependency detection
      - Missing dependency errors
      - Symbol version conflicts
      - Search path security
      - Memory overhead from many libraries
    concepts:
      - Dependency graph
      - Symbol interposition
      - Search paths
      - Production features
    skills:
      - Graph algorithms
      - Path resolution
      - Optimization
      - Documentation
    deliverables:
      - Dependency loader
      - Path resolver
      - Configuration
      - Documentation
    estimated_hours: "10-12"
