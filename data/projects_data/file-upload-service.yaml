id: file-upload-service
name: File Upload Service
description: >
  Build a production-ready file upload service supporting chunked uploads,
  multipart form data, presigned URLs, and resume capabilities for
  handling large file transfers reliably.

difficulty: intermediate
estimated_hours: 30-40
domain: app-dev

essence: >
  Chunked upload for large files, resumable uploads after interruption,
  presigned URLs for direct client-to-storage uploads, progress tracking,
  virus scanning integration, and storage backend abstraction.

why_important: >
  File upload is a core feature of many applications. Building it correctly
  with proper error handling and scalability is valuable at $120K-200K+
  for backend engineers at companies dealing with user-generated content.

learning_outcomes:
  - Implement chunked file uploads
  - Handle multipart form data
  - Build presigned URL generation
  - Implement upload resume after failure
  - Track upload progress
  - Integrate virus scanning
  - Abstract storage backends
  - Handle concurrent uploads

skills:
  - Chunked Uploads
  - Multipart Handling
  - Presigned URLs
  - Resume Logic
  - Progress Tracking
  - Storage Abstraction
  - Error Recovery
  - Concurrent Uploads

tags:
  - app-dev
  - file-upload
  - intermediate
  - multipart
  - presigned-urls
  - s3
  - storage
  - uploads

languages:
  recommended:
    - TypeScript
    - Go
    - Python
  also_possible:
    - Rust
    - Java

resources:
  - name: "S3 Presigned URLs"
    url: https://docs.aws.amazon.com/AmazonS3/latest/userguide/using-presigned-url.html
    type: documentation
  - name: "Tus Protocol (Resumable Uploads)"
    url: https://tus.io/
    type: specification
  - name: "MDN: File Upload Forms"
    url: https://developer.mozilla.org/en-US/docs/Web/HTTP/File_uploads
    type: documentation
  - name: "Virus Scanning with ClamAV"
    url: https://www.clamav.net/
    type: documentation

prerequisites:
  - type: skill
    name: Backend web development
  - type: skill
    name: Understanding of HTTP and forms
  - type: skill
    name: Basic cloud storage concepts
  - type: project
    name: http-server-basic or equivalent

milestones:
  - id: fus-m1
    name: Basic File Upload
    description: >
      Implement basic file upload with multipart form data handling
      and storage.
    acceptance_criteria:
      - Multipart form parsing
      - File type validation
      - File size limits enforcement
      - Unique filename generation
      - Local filesystem storage
      - Upload success/error responses
      - Basic security (path traversal prevention)
    pitfalls:
      - Memory issues with large files
      - Path traversal attacks
      - Filename collisions
      - MIME type spoofing
      - Missing cleanup on failure
    concepts:
      - Multipart forms
      - File validation
      - Secure storage
      - Error handling
    skills:
      - Form parsing
      - Validation
      - Storage
      - Security
    deliverables:
      - Upload endpoint
      - Validator
      - Storage module
      - Error responses
    estimated_hours: "6-7"

  - id: fus-m2
    name: Chunked Uploads
    description: >
      Implement chunked upload for large files with progress tracking
      and resume capability.
    acceptance_criteria:
      - Client-side chunk splitting
      - Server-side chunk assembly
      - Chunk order verification
      - Parallel chunk uploads
      - Progress tracking per chunk
      - Resume from interrupted upload
      - Cleanup of incomplete uploads
    pitfalls:
      - Chunk ordering issues
      - Corrupted assembly from missing chunks
      - Storage of incomplete uploads
      - Race conditions in assembly
      - Client/server chunk size mismatch
    concepts:
      - Chunking
      - Assembly
      - Progress tracking
      - Resume
    skills:
      - Chunk handling
      - Assembly logic
      - State management
      - Concurrency
    deliverables:
      - Chunk upload endpoint
      - Assembler
      - Progress tracker
      - Resume handler
    estimated_hours: "7-8"

  - id: fus-m3
    name: Presigned URLs
    description: >
      Implement presigned URL generation for direct client-to-storage
      uploads bypassing the server.
    acceptance_criteria:
      - Presigned URL generation (S3-compatible)
      - URL expiration configuration
      - Content-type restrictions
      - File size limits in URL
      - Callback/webhook on completion
      - Support for both upload and download
      - Security: signed URLs can't be forged
    pitfalls:
      - Expiration too short for large files
      - Unsigned content-type changes
      - Missing completion notification
      - URL leakage allows unauthorized uploads
      - CORS configuration for direct upload
    concepts:
      - Presigned URLs
      - Direct upload
      - Callbacks
      - Security
    skills:
      - URL signing
      - Storage integration
      - Webhook handling
      - Security
    deliverables:
      - URL generator
      - Signature verification
      - Callback handler
      - Download URLs
    estimated_hours: "6-7"

  - id: fus-m4
    name: Storage Abstraction
    description: >
      Build a storage abstraction layer supporting multiple backends
      (local, S3, GCS, etc.).
    acceptance_criteria:
      - Storage interface/trait definition
      - Local filesystem implementation
      - S3-compatible implementation
      - In-memory implementation for testing
      - Configuration-based backend selection
      - Consistent error handling across backends
      - Streaming support for large files
    pitfalls:
      - Inconsistent behavior across backends
      - Missing metadata support
      - Streaming issues with some backends
      - Configuration complexity
      - Testing with mocked storage
    concepts:
      - Abstraction layers
      - Interface design
      - Backend selection
      - Streaming
    skills:
      - Interface design
      - Backend integration
      - Configuration
      - Testing
    deliverables:
      - Storage interface
      - Local backend
      - S3 backend
      - Configuration
    estimated_hours: "6-7"

  - id: fus-m5
    name: Production Features
    description: >
      Add production features including virus scanning, rate limiting,
      and monitoring.
    acceptance_criteria:
      - Virus scanning integration (ClamAV or API)
      - Rate limiting per user/IP
      - Storage quotas per user
      - Upload progress webhooks
      - Metrics (uploads, failures, sizes)
      - Cleanup job for incomplete uploads
      - Documentation and API spec
    pitfalls:
      - Virus scanning latency
      - Rate limiting false positives
      - Quota calculation race conditions
      - Webhook delivery failures
      - Metrics storage overhead
    concepts:
      - Security scanning
      - Rate limiting
      - Quotas
      - Observability
    skills:
      - Scanning integration
      - Rate limiting
      - Monitoring
      - Documentation
    deliverables:
      - Scanner integration
      - Rate limiter
      - Metrics
      - Cleanup job
      - Documentation
    estimated_hours: "6-7"
