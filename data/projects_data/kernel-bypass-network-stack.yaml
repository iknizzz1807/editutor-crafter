id: kernel-bypass-network-stack
name: Kernel Bypass Network Stack
description: >
  Build a user-space TCP/IP stack using kernel bypass techniques (DPDK
  or AF_XDP) for ultra-low latency packet processing in HFT environments.

difficulty: expert
estimated_hours: 100-140
domain: performance-engineering

essence: >
  Direct hardware access via kernel bypass, user-space network stack
  implementation (TCP, UDP, IP, ARP), zero-copy packet processing,
  and poll-mode drivers for minimal latency in the microsecond range.

why_important: >
  This is the holy grail of HFT infrastructure. Engineers who can build
  kernel bypass network stacks earn $400K-1M+ at top trading firms.
  This skill set is extremely rare and highly valued.

learning_outcomes:
  - Understand kernel bypass techniques (DPDK, AF_XDP, io_uring)
  - Implement user-space TCP/IP stack from scratch
  - Build zero-copy packet processing pipelines
  - Implement poll-mode drivers for NICs
  - Handle ARP, IP, TCP, UDP protocols
  - Optimize for microsecond-scale latency
  - Implement TCP congestion control
  - Debug network stack issues at packet level

skills:
  - Kernel Bypass (DPDK/AF_XDP)
  - TCP/IP Implementation
  - Zero-Copy Networking
  - Poll-Mode Drivers
  - Packet Processing
  - Protocol Implementation
  - Latency Optimization
  - Network Debugging

tags:
  - dpdk
  - expert
  - hft
  - kernel-bypass
  - low-latency
  - networking
  - tcp-ip
  - zero-copy

languages:
  recommended:
    - C
    - Rust
  also_possible:
    - C++

resources:
  - name: "DPDK Documentation"
    url: https://doc.dpdk.org/guides/
    type: documentation
  - name: "AF_XDP Documentation"
    url: https://www.kernel.org/doc/html/latest/networking/af_xdp.html
    type: documentation
  - name: "LwIP (Lightweight IP Stack)"
    url: https://savannah.nongnu.org/projects/lwip/
    type: reference
  - name: "TCP/IP Illustrated (Stevens)"
    url: https://www.oreilly.com/library/view/tcpip-illustrated-volume/9780132808200/
    type: book

prerequisites:
  - type: skill
    name: C systems programming
  - type: skill
    name: Network programming fundamentals
  - type: skill
    name: Understanding of Ethernet, IP, TCP protocols
  - type: project
    id: build-tcp-stack
    name: Build TCP Stack (kernel-based)

milestones:
  - id: kbns-m1
    name: Kernel Bypass Setup
    description: >
      Set up kernel bypass infrastructure using DPDK or AF_XDP for
      direct packet access from user space.
    acceptance_criteria:
      - DPDK or AF_XDP initialized and working
      - Network interface bound to user-space driver
      - Packet reception in user space without kernel involvement
      - Packet transmission from user space
      - Zero-copy packet buffer management
      - Performance: packet processing under 2 microseconds
    pitfalls:
      - DPDK requires hugepages and specific kernel config
      - AF_XDP requires newer kernel (4.18+)
      - NIC binding removes interface from kernel networking
      - Driver compatibility varies by NIC vendor
      - Debugging without kernel tools is difficult
    concepts:
      - Kernel bypass
      - User-space drivers
      - Zero-copy buffers
      - Poll-mode operation
    skills:
      - DPDK/AF_XDP setup
      - Driver binding
      - Buffer management
      - Performance measurement
    deliverables:
      - Kernel bypass initialization
      - Packet RX/TX functions
      - Buffer pool
      - Performance benchmark
    estimated_hours: "20-24"

  - id: kbns-m2
    name: Ethernet & ARP Layer
    description: >
      Implement Ethernet frame processing and ARP protocol for
      link-layer communication.
    acceptance_criteria:
      - Ethernet frame parsing (src/dst MAC, ethertype)
      - Ethernet frame construction
      - ARP request/reply handling
      - ARP cache for MAC address lookup
      - Gratuitous ARP for address announcement
      - Handle VLAN tags (optional)
    pitfalls:
      - ARP cache must handle timeouts and invalidation
      - Ethernet padding for minimum frame size
      - MAC address byte order differs by architecture
      - Promiscuous mode needed for all frames
      - ARP spoofing security considerations
    concepts:
      - Ethernet frames
      - MAC addressing
      - ARP protocol
      - Link layer
    skills:
      - Frame parsing
      - ARP implementation
      - Cache design
      - Protocol debugging
    deliverables:
      - Ethernet layer
      - ARP implementation
      - ARP cache
      - Frame construction
    estimated_hours: "12-16"

  - id: kbns-m3
    name: IP & UDP Layer
    description: >
      Implement IPv4 processing and UDP protocol for datagram
      communication.
    acceptance_criteria:
      - IPv4 header parsing and construction
      - IP fragmentation and reassembly
      - IP checksum calculation (optimized)
      - UDP socket implementation
      - UDP checksum (optional but recommended)
      - ICMP echo (ping) response
      - Basic routing table for multi-interface
    pitfalls:
      - IP fragmentation kills performance; avoid with MSS
      - Checksum offload not available in user space
      - IP options rarely used but must handle
      - Fragment reassembly DoS attacks
      - TTL handling and ICMP responses
    concepts:
      - IPv4 protocol
      - Fragmentation
      - UDP protocol
      - ICMP
    skills:
      - IP implementation
      - Fragmentation handling
      - UDP sockets
      - Checksum optimization
    deliverables:
      - IP layer
      - UDP implementation
      - Fragmentation handler
      - ICMP responder
    estimated_hours: "16-20"

  - id: kbns-m4
    name: TCP Implementation
    description: >
      Implement a minimal but functional TCP stack with connection
      management, reliable delivery, and congestion control.
    acceptance_criteria:
      - TCP three-way handshake
      - TCP connection teardown (FIN/RST)
      - Sequence number management
      - Acknowledgment and retransmission
      - Sliding window flow control
      - Basic congestion control (Reno or CUBIC)
      - TCP checksum
      - Support for at least 10K concurrent connections
    pitfalls:
      - TCP state machine is complex; many edge cases
      - Retransmission timeout calculation critical
      - Sequence number wraparound (PAWS)
      - SYN flood attacks; use SYN cookies
      - Zero-window probes for stuck receivers
    concepts:
      - TCP protocol
      - Reliable delivery
      - Flow control
      - Congestion control
    skills:
      - TCP state machine
      - Retransmission
      - Window management
      - Congestion algorithms
    deliverables:
      - TCP state machine
      - Connection manager
      - Retransmission timer
      - Congestion control
    estimated_hours: "24-32"

  - id: kbns-m5
    name: Optimization & Production Hardening
    description: >
      Optimize the stack for ultra-low latency and add production
      features like monitoring, debugging, and failover.
    acceptance_criteria:
      - Latency under 5 microseconds for packet-to-application
      - Batch processing for higher throughput
      - NUMA-aware memory allocation
      - Lock-free data paths
      - Statistics and monitoring (packet rates, errors)
      - Packet capture for debugging
      - Graceful degradation under load
      - Documentation for deployment
    pitfalls:
      - Locks in data path destroy latency
      - Cross-NUMA memory access is slow
      - Batch processing increases latency
      - Statistics collection adds overhead
      - Production NICs behave differently from lab
    concepts:
      - Latency optimization
      - NUMA awareness
      - Lock-free design
      - Production readiness
    skills:
      - Performance optimization
      - Lock-free programming
      - Monitoring
      - Documentation
    deliverables:
      - Optimized data path
      - NUMA configuration
      - Statistics exporter
      - Debug tools
      - Deployment guide
    estimated_hours: "20-28"
