id: zero-copy-msg-bus
name: Zero-Copy Message Bus
description: >
  Build a high-throughput messaging system using zero-copy techniques,
  shared memory IPC, and efficient serialization for inter-process
  communication with minimal latency overhead.

difficulty: advanced
estimated_hours: 50-70
domain: performance-engineering

essence: >
  Shared memory regions for lock-free message passing, flat buffer
  serialization to avoid marshaling overhead, memory-mapped ring buffers,
  and careful memory lifecycle management across process boundaries.

why_important: >
  High-frequency trading, real-time analytics, and low-latency microservices
  require zero-copy IPC. Engineers with these skills earn $250K-500K+ at
  trading firms, cloud providers, and real-time systems companies.

learning_outcomes:
  - Design shared memory regions for IPC
  - Implement lock-free ring buffers in shared memory
  - Build zero-copy serialization format
  - Handle memory lifecycle across processes
  - Implement efficient publish-subscribe patterns
  - Handle process crash recovery
  - Benchmark and optimize for tail latency
  - Implement backpressure and flow control

skills:
  - Shared Memory IPC
  - Zero-Copy Serialization
  - Lock-Free Ring Buffers
  - Memory-Mapped Files
  - Process Coordination
  - Backpressure Handling
  - Crash Recovery
  - Latency Optimization

tags:
  - advanced
  - ipc
  - latency
  - low-latency
  - messaging
  - serialization
  - shared-memory
  - zero-copy

languages:
  recommended:
    - C++
    - Rust
  also_possible:
    - C

resources:
  - name: "LMAX Disruptor Paper"
    url: https://lmax-exchange.github.io/disruptor/files/LMAXDisruptor.pdf
    type: paper
  - name: "FlatBuffers Documentation"
    url: https://flatbuffers.dev/
    type: documentation
  - name: "Boost.Interprocess"
    url: https://www.boost.org/doc/libs/release/doc/html/interprocess.html
    type: documentation
  - name: "Aeron Protocol"
    url: https://github.com/real-logic/aeron
    type: reference

prerequisites:
  - type: skill
    name: C++ or Rust systems programming
  - type: skill
    name: Understanding of virtual memory and memory mapping
  - type: skill
    name: Lock-free programming concepts
  - type: project
    id: message-queue
    name: Message Queue

milestones:
  - id: zcmb-m1
    name: Shared Memory Ring Buffer
    description: >
      Implement a lock-free ring buffer in shared memory for single-producer
      single-consumer message passing between processes.
    acceptance_criteria:
      - Shared memory region created and mapped by multiple processes
      - Lock-free SPSC ring buffer implementation
      - Memory barriers correctly placed for cross-process visibility
      - Handles wraparound correctly
      - Configurable buffer size with power-of-2 requirement
      - Process cleanup on abnormal termination
      - Latency benchmark shows sub-microsecond round-trip
    pitfalls:
      - Memory barriers differ from thread synchronization
      - Process crash leaves shared memory in undefined state
      - False sharing degrades performance
      - Buffer sizing affects tail latency
      - Permission issues with shared memory objects
    concepts:
      - Shared memory
      - Lock-free ring buffer
      - Memory barriers
      - SPSC patterns
    skills:
      - Shared memory IPC
      - Lock-free design
      - Memory mapping
      - Barrier placement
    deliverables:
      - Shared memory allocator
      - SPSC ring buffer
      - Process coordination
      - Latency benchmark
    estimated_hours: "12-14"

  - id: zcmb-m2
    name: Zero-Copy Serialization
    description: >
      Design and implement a flat buffer serialization format that allows
      direct memory access without parsing or copying.
    acceptance_criteria:
      - Flat buffer format with inline data layout
      - No parsing required - direct field access via offsets
      - Schema definition language for message types
      - Code generation for type-safe access
      - Supports nested messages and arrays
      - Backward/forward compatibility for schema evolution
      - Benchmark shows 10x+ faster than JSON/Protobuf parsing
    pitfalls:
      - Alignment requirements for direct field access
      - Endianness considerations for cross-platform
      - Schema evolution complexity
      - Variable-length fields require careful offset handling
      - String handling needs length prefix or null terminator
    concepts:
      - Flat buffers
      - Zero-copy access
      - Schema evolution
      - Code generation
    skills:
      - Serialization design
      - Code generation
      - Binary format
      - Compatibility handling
    deliverables:
      - Flat buffer format spec
      - Schema definition
      - Code generator
      - Serialization benchmark
    estimated_hours: "14-16"

  - id: zcmb-m3
    name: Multi-Producer Multi-Consumer
    description: >
      Extend the ring buffer to support multiple producers and consumers
      with proper synchronization and fairness.
    acceptance_criteria:
      - MPMC ring buffer with lock-free or minimal locking
      - Proper handling of concurrent producers
      - Proper handling of concurrent consumers
      - Fair scheduling between producers
      - Backpressure when consumers can't keep up
      - No message loss under normal operation
      - Performance degrades gracefully under contention
    pitfalls:
      - MPMC contention significantly impacts performance
      - Lock-free MPMC is complex; consider hybrid approaches
      - Starvation possible without fairness mechanisms
      - Memory ordering critical for correctness
      - ABA problem in lock-free implementations
    concepts:
      - MPMC patterns
      - Lock-free MPMC
      - Contention management
      - Fairness
    skills:
      - MPMC implementation
      - Contention handling
      - Lock-free algorithms
      - Testing concurrent code
    deliverables:
      - MPMC ring buffer
      - Backpressure mechanism
      - Contention benchmark
      - Correctness tests
    estimated_hours: "10-14"

  - id: zcmb-m4
    name: Publish-Subscribe & Topics
    description: >
      Build a topic-based pub/sub system on top of the message bus with
      efficient filtering and routing.
    acceptance_criteria:
      - Topic-based message routing
      - Multiple subscribers per topic
      - Pattern-based subscription (wildcards)
      - Message filtering at subscriber level
      - Retained messages for late subscribers
      - Last-will messages for disconnect notification
      - Horizontal scaling support
    pitfalls:
      - Topic matching can be expensive; use efficient data structures
      - Message ordering guarantees across topics
      - Backpressure propagation across subscribers
      - Memory usage with many topics
      - Subscriber registration race conditions
    concepts:
      - Pub/sub patterns
      - Topic routing
      - Message filtering
      - Scalability
    skills:
      - Pub/sub implementation
      - Pattern matching
      - Routing efficiency
      - Distributed patterns
    deliverables:
      - Topic manager
      - Pattern matcher
      - Subscription API
      - Routing benchmark
    estimated_hours: "10-12"

  - id: zcmb-m5
    name: Crash Recovery & Durability
    description: >
      Implement crash recovery mechanisms and optional durability for
      the message bus to handle process failures gracefully.
    acceptance_criteria:
      - Detection of crashed producers/consumers
      - Recovery of in-flight messages where possible
      - Optional persistent storage for durability
      - Checkpoint/restart capability
      - Automatic reconnection on process restart
      - No message duplication (exactly-once semantics option)
      - Recovery time under 100ms for typical scenarios
    pitfalls:
      - Exactly-once semantics very hard to achieve
      - Persistent storage kills performance
      - Crash during recovery corrupts state
      - Distributed crash recovery requires coordination
      - Memory leaks in long-running recovery scenarios
    concepts:
      - Crash recovery
      - Durability
      - Checkpointing
      - Exactly-once semantics
    skills:
      - Recovery design
      - Persistence
      - State management
      - Testing failure scenarios
    deliverables:
      - Crash detection
      - Recovery mechanism
      - Persistence option
      - Failure tests
    estimated_hours: "10-12"
