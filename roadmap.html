<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduTutor Crafter - Learning Roadmap</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0d1117;
            --bg-card: #161b22;
            --bg-card-hover: #1c2128;
            --bg-sidebar: #010409;
            --border: #30363d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --accent: #238636;
            --accent-bright: #3fb950;
            --accent-hover: #2ea043;
            --blue: #58a6ff;
            --purple: #a371f7;
            --orange: #d29922;
            --red: #f85149;
            --beginner: #3fb950;
            --intermediate: #d29922;
            --advanced: #f0883e;
            --expert: #f85149;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 18px;
            color: var(--text-primary);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent-bright), var(--blue));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .progress-overview {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
        }

        .progress-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .progress-bar {
            height: 8px;
            background: var(--bg-card);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-bright), var(--blue));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-text {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        .progress-text strong {
            color: var(--accent-bright);
        }

        .domain-nav {
            padding: 12px 0;
        }

        .nav-section-title {
            padding: 8px 20px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .domain-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.15s ease;
            border-left: 2px solid transparent;
        }

        .domain-item:hover {
            background: var(--bg-card);
        }

        .domain-item.active {
            background: var(--bg-card);
            border-left-color: var(--accent-bright);
        }

        .domain-icon {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        .domain-info {
            flex: 1;
            min-width: 0;
        }

        .domain-name {
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .domain-count {
            font-size: 12px;
            color: var(--text-muted);
        }

        .domain-progress {
            width: 32px;
            height: 32px;
            position: relative;
        }

        .domain-progress svg {
            transform: rotate(-90deg);
        }

        .domain-progress circle {
            fill: none;
            stroke-width: 3;
        }

        .domain-progress .bg {
            stroke: var(--bg-card);
        }

        .domain-progress .fill {
            stroke: var(--accent-bright);
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }

        /* Main Content */
        .main {
            flex: 1;
            margin-left: 280px;
            min-height: 100vh;
        }

        .main-header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-sidebar);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .main-header h1 {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .main-header p {
            color: var(--text-secondary);
            margin-top: 4px;
            font-size: 14px;
        }

        .filters {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 6px 12px;
            border: 1px solid var(--border);
            background: transparent;
            border-radius: 6px;
            font-size: 13px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s ease;
            font-family: inherit;
        }

        .filter-btn:hover {
            border-color: var(--text-muted);
            color: var(--text-primary);
        }

        .filter-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .content {
            padding: 24px 32px;
        }

        /* Project Cards */
        .projects-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .level-group {
            margin-bottom: 32px;
        }

        .level-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        .level-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .level-badge.beginner { background: rgba(63, 185, 80, 0.15); color: var(--beginner); }
        .level-badge.intermediate { background: rgba(210, 153, 34, 0.15); color: var(--intermediate); }
        .level-badge.advanced { background: rgba(240, 136, 62, 0.15); color: var(--advanced); }
        .level-badge.expert { background: rgba(248, 81, 73, 0.15); color: var(--expert); }

        .level-count {
            font-size: 13px;
            color: var(--text-muted);
        }

        .project-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .project-card:hover {
            border-color: var(--text-muted);
        }

        .project-card.expanded {
            border-color: var(--accent-bright);
        }

        .project-header {
            padding: 16px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .project-header:hover {
            background: var(--bg-card-hover);
        }

        .project-checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .project-checkbox:hover {
            border-color: var(--accent-bright);
        }

        .project-checkbox.completed {
            background: var(--accent-bright);
            border-color: var(--accent-bright);
        }

        .project-checkbox.completed::after {
            content: '‚úì';
            color: white;
            font-size: 12px;
            font-weight: 700;
        }

        .project-info {
            flex: 1;
            min-width: 0;
        }

        .project-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .project-title .detailed-badge {
            font-size: 10px;
            padding: 2px 6px;
            background: rgba(88, 166, 255, 0.15);
            color: var(--blue);
            border-radius: 4px;
            font-weight: 500;
        }

        .project-desc {
            font-size: 13px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .project-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-shrink: 0;
        }

        .project-meta span {
            font-size: 12px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .expand-icon {
            color: var(--text-muted);
            font-size: 14px;
            transition: transform 0.2s ease;
        }

        .project-card.expanded .expand-icon {
            transform: rotate(180deg);
        }

        /* Milestone Timeline */
        .project-content {
            display: none;
            border-top: 1px solid var(--border);
            background: var(--bg-sidebar);
        }

        .project-card.expanded .project-content {
            display: block;
        }

        .project-detail-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }

        .detail-stats {
            display: flex;
            gap: 24px;
            margin-bottom: 16px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-icon {
            width: 32px;
            height: 32px;
            background: var(--bg-card);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .stat-info {
            font-size: 13px;
        }

        .stat-info strong {
            display: block;
            color: var(--text-primary);
        }

        .stat-info span {
            color: var(--text-muted);
            font-size: 11px;
        }

        .skills-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .skill-tag {
            padding: 4px 10px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Timeline */
        .milestones-timeline {
            padding: 24px;
        }

        .timeline-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .milestone {
            position: relative;
            padding-left: 40px;
            padding-bottom: 24px;
        }

        .milestone:last-child {
            padding-bottom: 0;
        }

        .milestone::before {
            content: '';
            position: absolute;
            left: 11px;
            top: 28px;
            bottom: 0;
            width: 2px;
            background: var(--border);
        }

        .milestone:last-child::before {
            display: none;
        }

        .milestone-marker {
            position: absolute;
            left: 0;
            top: 0;
            width: 24px;
            height: 24px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .milestone-marker:hover {
            border-color: var(--accent-bright);
            color: var(--accent-bright);
        }

        .milestone.completed .milestone-marker {
            background: var(--accent-bright);
            border-color: var(--accent-bright);
            color: white;
        }

        .milestone.completed::before {
            background: var(--accent-bright);
        }

        .milestone-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .milestone-header {
            padding: 14px 16px;
            cursor: pointer;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 12px;
        }

        .milestone-header:hover {
            background: var(--bg-card-hover);
        }

        .milestone-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .milestone-desc {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .milestone-toggle {
            color: var(--text-muted);
            font-size: 12px;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .milestone-details {
            display: none;
            border-top: 1px solid var(--border);
            padding: 16px;
        }

        .milestone.open .milestone-details {
            display: block;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-section:last-child {
            margin-bottom: 0;
        }

        .detail-section-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .deliverables-list {
            list-style: none;
        }

        .deliverables-list li {
            position: relative;
            padding: 8px 0 8px 24px;
            font-size: 13px;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border);
        }

        .deliverables-list li:last-child {
            border-bottom: none;
        }

        .deliverables-list li::before {
            content: '‚óã';
            position: absolute;
            left: 0;
            color: var(--accent-bright);
        }

        .criteria-list li::before {
            content: '‚úì';
            color: var(--beginner);
        }

        .pitfalls-list li::before {
            content: '‚ö†';
            color: var(--orange);
        }

        /* Hints */
        .hints-section {
            background: var(--bg-sidebar);
            border-radius: 6px;
            overflow: hidden;
        }

        .hint-item {
            border-bottom: 1px solid var(--border);
        }

        .hint-item:last-child {
            border-bottom: none;
        }

        .hint-header {
            padding: 12px 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.15s ease;
        }

        .hint-header:hover {
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .hint-header .level {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hint-header .level-icon {
            font-size: 14px;
        }

        .hint-content {
            display: none;
            padding: 0 14px 14px;
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .hint-content pre {
            background: var(--bg-dark);
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            margin-top: 8px;
            white-space: pre-wrap;
        }

        .hint-content code {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-dark);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }

        .hint-item.open .hint-content {
            display: block;
        }

        .hint-item.open .hint-header {
            background: var(--bg-card);
        }

        /* Mobile */
        .mobile-header {
            display: none;
            padding: 16px 20px;
            background: var(--bg-sidebar);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 200;
        }

        .menu-btn {
            width: 40px;
            height: 40px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--text-primary);
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 99;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar-overlay.open {
                display: block;
            }

            .main {
                margin-left: 0;
            }

            .mobile-header {
                display: flex;
                align-items: center;
                gap: 16px;
            }

            .main-header {
                display: none;
            }

            .content {
                padding: 16px;
            }

            .project-header {
                padding: 14px 16px;
            }

            .project-meta {
                display: none;
            }

            .detail-stats {
                flex-wrap: wrap;
                gap: 12px;
            }

            .milestones-timeline {
                padding: 16px;
            }

            .milestone {
                padding-left: 32px;
            }

            .milestone::before {
                left: 7px;
            }

            .milestone-marker {
                width: 18px;
                height: 18px;
                font-size: 10px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <!-- Mobile Header -->
    <div class="mobile-header">
        <button class="menu-btn" id="menuBtn">‚ò∞</button>
        <span class="logo">
            <span class="logo-icon">üéØ</span>
            EduTutor Crafter
        </span>
    </div>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-icon">üéØ</span>
                EduTutor Crafter
            </div>
        </div>

        <div class="progress-overview">
            <div class="progress-label">Overall Progress</div>
            <div class="progress-bar">
                <div class="progress-fill" id="overallProgress" style="width: 0%"></div>
            </div>
            <div class="progress-text">
                <strong id="completedCount">0</strong> of <span id="totalCount">0</span> milestones completed
            </div>
        </div>

        <nav class="domain-nav">
            <div class="nav-section-title">Domains</div>
            <div id="domainList"></div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main">
        <header class="main-header">
            <h1 id="currentDomainTitle">
                <span id="currentDomainIcon">üìö</span>
                <span id="currentDomainName">Select a Domain</span>
            </h1>
            <p id="currentDomainDesc">Choose a domain from the sidebar to view projects</p>

            <div class="filters">
                <button class="filter-btn active" data-filter="all">All Levels</button>
                <button class="filter-btn" data-filter="beginner">Beginner</button>
                <button class="filter-btn" data-filter="intermediate">Intermediate</button>
                <button class="filter-btn" data-filter="advanced">Advanced</button>
                <button class="filter-btn" data-filter="expert">Expert</button>
            </div>
        </header>

        <div class="content" id="mainContent">
            <div class="empty-state">
                <div class="icon">üëà</div>
                <p>Select a domain from the sidebar to get started</p>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4/dist/js-yaml.min.js"></script>
    <script>
        // State
        let projectsData = null;
        let currentDomain = null;
        let currentFilter = 'all';
        let progress = JSON.parse(localStorage.getItem('edututorProgress') || '{}');

        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const menuBtn = document.getElementById('menuBtn');
        const domainList = document.getElementById('domainList');
        const mainContent = document.getElementById('mainContent');
        const filterBtns = document.querySelectorAll('.filter-btn');

        // Load data
        async function loadData() {
            try {
                const response = await fetch('data/projects.yaml');
                const yamlText = await response.text();
                const data = jsyaml.load(yamlText);

                projectsData = {
                    domains: data.domains,
                    expertProjects: data.expert_projects || {}
                };

                renderDomainNav();
                updateOverallProgress();

                // Auto-select first domain
                if (projectsData.domains.length > 0) {
                    selectDomain(projectsData.domains[0].id);
                }
            } catch (error) {
                console.error('Error loading data:', error);
                mainContent.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">‚ùå</div>
                        <p>Error loading data: ${error.message}</p>
                        <p style="margin-top: 8px; font-size: 12px;">Run: python -m http.server 8000</p>
                    </div>
                `;
            }
        }

        // Render domain navigation
        function renderDomainNav() {
            domainList.innerHTML = projectsData.domains.map(domain => {
                const projectCount = countProjects(domain);
                const completedCount = countCompletedMilestones(domain);
                const totalMilestones = countTotalMilestones(domain);
                const progressPct = totalMilestones > 0 ? (completedCount / totalMilestones) * 100 : 0;
                const circumference = 2 * Math.PI * 12;
                const offset = circumference - (progressPct / 100) * circumference;

                return `
                    <div class="domain-item" data-domain="${domain.id}">
                        <span class="domain-icon">${domain.icon}</span>
                        <div class="domain-info">
                            <div class="domain-name">${domain.name}</div>
                            <div class="domain-count">${projectCount} projects</div>
                        </div>
                        <div class="domain-progress">
                            <svg width="32" height="32" viewBox="0 0 32 32">
                                <circle class="bg" cx="16" cy="16" r="12"/>
                                <circle class="fill" cx="16" cy="16" r="12"
                                    stroke-dasharray="${circumference}"
                                    stroke-dashoffset="${offset}"/>
                            </svg>
                        </div>
                    </div>
                `;
            }).join('');

            // Add click handlers
            document.querySelectorAll('.domain-item').forEach(item => {
                item.addEventListener('click', () => {
                    selectDomain(item.dataset.domain);
                    closeSidebar();
                });
            });
        }

        // Select domain
        function selectDomain(domainId) {
            currentDomain = projectsData.domains.find(d => d.id === domainId);
            if (!currentDomain) return;

            // Update active state
            document.querySelectorAll('.domain-item').forEach(item => {
                item.classList.toggle('active', item.dataset.domain === domainId);
            });

            // Update header
            document.getElementById('currentDomainIcon').textContent = currentDomain.icon;
            document.getElementById('currentDomainName').textContent = currentDomain.name;
            document.getElementById('currentDomainDesc').textContent = currentDomain.subdomains.map(s => typeof s === 'string' ? s : s.name).join(' ‚Ä¢ ');

            renderProjects();
        }

        // Render projects
        function renderProjects() {
            if (!currentDomain) return;

            const levels = currentFilter === 'all'
                ? ['beginner', 'intermediate', 'advanced', 'expert']
                : [currentFilter];

            let html = '';

            levels.forEach(level => {
                const projects = currentDomain.projects[level] || [];
                if (projects.length === 0) return;

                html += `
                    <div class="level-group">
                        <div class="level-header">
                            <span class="level-badge ${level}">${level}</span>
                            <span class="level-count">${projects.length} projects</span>
                        </div>
                        <div class="projects-grid">
                            ${projects.map(project => renderProjectCard(project, level)).join('')}
                        </div>
                    </div>
                `;
            });

            if (!html) {
                html = `
                    <div class="empty-state">
                        <div class="icon">üì≠</div>
                        <p>No projects found for this filter</p>
                    </div>
                `;
            }

            mainContent.innerHTML = html;

            // Add event listeners
            document.querySelectorAll('.project-header').forEach(header => {
                header.addEventListener('click', (e) => {
                    if (e.target.closest('.project-checkbox')) return;
                    const card = header.closest('.project-card');
                    card.classList.toggle('expanded');
                });
            });

            document.querySelectorAll('.project-checkbox').forEach(checkbox => {
                checkbox.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const projectId = checkbox.dataset.project;
                    toggleProjectCompletion(projectId);
                });
            });

            document.querySelectorAll('.milestone-header').forEach(header => {
                header.addEventListener('click', () => {
                    const milestone = header.closest('.milestone');
                    milestone.classList.toggle('open');
                });
            });

            document.querySelectorAll('.milestone-marker').forEach(marker => {
                marker.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const milestoneId = marker.dataset.milestone;
                    toggleMilestoneCompletion(milestoneId);
                });
            });

            document.querySelectorAll('.hint-header').forEach(header => {
                header.addEventListener('click', () => {
                    const hint = header.closest('.hint-item');
                    hint.classList.toggle('open');
                });
            });
        }

        // Render project card
        function renderProjectCard(project, level) {
            const expertData = projectsData.expertProjects[project.id];
            const isCompleted = progress[project.id]?.completed;
            const milestoneCount = expertData?.milestones?.length || 0;
            const completedMilestones = expertData?.milestones?.filter((_, i) =>
                progress[`${project.id}-m${i}`]?.completed
            ).length || 0;

            return `
                <div class="project-card" data-project="${project.id}">
                    <div class="project-header">
                        <div class="project-checkbox ${isCompleted ? 'completed' : ''}" data-project="${project.id}"></div>
                        <div class="project-info">
                            <div class="project-title">
                                ${project.name}
                                ${project.detailed ? '<span class="detailed-badge">Detailed</span>' : ''}
                            </div>
                            <div class="project-desc">${project.description || ''}</div>
                        </div>
                        <div class="project-meta">
                            ${milestoneCount > 0 ? `<span>üìã ${completedMilestones}/${milestoneCount}</span>` : ''}
                            ${expertData?.estimated_hours ? `<span>‚è±Ô∏è ${expertData.estimated_hours}h</span>` : ''}
                        </div>
                        <span class="expand-icon">‚ñº</span>
                    </div>

                    ${expertData ? renderProjectContent(project, expertData) : ''}
                </div>
            `;
        }

        // Render project content (milestones)
        function renderProjectContent(project, expertData) {
            return `
                <div class="project-content">
                    <div class="project-detail-header">
                        <div class="detail-stats">
                            <div class="stat-item">
                                <div class="stat-icon">‚è±Ô∏è</div>
                                <div class="stat-info">
                                    <strong>${expertData.estimated_hours || '?'} hours</strong>
                                    <span>Estimated time</span>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">üìã</div>
                                <div class="stat-info">
                                    <strong>${expertData.milestones?.length || 0} milestones</strong>
                                    <span>Total steps</span>
                                </div>
                            </div>
                            ${expertData.difficulty ? `
                                <div class="stat-item">
                                    <div class="stat-icon">üìä</div>
                                    <div class="stat-info">
                                        <strong>${expertData.difficulty}</strong>
                                        <span>Difficulty</span>
                                    </div>
                                </div>
                            ` : ''}
                        </div>

                        ${expertData.skills?.length > 0 ? `
                            <div class="skills-list">
                                ${expertData.skills.map(skill => `<span class="skill-tag">${skill}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>

                    <div class="milestones-timeline">
                        <div class="timeline-title">üìç Milestones</div>
                        ${(expertData.milestones || []).map((m, idx) => renderMilestone(project.id, m, idx)).join('')}
                    </div>
                </div>
            `;
        }

        // Render milestone
        function renderMilestone(projectId, milestone, idx) {
            const milestoneId = `${projectId}-m${idx}`;
            const isCompleted = progress[milestoneId]?.completed;

            return `
                <div class="milestone ${isCompleted ? 'completed' : ''}" data-milestone-id="${milestoneId}">
                    <div class="milestone-marker" data-milestone="${milestoneId}">${idx + 1}</div>
                    <div class="milestone-card">
                        <div class="milestone-header">
                            <div>
                                <div class="milestone-title">${milestone.name}</div>
                                <div class="milestone-desc">${milestone.description || ''}</div>
                            </div>
                            <span class="milestone-toggle">‚ñº</span>
                        </div>

                        <div class="milestone-details">
                            ${milestone.skills?.length > 0 ? `
                                <div class="detail-section">
                                    <div class="detail-section-title">üéØ Skills</div>
                                    <div class="skills-list">
                                        ${milestone.skills.map(s => `<span class="skill-tag">${s}</span>`).join('')}
                                    </div>
                                </div>
                            ` : ''}

                            ${milestone.deliverables?.length > 0 ? `
                                <div class="detail-section">
                                    <div class="detail-section-title">üì¶ Deliverables</div>
                                    <ul class="deliverables-list">
                                        ${milestone.deliverables.map(d => `<li>${d}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}

                            ${milestone.criteria?.length > 0 ? `
                                <div class="detail-section">
                                    <div class="detail-section-title">‚úÖ Acceptance Criteria</div>
                                    <ul class="deliverables-list criteria-list">
                                        ${milestone.criteria.map(c => `<li>${c}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}

                            ${milestone.hints ? `
                                <div class="detail-section">
                                    <div class="detail-section-title">üí° Hints (Progressive)</div>
                                    <div class="hints-section">
                                        ${milestone.hints.level1 ? `
                                            <div class="hint-item">
                                                <div class="hint-header">
                                                    <span class="level"><span class="level-icon">üå±</span> Level 1 - Gentle Nudge</span>
                                                    <span>‚ñº</span>
                                                </div>
                                                <div class="hint-content">${formatHint(milestone.hints.level1)}</div>
                                            </div>
                                        ` : ''}
                                        ${milestone.hints.level2 ? `
                                            <div class="hint-item">
                                                <div class="hint-header">
                                                    <span class="level"><span class="level-icon">üåø</span> Level 2 - More Detail</span>
                                                    <span>‚ñº</span>
                                                </div>
                                                <div class="hint-content">${formatHint(milestone.hints.level2)}</div>
                                            </div>
                                        ` : ''}
                                        ${milestone.hints.level3 ? `
                                            <div class="hint-item">
                                                <div class="hint-header">
                                                    <span class="level"><span class="level-icon">üå≥</span> Level 3 - Full Guidance</span>
                                                    <span>‚ñº</span>
                                                </div>
                                                <div class="hint-content">${formatHint(milestone.hints.level3)}</div>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            ` : ''}

                            ${milestone.pitfalls?.length > 0 ? `
                                <div class="detail-section">
                                    <div class="detail-section-title">‚ö†Ô∏è Common Pitfalls</div>
                                    <ul class="deliverables-list pitfalls-list">
                                        ${milestone.pitfalls.map(p => `<li>${p}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}

                            ${milestone.concepts?.length > 0 ? `
                                <div class="detail-section">
                                    <div class="detail-section-title">üìö Key Concepts</div>
                                    <div class="skills-list">
                                        ${milestone.concepts.map(c => `<span class="skill-tag">${c}</span>`).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // Escape HTML special characters
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Format hint text (handle code blocks)
        function formatHint(text) {
            if (!text) return '';

            // First, extract and preserve code blocks
            const codeBlocks = [];
            text = text.replace(/```(\w*)\n?([\s\S]*?)```/g, (match, lang, code) => {
                const placeholder = `__CODE_BLOCK_${codeBlocks.length}__`;
                codeBlocks.push(`<pre><code>${escapeHtml(code)}</code></pre>`);
                return placeholder;
            });

            // Extract and preserve inline code
            const inlineCode = [];
            text = text.replace(/`([^`]+)`/g, (match, code) => {
                const placeholder = `__INLINE_CODE_${inlineCode.length}__`;
                inlineCode.push(`<code>${escapeHtml(code)}</code>`);
                return placeholder;
            });

            // Escape remaining HTML in text
            text = escapeHtml(text);

            // Restore code blocks
            codeBlocks.forEach((block, i) => {
                text = text.replace(`__CODE_BLOCK_${i}__`, block);
            });

            // Restore inline code
            inlineCode.forEach((code, i) => {
                text = text.replace(`__INLINE_CODE_${i}__`, code);
            });

            // Convert line breaks
            text = text.replace(/\n/g, '<br>');
            return text;
        }

        // Toggle completion
        function toggleProjectCompletion(projectId) {
            if (!progress[projectId]) {
                progress[projectId] = { completed: false };
            }
            progress[projectId].completed = !progress[projectId].completed;
            saveProgress();
            renderProjects();
            renderDomainNav();
            updateOverallProgress();
        }

        function toggleMilestoneCompletion(milestoneId) {
            if (!progress[milestoneId]) {
                progress[milestoneId] = { completed: false };
            }
            progress[milestoneId].completed = !progress[milestoneId].completed;
            saveProgress();
            renderProjects();
            renderDomainNav();
            updateOverallProgress();
        }

        function saveProgress() {
            localStorage.setItem('edututorProgress', JSON.stringify(progress));
        }

        // Count helpers
        function countProjects(domain) {
            return ['beginner', 'intermediate', 'advanced', 'expert'].reduce((sum, level) => {
                return sum + (domain.projects[level]?.length || 0);
            }, 0);
        }

        function countTotalMilestones(domain) {
            let count = 0;
            ['beginner', 'intermediate', 'advanced', 'expert'].forEach(level => {
                (domain.projects[level] || []).forEach(project => {
                    const expertData = projectsData.expertProjects[project.id];
                    if (expertData?.milestones) {
                        count += expertData.milestones.length;
                    }
                });
            });
            return count;
        }

        function countCompletedMilestones(domain) {
            let count = 0;
            ['beginner', 'intermediate', 'advanced', 'expert'].forEach(level => {
                (domain.projects[level] || []).forEach(project => {
                    const expertData = projectsData.expertProjects[project.id];
                    if (expertData?.milestones) {
                        expertData.milestones.forEach((_, i) => {
                            if (progress[`${project.id}-m${i}`]?.completed) {
                                count++;
                            }
                        });
                    }
                });
            });
            return count;
        }

        function updateOverallProgress() {
            let totalMilestones = 0;
            let completedMilestones = 0;

            projectsData.domains.forEach(domain => {
                totalMilestones += countTotalMilestones(domain);
                completedMilestones += countCompletedMilestones(domain);
            });

            const pct = totalMilestones > 0 ? (completedMilestones / totalMilestones) * 100 : 0;

            document.getElementById('overallProgress').style.width = pct + '%';
            document.getElementById('completedCount').textContent = completedMilestones;
            document.getElementById('totalCount').textContent = totalMilestones;
        }

        // Mobile sidebar
        menuBtn.addEventListener('click', () => {
            sidebar.classList.add('open');
            sidebarOverlay.classList.add('open');
        });

        sidebarOverlay.addEventListener('click', closeSidebar);

        function closeSidebar() {
            sidebar.classList.remove('open');
            sidebarOverlay.classList.remove('open');
        }

        // Filter buttons
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                renderProjects();
            });
        });

        // Initialize
        loadData();
    </script>
</body>
</html>
